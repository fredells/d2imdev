cscope 15 $HOME/d2imdev/mapedit/src -q 0000002036 0000610709
	@anim.c

1 
	~<°rög.h
>

2 
	~"°ru˘s.h
"

3 
	~"dccöfo.h
"

4 
	~"misc.h
"

5 
	~"dc6öfo.h
"

6 
	~"™imd©a.h
"

7 
	~"™im.h
"

12 
	$™im_lﬂd_dcc
(

13 * 
«me
,

14 
COF_S
 * 
cof
,

15 
œy_idx
,

16 
u£r_dú
,

17 
UBYTE
 * 
∑lshi·


20 
LAY_INF_S
 * 
œy
;

21 
DCC_S
 * 
dcc
;

22 
íåy
, 
i
, 
size
, 
w
, 
h
, 
x
, 
y
;

23 * 
buff
;

24 
dú
 = 0, 
Àn
;

27 i‡((
cof
 =
NULL
Ë|| (
œy_idx
 >
COMPOSIT_NB
))

29 
œy
 = & 
cof
->
œy_öf
[
œy_idx
];

32 
íåy
 = 
	`misc_lﬂd_mpq_fûe
(
«me
, & 
buff
, & 
Àn
, 
FALSE
);

33 i‡(
íåy
 == -1)

53 
dcc
 = 
	`dcc_mem_lﬂd
(
buff
, 
Àn
);

54 
	`‰ì
(
buff
);

55 i‡(
dcc
 =
NULL
)

59 
cof
->
dú
)

62 1 : 
dú
 = 
glb_ds1edô
.
√w_dú1
[
u£r_dú
]; ;

63 4 : 
dú
 = 
glb_ds1edô
.
√w_dú4
[
u£r_dú
]; ;

64 8 : 
dú
 = 
glb_ds1edô
.
√w_dú8
[
u£r_dú
]; ;

65 16 : 
dú
 = 
glb_ds1edô
.
√w_dú16
[
u£r_dú
]; ;

66 32 : 
dú
 = 
glb_ds1edô
.
√w_dú32
[
u£r_dú
]; ;

70 i‡(
	`dcc_decode
(
dcc
, 1 << 
dú
))

72 
	`dcc_de°roy
(
dcc
);

77 
size
 = 
dcc
->
hódî
.
‰ames_≥r_dú
 * (
BITMAP
 *);

78 
œy
->
bmp_num
 = 
dcc
->
hódî
.
‰ames_≥r_dú
;

79 
œy
->
bmp
 = (
BITMAP
 **Ë
	`mÆloc
(
size
);

80 i‡(
œy
->
bmp
 =
NULL
)

82 
	`dcc_de°roy
(
dcc
);

85 
	`mem£t
(
œy
->
bmp
, 0, 
size
);

88 
w
 = 
dcc
->
‰ame
[
dú
][0].
bmp
->w;

89 
h
 = 
dcc
->
‰ame
[
dú
][0].
bmp
->h;

90 
œy
->
off_x
 = 
dcc
->
dúe˘i⁄
[
dú
].
box
.
xmö
;

91 
œy
->
off_y
 = 
dcc
->
dúe˘i⁄
[
dú
].
box
.
ymö
;

92 
i
=0; i < 
dcc
->
hódî
.
‰ames_≥r_dú
; i++)

95 
œy
->
bmp
[
i
] = 
	`¸óã_bôm≠
(
w
, 
h
);

97 i‡(
œy
->
bmp
[
i
] =
NULL
){

98 
i
)

100 
i
--;

101 
	`de°roy_bôm≠
(
œy
->
bmp
[
i
]);

103 
	`dcc_de°roy
(
dcc
);

107 i‡(
∑lshi·
){

108 
y
=0; y<
h
; y++)

109 
x
=0; x<
w
; x++)

110 
	`puçixñ
(
œy
->
bmp
[
i
], 
x
, 
y
, 
∑lshi·
[
	`gëpixñ
(
dcc
->
‰ame
[
dú
][i].bmp, x, y)]);

113 
	`blô
(
dcc
->
‰ame
[
dú
][
i
].
bmp
, 
œy
->bmp[i], 0, 0, 0, 0, 
w
, 
h
);

118 
	`dcc_de°roy
(
dcc
);

120 
	}
}

124 
COF_S
 * 
	$™im_lﬂd_cof
(* 
ba£
, * 
tok
, * 
mod
, * 
˛as
, 
u£r_dú
, 
obj_löe
, 
¥ogªss
)

126 
TXT_S
 * 
txt
 = 
glb_ds1edô
.
obj_buff
;

127 
TXT_S
 * 
txt2
 = 
glb_ds1edô
.
obje˘s_buff
;

129 
COF_S
 * 
cof
;

130 * 
buff
;

131 * 
b±r
;

132 * 
•å
;

133 * 
∑l_«me
;

134 * 
∑l_buff
;

135 * 
Õå
;

137 
™imd©a_«me
[80];

138 
«me
[256];

139 
∑l_idx
=0;

140 
∑l_Àn
;

141 
id
;

142 
löe
;

143 
™imd©a_Âd
;

144 
™imd©a_•ìd
;

145 
Àn
;

147 
i
;

148 
size
;

149 
íåy
;

150 
idx
;

151 
d⁄e
;

152 
mode
;

154 
comp_°r
[
COMPOSIT_NB
][3] = {

159 i‡(
¥ogªss
) {

160 
	`¥ötf
("\n");

164 
∑l_buff
 = 
NULL
;

165 i‡(
txt
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Cﬁ‹m≠")].
size
 &&Åxt->col[misc_get_txt_column_num(RQ_OBJ, "Index")].size) {

166 
∑l_«me
 = 
txt
->
d©a
 + (
obj_löe
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Cﬁ‹m≠")].
off£t
;

167 
•å
 = 
txt
->
d©a
 + (
obj_löe
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Index")].
off£t
;

168 
∑l_idx
 = * ((*Ë
•å
);

169 i‡(
∑l_«me
[0] && 
∑l_idx
) {

170 i‡(
¥ogªss
) {

171 
	`¥ötf
("lﬂd cﬁ‹m≠ <%s>, wû»u£ index %li\n", 
∑l_«me
, 
∑l_idx
);

172 
	`fÊush
(
°dout
);

174 
íåy
 = 
	`misc_lﬂd_mpq_fûe
(
∑l_«me
, & 
∑l_buff
, & 
∑l_Àn
, 
¥ogªss
);

175 i‡(
íåy
 != -1) {

177 
∑l_idx
 = (pal_idx - 1) * 256;

178 i‡((
∑l_idx
 + 255Ë>
∑l_Àn
) {

179 
	`‰ì
(
∑l_buff
);

180 
∑l_buff
 = 
NULL
;

182 } i‡(
¥ogªss
) {

183 
	`¥ötf
(" (couldn'tÜoadÅhe colormap)\n");

184 
	`fÊush
(
°dout
);

191 
	`•rötf
–
«me
, "%s\\%s\\Cof\\%s%s%s.cof", 
ba£
, 
tok
,Åok, 
mod
, 
˛as
 );

197 i‡(
¥ogªss
) {

198 
	`¥ötf
("\∆ﬂd COF <%s>\n", 
«me
);

199 
	`fÊush
(
°dout
);

202 
íåy
 = 
	`misc_lﬂd_mpq_fûe
(
«me
, & 
buff
, & 
Àn
, 
¥ogªss
);

203 i‡(
íåy
 == -1) {

204  
NULL
;

208 
size
 = (
COF_S
);

209 
cof
 = (
COF_S
 *Ë
	`mÆloc
(
size
);

210 i‡(
cof
 =
NULL
) {

211 
	`‰ì
(
buff
);

212  
NULL
;

214 
	`mem£t
(
cof
, 0, 
size
);

218 
cof
->
cur_dú
 = 
u£r_dú
;

220 
b±r
 = 
buff
;

223 
cof
->
œy
 = * 
b±r
;

224 
b±r
++;

243 
cof
->
Âd
 = * 
b±r
;

246 
cof
->
cur_‰ame
 = 
	`ønd
(Ë% cof->
Âd
;

247 
b±r
++;

251 
cof
->
dú
 = * 
b±r
;

252 
b±r
++;

255 
b±r
 += 25;

260 
i
=0; i < 
cof
->
œy
; i++) {

272 
idx
 = * 
b±r
;

273 
b±r
++;

276 
cof
->
œy_öf
[
idx
].
shad_a
 = * 
b±r
;

277 
b±r
++;

278 
cof
->
œy_öf
[
idx
].
shad_b
 = * 
b±r
;

279 
b±r
++;

282 
cof
->
œy_öf
[
idx
].
å™s_a
 = * 
b±r
;

283 
b±r
++;

284 
cof
->
œy_öf
[
idx
].
å™s_b
 = * 
b±r
;

285 
b±r
++;

289 
	`mem˝y
(
cof
->
œy_öf
[
idx
].
w˛ass
, 
b±r
, 4);

290 
b±r
 += 4;

294 
•å
 = 
txt
->
d©a
 + (
obj_löe
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "HD"Ë+ 
idx
].
off£t
;

295 
	`•rötf
(
«me
, "%s\\%s\\%s\\%s%s%s%s%s.dcc", 
ba£
, 
tok
, 
comp_°r
[
idx
],Åok, comp_°r[idx], 
•å
, 
mod
, 
cof
->
œy_öf
[idx].
w˛ass
);

297 i‡(
¥ogªss
) {

298 
	`¥ötf
("\∆ﬂd DCC <%s>\n", 
«me
);

299 
	`fÊush
(
°dout
);

302 i‡(
	`°æí
(
«me
)) {

303 i‡((
∑l_buff
 !
NULL
Ë&& (
cof
->
œy_öf
[
idx
].
å™s_a
 == 0)) {

306 i‡(
	`™im_lﬂd_dcc
(
«me
, 
cof
, 
idx
, 
u£r_dú
, (
UBYTE
 *Ë(
∑l_buff
 + 
∑l_idx
))) {

308 
	`¥ötf
("DEBUG: +++++++++++++++++++++++++++++++++++++++++++++++++++++++\n");

309 
	`¥ötf
("DEBUG: LOADING FAIL....\n");

310 
«me
[
	`°æí
(name) - 1] = '6';

311 
	`¥ötf
("DEBUG: TRY LOADING <%s>\n",
«me
);

312 
	`¥ötf
("DEBUG: +++++++++++++++++++++++++++++++++++++++++++++++++++++++\n");

313 
	`™im_lﬂd_dc6
(
«me
, 
cof
, 
idx
, 
u£r_dú
, (
UBYTE
 *Ë(
∑l_buff
 + 
∑l_idx
));

319 i‡(
	`™im_lﬂd_dcc
(
«me
, 
cof
, 
idx
, 
u£r_dú
, 
NULL
)) {

324 
	`¥ötf
("DEBUG: +++++++++++++++++++++++++++++++++++++++++++++++++++++++\n");

325 
	`¥ötf
("DEBUG: LOADING FAIL....\n");

326 
«me
[
	`°æí
(name) - 1] = '6';

327 
	`¥ötf
("DEBUG: TRY LOADING <%s>\n",
«me
);

328 
	`¥ötf
("DEBUG: +++++++++++++++++++++++++++++++++++++++++++++++++++++++\n");

332 
	`™im_lﬂd_dc6
(
«me
, 
cof
, 
idx
, 
u£r_dú
, 
NULL
);

341 
b±r
 +
cof
->
Âd
;

349 
size
 = 
cof
->
dú
 * cof->
Âd
 * cof->
œy
;

350 
cof
->
¥i‹ôy
 = (
UBYTE
 *Ë
	`mÆloc
(
size
);

351 i‡(
cof
->
¥i‹ôy
 =
NULL
) {

352 
	`‰ì
(
cof
);

353 
	`‰ì
(
buff
);

354  
NULL
;

358 
	`mem˝y
(
cof
->
¥i‹ôy
, 
b±r
, 
size
);

362 
cof
->
•d_mul
 = 1;

363 
cof
->
•d_div
 = 256;

366 
cof
->
xoff£t
 = cof->
yoff£t
 = 0;

369 
	`•rötf
(
™imd©a_«me
, "%s%s%s", 
tok
, 
mod
, 
˛as
);

370 i‡(
	`™imd©a_gë_cof_öfo
(
™imd©a_«me
, & 
™imd©a_Âd
, & 
™imd©a_•ìd
) == 0) {

373 
cof
->
•d_mul
 = 
™imd©a_•ìd
;

374 
cof
->
•d_div
 = 256;

378 
•å
 = 
txt
->
d©a
 + (
obj_löe
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
glb_ds1edô
.
cﬁ_obj_id
].
off£t
;

379 
Õå
 = (*Ë
•å
;

380 
id
 = * 
Õå
;

381 
	`¥ötf
("obje˘ %†ID = %li\n", 
«me
, 
id
);

385 i‡(
	`°ricmp
(
mod
, "NU") == 0) {

386 
mode
 = 0;

387 } i‡(
	`°ricmp
(
mod
, "OP") == 0) {

388 
mode
 = 1;

389 } i‡(
	`°ricmp
(
mod
, "ON") == 0) {

390 
mode
 = 2;

391 } i‡(
	`°ricmp
(
mod
, "S1") == 0) {

392 
mode
 = 3;

393 } i‡(
	`°ricmp
(
mod
, "S2") == 0) {

394 
mode
 = 4;

395 } i‡(
	`°ricmp
(
mod
, "S3") == 0) {

396 
mode
 = 5;

397 } i‡(
	`°ricmp
(
mod
, "S4") == 0) {

398 
mode
 = 6;

399 } i‡(
	`°ricmp
(
mod
, "S5") == 0) {

400 
mode
 = 7;

404 
	`‰ì
(
buff
);

405 i‡(
∑l_buff
) {

406 
	`‰ì
(
∑l_buff
);

408  
cof
;

412 i‡(
id
) {

413 
d⁄e
 = 
FALSE
;

414 
i
 = 0;

415 
löe
 = 0;

416 
glb_ds1edô
.
obj_desc
[
obj_löe
].
obje˘s_löe
 = -1;

417  ! 
d⁄e
) {

418 
•å
 = 
txt2
->
d©a
 + (
i
 *Åxt2->
löe_size
Ë+Åxt2->
cﬁ
[
glb_ds1edô
.
cﬁ_obje˘s_id
].
off£t
;

419 
Õå
 = (*Ë
•å
;

420 i‡–(* 
Õå
Ë=
id
) {

421 
d⁄e
 = 
TRUE
;

422 
löe
 = 
i
;

424 
i
++;

425 i‡(
i
 >
txt2
->
löe_num
) {

427 
	`‰ì
(
buff
);

428 i‡(
∑l_buff
) {

429 
	`‰ì
(
∑l_buff
);

431  
cof
;

435 
glb_ds1edô
.
obj_desc
[
obj_löe
].
obje˘s_löe
 = 
löe
;

438 
•å
 = 
txt2
->
d©a
 + (
löe
 *Åxt2->
löe_size
Ë+Åxt2->
cﬁ
[
glb_ds1edô
.
cﬁ_‰ame_dñè
[
mode
]].
off£t
;

439 
Õå
 = (*Ë
•å
;

440 
cof
->
•d_mul
 = (* 
Õå
) == 0 ? 256 : (*Üptr);

443 
cof
->
•d_div
 = 256;

446 i‡(
txt2
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "Xoff£t")].
size
) {

447 
•å
 = 
txt2
->
d©a
 + (
löe
 *Åxt2->
löe_size
Ë+Åxt2->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "Xoff£t")].
off£t
;

448 
Õå
 = (*Ë
•å
;

449 
cof
->
xoff£t
 = * 
Õå
;

451 i‡(
txt2
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "Yoff£t")].
size
) {

452 
•å
 = 
txt2
->
d©a
 + (
löe
 *Åxt2->
löe_size
Ë+Åxt2->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "Yoff£t")].
off£t
;

453 
Õå
 = (*Ë
•å
;

454 
cof
->
yoff£t
 = * 
Õå
;

458 i‡(
txt2
->
cﬁ
[
glb_ds1edô
.
cﬁ_‹dîÊag
[
mode
]].
size
) {

459 
•å
 = 
txt2
->
d©a
 + (
löe
 *Åxt2->
löe_size
Ë+Åxt2->
cﬁ
[
glb_ds1edô
.
cﬁ_‹dîÊag
[
mode
]].
off£t
;

460 
Õå
 = (*Ë
•å
;

461 
cof
->
‹dîÊag
 = * 
Õå
;

465 i‡–* 
Õå
 == 0) {

466 i‡(
txt2
->
cﬁ
[
glb_ds1edô
.
cﬁ_‹dîÊag
[0]].
size
) {

467 
•å
 = 
txt2
->
d©a
 + (
löe
 *Åxt2->
löe_size
Ë+Åxt2->
cﬁ
[
glb_ds1edô
.
cﬁ_‹dîÊag
[0]].
off£t
;

468 
Õå
 = (*Ë
•å
;

469 
cof
->
‹dîÊag
 = * 
Õå
;

473 
	`¥ötf
("obje˘ %†‹dîÊag = %li\n", 
«me
, 
cof
->
‹dîÊag
);

478 
	`‰ì
(
buff
);

479 i‡(
∑l_buff
) {

480 
	`‰ì
(
∑l_buff
);

482  
cof
;

483 
	}
}

487 
COF_S
 * 
	$™im_lﬂd_desc_gfx
(
i
, 
¥ogªss
)

489 
TXT_S
 * 
txt
 = 
glb_ds1edô
.
obj_buff
;

490 
COF_S
 * 
cof
 = 
NULL
;

491 * 
ba£
;

492 * 
tok
;

493 * 
mod
;

494 * 
˛as
;

495 *
•å
;

496 * 
dú±r
;

498 
dú
;

501 i‡(
txt
 =
NULL
) {

502  
NULL
;

505 
ba£
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Ba£")].
off£t
;

506 
tok
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Tokí")].
off£t
;

507 
mod
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Mode")].
off£t
;

508 
˛as
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Cœss")].
off£t
;

509 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Dúe˘i⁄")].
off£t
;

511 
dú±r
 = (*Ë
•å
;

513 
dú
 = 0;

514 i‡(
txt
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Dúe˘i⁄")].
size
) {

515 
dú
 = * 
dú±r
;

518 i‡(
ba£
[0] && 
tok
[0] && 
mod
[0] && 
˛as
[0]) {

519 
cof
 = 
	`™im_lﬂd_cof
(
ba£
, 
tok
, 
mod
, 
˛as
, 
dú
, 
i
, 
¥ogªss
);

522  
cof
;

523 
	}
}

527 
	$™im_de°roy_cof
(
COF_S
 * 
cof
)

529 
BITMAP
 ** 
bmp
;

531 
b
, 
max_b
, 
c
;

532 
size
 = 0;

534 i‡(
cof
 =
NULL
) {

539 
c
=0; c < 
COMPOSIT_NB
; c++) {

541 
bmp
 = 
cof
->
œy_öf
[
c
].bmp;

542 i‡(
bmp
 !
NULL
) {

543 
max_b
 = 
cof
->
œy_öf
[
c
].
bmp_num
;

544 
b
=0; b < 
max_b
; b++) {

545 i‡(
bmp
[
b
] !
NULL
) {

546 
size
 +(
BITMAP
);

547 
size
 +
bmp
[
b
]->
w
 * bmp[b]->
h
;

548 
	`de°roy_bôm≠
(
bmp
[
b
]);

551 
size
 +
max_b
 *  (
BITMAP
 *);

552 
	`‰ì
(
bmp
);

557 i‡(
cof
->
¥i‹ôy
 !
NULL
) {

558 
size
 +
cof
->
dú
 * cof->
Âd
 * cof->
œy
;

559 
	`‰ì
(
cof
->
¥i‹ôy
);

563 
size
 +(
COF_S
);

564 
	`‰ì
(
cof
);

567  
size
;

568 
	}
}

572 
	$™im_upd©e_gfx
(
¥ogªss
)

574 
COF_S
 * 
cof
;

575 
TXT_S
 * 
txt
 = 
glb_ds1edô
.
obj_buff
;

577 
d
, 
od
, 
o
, 
idx
;

578 
ds1_™im_u£d
;

580 i‡(
txt
 =
NULL
) {

585 
od
=0; od < 
txt
->
löe_num
; od++) {

589 
glb_ds1edô
.
obj_desc
[
od
].
ußge_cou¡
 = 0;

598 
d
=0; d < 
DS1_MAX
; d++) {

599 i‡(
glb_ds1
[
d
].
«me
[0] == 0) {

602 
o
=0; o < 
glb_ds1
[
d
].
obj_num
; o++) {

603 
idx
 = 
glb_ds1
[
d
].
obj
[
o
].
desc_idx
;

604 i‡(
idx
 != -1) {

606 
glb_ds1edô
.
obj_desc
[
idx
].
ußge_cou¡
++;

612 
od
=0; od < 
txt
->
löe_num
; od++) {

613 
cof
 = 
glb_ds1edô
.
obj_desc
[
od
].cof;

614 i‡(
glb_ds1edô
.
obj_desc
[
od
].
ußge_cou¡
 == 0) {

616 i‡(
cof
 !
NULL
) {

618 
	`™im_de°roy_cof
(
cof
);

619 
glb_ds1edô
.
obj_desc
[
od
].
cof
 = 
NULL
;

623 i‡(
cof
 =
NULL
) {

627 
glb_ds1edô
.
obj_desc
[
od
].
cof
 = 
	`™im_lﬂd_desc_gfx
(od, 
¥ogªss
);

628 i‡(
¥ogªss
) {

629 
	`Ârötf
(
°dîr
, ".");

630 
	`fÊush
(
°dîr
);

637 
d
=0; d < 
DS1_MAX
; d++)

639 i‡(
glb_ds1
[
d
].
«me
[0] == 0)

641 
ds1_™im_u£d
 = 
FALSE
;

642 
o
=0; o < 
glb_ds1
[
d
].
obj_num
; o++)

644 
idx
 = 
glb_ds1
[
d
].
obj
[
o
].
desc_idx
;

645 i‡(
idx
 != -1)

647 i‡(
glb_ds1edô
.
obj_desc
[
idx
].
cof
 !
NULL
)

649 
ds1_™im_u£d
 = 
TRUE
;

650 
o
 = 
glb_ds1
[
d
].
obj_num
;

654 i‡(
ds1_™im_u£d
 =
FALSE
)

655 
glb_ds1
[
d
].
™im©i⁄s_œyî_mask
 = 0;

657 
	}
}

661 
	$™im_exô
()

663 
TXT_S
 * 
txt
 = 
glb_ds1edô
.
obj_buff
;

664 
COF_S
 * 
cof
;

665 
i
, 
size
 = 0;

668 i‡(
txt
 =
NULL
)

670 i‡(
glb_ds1edô
.
obj_desc
 =
NULL
)

673 
i
=0; i < 
txt
->
löe_num
; i++)

675 
cof
 = 
glb_ds1edô
.
obj_desc
[
i
].cof;

676 i‡(
cof
 !
NULL
)

678 
size
 +
	`™im_de°roy_cof
(
cof
);

679 
glb_ds1edô
.
obj_desc
[
i
].
cof
 = 
NULL
;

682  
size
;

683 
	}
}

	@anim.h

1 #i‚de‡
_ANIM_H_


3 
	#_ANIM_H_


	)

5 
™im_lﬂd_dcc
 (* 
«me
, 
COF_S
 * 
cof
, 
œy_idx
, 
u£r_dú
, 
UBYTE
 * 
∑lshi·
);

6 
COF_S
 * 
™im_lﬂd_cof
 (* 
ba£
, * 
tok
, * 
mod
, * 
˛as
, 
u£r_dú
, 
obj_löe
, 
¥ogªss
);

7 
COF_S
 * 
™im_lﬂd_desc_gfx
 (
i
, 
¥ogªss
);

8 
™im_de°roy_cof
 (
COF_S
 * 
cof
);

9 
™im_upd©e_gfx
 (
¥ogªss
);

10 
™im_exô
 ();

	@animdata.c

1 
	~<°rög.h
>

2 
	~<˘y≥.h
>

3 
	~"°ru˘s.h
"

4 
	~"misc.h
"

5 
	~"™imd©a.h
"

9 
UBYTE
 
	$™imd©a_hash_vÆue
(* 
«me
)

272 
i
;

273 
nb
 = 
	`°æí
(
«me
);

274 
UBYTE
 
hash
 = 0;

277 
i
=0; i < 
	`°æí
(
«me
); i++) {

278 i‡(
«me
[
i
] == '.') {

279 
nb
 = 
i
;

285 
i
=0; i < 
nb
; i++) {

286 
hash
 +
	`touµî
(
«me
[
i
]);

288  
hash
;

289 
	}
}

293 
	$™imd©a_lﬂd
()

297 * 
«me
 = "Data\\Global\\AnimData.d2";

298 
™imd©a_«me
[10];

299 
ANIM_DATA_RECORD_S
 * 
ªc_±r
 = 
NULL
;

300 * 
Õå
;

302 
nb_ªc
;

303 
íåy
, 
d⁄e
 = 
FALSE
, 
cuº_block
 = 0;

304 
UBYTE
 
hash
;

308 i‡(
glb_ds1edô
.
™im_d©a
.
buf„r
 !
NULL
) {

309 
	`‰ì
(
glb_ds1edô
.
™im_d©a
.
buf„r
);

313 
	`mem£t
–& 
glb_ds1edô
.
™im_d©a
, 0, (glb_ds1edit.anim_data) );

314 
íåy
 = 
	`misc_lﬂd_mpq_fûe
–
«me
, (**Ë& 
glb_ds1edô
.
™im_d©a
.
buf„r
, & glb_ds1edô.™im_d©a.
buf„r_size
, 
FALSE
 );

315 i‡((
íåy
 =-1Ë|| (
glb_ds1edô
.
™im_d©a
.
buf„r_size
 <= 4)) {

316 
	`¥ötf
("îr‹ : couldn'àlﬂd <%s>\n", 
«me
);

319 
	`¥ötf
("ok, <%s> found\n", 
«me
);

323 
Õå
 = ((*Ë
glb_ds1edô
.
™im_d©a
.
buf„r
);

325  !
d⁄e
) {

327 
nb_ªc
 = * 
Õå
;

328 
Õå
++;

330 
™imd©a_«me
[0] = '\0';

332 i‡(
nb_ªc
) {

341 
ªc_±r
 = (
ANIM_DATA_RECORD_S
 *Ë
Õå
;

342 
	`mem£t
(
™imd©a_«me
, 0, (animdata_name));

343 
	`°∫˝y
(
™imd©a_«me
, 
ªc_±r
->
cof_«me
, 8);

345 
hash
 = 
	`™imd©a_hash_vÆue
(
™imd©a_«me
);

347 
hash
 = 0;

351 
	`¥ötf
(" block %3i:ánimd©a_«mê%10s, hash = %5i,Çb_ªc‹d†%5li\n", 
cuº_block
, 
™imd©a_«me
, 
hash
, 
nb_ªc
);

611 
	`fÊush
(
°dout
);

612 
cuº_block
++;

615 i‡(
nb_ªc
) {

618 
glb_ds1edô
.
™im_d©a
.
block_poöãr
[
hash
] = 
ªc_±r
;

619 
glb_ds1edô
.
™im_d©a
.
nb_ªc‹ds
[
hash
] = 
nb_ªc
;

625 
Õå
 +40 * 
nb_ªc
;

626 i‡–(
UBYTE
 *Ë
Õå
 >((UBYTE *Ë
glb_ds1edô
.
™im_d©a
.
buf„r
 + glb_ds1edô.™im_d©a.
buf„r_size
) ) {

627 
d⁄e
 = 
TRUE
;

630 
	`¥ötf
("\n");

631 
	}
}

637 
	$™imd©a_gë_cof_öfo
(* 
«me
, * 
Âd
, * 
•ìd
)

646 
ANIM_DATA_RECORD_S
 * 
ªc_±r
;

647 
UBYTE
 
hash
;

648 
i
;

649 
ªc_«me
[80];

652 
hash
 = 
	`™imd©a_hash_vÆue
(
«me
);

653 
	`¥ötf
("%†i†hash %i", 
«me
, 
hash
);

654 i‡(
glb_ds1edô
.
™im_d©a
.
block_poöãr
[
hash
])

656 
ªc_±r
 = 
glb_ds1edô
.
™im_d©a
.
block_poöãr
[
hash
];

657 
i
=0; i < 
glb_ds1edô
.
™im_d©a
.
nb_ªc‹ds
[
hash
]; i++)

659 
	`mem£t
(
ªc_«me
, 0, (rec_name));

660 
	`°∫˝y
(
ªc_«me
, 
ªc_±r
[
i
].
cof_«me
, 8);

661 i‡(
	`°ricmp
(
ªc_«me
, 
«me
) == 0)

663 * 
Âd
 = 
ªc_±r
[
i
].
‰ames_≥r_dú
;

664 * 
•ìd
 = 
ªc_±r
[
i
].speed;

665 
	`¥ötf
(",Ñec‹d %òöÅh© block\n", 
i
);

666 
	`fÊush
(
°dout
);

671 * 
Âd
 = 0;

672 * 
•ìd
 = 0;

673 
	`¥ötf
(", butÉrror :Çot found inÅhere\n");

674 
	`fÊush
(
°dout
);

676 
	}
}

	@animdata.h

1 #i‚de‡
_ANIMDATA_H_


3 
	#_ANIMDATA_H_


	)

5 
UBYTE
 
™imd©a_hash_vÆue
 (* 
«me
);

6 
™imd©a_lﬂd
 ();

7 
™imd©a_gë_cof_öfo
 (* 
«me
, * 
Âd
, * 
•ìd
);

	@dc6info.c

1 
	~"°ru˘s.h
"

2 
	~"misc.h
"

3 
	~"dc6öfo.h
"

7 
	$dc6_decomp_n‹m
(* 
§c
, 
BITMAP
 * 
d°
, 
size
, 
x0
, 
y0
)

9 
UBYTE
 * 
±r
 = (UBYTE *Ë
§c
;

10 
i
;

11 
i2
, 
x
=
x0
, 
y
=
y0
, 
c
, 
c2
;

14 
i
=0; i<
size
; i++)

26 
c
 = * (
±r
 ++);

28 i‡(
c
 == 0x80) {

31 
x
 = 
x0
;

32 
y
--;

33 } i‡(
c
 & 0x80){

34 
x
 +
c
 & 0x7F;

36 
i2
=0; i2<
c
; i2++)

38 
c2
 = * (
±r
 ++);

39 
i
++;

40 
	`puçixñ
(
d°
, 
x
, 
y
, 
c2
);

41 
x
++;

45 
	}
}

50 
	$dc6_decomp_cm≠
(* 
§c
, 
BITMAP
 * 
d°
, 
size
, 
x0
, 
y0
,

51 
UBYTE
 * 
cm≠
)

53 
UBYTE
 * 
±r
 = (UBYTE *Ë
§c
;

54 
i
;

55 
i2
, 
x
=
x0
, 
y
=
y0
, 
c
, 
c2
;

58 
i
=0; i<
size
; i++)

60 
c
 = * (
±r
 ++);

62 i‡(
c
 == 0x80)

64 
x
 = 
x0
;

65 
y
--;

67 i‡(
c
 & 0x80)

68 
x
 +
c
 & 0x7F;

71 
i2
=0; i2<
c
; i2++)

73 
c2
 = * (
±r
 ++);

74 
i
++;

75 
	`puçixñ
(
d°
, 
x
, 
y
, 
cm≠
[
c2
]);

76 
x
++;

80 
	}
}

85 
	$™im_lﬂd_dc6
(* 
«me
, 
COF_S
 * 
cof
, 
œy_idx
, 
u£r_dú
,

86 
UBYTE
 * 
∑lshi·
)

88 
LAY_INF_S
 * 
œy
;

89 
íåy
, 
i
, 
size
, 
w
, 
h
, 
x1
, 
y1
, 
x2
, 
y2
;

90 * 
buff
;

91 
dú
 = 0, * 
Õå
, 
off£t
, 
Àn
;

92 
dc6_vî
, 
dc6_unk1
, 
dc6_unk2
, 
dc6_dú
, 
dc6_Âd
, * 
dc6_Âå
,

93 
f_w
, 
f_h
, 
f_offx
, 
f_offy
, 
f_x1
, 
f_x2
, 
f_y1
, 
f_y2
,

94 
f_Àn
;

95 
UBYTE
 * 
f_d©a
;

98 i‡((
cof
 =
NULL
Ë|| (
œy_idx
 >
COMPOSIT_NB
))

100 
œy
 = & 
cof
->
œy_öf
[
œy_idx
];

104 
íåy
 = 
	`misc_lﬂd_mpq_fûe
(
«me
, & 
buff
, & 
Àn
, 
FALSE
);

105 i‡(
íåy
 == -1)

109 
Õå
 = (*Ë
buff
;

111 
dc6_vî
 = 
Õå
[0];

113 
dc6_unk1
 = 
Õå
[1];

114 
dc6_unk2
 = 
Õå
[2];

116 
dc6_dú
 = 
Õå
[4];

117 
dc6_Âd
 = 
Õå
[5];

123 
dc6_Âå
 = & 
Õå
[6];

125 i‡((
dc6_vî
 !6Ë|| (
dc6_unk1
 !1Ë|| (
dc6_unk2
 != 0))

127 
	`‰ì
(
buff
);

132 i‡(
dc6_dú
 !
cof
->
dú
)

134 
	`‰ì
(
buff
);

139 
cof
->
dú
)

141 1 : 
dú
 = 
glb_ds1edô
.
√w_dú1
[
u£r_dú
]; ;

142 4 : 
dú
 = 
glb_ds1edô
.
√w_dú4
[
u£r_dú
]; ;

143 8 : 
dú
 = 
glb_ds1edô
.
√w_dú8
[
u£r_dú
]; ;

144 16 : 
dú
 = 
glb_ds1edô
.
√w_dú16
[
u£r_dú
]; ;

145 32 : 
dú
 = 
glb_ds1edô
.
√w_dú32
[
u£r_dú
]; ;

153 
x1
 = 
y1
 = 0x7FFFFFFFL;

154 
x2
 = 
y2
 = 0x80000000L;

155 
i
=0; i < 
dc6_Âd
; i++)

159 
off£t
 = 
dc6_Âå
[
dú
 * 
dc6_Âd
 + 
i
];

160 i‡(
off£t
 >
Àn
)

162 
	`‰ì
(
buff
);

165 
Õå
 = (*Ë(
buff
 + 
off£t
);

168 
f_w
 = 
Õå
[1];

169 
f_h
 = 
Õå
[2];

170 
f_offx
 = 
Õå
[3];

171 
f_offy
 = 
Õå
[4];

173 
f_x1
 = 
f_offx
;

174 
f_x2
 = 
f_x1
 + 
f_w
 - 1;

175 
f_y2
 = 
f_offy
;

176 
f_y1
 = 
f_y2
 - 
f_h
 + 1;

179 i‡(
f_x1
 < 
x1
)

180 
x1
 = 
f_x1
;

181 i‡(
f_x2
 > 
x2
)

182 
x2
 = 
f_x2
;

183 i‡(
f_y1
 < 
y1
)

184 
y1
 = 
f_y1
;

185 i‡(
f_y2
 > 
y2
)

186 
y2
 = 
f_y2
;

188 
w
 = 
x2
 - 
x1
 + 1;

189 
h
 = 
y2
 - 
y1
 + 1;

191 i‡((
w
 <0Ë|| (
h
 <= 0))

193 
	`‰ì
(
buff
);

197 
œy
->
off_x
 = 
x1
;

198 
œy
->
off_y
 = 
y1
;

202 
size
 = 
dc6_Âd
 * (
BITMAP
 *);

203 
œy
->
bmp_num
 = 
dc6_Âd
;

204 
œy
->
bmp
 = (
BITMAP
 **Ë
	`mÆloc
(
size
);

205 i‡(
œy
->
bmp
 =
NULL
)

207 
	`‰ì
(
buff
);

210 
	`mem£t
(
œy
->
bmp
, 0, 
size
);

213 
i
=0; i < 
dc6_Âd
; i++)

216 
off£t
 = 
dc6_Âå
[
dú
 * 
dc6_Âd
 + 
i
];

217 i‡(
off£t
 >
Àn
)

219 
i
)

221 
i
--;

222 
	`de°roy_bôm≠
(
œy
->
bmp
[
i
]);

224 
	`‰ì
(
buff
);

227 
Õå
 = (*Ë(
buff
 + 
off£t
);

230 
f_w
 = 
Õå
[1];

231 
f_h
 = 
Õå
[2];

232 
f_offx
 = 
Õå
[3];

233 
f_offy
 = 
Õå
[4];

237 
f_Àn
 = 
Õå
[7];

238 
f_d©a
 = (
UBYTE
 *Ë(& 
Õå
[8]);

241 
œy
->
bmp
[
i
] = 
	`¸óã_bôm≠
(
w
, 
h
);

242 i‡(
œy
->
bmp
[
i
] =
NULL
)

244 
i
)

246 
i
--;

247 
	`de°roy_bôm≠
(
œy
->
bmp
[
i
]);

249 
	`‰ì
(
buff
);

252 
	`˛ór
(
œy
->
bmp
[
i
]);

255 i‡(
∑lshi·
 =
NULL
)

257 
	`dc6_decomp_n‹m
(

258 
f_d©a
,

259 
œy
->
bmp
[
i
],

260 
f_Àn
,

261 
f_offx
 - 
x1
,

262 
h
 - 1 + 
f_offy
 - 
y2


267 
	`dc6_decomp_cm≠
(

268 
f_d©a
,

269 
œy
->
bmp
[
i
],

270 
f_Àn
,

271 
f_offx
 - 
x1
,

272 
h
 - 1 + 
f_offy
 - 
y2
,

273 
∑lshi·


277 
	`‰ì
(
buff
);

279 
	}
}

	@dc6info.h

1 #i‚de‡
_DC6_INFO_H_


3 
	#_DC6_INFO_H_


	)

5 
dc6_decomp_n‹m
 (* 
§c
, 
BITMAP
 * 
d°
, 
size
, 
x0
, 
y0
);

6 
dc6_decomp_cm≠
 (* 
§c
, 
BITMAP
 * 
d°
, 
size
, 
x0
, 
y0
, 
UBYTE
 * 
cm≠
);

7 
™im_lﬂd_dc6
 (* 
«me
, 
COF_S
 * 
cof
, 
œy_idx
, 
u£r_dú
, 
UBYTE
 * 
∑lshi·
);

	@dccinfo.c

1 
	~<°dio.h
>

2 
	~<°rög.h
>

3 
	~"ty≥s.h
"

5 #ifde‡
WIN32


6 #¥agm®
w¨nög
 (
push
)

7 #¥agm®
w¨nög
 (
dißbÀ
 : 4312 )

10 
	~<ÆÀgro.h
>

12 #ifde‡
WIN32


13 #¥agm®
w¨nög
 (
p›
)

16 
	~"dccöfo.h
"

18 
	#DCCINFO_SAVE_PCX


	)

23 
	$dcc_öô
()

26 
i
,

27 
ãmp
[16] = {0, 1, 2, 4, 6, 8, 10, 12, 14, 16, 20, 24, 26, 28, 30, 32};

29 
i
=0; i<16; i++)

30 
dcc_bôs_width_èbÀ
[
i
] = 
ãmp
[i];

32 
	`mem£t
(
dcc_îr‹
, 0, (dcc_error));

33 
	}
}

40 
	$dcc_ªad_byãs
(
DCC_BITSTREAM_S
 * 
bs
, 
byãs_numbî
, * 
de°
)

42 
i
;

45 i‡(
bs
->
cur_bô
)

48 
	`•rötf
(
dcc_îr‹
, "dcc_read_bytes() : bytesÑeading must beáligned "

49 "⁄á byã bound¨y (cur_bô = %i)\n", 
bs
->
cur_bô
);

54 
i
=0; i < 
byãs_numbî
; i++)

56 i‡(
bs
->
cur_bô_num
 >bs->
size
)

78 
	`•rötf
(
dcc_îr‹
, "dcc_read_bytes() : wantÅoÑead behind "

80 
bs
->
cur_bô_num
, bs->
size
);

83 * (((
UBYTE
 *Ë
de°
Ë+ 
i
Ë
bs
->
d©a
[bs->
cur_byã
];

84 
bs
->
cur_byã
 ++;

85 
bs
->
cur_bô_num
 += 8;

90 
	}
}

99 
	$dcc_ªad_bôs
(
DCC_BITSTREAM_S
 * 
bs
, 
bôs_numbî
, 
is_sig√d
,

100 
UDWORD
 * 
de°
 )

102 
b
, 
de°_bô
 = 0, 
de°_byã
 = 0;

106 * 
de°
 = 0;

120 i‡(
bôs_numbî
 < 0)

122 
	`•rötf
(
dcc_îr‹
, "dcc_read_bits() : can'tÑead %i bits\n",

123 
bôs_numbî
);

127 i‡(
bôs_numbî
 > 32)

130 
	`•rötf
(
dcc_îr‹
, "dcc_read_bits() : can'tÑead moreÅhan 32 bits "

136 
b
=0; b < 
bôs_numbî
; b++)

138 i‡(
bs
->
cur_bô_num
 >bs->
size
)

140 
	`•rötf
(
dcc_îr‹
, "dcc_read_bits() : wantÅoÑead behind "

142 
bs
->
cur_bô_num
, bs->
size
);

147 i‡–
bs
->
d©a
[bs->
cur_byã
] & (1 << bs->
cur_bô
) )

148 * (((
UBYTE
 *Ë
de°
Ë+ 
de°_byã
Ë|(1 << 
de°_bô
);

151 
de°_bô
++;

152 i‡(
de°_bô
 >= 8)

154 
de°_bô
 = 0;

155 
de°_byã
++;

157 
bs
->
cur_bô
++;

158 
bs
->
cur_bô_num
++;

159 i‡(
bs
->
cur_bô
 >= 8)

161 
bs
->
cur_bô
 = 0;

162 
bs
->
cur_byã
++;

167 i‡(
is_sig√d
 =
FALSE
)

172 i‡((* 
de°
Ë& (1 << (
bôs_numbî
-1)) )

175 (* 
de°
Ë|~ ((1 << 
bôs_numbî
) - 1);

179 
	}
}

185 
	$dcc_‰ame_hódî_bô°ªam
(
DCC_S
 *
dcc
, 
DCC_BITSTREAM_S
 *
bs
, 
d
, 
f
)

187 
DCC_DIRECTION_S
 * 
dú
 = & 
dcc
->
dúe˘i⁄
[
d
];

220 
DCC_FRAME_S
 * 
‰m
 = & 
dcc
->
‰ame
[
d
][
f
];

221 
sign
, 
width
=0, 
i
;

222 * 
±r
 = 
NULL
;

223 
add_îr‹
[80], 
°r
[30];

227 
i
=0; i<8; i++)

229 
sign
 = 
FALSE
;

230 
i
)

233 
width
 = 
dú
->
v¨übÀ0_bôs
;

234 
±r
 = & 
‰m
->
v¨übÀ0
;

235 
	`°r˝y
(
°r
, "variable0");

239 
width
 = 
dú
->
width_bôs
;

240 
±r
 = & 
‰m
->
width
;

241 
	`°r˝y
(
°r
, "width");

245 
width
 = 
dú
->
height_bôs
;

246 
±r
 = & 
‰m
->
height
;

247 
	`°r˝y
(
°r
, "height");

251 
sign
 = 
TRUE
;

252 
width
 = 
dú
->
xoff£t_bôs
;

253 
±r
 = & 
‰m
->
xoff£t
;

254 
	`°r˝y
(
°r
, "xoffset");

258 
sign
 = 
TRUE
;

259 
width
 = 
dú
->
yoff£t_bôs
;

260 
±r
 = & 
‰m
->
yoff£t
;

261 
	`°r˝y
(
°r
, "yoffset");

265 
width
 = 
dú
->
›ti⁄Æ_byãs_bôs
;

266 
±r
 = & 
‰m
->
›ti⁄Æ_byãs
;

267 
	`°r˝y
(
°r
, "optional_bytes");

271 
width
 = 
dú
->
coded_byãs_bôs
;

272 
±r
 = & 
‰m
->
coded_byãs
;

273 
	`°r˝y
(
°r
, "coded_bytes");

277 
width
 = 1;

278 
±r
 = & 
‰m
->
bŸtom_up
;

279 
	`°r˝y
(
°r
, "bottom_up");

282 i‡(
	`dcc_ªad_bôs
(
bs
, 
dcc_bôs_width_èbÀ
[
width
], 
sign
, 
±r
))

284 
	`•rötf
(
add_îr‹
, "‰amêhódî %i, %s\n", 
f
, 
°r
);

285 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

291 
dcc
->
‰ame
[
d
][
f
].
box
.
xmö
 = dcc->‰ame[d][f].
xoff£t
;

292 
dcc
->
‰ame
[
d
][
f
].
box
.
xmax
 = dcc->‰ame[d][f].box.
xmö
 + dcc->‰ame[d][f].
width
 - 1;

294 i‡(
dcc
->
‰ame
[
d
][
f
].
bŸtom_up
)

296 
dcc
->
‰ame
[
d
][
f
].
box
.
ymö
 = dcc->‰ame[d][f].
yoff£t
;

297 
dcc
->
‰ame
[
d
][
f
].
box
.
ymax
 = dcc->‰ame[d][f].box.
ymö
 + dcc->‰ame[d][f].
height
 - 1;

300 
dcc
->
‰ame
[
d
][
f
].
box
.
ymax
 = dcc->‰ame[d][f].
yoff£t
;

301 
dcc
->
‰ame
[
d
][
f
].
box
.
ymö
 = dcc->‰ame[d][f].box.
ymax
 - dcc->‰ame[d][f].
height
 + 1;

303 
dcc
->
‰ame
[
d
][
f
].
box
.
width
 = dcc->‰ame[d][f].box.
xmax
 - dcc->‰ame[d][f].box.
xmö
 + 1;

304 
dcc
->
‰ame
[
d
][
f
].
box
.
height
 = dcc->‰ame[d][f].box.
ymax
 - dcc->‰ame[d][f].box.
ymö
 + 1;

308 
	}
}

313 
	$dcc_öô_dú_bô°ªam
(
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
)

315 
DCC_BITSTREAM_S
 * 
ec
, * 
pm
, * 
ë
, * 
Ω
, * 
pcd
;

316 
UDWORD
 
glb_bô
 = (
bs
->
cur_byã
 * 8Ë+ bs->
cur_bô
;

320 
ec
 = & 
dcc
->
dúe˘i⁄
[
d
].
equÆ_˚Œ_bô°ªam
;

321 
pm
 = & 
dcc
->
dúe˘i⁄
[
d
].
pixñ_mask_bô°ªam
;

322 
ë
 = & 
dcc
->
dúe˘i⁄
[
d
].
ícodög_ty≥_bô°ªam
;

323 
Ω
 = & 
dcc
->
dúe˘i⁄
[
d
].
øw_pixñ_bô°ªam
;

324 
pcd
 = & 
dcc
->
dúe˘i⁄
[
d
].
pixñ_code_™d_di•œcmít_bô°ªam
;

327 i‡(
dcc
->
dúe˘i⁄
[
d
].
com¥essi⁄_Êag
 & 0x02)

329 
ec
->
d©a
 = 
bs
->d©®+ (
glb_bô
 / 8);

330 
ec
->
cur_bô
 = (
UBYTE
Ë(
glb_bô
 % 8);

331 
ec
->
cur_bô_num
 = 0;

332 
ec
->
cur_byã
 = 0;

333 
ec
->
size
 = 
dcc
->
dúe˘i⁄
[
d
].
equÆ_˚Œ_bô°ªam_size
;

334 
glb_bô
 +
ec
->
size
;

338 
pm
->
d©a
 = 
bs
->d©®+ (
glb_bô
 / 8);

339 
pm
->
cur_bô
 = (
UBYTE
Ë(
glb_bô
 % 8);

340 
pm
->
cur_bô_num
 = 0;

341 
pm
->
cur_byã
 = 0;

342 
pm
->
size
 = 
dcc
->
dúe˘i⁄
[
d
].
pixñ_mask_bô°ªam_size
;

343 
glb_bô
 +
pm
->
size
;

345 i‡(
dcc
->
dúe˘i⁄
[
d
].
com¥essi⁄_Êag
 & 0x01)

348 
ë
->
d©a
 = 
bs
->d©®+ (
glb_bô
 / 8);

349 
ë
->
cur_bô
 = (
UBYTE
Ë(
glb_bô
 % 8);

350 
ë
->
cur_bô_num
 = 0;

351 
ë
->
cur_byã
 = 0;

352 
ë
->
size
 = 
dcc
->
dúe˘i⁄
[
d
].
ícodög_ty≥_bô°ªam_size
;

353 
glb_bô
 +
ë
->
size
;

356 
Ω
->
d©a
 = 
bs
->d©®+ (
glb_bô
 / 8);

357 
Ω
->
cur_bô
 = (
UBYTE
Ë(
glb_bô
 % 8);

358 
Ω
->
cur_bô_num
 = 0;

359 
Ω
->
cur_byã
 = 0;

360 
Ω
->
size
 = 
dcc
->
dúe˘i⁄
[
d
].
øw_pixñ_bô°ªam_size
;

361 
glb_bô
 +
Ω
->
size
;

365 
pcd
->
d©a
 = 
bs
->d©®+ (
glb_bô
 / 8);

366 
pcd
->
cur_bô
 = (
UBYTE
Ë(
glb_bô
 % 8);

367 
pcd
->
cur_bô_num
 = 0;

368 
pcd
->
cur_byã
 = 0;

369 
pcd
->
size
 = 
bs
->sizê- 
glb_bô
;

415 
	}
}

421 
	$dcc_›ti⁄Æ_d©as
(
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
)

423 
UDWORD
 
size
 = 0;

424 
f
;

425 
add_îr‹
[80];

429 
f
=0; f < 
dcc
->
hódî
.
‰ames_≥r_dú
; f++)

430 
size
 +
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs
;

431 i‡(
size
 == 0)

435 i‡(
bs
->
cur_bô
)

438 
bs
->
cur_bô_num
 +8 - bs->
cur_bô
;

439 
bs
->
cur_bô
 = 0;

440 
bs
->
cur_byã
 ++;

444 
f
=0; f < 
dcc
->
hódî
.
‰ames_≥r_dú
; f++)

446 
size
 = 
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs
;

447 i‡(
size
)

450 
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs_d©a
 = (
UBYTE
 *Ë
	`mÆloc
 (
size
);

451 i‡(
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs_d©a
 =
NULL
)

453 
	`•rötf
(
dcc_îr‹
,

457 
size
, 
d
, 
f
);

462 i‡(
	`dcc_ªad_byãs
(
bs
, 
size
, 
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs_d©a
))

464 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, fømê%i\n", 
d
, 
f
);

465 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

473 
	}
}

479 
	$dcc_Ÿhî_bô°ªam_size
(
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
)

481 
add_îr‹
[80];

485 i‡(
dcc
->
dúe˘i⁄
[
d
].
com¥essi⁄_Êag
 & 0x02)

487 i‡(
	`dcc_ªad_bôs
(
bs
, 20, 
FALSE
,

488 & 
dcc
->
dúe˘i⁄
[
d
].
equÆ_˚Œ_bô°ªam_size
))

490 
	`•rötf
(
add_îr‹
,

491 "dúe˘i⁄ %i,ÉquÆ_˚Œ_bô°ªam_size\n", 
d
);

492 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

498 i‡(
	`dcc_ªad_bôs
(
bs
, 20, 
FALSE
,

499 & 
dcc
->
dúe˘i⁄
[
d
].
pixñ_mask_bô°ªam_size
))

501 
	`•rötf
(
add_îr‹
,

502 "dúe˘i⁄ %i,Öixñ_mask_bô°ªam_size\n", 
d
);

503 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

507 i‡(
dcc
->
dúe˘i⁄
[
d
].
com¥essi⁄_Êag
 & 0x01)

510 i‡(
	`dcc_ªad_bôs
(
bs
, 20, 
FALSE
,

511 & 
dcc
->
dúe˘i⁄
[
d
].
ícodög_ty≥_bô°ªam_size
))

513 
	`•rötf
(
add_îr‹
,

514 "dúe˘i⁄ %i,Éncodög_ty≥_bô°ªam_size\n", 
d
);

515 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

520 i‡(
	`dcc_ªad_bôs
(
bs
, 20, 
FALSE
,

521 & 
dcc
->
dúe˘i⁄
[
d
].
øw_pixñ_bô°ªam_size
))

523 
	`•rötf
(
add_îr‹
,

524 "dúe˘i⁄ %i,Ñaw_pixñ_bô°ªam_size\n", 
d
);

525 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

532 
	}
}

540 
	$dcc_pixñ_vÆues_key
(
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
)

542 
add_îr‹
[80];

543 
i
, 
idx
 = 0;

544 
UDWORD
 
tmp
;

546 
i
=0; i<256; i++)

548 i‡(
	`dcc_ªad_bôs
(
bs
, 1, 
FALSE
, & 
tmp
))

550 
	`•rötf
(
add_îr‹
,

551 "dúe˘i⁄ %i,Öixñ_vÆue†%i\n", 
d
, 
i
);

552 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

555 i‡(
tmp
)

556 
dcc
->
dúe˘i⁄
[
d
].
pixñ_vÆues
[
idx
++] = (
UBYTE
Ë
i
;

561 
	}
}

568 
	$dcc_¥ï¨e_buf„r_˚Œs
(
DCC_S
 * 
dcc
, 
d
)

570 
DCC_DIRECTION_S
 * 
dú
 = & 
dcc
->
dúe˘i⁄
[
d
];

571 
DCC_CELL_S
 * 
˚Œ
;

572 
buf„r_w
, 
buf„r_h
, 
tmp
, 
nb_˚Œ_w
, 
nb_˚Œ_h
, 
nb_˚Œ
,

573 
size
, * 
˚Œ_w
, * 
˚Œ_h
, 
i
, 
x0
, 
y0
, 
x
, 
y
;

575 
buf„r_w
 = 
dú
->
box
.
width
;

576 
buf„r_h
 = 
dú
->
box
.
height
;

579 
tmp
 = 
buf„r_w
 - 1;

580 
nb_˚Œ_w
 = 1 + (
tmp
 / 4);

582 
tmp
 = 
buf„r_h
 - 1;

583 
nb_˚Œ_h
 = 1 + (
tmp
 / 4);

601 
nb_˚Œ
 = 
nb_˚Œ_w
 * 
nb_˚Œ_h
;

602 
size
 = 
nb_˚Œ
 * (
DCC_CELL_S
);

603 
dú
->
buf„r_±r
 = (
DCC_CELL_S
 *Ë
	`mÆloc
(
size
);

604 i‡(
dú
->
buf„r_±r
 =
NULL
)

606 
	`•rötf
(
dcc_îr‹
, "dcc_prepare_buffer_cells() :\n"

608 
size
);

611 
	`mem£t
(
dú
->
buf„r_±r
, 0, 
size
);

613 
size
 = 
nb_˚Œ_w
 * ();

614 
˚Œ_w
 = (*Ë
	`mÆloc
(
size
);

615 i‡(
˚Œ_w
 =
NULL
)

617 
	`•rötf
(
dcc_îr‹
, "dcc_prepare_buffer_cells() :\n"

619 
size
);

623 
size
 = 
nb_˚Œ_h
 * ();

624 
˚Œ_h
 = (*Ë
	`mÆloc
(
size
);

625 i‡(
˚Œ_h
 =
NULL
)

627 
	`‰ì
(
˚Œ_w
);

628 
	`•rötf
(
dcc_îr‹
, "dcc_prepare_buffer_cells() :\n"

630 
size
);

634 i‡(
nb_˚Œ_w
 == 1)

635 
˚Œ_w
[0] = 
buf„r_w
;

638 
i
=0; i < (
nb_˚Œ_w
 - 1); i++)

639 
˚Œ_w
[
i
] = 4;

640 
˚Œ_w
[
nb_˚Œ_w
 - 1] = 
buf„r_w
 - (4 * (nb_cell_w - 1));

643 i‡(
nb_˚Œ_h
 == 1)

644 
˚Œ_h
[0] = 
buf„r_h
;

647 
i
=0; i < (
nb_˚Œ_h
 - 1); i++)

648 
˚Œ_h
[
i
] = 4;

649 
˚Œ_h
[
nb_˚Œ_h
 - 1] = 
buf„r_h
 - (4 * (nb_cell_h - 1));

652 
dú
->
nb_˚Œs_w
 = 
nb_˚Œ_w
;

653 
dú
->
nb_˚Œs_h
 = 
nb_˚Œ_h
;

655 
y0
 = 0;

656 
y
=0; y < 
nb_˚Œ_h
; y++)

658 
x0
 = 0;

659 
x
=0; x < 
nb_˚Œ_w
; x++)

661 
˚Œ
 = & 
dú
->
buf„r_±r
[
x
 + (
y
 * 
nb_˚Œ_w
)];

662 
˚Œ
->
w
 = 
˚Œ_w
[
x
];

663 
˚Œ
->
h
 = 
˚Œ_h
[
y
];

664 
˚Œ
->
bmp
 = 
	`¸óã_sub_bôm≠
(
dú
->bmp, 
x0
, 
y0
, cñl->
w
, cñl->
h
);

665 i‡(
˚Œ
->
bmp
 =
NULL
)

667 
	`•rötf
(
dcc_îr‹
, "dcc_prepare_buffer_cells() :\n"

669 
x0
, 
y0
);

672 
x0
 += 4;

674 
y0
 += 4;

677 
	`‰ì
(
˚Œ_w
);

678 
	`‰ì
(
˚Œ_h
);

681 
	}
}

688 
	$dcc_¥ï¨e_‰ame_˚Œs
(
DCC_S
 * 
dcc
, 
d
, 
f
)

690 
DCC_DIRECTION_S
 * 
dú
 = & 
dcc
->
dúe˘i⁄
[
d
];

691 
DCC_FRAME_S
 * 
‰ame
 = & 
dcc
->‰ame[
d
][
f
];

692 
DCC_CELL_S
 * 
˚Œ
 = 
NULL
;

693 
‰ame_w
, 
‰ame_h
, 
w
, 
h
, 
tmp
,

694 
nb_˚Œ_w
, 
nb_˚Œ_h
, 
nb_˚Œ
,

695 
size
, * 
˚Œ_w
, * 
˚Œ_h
, 
i
, 
x0
, 
y0
, 
x
, 
y
;

697 
‰ame_w
 = 
‰ame
->
box
.
width
;

698 
‰ame_h
 = 
‰ame
->
box
.
height
;

701 
w
 = 4 - ((
‰ame
->
box
.
xmö
 - 
dú
->box.xmin) % 4);

703 i‡((
‰ame_w
 - 
w
) <= 1)

704 
nb_˚Œ_w
 = 1;

708 
tmp
 = 
‰ame_w
 - 
w
 - 1;

709 
nb_˚Œ_w
 = 2 + (
tmp
 / 4);

710 i‡((
tmp
 % 4) == 0)

711 
nb_˚Œ_w
--;

714 
h
 = 4 - ((
‰ame
->
box
.
ymö
 - 
dú
->box.ymin) % 4);

715 i‡((
‰ame_h
 - 
h
) <= 1)

716 
nb_˚Œ_h
 = 1;

719 
tmp
 = 
‰ame_h
 - 
h
 - 1;

720 
nb_˚Œ_h
 = 2 + (
tmp
 / 4);

721 i‡((
tmp
 % 4) == 0)

722 
nb_˚Œ_h
--;

725 
nb_˚Œ
 = 
nb_˚Œ_w
 * 
nb_˚Œ_h
;

726 
size
 = 
nb_˚Œ
 * (
DCC_CELL_S
);

727 
‰ame
->
˚Œ
 = (
DCC_CELL_S
 *Ë
	`mÆloc
(
size
);

728 i‡(
‰ame
->
˚Œ
 =
NULL
)

730 
	`•rötf
(
dcc_îr‹
, "dcc_prepare_frame_cells() :\n"

732 
size
);

735 
	`mem£t
(
‰ame
->
˚Œ
, 0, 
size
);

737 
size
 = 
nb_˚Œ_w
 * ();

738 
˚Œ_w
 = (*Ë
	`mÆloc
(
size
);

739 i‡(
˚Œ_w
 =
NULL
)

741 
	`•rötf
(
dcc_îr‹
, "dcc_prepare_frame_cells() :\n"

743 
size
);

747 
size
 = 
nb_˚Œ_h
 * ();

748 
˚Œ_h
 = (*Ë
	`mÆloc
(
size
);

749 i‡(
˚Œ_h
 =
NULL
)

751 
	`‰ì
(
˚Œ_w
);

752 
	`•rötf
(
dcc_îr‹
, "dcc_prepare_frame_cells() :\n"

754 
size
);

758 i‡(
nb_˚Œ_w
 == 1)

759 
˚Œ_w
[0] = 
‰ame_w
;

762 
˚Œ_w
[0] = 
w
;

763 
i
=1; i < (
nb_˚Œ_w
 - 1); i++)

764 
˚Œ_w
[
i
] = 4;

765 
˚Œ_w
[
nb_˚Œ_w
 - 1] = 
‰ame_w
 - 
w
 - (4 * (nb_cell_w - 2));

768 i‡(
nb_˚Œ_h
 == 1)

769 
˚Œ_h
[0] = 
‰ame_h
;

772 
˚Œ_h
[0] = 
h
;

773 
i
=1; i < (
nb_˚Œ_h
 - 1); i++)

774 
˚Œ_h
[
i
] = 4;

775 
˚Œ_h
[
nb_˚Œ_h
 - 1] = 
‰ame_h
 - 
h
 - (4 * (nb_cell_h - 2));

778 
‰ame
->
nb_˚Œs_w
 = 
nb_˚Œ_w
;

779 
‰ame
->
nb_˚Œs_h
 = 
nb_˚Œ_h
;

781 
y0
 = 
‰ame
->
box
.
ymö
 - 
dú
->box.ymin;

782 
y
=0; y < 
nb_˚Œ_h
; y++)

784 
x0
 = 
‰ame
->
box
.
xmö
 - 
dú
->box.xmin;

785 
x
=0; x < 
nb_˚Œ_w
; x++)

787 
˚Œ
 = & 
‰ame
->˚Œ[
x
 + (
y
 * 
nb_˚Œ_w
)];

788 
˚Œ
->
x0
 = x0;

789 
˚Œ
->
y0
 = y0;

790 
˚Œ
->
w
 = 
˚Œ_w
[
x
];

791 
˚Œ
->
h
 = 
˚Œ_h
[
y
];

792 
˚Œ
->
bmp
 = 
	`¸óã_sub_bôm≠
(
dú
->bmp, 
x0
, 
y0
, cñl->
w
, cñl->
h
);

793 
x0
 +
˚Œ
->
w
;

795 
y0
 +
˚Œ
->
h
;

798 
	`‰ì
(
˚Œ_w
);

799 
	`‰ì
(
˚Œ_h
);

802 
	}
}

808 
	$dcc_fûl_pixñ_buf„r
(
DCC_S
 * 
dcc
, 
d
)

810 
DCC_DIRECTION_S
 * 
dú
 = & 
dcc
->
dúe˘i⁄
[
d
];

811 
DCC_FRAME_S
 * 
‰ame
;

812 
DCC_PB_ENTRY_S
 * 
ﬁd_íåy
, * 
√w_íåy
;

813 
˚Œ0_x
, 
˚Œ0_y
, 
˚Œ_w
, 
˚Œ_h
;

814 
UDWORD
 
tmp
, 
pixñ_mask
=0, 
ícodög_ty≥
, 
œ°_pixñ
, 
ªad_pixñ
[4],

815 
pix_di•l
;

816 
nb_˚Œ
, 
size
;

817 
i
, 
f
, 
cuº_˚Œ_x
, 
cuº_˚Œ_y
, 
cuº_˚Œ
;

818 
nb_pix_èbÀ
[16] =

820 
x
, 
y
, 
nb_pix
, 
√xt_˚Œ
, 
cuº_idx
,

821 
pb_idx
 = -1;

822 
DCC_PB_ENTRY_S
 ** 
˚Œ_buf„r
;

823 
buff_w
, 
buff_h
, 
decoded_pix
;

824 
add_îr‹
[256];

837 
size
 = 
DCC_MAX_PB_ENTRY
 * (
DCC_PB_ENTRY_S
);

838 
dú
->
pixñ_buf„r
 = (
DCC_PB_ENTRY_S
 *Ë
	`mÆloc
(
size
);

839 i‡(
dú
->
pixñ_buf„r
 =
NULL
)

841 
	`•rötf
(
dcc_îr‹
, "dcc_fill_pixel_buffer() : can'tállocate "

843 
size
, 
DCC_MAX_PB_ENTRY
);

846 
	`mem£t
(
dú
->
pixñ_buf„r
, 0, 
size
);

847 
i
=0; i < 
DCC_MAX_PB_ENTRY
; i++)

849 
dú
->
pixñ_buf„r
[
i
].
‰ame
 = -1;

850 
dú
->
pixñ_buf„r
[
i
].
‰ame_˚Œ_ödex
 = -1;

854 
dú
->
bmp
 = 
	`¸óã_bôm≠
(dú->
box
.
width
, dú->box.
height
);

855 i‡(
dú
->
bmp
 =
NULL
)

857 
	`•rötf
(
dcc_îr‹
, "dcc_fûl_pixñ_buf„r(Ë: c™'à¸óã buf„∏bôm≠ o‡%ld * %ldÖixñs\n", 
dú
->
box
.
width
, dú->box.
height
);

860 
	`˛ór
(
dú
->
bmp
);

865 i‡(
	`dcc_¥ï¨e_buf„r_˚Œs
(
dcc
, 
d
))

871 
buff_w
 = 
dú
->
nb_˚Œs_w
;

872 
buff_h
 = 
dú
->
nb_˚Œs_h
;

873 
nb_˚Œ
 = 
buff_w
 * 
buff_h
;

874 
size
 = 
nb_˚Œ
 * (
DCC_PB_ENTRY_S
 *);

875 
˚Œ_buf„r
 = (
DCC_PB_ENTRY_S
 **Ë
	`mÆloc
(
size
);

876 i‡(
˚Œ_buf„r
 =
NULL
)

878 
	`•rötf
(
dcc_îr‹
, "dcc_fill_pixel_buffer() : can'tállocate "

880 
size
, 
nb_˚Œ
);

883 
	`mem£t
(
˚Œ_buf„r
, 0, 
size
);

886 
f
=0; f < 
dcc
->
hódî
.
‰ames_≥r_dú
; f++)

889 i‡(
	`dcc_¥ï¨e_‰ame_˚Œs
(
dcc
, 
d
, 
f
))

891 
	`‰ì
(
˚Œ_buf„r
);

895 
‰ame
 = & 
dcc
->‰ame[
d
][
f
];

896 
˚Œ_w
 = 
‰ame
->
nb_˚Œs_w
;

897 
˚Œ_h
 = 
‰ame
->
nb_˚Œs_h
;

898 
˚Œ0_x
 = (
‰ame
->
box
.
xmö
 - 
dú
->box.xmin) / 4;

899 
˚Œ0_y
 = (
‰ame
->
box
.
ymö
 - 
dú
->box.ymin) / 4;

902 
y
=0; y < 
˚Œ_h
; y++)

904 
cuº_˚Œ_y
 = 
˚Œ0_y
 + 
y
;

905 
x
=0; x < 
˚Œ_w
; x++)

907 
cuº_˚Œ_x
 = 
˚Œ0_x
 + 
x
;

908 
cuº_˚Œ
 = 
cuº_˚Œ_x
 + (
cuº_˚Œ_y
 * 
buff_w
);

909 i‡(
cuº_˚Œ
 >
nb_˚Œ
)

911 
	`•rötf
(
dcc_îr‹
, "dcc_fill_pixel_buffer() : "

915 
cuº_˚Œ
, 
nb_˚Œ
,

916 
d
, 
f
, 
x
, 
y
);

917 
	`‰ì
(
˚Œ_buf„r
);

922 
√xt_˚Œ
 = 
FALSE
;

923 i‡(
˚Œ_buf„r
[
cuº_˚Œ
] !
NULL
)

925 i‡(
dú
->
equÆ_˚Œ_bô°ªam_size
)

927 i‡(
	`dcc_ªad_bôs
–& 
dú
->
equÆ_˚Œ_bô°ªam
,

928 1, 
FALSE
, & 
tmp
))

930 
	`•rötf
(
add_îr‹
, "dcc_fill_pixel_buffer() : "

933 
d
, 
f
, 
cuº_˚Œ
);

934 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

935 
	`‰ì
(
˚Œ_buf„r
);

940 
tmp
 = 0;

941 i‡(
tmp
 == 0)

943 i‡(
	`dcc_ªad_bôs
–& 
dú
->
pixñ_mask_bô°ªam
,

944 4, 
FALSE
, & 
pixñ_mask
))

946 
	`•rötf
(
add_îr‹
, "dcc_fill_pixel_buffer() : "

950 
d
, 
f
, 
cuº_˚Œ
, 
x
, 
y
);

951 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

952 
	`‰ì
(
˚Œ_buf„r
);

958 
√xt_˚Œ
 = 
TRUE
;

961 
pixñ_mask
 = 0x0F;

963 i‡(
√xt_˚Œ
 =
FALSE
)

968 
ªad_pixñ
[0] =Ñead_pixel[1] = 0;

969 
ªad_pixñ
[2] =Ñead_pixel[3] = 0;

970 
œ°_pixñ
 = 0;

971 
nb_pix
 = 
nb_pix_èbÀ
[
pixñ_mask
];

972 i‡(
nb_pix
 && 
dú
->
ícodög_ty≥_bô°ªam_size
)

974 i‡(
	`dcc_ªad_bôs
–& 
dú
->
ícodög_ty≥_bô°ªam
,

975 1, 
FALSE
, & 
ícodög_ty≥
))

977 
	`•rötf
(
add_îr‹
, "dcc_fill_pixel_buffer() :\n "

981 
d
, 
f
, 
cuº_˚Œ
, 
nb_pix
, 
cuº_˚Œ_x
, 
cuº_˚Œ_y
);

982 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

983 
	`‰ì
(
˚Œ_buf„r
);

988 
ícodög_ty≥
 = 0;

989 
decoded_pix
 = 0;

990 
i
=0; i < 
nb_pix
; i++)

992 i‡(
ícodög_ty≥
)

994 i‡(
	`dcc_ªad_bôs
–& 
dú
->
øw_pixñ_bô°ªam
,

995 8, 
FALSE
, & 
ªad_pixñ
[
i
]))

997 
	`•rötf
(
add_îr‹
, "dcc_fill_pixel_buffer() :\n "

1001 
d
, 
f
, 
cuº_˚Œ
, 
nb_pix
, 
cuº_˚Œ_x
, 
cuº_˚Œ_y
);

1002 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1003 
	`‰ì
(
˚Œ_buf„r
);

1009 
ªad_pixñ
[
i
] = 
œ°_pixñ
;

1010 i‡(
	`dcc_ªad_bôs
(

1011 & 
dú
->
pixñ_code_™d_di•œcmít_bô°ªam
,

1012 4, 
FALSE
, & 
pix_di•l
))

1014 
	`•rötf
(
add_îr‹
, "dcc_fill_pixel_buffer() :\n "

1017 
d
, 
f
, 
cuº_˚Œ
);

1018 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1019 
	`‰ì
(
˚Œ_buf„r
);

1022 
ªad_pixñ
[
i
] +
pix_di•l
;

1023 
pix_di•l
 == 15)

1025 i‡(
	`dcc_ªad_bôs
(

1026 & 
dú
->
pixñ_code_™d_di•œcmít_bô°ªam
,

1027 4, 
FALSE
, & 
pix_di•l
))

1029 
	`•rötf
(
add_îr‹
, "dcc_fill_pixel_buffer() :\n "

1032 
d
, 
f
, 
cuº_˚Œ
);

1033 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1034 
	`‰ì
(
˚Œ_buf„r
);

1037 
ªad_pixñ
[
i
] +
pix_di•l
;

1040 i‡(
ªad_pixñ
[
i
] =
œ°_pixñ
)

1042 
ªad_pixñ
[
i
] = 0;

1043 
i
 = 
nb_pix
;

1047 
œ°_pixñ
 = 
ªad_pixñ
[
i
];

1048 
decoded_pix
++;

1053 
ﬁd_íåy
 = 
˚Œ_buf„r
[
cuº_˚Œ
];

1054 
pb_idx
++;

1055 i‡(
pb_idx
 >
DCC_MAX_PB_ENTRY
)

1057 
	`•rötf
(
dcc_îr‹
, "dcc_fill_pixel_buffer() : "

1061 
DCC_MAX_PB_ENTRY
, 
d
, 
f
, 
cuº_˚Œ
, 
nb_pix
,

1062 
cuº_˚Œ_x
, 
cuº_˚Œ_y
);

1063 
	`‰ì
(
˚Œ_buf„r
);

1066 
√w_íåy
 = & 
dú
->
pixñ_buf„r
[
pb_idx
];

1067 
cuº_idx
 = 
decoded_pix
 - 1;

1068 
i
=0; i<4; i++)

1070 i‡(
pixñ_mask
 & (1 << 
i
))

1072 i‡(
cuº_idx
 >= 0)

1073 
√w_íåy
->
vÆ
[
i
] = (
UBYTE
Ë
ªad_pixñ
[
cuº_idx
--];

1075 
√w_íåy
->
vÆ
[
i
] = 0;

1078 
√w_íåy
->
vÆ
[
i
] = 
ﬁd_íåy
->val[i];

1080 
˚Œ_buf„r
[
cuº_˚Œ
] = 
√w_íåy
;

1081 
√w_íåy
->
‰ame
 = 
f
;

1082 
√w_íåy
->
‰ame_˚Œ_ödex
 = 
x
 + (
y
 * 
˚Œ_w
);

1090 
i
=0; i <
pb_idx
; i++)

1092 
x
=0; x<4; x++)

1094 
y
 = 
dú
->
pixñ_buf„r
[
i
].
vÆ
[
x
];

1095 
dú
->
pixñ_buf„r
[
i
].
vÆ
[
x
] = dú->
pixñ_vÆues
[
y
];

1100 
dú
->
pb_nb_íåy
 = 
pb_idx
 + 1;

1101 
	`‰ì
(
˚Œ_buf„r
);

1103 
	}
}

1107 
	$dcc_ßve_‰ame
(
DCC_S
 * 
dcc
, 
d
, 
f
, 
BITMAP
 * 
‰m_bmp
)

1109 
DCC_FRAME_S
 * 
Âå
 = & 
dcc
->
‰ame
[
d
][
f
];

1111 
Âå
->
bmp
 = 
	`¸óã_bôm≠
(
‰m_bmp
->
w
, frm_bmp->
h
);

1112 i‡(
Âå
->
bmp
 =
NULL
)

1114 
	`•rötf
(
dcc_îr‹
, "dcc_save_frame() : can't create final frame "

1116 
‰m_bmp
->
w
, frm_bmp->
h
);

1119 
	`blô
(
‰m_bmp
, 
Âå
->
bmp
, 0, 0, 0, 0, frm_bmp->
w
, frm_bmp->
h
);

1122 #ifde‡
DCCINFO_SAVE_PCX


1124 
tmp
[30];

1125 
PALETTE
 
tmµÆ
;

1126 
FILE
 * 
ö
;

1127 
i
;

1129 
ö
 = 
	`f›í
("act1.dat", "rb");

1130 i‡(
ö
 !
NULL
)

1132 
i
=0; i<256; i++)

1134 
tmµÆ
[
i
].
b
 = (
UBYTE
Ë
	`fgëc
(
ö
) >> 2;

1135 
tmµÆ
[
i
].
g
 = (
UBYTE
Ë
	`fgëc
(
ö
) >> 2;

1136 
tmµÆ
[
i
].
r
 = (
UBYTE
Ë
	`fgëc
(
ö
) >> 2;

1138 
	`f˛o£
(
ö
);

1139 
	`•rötf
(
tmp
, "d%02i-f%03i.pcx", 
d
, 
f
);

1140 
	`ßve_pcx
(
tmp
, 
‰m_bmp
, 
tmµÆ
);

1148 
	}
}

1154 
	$dcc_make_‰ames
(
DCC_S
 * 
dcc
, 
d
)

1156 
DCC_DIRECTION_S
 * 
dú
 = & 
dcc
->
dúe˘i⁄
[
d
];

1157 
DCC_PB_ENTRY_S
 * 
pbe
 = 
dú
->
pixñ_buf„r
;

1158 
DCC_FRAME_S
 * 
‰ame
;

1159 
DCC_CELL_S
 * 
buff_˚Œ
, * 
˚Œ
;

1160 
UDWORD
 
pix
;

1161 
nb_˚Œ
, 
nb_bô
,

1162 
˚Œ_x
, 
˚Œ_y
, 
˚Œ_idx
,

1163 
x
, 
y
, 
f
, 
c
;

1164 
BITMAP
 * 
‰m_bmp
;

1165 
add_îr‹
[256];

1169 
c
=0; c < 
dú
->
nb_˚Œs_w
 * dú->
nb_˚Œs_h
; c++)

1171 
dú
->
buf„r_±r
[
c
].
œ°_w
 = -1;

1172 
dú
->
buf„r_±r
[
c
].
œ°_h
 = -1;

1176 
‰m_bmp
 = 
	`¸óã_bôm≠
(
dú
->
box
.
width
, dú->box.
height
);

1177 i‡(
‰m_bmp
 =
NULL
)

1179 
	`•rötf
(
dcc_îr‹
, "dcc_make_‰ames(Ë: c™'à¸óãÅm∞‰amêbôm≠ o‡%ld * %ldÖixñs", 
dú
->
box
.
width
, dú->box.
height
);

1184 
f
=0; f < 
dcc
->
hódî
.
‰ames_≥r_dú
; f++)

1186 
	`˛ór
(
‰m_bmp
);

1187 
‰ame
 = & 
dcc
->‰ame[
d
][
f
];

1188 
nb_˚Œ
 = 
‰ame
->
nb_˚Œs_w
 * føme->
nb_˚Œs_h
;

1191 
c
=0; c < 
nb_˚Œ
; c++)

1194 
˚Œ
 = & 
‰ame
->˚Œ[
c
];

1197 
˚Œ_x
 = 
˚Œ
->
x0
 / 4;

1198 
˚Œ_y
 = 
˚Œ
->
y0
 / 4;

1199 
˚Œ_idx
 = 
˚Œ_x
 + (
˚Œ_y
 * 
dú
->
nb_˚Œs_w
);

1200 
buff_˚Œ
 = & 
dú
->
buf„r_±r
[
˚Œ_idx
];

1203 i‡((
pbe
->
‰ame
 !
f
Ë|| (pbe->
‰ame_˚Œ_ödex
 !
c
))

1208 i‡((
˚Œ
->
w
 !
buff_˚Œ
->
œ°_w
Ë|| (˚Œ->
h
 !buff_˚Œ->
œ°_h
))

1211 
	`˛ór
(
˚Œ
->
bmp
);

1218 
	`blô
(
dú
->
bmp
, dir->bmp,

1219 
buff_˚Œ
->
œ°_x0
, buff_˚Œ->
œ°_y0
,

1220 
˚Œ
->
x0
, cñl->
y0
,

1221 
˚Œ
->
w
, cñl->
h


1225 
	`blô
(
˚Œ
->
bmp
, 
‰m_bmp
,

1227 
˚Œ
->
x0
, cñl->
y0
,

1228 
˚Œ
->
w
, cñl->
h


1236 i‡(
pbe
->
vÆ
[0] ==Öbe->val[1])

1239 
	`˛ór_to_cﬁ‹
(
˚Œ
->
bmp
, 
pbe
->
vÆ
[0]);

1243 i‡(
pbe
->
vÆ
[1] ==Öbe->val[2])

1244 
nb_bô
 = 1;

1246 
nb_bô
 = 2;

1249 
y
=0; y < 
˚Œ
->
h
; y++)

1251 
x
=0; x < 
˚Œ
->
w
; x++)

1253 i‡(
	`dcc_ªad_bôs
(

1254 & 
dcc
->
dúe˘i⁄
[
d
].
pixñ_code_™d_di•œcmít_bô°ªam
,

1255 
nb_bô
, 
FALSE
, & 
pix
))

1257 
	`•rötf
(
add_îr‹
, "dcc_make_frame() :\n "

1260 
d
, 
pbe
->
‰ame
,Öbe->
‰ame_˚Œ_ödex
);

1261 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1264 
	`puçixñ
(
˚Œ
->
bmp
, 
x
, 
y
, 
pbe
->
vÆ
[
pix
]);

1270 
	`blô
(
˚Œ
->
bmp
, 
‰m_bmp
,

1272 
˚Œ
->
x0
, cñl->
y0
,

1273 
˚Œ
->
w
, cñl->
h


1277 
pbe
++;

1283 
buff_˚Œ
->
œ°_w
 = 
˚Œ
->
w
;

1284 
buff_˚Œ
->
œ°_h
 = 
˚Œ
->
h
;

1287 
buff_˚Œ
->
œ°_x0
 = 
˚Œ
->
x0
;

1288 
buff_˚Œ
->
œ°_y0
 = 
˚Œ
->
y0
;

1292 
	`dcc_ßve_‰ame
(
dcc
, 
d
, 
f
, 
‰m_bmp
);

1296 
	`de°roy_bôm≠
(
‰m_bmp
);

1298 
	}
}

1304 
	$dcc_dú_bô°ªam
(
DCC_S
 * 
dcc
, 
d
)

1306 
DCC_BITSTREAM_S
 
bs
;

1307 
f
;

1308 
add_îr‹
[80];

1311 i‡(
dcc
->
dúe˘i⁄
[
d
].
bmp
 !
NULL
)

1315 i‡((
d
 < 0Ë|| (d >
dcc
->
hódî
.
dúe˘i⁄s
))

1317 
	`•rötf
(
dcc_îr‹
, "dcc_dir_bitstream() : invalid direction, %i is "

1319 
d
, 
dcc
->
hódî
.
dúe˘i⁄s
);

1324 
bs
.
cur_bô
 = 0;

1325 
bs
.
cur_bô_num
 = 0;

1326 
bs
.
cur_byã
 = 0;

1327 
bs
.
d©a
 = 
dcc
->
±r
 + dcc->
hódî
.
dú_off£t
[
d
];

1328 i‡(
d
 =
dcc
->
hódî
.
dúe˘i⁄s
 - 1)

1329 
bs
.
size
 = 8 * (
dcc
->sizê- dcc->
hódî
.
dú_off£t
[
d
]);

1331 
bs
.
size
 = 8 * (
dcc
->
hódî
.
dú_off£t
[
d
 + 1] -

1332 
dcc
->
hódî
.
dú_off£t
[
d
]);

1336 i‡(
	`dcc_ªad_bôs
–& 
bs
, 32, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
outsize_coded
))

1338 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, outsize_coded\n", 
d
);

1339 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1343 i‡(
	`dcc_ªad_bôs
–& 
bs
, 2, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
com¥essi⁄_Êag
))

1345 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, com¥essi⁄_Êag\n", 
d
);

1346 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1350 i‡(
	`dcc_ªad_bôs
–& 
bs
, 4, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
v¨übÀ0_bôs
))

1352 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, v¨übÀ0_bôs\n", 
d
);

1353 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1357 i‡(
	`dcc_ªad_bôs
–& 
bs
, 4, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
width_bôs
))

1359 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, width_bôs\n", 
d
);

1360 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1364 i‡(
	`dcc_ªad_bôs
–& 
bs
, 4, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
height_bôs
))

1366 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, height_bôs\n", 
d
);

1367 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1371 i‡(
	`dcc_ªad_bôs
–& 
bs
, 4, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
xoff£t_bôs
))

1373 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, xoff£t_bôs\n", 
d
);

1374 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1378 i‡(
	`dcc_ªad_bôs
–& 
bs
, 4, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
yoff£t_bôs
))

1380 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, yoff£t_bôs\n", 
d
);

1381 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1385 i‡(
	`dcc_ªad_bôs
–& 
bs
, 4, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
›ti⁄Æ_byãs_bôs
))

1387 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, o±i⁄Æ_byãs_bôs\n", 
d
);

1388 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1392 i‡(
	`dcc_ªad_bôs
–& 
bs
, 4, 
FALSE
, & 
dcc
->
dúe˘i⁄
[
d
].
coded_byãs_bôs
))

1394 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, coded_byãs_bôs\n", 
d
);

1395 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1401 
dcc
->
dúe˘i⁄
[
d
].
box
.
xmö
 = dcc->dúe˘i⁄[d].box.
ymö
 = 0x7FFFFFFFL;

1402 
dcc
->
dúe˘i⁄
[
d
].
box
.
xmax
 = dcc->dúe˘i⁄[d].box.
ymax
 = 0x80000000L;

1406 
f
=0; f < 
dcc
->
hódî
.
‰ames_≥r_dú
; f++)

1409 i‡(
	`dcc_‰ame_hódî_bô°ªam
(
dcc
, & 
bs
, 
d
, 
f
))

1411 
	`•rötf
(
add_îr‹
, "dúe˘i⁄ %i, føme†hódî\n", 
d
);

1412 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1417 i‡(
dcc
->
‰ame
[
d
][
f
].
box
.
xmö
 < dcc->
dúe˘i⁄
[d].box.xmin)

1418 
dcc
->
dúe˘i⁄
[
d
].
box
.
xmö
 = dcc->
‰ame
[d][
f
].box.xmin;

1420 i‡(
dcc
->
‰ame
[
d
][
f
].
box
.
ymö
 < dcc->
dúe˘i⁄
[d].box.ymin)

1421 
dcc
->
dúe˘i⁄
[
d
].
box
.
ymö
 = dcc->
‰ame
[d][
f
].box.ymin;

1423 i‡(
dcc
->
‰ame
[
d
][
f
].
box
.
xmax
 > dcc->
dúe˘i⁄
[d].box.xmax)

1424 
dcc
->
dúe˘i⁄
[
d
].
box
.
xmax
 = dcc->
‰ame
[d][
f
].box.xmax;

1426 i‡(
dcc
->
‰ame
[
d
][
f
].
box
.
ymax
 > dcc->
dúe˘i⁄
[d].box.ymax)

1427 
dcc
->
dúe˘i⁄
[
d
].
box
.
ymax
 = dcc->
‰ame
[d][
f
].box.ymax;

1429 
dcc
->
dúe˘i⁄
[
d
].
box
.
width
 = dcc->dúe˘i⁄[d].box.
xmax
 - dcc->dúe˘i⁄[d].box.
xmö
 + 1;

1430 
dcc
->
dúe˘i⁄
[
d
].
box
.
height
 = dcc->dúe˘i⁄[d].box.
ymax
 - dcc->dúe˘i⁄[d].box.
ymö
 + 1;

1433 i‡(
	`dcc_›ti⁄Æ_d©as
(
dcc
, & 
bs
, 
d
))

1437 i‡(
	`dcc_Ÿhî_bô°ªam_size
(
dcc
, & 
bs
, 
d
))

1441 i‡(
	`dcc_pixñ_vÆues_key
(
dcc
, & 
bs
, 
d
))

1445 
	`dcc_öô_dú_bô°ªam
(
dcc
, & 
bs
, 
d
);

1448 i‡(
	`dcc_fûl_pixñ_buf„r
(
dcc
, 
d
))

1452 i‡(
	`dcc_make_‰ames
(
dcc
, 
d
))

1456 i‡(
dcc
->
dúe˘i⁄
[
d
].
pixñ_buf„r
)

1458 
	`‰ì
(
dcc
->
dúe˘i⁄
[
d
].
pixñ_buf„r
);

1459 
dcc
->
dúe˘i⁄
[
d
].
pixñ_buf„r
 = 
NULL
;

1463 i‡(
dcc
->
dúe˘i⁄
[
d
].
equÆ_˚Œ_bô°ªam_size
 !=

1464 
dcc
->
dúe˘i⁄
[
d
].
equÆ_˚Œ_bô°ªam
.
cur_bô_num
)

1466 
	`•rötf
(
dcc_îr‹
, "dúe˘i⁄ %i,ÉquÆ_˚Œ bô°ªamÇŸÑód com∂ëly whûêô should\n", 
d
);

1467 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1470 i‡(
dcc
->
dúe˘i⁄
[
d
].
pixñ_mask_bô°ªam_size
 !=

1471 
dcc
->
dúe˘i⁄
[
d
].
pixñ_mask_bô°ªam
.
cur_bô_num
)

1473 
	`•rötf
(
dcc_îr‹
, "dúe˘i⁄ %i,Öixñ_mask bô°ªamÇŸÑód com∂ëly whûêô should\n", 
d
);

1474 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1477 i‡(
dcc
->
dúe˘i⁄
[
d
].
ícodög_ty≥_bô°ªam_size
 !=

1478 
dcc
->
dúe˘i⁄
[
d
].
ícodög_ty≥_bô°ªam
.
cur_bô_num
)

1480 
	`•rötf
(
dcc_îr‹
, "dúe˘i⁄ %i,Éncodög_ty≥ bô°ªamÇŸÑód com∂ëly whûêô should\n", 
d
);

1481 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1484 i‡(
dcc
->
dúe˘i⁄
[
d
].
pixñ_code_™d_di•œcmít_bô°ªam
.
cur_bô_num
 + 7

1485 < 
dcc
->
dúe˘i⁄
[
d
].
pixñ_code_™d_di•œcmít_bô°ªam
.
size
)

1487 
	`•rötf
(
dcc_îr‹
, "dúe˘i⁄ %i,Öixñ_code_™d_di•œcmíàbô°ªamÇŸÑód com∂ëly whûêô should\n", 
d
);

1488 
	`°rˇt
(
dcc_îr‹
, 
add_îr‹
);

1493 
	}
}

1498 
	$dcc_fûe_hódî
(
DCC_S
 * 
dcc
)

1500 
DCC_BITSTREAM_S
 
bs
;

1501 
i
;

1503 i‡(
dcc
->
hódî
.
Æªady_decoded
 =
TRUE
)

1506 
bs
.
cur_bô
 = 0;

1507 
bs
.
cur_bô_num
 = 0;

1508 
bs
.
cur_byã
 = 0;

1509 
bs
.
d©a
 = 
dcc
->
±r
;

1510 
bs
.
size
 = 8 * 
dcc
->size;

1534 i‡(
	`dcc_ªad_byãs
–& 
bs
, 1, & 
dcc
->
hódî
.
fûe_sig«tuª
))

1537 i‡(
	`dcc_ªad_byãs
–& 
bs
, 1, & 
dcc
->
hódî
.
vîsi⁄
))

1540 i‡(
	`dcc_ªad_byãs
–& 
bs
, 1, & 
dcc
->
hódî
.
dúe˘i⁄s
))

1543 i‡(
	`dcc_ªad_byãs
–& 
bs
, 4, & 
dcc
->
hódî
.
‰ames_≥r_dú
))

1547 i‡(
	`dcc_ªad_byãs
–& 
bs
, 4, & 
dcc
->
hódî
.
èg
))

1550 i‡(
	`dcc_ªad_byãs
–& 
bs
, 4, & 
dcc
->
hódî
.
föÆ_dc6_size
))

1553 
i
=0; i < 
dcc
->
hódî
.
dúe˘i⁄s
; i++)

1554 i‡(
	`dcc_ªad_byãs
–& 
bs
, 4, & 
dcc
->
hódî
.
dú_off£t
[
i
]))

1558 
dcc
->
hódî
.
Æªady_decoded
 = 
TRUE
;

1560 
	}
}

1569 
	$dcc_decode
(
DCC_S
 * 
dcc
, 
dú_bôfõld
)

1571 
d
;

1575 
	`dcc_öô
();

1578 
dcc
->
box
.
xmö
 = dcc->box.
ymö
 = 0x7FFFFFFFL;

1579 
dcc
->
box
.
xmax
 = dcc->box.
ymax
 = 0x80000000L;

1583 i‡(
	`dcc_fûe_hódî
(
dcc
))

1587 
d
=0; d<
dcc
->
hódî
.
dúe˘i⁄s
; d++)

1589 i‡(
dú_bôfõld
 & (1 << 
d
)) {

1593 i‡(
	`dcc_dú_bô°ªam
(
dcc
, 
d
))

1597 i‡(
dcc
->
dúe˘i⁄
[
d
].
box
.
xmö
 < dcc->box.xmin)

1598 
dcc
->
box
.
xmö
 = dcc->
dúe˘i⁄
[
d
].box.xmin;

1600 i‡(
dcc
->
dúe˘i⁄
[
d
].
box
.
ymö
 < dcc->box.ymin)

1601 
dcc
->
box
.
ymö
 = dcc->
dúe˘i⁄
[
d
].box.ymin;

1603 i‡(
dcc
->
dúe˘i⁄
[
d
].
box
.
xmax
 > dcc->box.xmax)

1604 
dcc
->
box
.
xmax
 = dcc->
dúe˘i⁄
[
d
].box.xmax;

1606 i‡(
dcc
->
dúe˘i⁄
[
d
].
box
.
ymax
 > dcc->box.ymax)

1607 
dcc
->
box
.
ymax
 = dcc->
dúe˘i⁄
[
d
].box.ymax;

1610 
dcc
->
box
.
width
 = dcc->box.
xmax
 - dcc->box.
xmö
 + 1;

1611 
dcc
->
box
.
height
 = dcc->box.
ymax
 - dcc->box.
ymö
 + 1;

1615 
	}
}

1620 
	$dcc_debug
(
DCC_S
 * 
dcc
)

1622 
d
, 
f
, 
i
;

1624 
	`¥ötf
("fûe_sig«tuª = %i\n", 
dcc
->
hódî
.
fûe_sig«tuª
);

1625 
	`¥ötf
("vîsi⁄ = %i\n", 
dcc
->
hódî
.
vîsi⁄
);

1626 
	`¥ötf
("dúe˘i⁄† = %i\n", 
dcc
->
hódî
.
dúe˘i⁄s
);

1627 
	`¥ötf
("‰ames_≥r_dú = %li\n", 
dcc
->
hódî
.
‰ames_≥r_dú
);

1628 
	`¥ötf
("èg = %li\n", 
dcc
->
hódî
.
èg
);

1629 
	`¥ötf
("föÆ_dc6_sizê%lòbyãs\n", 
dcc
->
hódî
.
föÆ_dc6_size
);

1631 
	`¥ötf
("\nbox = (%li, %li) ---> (%li, %li) = %li * %li\n",

1632 
dcc
->
box
.
xmö
, dcc->box.
ymö
,

1633 
dcc
->
box
.
xmax
, dcc->box.
ymax
,

1634 
dcc
->
box
.
width
, dcc->box.
height


1637 
d
=0; d<
dcc
->
hódî
.
dúe˘i⁄s
; d++)

1639 
	`¥ötf
("\ndúe˘i⁄ %2i\n", 
d
);

1640 
	`¥ötf
(" outsize_coded = %lòbyãs\n", 
dcc
->
dúe˘i⁄
[
d
].
outsize_coded
);

1641 
	`¥ötf
(" com¥essi⁄_Êag = %li\n", 
dcc
->
dúe˘i⁄
[
d
].
com¥essi⁄_Êag
);

1642 
	`¥ötf
(" v¨übÀ0_bô† = %2lu (%2òbôs)\n", 
dcc
->
dúe˘i⁄
[
d
].
v¨übÀ0_bôs
, 
dcc_bôs_width_èbÀ
[dcc->direction[d].variable0_bits]);

1643 
	`¥ötf
(" width_bô† = %2lu (%2òbôs)\n", 
dcc
->
dúe˘i⁄
[
d
].
width_bôs
, 
dcc_bôs_width_èbÀ
[dcc->direction[d].width_bits]);

1644 
	`¥ötf
(" height_bô† = %2lu (%2òbôs)\n", 
dcc
->
dúe˘i⁄
[
d
].
height_bôs
, 
dcc_bôs_width_èbÀ
[dcc->direction[d].height_bits]);

1645 
	`¥ötf
(" xoff£t_bô† = %2lu (%2òbôs)\n", 
dcc
->
dúe˘i⁄
[
d
].
xoff£t_bôs
, 
dcc_bôs_width_èbÀ
[dcc->direction[d].xoffset_bits]);

1646 
	`¥ötf
(" yoff£t_bô† = %2lu (%2òbôs)\n", 
dcc
->
dúe˘i⁄
[
d
].
yoff£t_bôs
, 
dcc_bôs_width_èbÀ
[dcc->direction[d].yoffset_bits]);

1647 
	`¥ötf
(" o±i⁄Æ_byãs_bô†%2lu (%2òbôs)\n", 
dcc
->
dúe˘i⁄
[
d
].
›ti⁄Æ_byãs_bôs
, 
dcc_bôs_width_èbÀ
[dcc->direction[d].optional_bytes_bits]);

1648 
	`¥ötf
(" coded_byãs_bô† = %2lu (%2òbôs)\n", 
dcc
->
dúe˘i⁄
[
d
].
coded_byãs_bôs
, 
dcc_bôs_width_èbÀ
[dcc->direction[d].coded_bytes_bits]);

1649 
	`¥ötf
(" box = (%li, %li) ---> (%li, %li) = %li * %li\n",

1650 
dcc
->
dúe˘i⁄
[
d
].
box
.
xmö
,

1651 
dcc
->
dúe˘i⁄
[
d
].
box
.
ymö
,

1652 
dcc
->
dúe˘i⁄
[
d
].
box
.
xmax
,

1653 
dcc
->
dúe˘i⁄
[
d
].
box
.
ymax
,

1654 
dcc
->
dúe˘i⁄
[
d
].
box
.
width
,

1655 
dcc
->
dúe˘i⁄
[
d
].
box
.
height


1657 
	`¥ötf
(" cells = %i * %i = %i\n",

1658 
dcc
->
dúe˘i⁄
[
d
].
nb_˚Œs_w
,

1659 
dcc
->
dúe˘i⁄
[
d
].
nb_˚Œs_h
,

1660 
dcc
->
dúe˘i⁄
[
d
].
nb_˚Œs_w
 * dcc->dúe˘i⁄[d].
nb_˚Œs_h


1662 
	`¥ötf
(" CVDCC.DLL offsets = %li, %li (in version < 3.0)\n\n",

1663 
dcc
->
dúe˘i⁄
[
d
].
box
.
xmö
,

1664 
dcc
->
dúe˘i⁄
[
d
].
box
.
ymax


1666 
	`¥ötf
("ÉquÆ_˚Œ_bô°ªam_sizê = %8lòbô†‘ód %8li)\n", 
dcc
->
dúe˘i⁄
[
d
].
equÆ_˚Œ_bô°ªam_size
, dcc->dúe˘i⁄[d].
equÆ_˚Œ_bô°ªam
.
cur_bô_num
);

1667 
	`¥ötf
("Öixñ_mask_bô°ªam_sizê = %8lòbô†‘ód %8li)\n", 
dcc
->
dúe˘i⁄
[
d
].
pixñ_mask_bô°ªam_size
, dcc->dúe˘i⁄[d].
pixñ_mask_bô°ªam
.
cur_bô_num
);

1668 
	`¥ötf
("Éncodög_ty≥_bô°ªam_sizê = %8lòbô†‘ód %8li)\n", 
dcc
->
dúe˘i⁄
[
d
].
ícodög_ty≥_bô°ªam_size
, dcc->dúe˘i⁄[d].
ícodög_ty≥_bô°ªam
.
cur_bô_num
);

1669 
	`¥ötf
("Ñaw_pixñ_bô°ªam_sizê = %8lòbô†‘ód %8li)\n", 
dcc
->
dúe˘i⁄
[
d
].
øw_pixñ_bô°ªam_size
, dcc->dúe˘i⁄[d].
øw_pixñ_bô°ªam
.
cur_bô_num
);

1670 
	`¥ötf
("Öixñ_code_™d_di•œcmít.sizê%8lòbô†‘ód %8li)\n", 
dcc
->
dúe˘i⁄
[
d
].
pixñ_code_™d_di•œcmít_bô°ªam
.
size
, dcc->dúe˘i⁄[d].pixñ_code_™d_di•œcmít_bô°ªam.
cur_bô_num
);

1672 
	`¥ötf
("\nÖixel_values :\n");

1673 
i
=0; i < 256; i++)

1675 
	`¥ötf
(" %3i", 
dcc
->
dúe˘i⁄
[
d
].
pixñ_vÆues
[
i
]);

1676 i‡–! ((
i
+1) % 16))

1677 
	`¥ötf
("\n");

1680 
f
=0; f<
dcc
->
hódî
.
‰ames_≥r_dú
; f++)

1682 
	`¥ötf
("\¿ fømê%3i\n", 
f
);

1684 i‡(
dcc
->
dúe˘i⁄
[
d
].
v¨übÀ0_bôs
)

1685 
	`¥ötf
(" v¨übÀ0 = %lu\n", 
dcc
->
‰ame
[
d
][
f
].
v¨übÀ0
);

1687 i‡(
dcc
->
dúe˘i⁄
[
d
].
width_bôs
)

1688 
	`¥ötf
(" width = %lu\n", 
dcc
->
‰ame
[
d
][
f
].
width
);

1690 i‡(
dcc
->
dúe˘i⁄
[
d
].
height_bôs
)

1691 
	`¥ötf
(" heighà = %lu\n", 
dcc
->
‰ame
[
d
][
f
].
height
);

1693 i‡(
dcc
->
dúe˘i⁄
[
d
].
xoff£t_bôs
)

1694 
	`¥ötf
(" xoff£à = %li\n", 
dcc
->
‰ame
[
d
][
f
].
xoff£t
);

1696 i‡(
dcc
->
dúe˘i⁄
[
d
].
yoff£t_bôs
)

1697 
	`¥ötf
(" yoff£à = %li\n", 
dcc
->
‰ame
[
d
][
f
].
yoff£t
);

1699 i‡(
dcc
->
dúe˘i⁄
[
d
].
›ti⁄Æ_byãs_bôs
)

1700 
	`¥ötf
(" o±i⁄Æ_byã†%lu\n", 
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs
);

1702 i‡(
dcc
->
dúe˘i⁄
[
d
].
coded_byãs_bôs
)

1703 
	`¥ötf
(" coded_byã† = %lu\n", 
dcc
->
‰ame
[
d
][
f
].
coded_byãs
);

1705 
	`¥ötf
(" bŸtom_u∞ = %li\n", 
dcc
->
‰ame
[
d
][
f
].
bŸtom_up
);

1706 
	`¥ötf
(" box = (%li, %li) ---> (%li, %li) = %li * %li\n",

1707 
dcc
->
‰ame
[
d
][
f
].
box
.
xmö
,

1708 
dcc
->
‰ame
[
d
][
f
].
box
.
ymö
,

1709 
dcc
->
‰ame
[
d
][
f
].
box
.
xmax
,

1710 
dcc
->
‰ame
[
d
][
f
].
box
.
ymax
,

1711 
dcc
->
‰ame
[
d
][
f
].
box
.
width
,

1712 
dcc
->
‰ame
[
d
][
f
].
box
.
height


1715 
	`¥ötf
(" box2 = (%li, %li) ---> (%li, %li) = %li * %li\n",

1716 
dcc
->
‰ame
[
d
][
f
].
box
.
xmö
 - dcc->
dúe˘i⁄
[d].box.xmin,

1717 
dcc
->
‰ame
[
d
][
f
].
box
.
ymö
 - dcc->
dúe˘i⁄
[d].box.ymin,

1718 
dcc
->
‰ame
[
d
][
f
].
box
.
xmax
 - dcc->
dúe˘i⁄
[d].box.
xmö
,

1719 
dcc
->
‰ame
[
d
][
f
].
box
.
ymax
 - dcc->
dúe˘i⁄
[d].box.
ymö
,

1720 
dcc
->
‰ame
[
d
][
f
].
box
.
width
,

1721 
dcc
->
‰ame
[
d
][
f
].
box
.
height


1724 
	`¥ötf
(" cells = %i * %i = %i\n",

1725 
dcc
->
‰ame
[
d
][
f
].
nb_˚Œs_w
,

1726 
dcc
->
‰ame
[
d
][
f
].
nb_˚Œs_h
,

1727 
dcc
->
‰ame
[
d
][
f
].
nb_˚Œs_w
 * dcc->‰ame[d][f].
nb_˚Œs_h


1730 
	`¥ötf
(" 1° cñl0_x, y = %d, %d\n", 
dcc
->
‰ame
[
d
][
f
].
˚Œ
[0].
x0
, dcc->‰ame[d][f].˚Œ[0].
y0
);

1732 i‡(
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs
)

1734 
	`¥ötf
(" optional datas =");

1735 
i
=0; i < (Ë
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs
; i++)

1736 
	`¥ötf
(" %02X", 
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs_d©a
[
i
]);

1737 
	`¥ötf
("\n");

1741 
	`¥ötf
("\ndcc_îr‹[] :\n%s", 
dcc_îr‹
);

1742 
	}
}

1751 
DCC_S
 * 
	$dcc_disk_lﬂd
(* 
dcc_«me
)

1753 
DCC_S
 * 
dcc
;

1754 
FILE
 * 
ö
;

1755 
size
;

1758 
ö
 = 
	`f›í
(
dcc_«me
, "rb");

1759 i‡(
ö
 =
NULL
)

1761 
	`•rötf
(
dcc_îr‹
, "dcc_disk_lﬂd(Ë: c™'à›í %s\n", 
dcc_«me
);

1762  
NULL
;

1766 
size
 = (
DCC_S
);

1767 
dcc
 = (
DCC_S
 *Ë
	`mÆloc
(
size
);

1768 i‡(
dcc
 =
NULL
)

1770 
	`•rötf
(
dcc_îr‹
, "dcc_disk_load() : can'tállocate %i bytes (main struct) "

1771 "f‹ %s\n", 
size
, 
dcc_«me
);

1772 
	`f˛o£
(
ö
);

1773  
NULL
;

1775 
	`mem£t
(
dcc
, 0, 
size
);

1778 
	`f£ek
(
ö
, 0, 
SEEK_END
);

1779 
dcc
->
size
 = 
	`·ñl
(
ö
);

1780 i‡(
dcc
->
size
 < 0)

1782 
	`•rötf
(
dcc_îr‹
, "dcc_disk_load() : ftell() haveÑeturn %li "

1783 "f‹ %s\n", 
dcc
->
size
, 
dcc_«me
);

1784 
	`f˛o£
(
ö
);

1785 
	`‰ì
(
dcc
);

1786  
NULL
;

1788 
	`f£ek
(
ö
, 0, 
SEEK_SET
);

1791 
dcc
->
±r
 = (
UBYTE
 *Ë
	`mÆloc
(dcc->
size
);

1792 i‡(
dcc
->
±r
 =
NULL
)

1794 
	`•rötf
(
dcc_îr‹
, "dcc_disk_load() : can'tállocate %li bytes (buffer) "

1795 "f‹ %s\n", 
dcc
->
size
, 
dcc_«me
);

1796 
	`f˛o£
(
ö
);

1797 
	`‰ì
(
dcc
);

1798  
NULL
;

1802 
	`‰ód
(
dcc
->
±r
, dcc->
size
, 1, 
ö
);

1805 
	`f˛o£
(
ö
);

1806  
dcc
;

1807 
	}
}

1817 
DCC_S
 * 
	$dcc_mem_lﬂd
(* 
mem_±r
, 
mem_size
)

1819 
DCC_S
 * 
dcc
;

1820 
size
;

1823 
size
 = (
DCC_S
);

1824 
dcc
 = (
DCC_S
 *Ë
	`mÆloc
(
size
);

1825 i‡(
dcc
 =
NULL
)

1827 
	`•rötf
(
dcc_îr‹
, "dcc_mem_load() : can'tállocate %i bytes "

1828 "(maö såu˘)\n", 
size
);

1829  
NULL
;

1831 
	`mem£t
(
dcc
, 0, 
size
);

1834 
dcc
->
size
 = 
mem_size
;

1835 i‡(
dcc
->
size
 < 0)

1837 
	`•rötf
(
dcc_îr‹
, "dcc_mem_lﬂd(Ë: sizêi†%òbyãs\n", 
mem_size
);

1838 
	`‰ì
(
dcc
);

1839  
NULL
;

1843 
dcc
->
±r
 = (
UBYTE
 *Ë
	`mÆloc
(dcc->
size
);

1844 i‡(
dcc
->
±r
 =
NULL
)

1846 
	`•rötf
(
dcc_îr‹
, "dcc_mem_load() : can'tállocate %li bytes "

1847 "(buf„r)\n", 
dcc
->
size
);

1848 
	`‰ì
(
dcc
);

1849  
NULL
;

1853 
	`mem˝y
(
dcc
->
±r
, 
mem_±r
, 
mem_size
);

1856  
dcc
;

1857 
	}
}

1862 
	$dcc_de°roy
(
DCC_S
 * 
dcc
)

1864 
d
, 
f
, 
nb_˚Œ
, 
i
;

1867 i‡(
dcc
 =
NULL
)

1871 i‡(
dcc
->
±r
 !
NULL
)

1873 
	`‰ì
(
dcc
->
±r
);

1874 
dcc
->
±r
 = 
NULL
;

1878 
d
=0; d < 
dcc
->
hódî
.
dúe˘i⁄s
; d++)

1881 
f
=0; f < 
dcc
->
hódî
.
‰ames_≥r_dú
; f++)

1884 i‡(
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs_d©a
)

1886 
	`‰ì
(
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs_d©a
);

1887 
dcc
->
‰ame
[
d
][
f
].
›ti⁄Æ_byãs_d©a
 = 
NULL
;

1891 i‡(
dcc
->
‰ame
[
d
][
f
].
˚Œ
)

1893 
nb_˚Œ
 = 
dcc
->
‰ame
[
d
][
f
].
nb_˚Œs_w
 * dcc->‰ame[d][f].
nb_˚Œs_h
;

1894 
i
=0; i < 
nb_˚Œ
; i++)

1895 i‡(
dcc
->
‰ame
[
d
][
f
].
˚Œ
[
i
].
bmp
)

1896 
	`de°roy_bôm≠
(
dcc
->
‰ame
[
d
][
f
].
˚Œ
[
i
].
bmp
);

1898 
	`‰ì
(
dcc
->
‰ame
[
d
][
f
].
˚Œ
);

1899 
dcc
->
‰ame
[
d
][
f
].
˚Œ
 = 
NULL
;

1903 i‡(
dcc
->
‰ame
[
d
][
f
].
bmp
)

1904 
	`de°roy_bôm≠
(
dcc
->
‰ame
[
d
][
f
].
bmp
);

1908 i‡(
dcc
->
dúe˘i⁄
[
d
].
pixñ_buf„r
)

1910 
	`‰ì
(
dcc
->
dúe˘i⁄
[
d
].
pixñ_buf„r
);

1911 
dcc
->
dúe˘i⁄
[
d
].
pixñ_buf„r
 = 
NULL
;

1915 i‡(
dcc
->
dúe˘i⁄
[
d
].
buf„r_±r
)

1917 
nb_˚Œ
 = 
dcc
->
dúe˘i⁄
[
d
].
nb_˚Œs_w
 * dcc->dúe˘i⁄[d].
nb_˚Œs_h
;

1918 
i
=0; i < 
nb_˚Œ
; i++)

1919 i‡(
dcc
->
dúe˘i⁄
[
d
].
buf„r_±r
[
i
].
bmp
)

1920 
	`de°roy_bôm≠
(
dcc
->
dúe˘i⁄
[
d
].
buf„r_±r
[
i
].
bmp
);

1922 
	`‰ì
(
dcc
->
dúe˘i⁄
[
d
].
buf„r_±r
);

1923 
dcc
->
dúe˘i⁄
[
d
].
buf„r_±r
 = 
NULL
;

1927 i‡(
dcc
->
dúe˘i⁄
[
d
].
bmp
)

1928 
	`de°roy_bôm≠
(
dcc
->
dúe˘i⁄
[
d
].
bmp
);

1932 
	`‰ì
(
dcc
);

1933 
	}
}

	@dccinfo.h

1 #i‚de‡
_DCC_INFO_H_


3 
	#_DCC_INFO_H_


	)

6 
	#DCC_MAX_DIR
 32

	)

7 
	#DCC_MAX_FRAME
 256

	)

9 
	#DCC_MAX_PB_ENTRY
 85000

	)

12 
	gdcc_îr‹
[512];

17 
	gdcc_bôs_width_èbÀ
[16];

19 
	sDCC_BOX_S


21 
	mxmö
;

22 
	mymö
;

23 
	mxmax
;

24 
	mymax
;

25 
	mwidth
;

26 
	mheight
;

27 } 
	tDCC_BOX_S
;

29 
	sDCC_CELL_S


31 
	mx0
, 
	my0
;

32 
	mw
, 
	mh
;

34 
	mœ°_w
, 
	mœ°_h
;

36 
	mœ°_x0
, 
	mœ°_y0
;

38 
BITMAP
 * 
	mbmp
;

39 } 
	tDCC_CELL_S
;

42 
	sDCC_FRAME_S


44 
UDWORD
 
	mv¨übÀ0
;

45 
UDWORD
 
	mwidth
;

46 
UDWORD
 
	mheight
;

47 
	mxoff£t
;

48 
	myoff£t
;

49 
UDWORD
 
	m›ti⁄Æ_byãs
;

50 
UDWORD
 
	mcoded_byãs
;

52 
UBYTE
 * 
	m›ti⁄Æ_byãs_d©a
;

56 
UDWORD
 
	mbŸtom_up
;

59 
DCC_CELL_S
 * 
	m˚Œ
;

60 
	mnb_˚Œs_w
;

61 
	mnb_˚Œs_h
;

64 
DCC_BOX_S
 
	mbox
;

67 
BITMAP
 * 
	mbmp
;

69 } 
	tDCC_FRAME_S
;

71 
	sDCC_BITSTREAM_S


73 
UBYTE
 * 
	md©a
;

74 
UDWORD
 
	msize
;

75 
UDWORD
 
	mcur_byã
;

76 
UBYTE
 
	mcur_bô
;

78 
UDWORD
 
	mcur_bô_num
;

80 } 
	tDCC_BITSTREAM_S
;

83 
	sDCC_PB_ENTRY_S


85 
UBYTE
 
	mvÆ
[4];

86 
	m‰ame
;

87 
	m‰ame_˚Œ_ödex
;

88 } 
	tDCC_PB_ENTRY_S
;

90 
	sDCC_DIRECTION_S


92 
UDWORD
 
	moutsize_coded
;

93 
UDWORD
 
	mcom¥essi⁄_Êag
;

97 
UDWORD
 
	mv¨übÀ0_bôs
;

98 
UDWORD
 
	mwidth_bôs
;

99 
UDWORD
 
	mheight_bôs
;

100 
UDWORD
 
	mxoff£t_bôs
;

101 
UDWORD
 
	myoff£t_bôs
;

102 
UDWORD
 
	m›ti⁄Æ_byãs_bôs
;

103 
UDWORD
 
	mcoded_byãs_bôs
;

106 
UDWORD
 
	mequÆ_˚Œ_bô°ªam_size
;

107 
UDWORD
 
	mpixñ_mask_bô°ªam_size
;

108 
UDWORD
 
	mícodög_ty≥_bô°ªam_size
;

109 
UDWORD
 
	møw_pixñ_bô°ªam_size
;

110 
DCC_BITSTREAM_S
 
	mequÆ_˚Œ_bô°ªam
;

111 
DCC_BITSTREAM_S
 
	mpixñ_mask_bô°ªam
;

112 
DCC_BITSTREAM_S
 
	mícodög_ty≥_bô°ªam
;

113 
DCC_BITSTREAM_S
 
	møw_pixñ_bô°ªam
;

114 
DCC_BITSTREAM_S
 
	mpixñ_code_™d_di•œcmít_bô°ªam
;

117 
	mnb_˚Œs_w
;

118 
	mnb_˚Œs_h
;

119 
BITMAP
 * 
	mbmp
;

120 
DCC_CELL_S
 * 
	mbuf„r_±r
;

123 
DCC_PB_ENTRY_S
 * 
	mpixñ_buf„r
;

124 
	mpb_nb_íåy
;

127 
UBYTE
 
	mpixñ_vÆues
[256];

130 
DCC_BOX_S
 
	mbox
;

131 } 
	tDCC_DIRECTION_S
;

133 
	sDCC_HEADER_S


135 
UBYTE
 
	mfûe_sig«tuª
;

136 
UBYTE
 
	mvîsi⁄
;

137 
UBYTE
 
	mdúe˘i⁄s
;

138 
	m‰ames_≥r_dú
;

139 
	mèg
;

141 
	mföÆ_dc6_size
;

142 
	mdú_off£t
 [
DCC_MAX_DIR
];

144 
	mÆªady_decoded
;

145 } 
	tDCC_HEADER_S
;

147 
	sDCC_S


149 
UBYTE
 * 
	m±r
;

150 
	msize
;

151 
DCC_HEADER_S
 
	mhódî
;

152 
DCC_DIRECTION_S
 
	mdúe˘i⁄
 [
DCC_MAX_DIR
];

153 
DCC_FRAME_S
 
	m‰ame
 [
DCC_MAX_DIR
] [
DCC_MAX_FRAME
];

154 
DCC_BOX_S
 
	mbox
;

155 } 
	tDCC_S
;

157 
dcc_öô
 ();

158 
dcc_ªad_byãs
 (
DCC_BITSTREAM_S
 * 
bs
, 
byãs_numbî
, * 
de°
);

159 
dcc_ªad_bôs
 (
DCC_BITSTREAM_S
 * 
bs
, 
bôs_numbî
, 
is_sig√d
, 
UDWORD
 * 
de°
 );

160 
dcc_‰ame_hódî_bô°ªam
 (
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
, 
f
);

161 
dcc_öô_dú_bô°ªam
 (
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
);

162 
dcc_›ti⁄Æ_d©as
 (
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
);

163 
dcc_Ÿhî_bô°ªam_size
 (
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
);

164 
dcc_pixñ_vÆues_key
 (
DCC_S
 * 
dcc
, 
DCC_BITSTREAM_S
 * 
bs
, 
d
);

165 
dcc_¥ï¨e_buf„r_˚Œs
 (
DCC_S
 * 
dcc
, 
d
);

166 
dcc_¥ï¨e_‰ame_˚Œs
 (
DCC_S
 * 
dcc
, 
d
, 
f
);

167 
dcc_fûl_pixñ_buf„r
 (
DCC_S
 * 
dcc
, 
d
);

168 
dcc_ßve_‰ame
 (
DCC_S
 * 
dcc
, 
d
, 
f
, 
BITMAP
 * 
‰m_bmp
);

169 
dcc_make_‰ames
 (
DCC_S
 * 
dcc
, 
d
);

170 
dcc_dú_bô°ªam
 (
DCC_S
 * 
dcc
, 
d
);

171 
dcc_fûe_hódî
 (
DCC_S
 * 
dcc
);

172 
dcc_decode
 (
DCC_S
 * 
dcc
, 
dú_bôfõld
);

173 
dcc_debug
 (
DCC_S
 * 
dcc
);

174 
DCC_S
 * 
dcc_disk_lﬂd
 (* 
dcc_«me
);

175 
DCC_S
 * 
dcc_mem_lﬂd
 (* 
mem_±r
, 
mem_size
);

176 
dcc_de°roy
 (
DCC_S
 * 
dcc
);

	@ds1misc.c

1 
	~<°rög.h
>

2 
	~"°ru˘s.h
"

3 
	~"dt1misc.h
"

4 
	~"îr‹.h
"

5 
	~"edôobj.h
"

6 
	~"w¥evõw.h
"

7 
	~"ds1misc.h
"

8 
	~"misc.h
"

13 
	$ds1_‰ì
(
i
)

15 
d
, 
tŸÆ
 = 0;

17 i‡(
	`°æí
(
glb_ds1
[
i
].
«me
) == 0)

20 
	`Ârötf
(
°dîr
, " . %s\n", 
glb_ds1
[
i
].
«me
);

21 
	`fÊush
(
°dîr
);

24 
	`Ârötf
(
°dîr
, " _ dt1s");

25 
	`fÊush
(
°dîr
);

26 
d
=0; d<
DT1_IN_DS1_MAX
; d++)

27 
	`dt1_dñ
(
glb_ds1
[
i
].
dt1_idx
[
d
]);

30 
	`Ârötf
(
°dîr
, ", blockÅable");

31 
	`fÊush
(
°dîr
);

32 i‡(
glb_ds1
[
i
].
block_èbÀ
 !
NULL
)

34 
tŸÆ
 +
glb_ds1
[
i
].
bt_num
 * (
BLOCK_TABLE_S
);

35 
	`‰ì
(
glb_ds1
[
i
].
block_èbÀ
);

39 
	`Ârötf
(
°dîr
, ", file buffer");

40 
	`fÊush
(
°dîr
);

41 i‡(
glb_ds1
[
i
].
fûe_buff
 !
NULL
)

43 
tŸÆ
 +
glb_ds1
[
i
].
fûe_Àn
;

44 
	`‰ì
(
glb_ds1
[
i
].
fûe_buff
);

48 
	`Ârötf
(
°dîr
, ", floors");

49 
	`fÊush
(
°dîr
);

50 i‡(
glb_ds1
[
i
].
Êo‹_buff
 !
NULL
)

52 
tŸÆ
 +
glb_ds1
[
i
].
Êo‹_buff_Àn
;

53 
	`‰ì
(
glb_ds1
[
i
].
Êo‹_buff
);

55 i‡(
glb_ds1
[
i
].
Êo‹_buff2
 !
NULL
)

57 
tŸÆ
 +
glb_ds1
[
i
].
Êo‹_buff_Àn
;

58 
	`‰ì
(
glb_ds1
[
i
].
Êo‹_buff2
);

62 
	`Ârötf
(
°dîr
, ", shadows");

63 
	`fÊush
(
°dîr
);

64 i‡(
glb_ds1
[
i
].
shadow_buff
 !
NULL
)

66 
tŸÆ
 +
glb_ds1
[
i
].
shadow_buff_Àn
;

67 
	`‰ì
(
glb_ds1
[
i
].
shadow_buff
);

69 i‡(
glb_ds1
[
i
].
shadow_buff2
 !
NULL
)

71 
tŸÆ
 +
glb_ds1
[
i
].
shadow_buff_Àn
;

72 
	`‰ì
(
glb_ds1
[
i
].
shadow_buff2
);

76 
	`Ârötf
(
°dîr
, ", unknown");

77 
	`fÊush
(
°dîr
);

78 i‡(
glb_ds1
[
i
].
èg_buff
 !
NULL
)

80 
tŸÆ
 +
glb_ds1
[
i
].
èg_buff_Àn
;

81 
	`‰ì
(
glb_ds1
[
i
].
èg_buff
);

83 i‡(
glb_ds1
[
i
].
èg_buff2
 !
NULL
)

85 
tŸÆ
 +
glb_ds1
[
i
].
èg_buff_Àn
;

86 
	`‰ì
(
glb_ds1
[
i
].
èg_buff2
);

90 
	`Ârötf
(
°dîr
, ", walls\n");

91 
	`fÊush
(
°dîr
);

92 i‡(
glb_ds1
[
i
].
wÆl_buff
 !
NULL
)

94 
tŸÆ
 +
glb_ds1
[
i
].
wÆl_buff_Àn
;

95 
	`‰ì
(
glb_ds1
[
i
].
wÆl_buff
);

97 i‡(
glb_ds1
[
i
].
wÆl_buff2
 !
NULL
)

99 
tŸÆ
 +
glb_ds1
[
i
].
wÆl_buff_Àn
;

100 
	`‰ì
(
glb_ds1
[
i
].
wÆl_buff2
);

104 i‡(
glb_ds1
[
i
].
group
 !
NULL
)

105 
	`‰ì
(
glb_ds1
[
i
].
group
);

108 
	`mem£t
(& 
glb_ds1
[
i
], 0, (
DS1_S
));

109 
	`Ârötf
(
°dîr
, " byã†‰ì = %i\n", 
tŸÆ
);

110 
	`fÊush
(
°dîr
);

111  
tŸÆ
;

112 
	}
}

117 
	$w¥›_2_block
(
i
, 
CELL_W_S
 * 
w_±r
)

119 
‹õ¡©i⁄
;

120 
maö_ödex
;

121 
sub_ödex
;

122 
b
;

124 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
i
].
block_èbÀ
;

126 
w_±r
->
bt_idx
 = -1;

127 i‡(
w_±r
->
¥›1
 == 0) {

130 
w_±r
->
bt_idx
 = 0;

134 
‹õ¡©i⁄
 = 
w_±r
->orientation;

135 
maö_ödex
 = (
w_±r
->
¥›3
 >> 4Ë+ ((w_±r->
¥›4
 & 0x03) << 4);

136 
sub_ödex
 = 
w_±r
->
¥›2
;

137 
b
=0; b<
glb_ds1
[
i
].
bt_num
; b++) {

138 i‡–(
bt_±r
->
‹õ¡©i⁄
 =‹õ¡©i⁄Ë&& (bt_±r->
maö_ödex
 =maö_ödexË&& (bt_±r->
sub_ödex
 =sub_ödexË&& (bt_±r->
u£d_by_edô‹
)) {

139 
w_±r
->
bt_idx
 = 
b
;

142 
bt_±r
++;

146 i‡((
‹õ¡©i⁄
 == 18) || (orientation == 19)) {

147 i‡(
‹õ¡©i⁄
 == 18) {

148 
‹õ¡©i⁄
 = 19;

150 
‹õ¡©i⁄
 = 18;

154 
bt_±r
 = 
glb_ds1
[
i
].
block_èbÀ
;

155 
b
=0; b<
glb_ds1
[
i
].
bt_num
; b++) {

156 i‡–(
bt_±r
->
‹õ¡©i⁄
 =‹õ¡©i⁄Ë&& (bt_±r->
maö_ödex
 =maö_ödexË&& (bt_±r->
sub_ödex
 =sub_ödexË&& (bt_±r->
u£d_by_edô‹
) ) {

157 
w_±r
->
bt_idx
 = 
b
;

160 
bt_±r
++;

164 
sub_ödex
 = 0;

165 
bt_±r
 = 
glb_ds1
[
i
].
block_èbÀ
;

166 
b
=0; b<
glb_ds1
[
i
].
bt_num
; b++) {

167 i‡–(
bt_±r
->
‹õ¡©i⁄
 =‹õ¡©i⁄Ë&& (bt_±r->
maö_ödex
 =maö_ödexË&& (bt_±r->
sub_ödex
 =sub_ödexË&& (bt_±r->
u£d_by_edô‹
) ) {

168 
w_±r
->
bt_idx
 = 
b
;

171 
bt_±r
++;

174 
	}
}

179 
	$Âr›_2_block
(
i
, 
CELL_F_S
 * 
f_±r
)

181 
maö_ödex
, 
sub_ödex
;

182 
b
;

183 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
i
].
block_èbÀ
;

185 
f_±r
->
bt_idx
 = -1;

186 i‡(
f_±r
->
¥›1
 == 0) {

188 
f_±r
->
bt_idx
 = 0;

192 
maö_ödex
 = (
f_±r
->
¥›3
 >> 4Ë+ ((f_±r->
¥›4
 & 0x03) << 4);

193 
sub_ödex
 = 
f_±r
->
¥›2
;

194 
b
=0; b<
glb_ds1
[
i
].
bt_num
; b++) {

195 i‡–(
bt_±r
->
‹õ¡©i⁄
 =0Ë&& (bt_±r->
maö_ödex
 =maö_ödexË&& (bt_±r->
sub_ödex
 =sub_ödexË&& (bt_±r->
u£d_by_edô‹
) ) {

196 
f_±r
->
bt_idx
 = 
b
;

199 
bt_±r
++;

201 
	}
}

206 
	$•r›_2_block
(
i
, 
CELL_S_S
 * 
s_±r
)

208 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
i
].
block_èbÀ
;

209 
maö_ödex
, 
sub_ödex
;

210 
b
;

212 
s_±r
->
bt_idx
 = -1;

213 i‡(
s_±r
->
¥›1
 == 0) {

215 
s_±r
->
bt_idx
 = 0;

219 
maö_ödex
 = (
s_±r
->
¥›3
 >> 4Ë+ ((s_±r->
¥›4
 & 0x03) << 4);

220 
sub_ödex
 = 
s_±r
->
¥›2
;

221 
b
=0; b<
glb_ds1
[
i
].
bt_num
; b++) {

222 i‡–(
bt_±r
->
‹õ¡©i⁄
 =13Ë&& (bt_±r->
maö_ödex
 =maö_ödexË&& (bt_±r->
sub_ödex
 =sub_ödexË&& (bt_±r->
u£d_by_edô‹
) ) {

223 
s_±r
->
bt_idx
 = 
b
;

226 
bt_±r
++;

228 
	}
}

234 
	$ds1_make_¥›_2_block
(
i
)

236 
CELL_F_S
 *
f_±r
;

237 
CELL_S_S
 *
s_±r
;

238 
CELL_W_S
 *
w_±r
;

240 
x
, 
y
, 
n
;

242 
w_±r
 = 
glb_ds1
[
i
].
wÆl_buff
;

243 
f_±r
 = 
glb_ds1
[
i
].
Êo‹_buff
;

244 
s_±r
 = 
glb_ds1
[
i
].
shadow_buff
;

246 
y
=0; y<
glb_ds1
[
i
].
height
; y++) {

247 
x
=0; x<
glb_ds1
[
i
].
width
; x++) {

249 
n
=0;Ç<
glb_ds1
[
i
].
wÆl_num
;Ç++) {

250 
	`w¥›_2_block
(
i
, 
w_±r
);

251 
w_±r
++;

253 
n
=0;Ç<
glb_ds1
[
i
].
Êo‹_num
;Ç++) {

254 
	`Âr›_2_block
(
i
, 
f_±r
);

255 
f_±r
++;

257 
n
=0;Ç<
glb_ds1
[
i
].
shadow_num
;Ç++)

259 
	`•r›_2_block
(
i
, 
s_±r
);

278 
s_±r
++;

282 
	}
}

291 
	$ds1_ªad
(c⁄° * 
ds1«me
, 
ds1_idx
, 
√w_width
, 
√w_height
)

293 
FILE
 * 
ö
;

294 
CELL_F_S
 * 
f_±r
[
FLOOR_MAX_LAYER
];

295 
CELL_S_S
 * 
s_±r
[
SHADOW_MAX_LAYER
];

296 
CELL_T_S
 * 
t_±r
[
TAG_MAX_LAYER
];

297 
CELL_W_S
 * 
w_±r
[
WALL_MAX_LAYER
];

298 
CELL_W_S
 * 
o_±r
[
WALL_MAX_LAYER
];

299 
OBJ_LABEL_S
 * 
œbñ
;

301 
o
, 
x
, 
y
, 
nb_œyî
, 
size
, 
n
, 
p
, 
ds1_Àn
, 
d⁄e
, 
cx
, 
cy
, 
dx
, 
dy
;

302 
cuºít_vÆid_obj_idx
=0;

303 
max_subtûe_width
;

304 
max_subtûe_height
;

305 
w_num
, 
f_num
, 
s_num
, 
t_num
, * 
±r
, 
≈c
, 
∑th
;

306 
œy_°ªam
[14];

307 
dú_lookup
[25] = {

311 
UBYTE
 * 
b±r
;

312 * 
ds1_buff
;

313 
obj_∑th_w¨n_wrŸe
 = 
FALSE
, 
œ°_o
, 
nb
;

314 
tmp
[150], * 
˝å
;

315 
tûe_x
, 
tûe_y
, 
zoom
;

316 
ö¸
;

318 
	`DEBUG_MESSAGE
("ds1_ªad(\"%s\"):ö\n", 
ds1«me
);

320 if(
ds1_idx
 >
DS1_MAX
){

321 
	`FATAL_EXIT
("nŸÉnough fªêds1 slŸ f‹ %s, max i†%i", 
ds1«me
, 
DS1_MAX
);

324 i‡(
	`°æí
(
glb_ds1
[
ds1_idx
].
«me
)){

325 
	`FATAL_EXIT
("ds1 slŸ %òi†Æªady u£d by %s", 
ds1_idx
, 
glb_ds1
[ds1_idx].
«me
);

328 i‡(
	`°ricmp
(
glb_ds1
[
ds1_idx
].
«me
, 
ds1«me
) == 0){

329 
	`FATAL_EXIT
–"ds1 slŸ %òi†ÆªadyÜﬂded (%s)", 
ds1_idx
, 
glb_ds1
[ds1_idx].
«me
);

333 
x
 = 
	`°æí
(
ds1«me
) - 1;

336 (
x
 >0Ë&& (
ds1«me
[x] != '\\') && (ds1name[x] != '/') && (ds1name[x] != ':')){

337 
x
--;

339 i‡(
x
 == 0){

340 
	`°r˝y
(
glb_ds1
[
ds1_idx
].
fûíame
, 
ds1«me
);

342 
	`°r˝y
(
glb_ds1
[
ds1_idx
].
fûíame
, 
ds1«me
 + 
x
 + 1);

344 
	`°r˝y
(
glb_ds1
[
ds1_idx
].
«me
, 
ds1«me
);

349 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
 = 
OBJ_MAX_START
;

353 
size
 = 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
 * ();

354 
glb_ds1
[
ds1_idx
].
døwög_‹dî
 = (*)
	`ˇŒoc
(glb_ds1[ds1_idx].
cuºít_obj_max
, ());

355 if(
glb_ds1
[
ds1_idx
].
døwög_‹dî
 =
NULL
){

356 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ glb_ds1[].døwög_‹dî o‡%s\n", 
size
, 
ds1«me
);

360 
size
 = 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
 * (
OBJ_S
);

361 
glb_ds1
[
ds1_idx
].
obj
 = (
OBJ_S
 *Ë
	`ˇŒoc
(glb_ds1[ds1_idx].
cuºít_obj_max
, (OBJ_S));

362 i‡(
glb_ds1
[
ds1_idx
].
obj
 =
NULL
){

363 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ glb_ds1[].obj o‡%s\n", 
size
, 
ds1«me
);

367 
glb_ds1
[
ds1_idx
].
obj_undo
 = (
OBJ_S
 *)
	`ˇŒoc
(glb_ds1[ds1_idx].
cuºít_obj_max
, (OBJ_S));

368 i‡(
glb_ds1
[
ds1_idx
].
obj_undo
 =
NULL
){

369 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ glb_ds1[].obj_undÿo‡%s\n", 
size
, 
ds1«me
);

373 
x
=0; x < 
WALL_MAX_LAYER
; x++){

374 
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
x
] = 1;

377 
x
=0; x < 
FLOOR_MAX_LAYER
; x++){

378 
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
x
] = 1;

381 
x
=0; x < 
SHADOW_MAX_LAYER
; x++){

382 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
x
] = 3;

385 
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
 = 
OL_NONE
;

386 
glb_ds1
[
ds1_idx
].
∑ths_œyî_mask
 = 1;

387 
glb_ds1
[
ds1_idx
].
wÆkabÀ_œyî_mask
 = 0;

388 
glb_ds1
[
ds1_idx
].
subtûe_hñp_di•œy
 = 1;

389 
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
 = 1;

390 
glb_ds1
[
ds1_idx
].
•ecül_œyî_mask
 = 1;

394 
ö
 = 
	`f›í
(
ds1«me
, "rb");

395 if(
ö
 =
NULL
){

396 
	`FATAL_EXIT
("ˇn'à›í %s\n", 
ds1«me
);

398 
	`f£ek
(
ö
, 0, 
SEEK_END
);

399 
ds1_Àn
 = 
	`·ñl
(
ö
);

400 
	`f£ek
(
ö
, 0, 
SEEK_SET
);

401 
ds1_buff
 = (*Ë
	`mÆloc
(
ds1_Àn
);

402 if(
ds1_buff
 =
NULL
){

403 
	`f˛o£
(
ö
);

404 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ %s\n", 
ds1_Àn
, 
ds1«me
);

406 
	`‰ód
(
ds1_buff
, 
ds1_Àn
, 1, 
ö
);

407 
	`f˛o£
(
ö
);

410 
w_num
 = 0;

411 
f_num
 = 0;

412 
s_num
 = 1;

413 
t_num
 = 0;

414 
±r
 = (*)
ds1_buff
;

530 
glb_ds1
[
ds1_idx
].
vîsi⁄
 = *
±r
;

531 
±r
++;

535 
glb_ds1
[
ds1_idx
].
width
 = (* 
±r
) + 1;

536 
±r
++;

539 
glb_ds1
[
ds1_idx
].
height
 = (* 
±r
) + 1;

540 
±r
++;

543 i‡((
√w_width
 <0Ë|| (
√w_height
 <= 0))

545 
√w_width
 = 
glb_ds1
[
ds1_idx
].
width
;

546 
√w_height
 = 
glb_ds1
[
ds1_idx
].
height
;

551 
glb_ds1
[
ds1_idx
].
a˘
 = 1;

553 if(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 8){

554 
glb_ds1
[
ds1_idx
].
a˘
 = (* 
±r
) + 1;

555 
±r
++;

556 i‡(
glb_ds1
[
ds1_idx
].
a˘
 > 5){

559 
glb_ds1
[
ds1_idx
].
a˘
 = 5;

564 
glb_ds1
[
ds1_idx
].
èg_ty≥
 = 0;

565 if(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 10){

566 
glb_ds1
[
ds1_idx
].
èg_ty≥
 = *
±r
;

567 
±r
++;

570 i‡((
glb_ds1
[
ds1_idx
].
èg_ty≥
 == 1) || (glb_ds1[ds1_idx].tag_type == 2)){

571 
t_num
 = 1;

576 
	`¥ötf
("\nvîsi⁄ : %li\n", 
glb_ds1
[
ds1_idx
].
vîsi⁄
);

577 
	`¥ötf
("width : %li\n", 
glb_ds1
[
ds1_idx
].
width
);

578 
	`¥ötf
("heighà : %li\n", 
glb_ds1
[
ds1_idx
].
height
);

579 
	`¥ötf
("a˘ : %li\n", 
glb_ds1
[
ds1_idx
].
a˘
);

580 
	`¥ötf
("èg_ty≥ : %li\n", 
glb_ds1
[
ds1_idx
].
èg_ty≥
);

583 
glb_ds1
[
ds1_idx
].
fûe_num
 = 0;

584 if(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 3){

586 
glb_ds1
[
ds1_idx
].
fûe_num
 = * 
±r
;

587 
±r
++;

588 
n
 = 0;

589 
	`¥ötf
("fûíame† : %li\n", 
glb_ds1
[
ds1_idx
].
fûe_num
);

591 
x
=0; x<
glb_ds1
[
ds1_idx
].
fûe_num
; x++){

607 
	`¥ötf
(" %2ò: %s\n", 
x
 + 1, ((*Ë
±r
Ë+ 
n
);

608 
n
 +(
	`°æí
–((*Ë
±r
) +Ç) + 1);

611 
glb_ds1
[
ds1_idx
].
fûe_buff
 = (*Ë
	`mÆloc
(
n
);

612 if(
glb_ds1
[
ds1_idx
].
fûe_buff
 =
NULL
){

613 
	`‰ì
(
ds1_buff
);

614 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ fûe†öÅhêds1\n", 
n
);

616 
glb_ds1
[
ds1_idx
].
fûe_Àn
 = 
n
;

619 
	`mem˝y
(
glb_ds1
[
ds1_idx
].
fûe_buff
, 
±r
, 
n
);

620 
±r
 = (*Ë(((*Ë±rË+ 
n
);

623 
	`¥ötf
("no filenames\n");

627 i‡((
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 9) && (glb_ds1[ds1_idx].version <= 13)){

628 
±r
 += 2;

633 if(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 4){

636 
w_num
 = * 
±r
;

637 
±r
++;

640 if(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 16){

641 
f_num
 = * 
±r
;

642 
±r
++;

644 
f_num
 = 1;

649 
w_num
 = 1;

650 
f_num
 = 1;

651 
t_num
 = 1;

655 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 < 4)

657 
œy_°ªam
[0] = 1;

658 
œy_°ªam
[1] = 9;

659 
œy_°ªam
[2] = 5;

660 
œy_°ªam
[3] = 12;

661 
œy_°ªam
[4] = 11;

662 
nb_œyî
 = 5;

684 
nb_œyî
 = 0;

685 
x
=0; x<
w_num
; x++) {

686 
œy_°ªam
[
nb_œyî
++] = 1 + 
x
;

687 
œy_°ªam
[
nb_œyî
++] = 5 + 
x
;

689 
x
=0; x<
f_num
; x++){

690 
œy_°ªam
[
nb_œyî
++] = 9 + 
x
;

692 i‡(
s_num
){

693 
œy_°ªam
[
nb_œyî
++] = 11;

695 i‡(
t_num
){

696 
œy_°ªam
[
nb_œyî
++] = 12;

701 
	`¥ötf
("œyîs: (2 * %lòwÆlsË+ %lòÊo‹†+ %lòshadow" " + %lòèg\n", 
w_num
, 
f_num
, 
s_num
, 
t_num
);

704 if(
glb_c⁄fig
.
Æways_max_œyîs
){

705 
f_num
 = 
FLOOR_MAX_LAYER
;

706 
w_num
 = 
WALL_MAX_LAYER
;

708 
glb_ds1
[
ds1_idx
].
Êo‹_num
 = 
f_num
;

709 
glb_ds1
[
ds1_idx
].
shadow_num
 = 
s_num
;

710 
glb_ds1
[
ds1_idx
].
èg_num
 = 
t_num
;

711 
glb_ds1
[
ds1_idx
].
wÆl_num
 = 
w_num
;

715 
glb_ds1
[
ds1_idx
].
Êo‹_löe
 = 
√w_width
 * glb_ds1[ds1_idx].
Êo‹_num
;

716 
glb_ds1
[
ds1_idx
].
Êo‹_Àn
 = glb_ds1[ds1_idx].
Êo‹_löe
 * 
√w_height
;

717 
glb_ds1
[
ds1_idx
].
Êo‹_buff_Àn
 = glb_ds1[ds1_idx].
Êo‹_Àn
 * (
CELL_F_S
);

718 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 = (
CELL_F_S
 *Ë
	`mÆloc
(glb_ds1[ds1_idx].
Êo‹_buff_Àn
);

719 if(
glb_ds1
[
ds1_idx
].
Êo‹_buff
 =
NULL
){

720 
	`‰ì
(
ds1_buff
);

721 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ flo‹ buf„r\n", 
glb_ds1
[
ds1_idx
].
Êo‹_buff_Àn
);

723 
	`mem£t
(
glb_ds1
[
ds1_idx
].
Êo‹_buff
, 0, glb_ds1[ds1_idx].
Êo‹_buff_Àn
);

726 
glb_ds1
[
ds1_idx
].
Êo‹_buff2
 = (
CELL_F_S
 *Ë
	`mÆloc
(glb_ds1[ds1_idx].
Êo‹_buff_Àn
);

727 if(
glb_ds1
[
ds1_idx
].
Êo‹_buff2
 =
NULL
){

728 
	`‰ì
(
ds1_buff
);

729 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ flo‹ 2nd buf„r\n", 
glb_ds1
[
ds1_idx
].
Êo‹_buff_Àn
);

731 
	`mem£t
(
glb_ds1
[
ds1_idx
].
Êo‹_buff2
, 0, glb_ds1[ds1_idx].
Êo‹_buff_Àn
);

734 
glb_ds1
[
ds1_idx
].
shadow_löe
 = 
√w_width
 * glb_ds1[ds1_idx].
shadow_num
;

735 
glb_ds1
[
ds1_idx
].
shadow_Àn
 = glb_ds1[ds1_idx].
shadow_löe
 * 
√w_height
;

736 
glb_ds1
[
ds1_idx
].
shadow_buff_Àn
 = glb_ds1[ds1_idx].
shadow_Àn
 * (
CELL_S_S
);

737 
glb_ds1
[
ds1_idx
].
shadow_buff
 = (
CELL_S_S
 *Ë
	`mÆloc
(glb_ds1[ds1_idx].
shadow_buff_Àn
);

738 if(
glb_ds1
[
ds1_idx
].
shadow_buff
 =
NULL
){

739 
	`‰ì
(
ds1_buff
);

740 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ shadow buf„r\n", 
glb_ds1
[
ds1_idx
].
shadow_buff_Àn
);

742 
	`mem£t
(
glb_ds1
[
ds1_idx
].
shadow_buff
, 0, glb_ds1[ds1_idx].
shadow_buff_Àn
);

744 
glb_ds1
[
ds1_idx
].
shadow_buff2
 = (
CELL_S_S
 *Ë
	`mÆloc
(glb_ds1[ds1_idx].
shadow_buff_Àn
);

745 i‡(
glb_ds1
[
ds1_idx
].
shadow_buff2
 =
NULL
){

746 
	`‰ì
(
ds1_buff
);

747 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ shadow 2nd buf„r\n", 
glb_ds1
[
ds1_idx
].
shadow_buff_Àn
);

749 
	`mem£t
(
glb_ds1
[
ds1_idx
].
shadow_buff2
, 0, glb_ds1[ds1_idx].
shadow_buff_Àn
);

752 
glb_ds1
[
ds1_idx
].
èg_löe
 = 
√w_width
 * glb_ds1[ds1_idx].
èg_num
;

753 
glb_ds1
[
ds1_idx
].
èg_Àn
 = glb_ds1[ds1_idx].
èg_löe
 * 
√w_height
;

754 
glb_ds1
[
ds1_idx
].
èg_buff_Àn
 = glb_ds1[ds1_idx].
èg_Àn
 * (
CELL_T_S
);

755 
glb_ds1
[
ds1_idx
].
èg_buff
 = (
CELL_T_S
 *Ë
	`mÆloc
(glb_ds1[ds1_idx].
èg_buff_Àn
);

756 i‡(
glb_ds1
[
ds1_idx
].
èg_buff
 =
NULL
) {

757 
	`‰ì
(
ds1_buff
);

758 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹Åag buf„r\n", 
glb_ds1
[
ds1_idx
].
èg_buff_Àn
);

760 
	`mem£t
(
glb_ds1
[
ds1_idx
].
èg_buff
, 0, glb_ds1[ds1_idx].
èg_buff_Àn
);

762 
glb_ds1
[
ds1_idx
].
èg_buff2
 = (
CELL_T_S
 *Ë
	`mÆloc
(glb_ds1[ds1_idx].
èg_buff_Àn
);

763 if(
glb_ds1
[
ds1_idx
].
èg_buff2
 =
NULL
){

764 
	`‰ì
(
ds1_buff
);

765 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹Åag 2nd buf„r\n", 
glb_ds1
[
ds1_idx
].
èg_buff_Àn
);

767 
	`mem£t
(
glb_ds1
[
ds1_idx
].
èg_buff2
, 0, glb_ds1[ds1_idx].
èg_buff_Àn
);

770 
glb_ds1
[
ds1_idx
].
wÆl_löe
 = 
√w_width
 * glb_ds1[ds1_idx].
wÆl_num
;

771 
glb_ds1
[
ds1_idx
].
wÆl_Àn
 = glb_ds1[ds1_idx].
wÆl_löe
 * 
√w_height
;

772 
glb_ds1
[
ds1_idx
].
wÆl_buff_Àn
 = glb_ds1[ds1_idx].
wÆl_Àn
 * (
CELL_W_S
);

773 
glb_ds1
[
ds1_idx
].
wÆl_buff
 = (
CELL_W_S
 *Ë
	`mÆloc
(glb_ds1[ds1_idx].
wÆl_buff_Àn
);

774 if(
glb_ds1
[
ds1_idx
].
wÆl_buff
 =
NULL
){

775 
	`‰ì
(
ds1_buff
);

776 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ wÆ»buf„r\n", 
glb_ds1
[
ds1_idx
].
wÆl_buff_Àn
);

778 
	`mem£t
(
glb_ds1
[
ds1_idx
].
wÆl_buff
, 0, glb_ds1[ds1_idx].
wÆl_buff_Àn
);

780 
glb_ds1
[
ds1_idx
].
wÆl_buff2
 = (
CELL_W_S
 *Ë
	`mÆloc
(glb_ds1[ds1_idx].
wÆl_buff_Àn
);

781 if(
glb_ds1
[
ds1_idx
].
wÆl_buff2
 =
NULL
){

782 
	`‰ì
(
ds1_buff
);

783 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ wÆ»2nd buf„r\n", 
glb_ds1
[
ds1_idx
].
wÆl_buff_Àn
);

785 
	`mem£t
(
glb_ds1
[
ds1_idx
].
wÆl_buff2
, 0, glb_ds1[ds1_idx].
wÆl_buff_Àn
);

790 
x
=0; x<
FLOOR_MAX_LAYER
; x++){

791 
f_±r
[
x
] = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + x;

794 
x
=0; x<
SHADOW_MAX_LAYER
; x++){

795 
s_±r
[
x
] = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + x;

798 
x
=0; x<
TAG_MAX_LAYER
; x++){

799 
t_±r
[
x
] = 
glb_ds1
[
ds1_idx
].
èg_buff
 + x;

802 
x
=0; x<
WALL_MAX_LAYER
; x++){

803 
o_±r
[
x
] = 
w_±r
[x] = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + x;

806 
b±r
 = (
UBYTE
 *Ë
±r
;

809 
n
=0;Ç < 
nb_œyî
;Ç++){

810 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++){

811 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++){

827 
œy_°ªam
[
n
]){

872 if((
x
 < 
√w_width
Ë&& (
y
 < 
√w_height
)){

873 
p
 = 
œy_°ªam
[
n
] - 1;

874 
w_±r
[
p
]->
¥›1
 = * 
b±r
;

875 
b±r
++;

876 
w_±r
[
p
]->
¥›2
 = * 
b±r
;

877 
b±r
++;

878 
w_±r
[
p
]->
¥›3
 = * 
b±r
;

879 
b±r
++;

880 
w_±r
[
p
]->
¥›4
 = * 
b±r
;

881 
b±r
++;

882 
w_±r
[
p
] +
w_num
;

885 
b±r
 += 4;

904 if((
x
 < 
√w_width
Ë&& (
y
 < 
√w_height
)){

905 
p
 = 
œy_°ªam
[
n
] - 5;

906 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 < 7){

907 
o_±r
[
p
]->
‹õ¡©i⁄
 = 
dú_lookup
[* 
b±r
];

910 
o_±r
[
p
]->
‹õ¡©i⁄
 = * 
b±r
;

912 
o_±r
[
p
] +
w_num
;

914 
b±r
 += 4;

921 if((
x
 < 
√w_width
Ë&& (
y
 < 
√w_height
)){

922 
p
 = 
œy_°ªam
[
n
] - 9;

923 
f_±r
[
p
]->
¥›1
 = * 
b±r
;

924 
b±r
++;

925 
f_±r
[
p
]->
¥›2
 = * 
b±r
;

926 
b±r
++;

927 
f_±r
[
p
]->
¥›3
 = * 
b±r
;

928 
b±r
++;

929 
f_±r
[
p
]->
¥›4
 = * 
b±r
;

930 
b±r
++;

931 
f_±r
[
p
] +
f_num
;

933 
b±r
 += 4;

939 if((
x
 < 
√w_width
Ë&& (
y
 < 
√w_height
)){

940 
p
 = 
œy_°ªam
[
n
] - 11;

941 
s_±r
[
p
]->
¥›1
 = * 
b±r
;

942 
b±r
++;

943 
s_±r
[
p
]->
¥›2
 = * 
b±r
;

944 
b±r
++;

945 
s_±r
[
p
]->
¥›3
 = * 
b±r
;

946 
b±r
++;

947 
s_±r
[
p
]->
¥›4
 = * 
b±r
;

948 
b±r
++;

949 
s_±r
[
p
] +
s_num
;

951 
b±r
 += 4;

957 i‡((
x
 < 
√w_width
Ë&& (
y
 < 
√w_height
))

959 
p
 = 
œy_°ªam
[
n
] - 12;

960 
t_±r
[
p
]->
num
 = (
UDWORD
Ë* ((UDWORD *Ë
b±r
);

961 
t_±r
[
p
] +
t_num
;

963 
b±r
 += 4;

969 
p
 = 
√w_width
 - 
glb_ds1
[
ds1_idx
].
width
;

971 if(
p
 > 0){

972 
œy_°ªam
[
n
]){

978 
w_±r
[
œy_°ªam
[
n
] - 1] +
p
 * 
w_num
;

986 
o_±r
[
œy_°ªam
[
n
] - 5] +
p
 * 
w_num
;

992 
f_±r
[
œy_°ªam
[
n
] - 9] +
p
 * 
f_num
;

997 
s_±r
[
œy_°ªam
[
n
] - 11] +
p
 * 
s_num
;

1002 
t_±r
[
œy_°ªam
[
n
] - 12] +
p
 * 
t_num
;

1010 
glb_ds1
[
ds1_idx
].
width
 = 
√w_width
;

1011 
glb_ds1
[
ds1_idx
].
height
 = 
√w_height
;

1014 
±r
 = (*Ë
b±r
;

1016 
glb_ds1
[
ds1_idx
].
obj_num
 = 0;

1017 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 2){

1018 
glb_ds1
[
ds1_idx
].
obj_num
 = *
±r
;

1019 
±r
++;

1021 
	`¥ötf
("obje˘† : %li\n", 
glb_ds1
[
ds1_idx
].
obj_num
);

1023 if(
glb_ds1
[
ds1_idx
].
obj_num
 > glb_ds1[ds1_idx].
cuºít_obj_max
){

1025 
ö¸
 = 1 + 
glb_ds1
[
ds1_idx
].
obj_num
 - glb_ds1[ds1_idx].
cuºít_obj_max
;

1026 i‡(
	`misc_ö¸ó£_ds1_obje˘s_max
(
ds1_idx
, 
ö¸
) != 0){

1027 
	`‰ì
(
ds1_buff
);

1028 
	`FATAL_EXIT
("toÿm™y obje˘†(%ld),Édô‹ max i†<%i>\n", 
glb_ds1
[
ds1_idx
].
obj_num
, glb_ds1[ds1_idx].
cuºít_obj_max
);

1032 
cuºít_vÆid_obj_idx
 = 0;

1035 
max_subtûe_width
 = 
√w_width
 * 5;

1036 
max_subtûe_height
 = 
√w_height
 * 5;

1037 
n
=0;Ç < 
glb_ds1
[
ds1_idx
].
obj_num
;Ç++){

1039 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].
ty≥
 = *
±r
;

1040 
±r
++;

1041 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].
id
 = *
±r
;

1042 
±r
++;

1043 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].x = *
±r
;

1044 
±r
++;

1045 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].y = *
±r
;

1046 
±r
++;

1102 
	`¥ötf
–"x = %4d, y = %4d\n", 
x
, 
y
);

1104 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 > 5){

1106 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].
ds1_Êags
 = * 
±r
;

1107 
±r
++;

1111 if((
x
 >0Ë&& (x < 
max_subtûe_width
Ë&& (
y
 >0Ë&& (y < 
max_subtûe_height
)){

1113 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].
∑th_num
 = 0;

1114 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].
desc_idx
 = -1;

1115 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].
Êags
 = 0;

1117 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].
‰ame_dñè
 = 
	`ønd
()%256;

1134 
œbñ
 = & 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
].label;

1135 
œbñ
->
rx
 =Üabñ->
ry
 =Üabñ->
w
 =Üabñ->
h
 =Üabñ->
Êags
 = 0;

1137 
	`edôobj_make_obj_desc
(
ds1_idx
, 
cuºít_vÆid_obj_idx
);

1138 
cuºít_vÆid_obj_idx
++;

1141 
	`mem£t
–& 
glb_ds1
[
ds1_idx
].
obj
[
cuºít_vÆid_obj_idx
], 0, (glb_ds1[ds1_idx].obj[current_valid_obj_idx]) );

1145 
	`¥ötf
("no objects\n");

1149 
glb_ds1
[
ds1_idx
].
obj_num
 = 
cuºít_vÆid_obj_idx
;

1157 i‡–(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >12Ë&& ((glb_ds1[ds1_idx].
èg_ty≥
 == 1) || (glb_ds1[ds1_idx].tag_type == 2))) {

1161 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 18){

1162 
±r
++;

1165 
glb_ds1
[
ds1_idx
].
group_num
 = 
n
 = * 
±r
;

1166 
±r
++;

1168 
	`¥ötf
("group† : %d\n", 
n
);

1171 
glb_ds1
[
ds1_idx
].
group_size
 = 
size
 = 
n
 * (
GROUP_S
);

1172 
glb_ds1
[
ds1_idx
].
group
 = (
GROUP_S
 *Ë
	`mÆloc
(
size
);

1173 if(
glb_ds1
[
ds1_idx
].
group
 =
NULL
){

1174 
	`‰ì
(
ds1_buff
);

1175 
	`FATAL_EXIT
("nŸÉnough mem (%òbyãsËf‹ groups\n", 
size
);

1177 
	`mem£t
(
glb_ds1
[
ds1_idx
].
group
, 0, 
size
);

1180 
x
=0; x<
n
; x++){

1181 i‡((
UDWORD
Ë
±r
 < (((UDWORDË
ds1_buff
Ë+ 
ds1_Àn
)){

1182 
glb_ds1
[
ds1_idx
].
group
[
x
].
tûe_x
 = * 
±r
;

1184 
±r
++;

1185 i‡((
UDWORD
Ë
±r
 < (((UDWORDË
ds1_buff
Ë+ 
ds1_Àn
)){

1186 
glb_ds1
[
ds1_idx
].
group
[
x
].
tûe_y
 = * 
±r
;

1188 
±r
++;

1189 i‡((
UDWORD
Ë
±r
 < (((UDWORDË
ds1_buff
Ë+ 
ds1_Àn
)){

1190 
glb_ds1
[
ds1_idx
].
group
[
x
].
width
 = * 
±r
;

1192 
±r
++;

1193 i‡((
UDWORD
Ë
±r
 < (((UDWORDË
ds1_buff
Ë+ 
ds1_Àn
)){

1194 
glb_ds1
[
ds1_idx
].
group
[
x
].
height
 = * 
±r
;

1196 
±r
++;

1197 if(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 13){

1198 if((
UDWORD
Ë
±r
 < (((UDWORDË
ds1_buff
Ë+ 
ds1_Àn
)){

1199 
glb_ds1
[
ds1_idx
].
group
[
x
].
unk
 = * 
±r
;

1201 
±r
++;

1205 
	`¥ötf
("no groups\n");

1210 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 14) {

1211 i‡((
UDWORD
Ë
±r
 < (((UDWORDË
ds1_buff
Ë+ 
ds1_Àn
))

1212 
≈c
 = * 
±r
;

1214 
≈c
 = 0;

1215 
±r
++;

1216 
	`¥ötf
("≈¯∑th† : %li\n", 
≈c
);

1217 
n
=0;Ç<
≈c
;Ç++)

1219 
∑th
 = * 
±r
;

1220 
±r
++;

1221 
x
 = * 
±r
;

1222 
±r
++;

1223 
y
 = * 
±r
;

1224 
±r
++;

1227 
o
 = 
œ°_o
 = 
nb
 = 0;

1228 
d⁄e
 = 
FALSE
;

1229 ! 
d⁄e
)

1231 i‡(
o
 < 
glb_ds1
[
ds1_idx
].
obj_num
)

1233 i‡((
glb_ds1
[
ds1_idx
].
obj
[
o
].
x
 =xË&& (glb_ds1[ds1_idx].obj[o].
y
 == y))

1235 
œ°_o
 = 
o
;

1236 
nb
++;

1237 i‡(
nb
 >= 2)

1238 
d⁄e
 = 
TRUE
;

1240 
o
++;

1243 
d⁄e
 = 
TRUE
;

1246 i‡(
nb
 >= 2)

1251 i‡(
obj_∑th_w¨n_wrŸe
 !
TRUE
)

1253 
obj_∑th_w¨n_wrŸe
 = 
TRUE
;

1254 
	`¥ötf
("\n" "ds1_read() : WARNING,ÅhereáreátÜeast 2 objectsátÅhe same coordinates for someÖaths datas.\n");

1256 
	`¥ötf
(" * Removög %ldÖ©h†poöt†o‡1 obje˘áàco‹dö©e†(%ld, %ld)\n", 
∑th
, 
x
, 
y
);

1257 
	`fÊush
(
°dout
);

1260 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

1262 i‡((
glb_ds1
[
ds1_idx
].
obj
[
o
].
x
 =xË&& (glb_ds1[ds1_idx].obj[o].
y
 == y) &&

1263 (
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
 != 0))

1265 
p
=0;Ö < 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
;Ö++)

1267 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].
x
 = 0;

1268 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].
y
 = 0;

1269 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].
a˘i⁄
 = 0;

1270 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].
Êags
 = 0;

1272 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
 = 0;

1277 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 15)

1279 
p
=0;Ö < 
∑th
;Ö++)

1280 
±r
 += 3;

1284 
p
=0;Ö < 
∑th
;Ö++)

1285 
±r
 += 2;

1291 
o
 = 
œ°_o
;

1294 i‡(
o
 >
glb_ds1
[
ds1_idx
].
obj_num
)

1299 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 15)

1301 
p
=0;Ö < 
∑th
;Ö++)

1302 
±r
 += 3;

1306 
p
=0;Ö < 
∑th
;Ö++)

1307 
±r
 += 2;

1314 i‡(
∑th
 > 
WINDS1EDIT_PATH_MAX
)

1316 
	`‰ì
(
ds1_buff
);

1317 
	`FATAL_EXIT
("obje˘ %d havêtoÿmuchÖ©h†(%ld),Édô‹ max i†%ld\n", 
o
, 
∑th
, 
WINDS1EDIT_PATH_MAX
);

1321 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
 = 
∑th
;

1322 
p
=0;Ö < 
∑th
;Ö++)

1324 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].
x
 = * 
±r
;

1325 
±r
++;

1326 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].
y
 = * 
±r
;

1327 
±r
++;

1328 i‡(
glb_ds1
[
ds1_idx
].
vîsi⁄
 >= 15)

1330 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].
a˘i⁄
 = * 
±r
;

1331 
±r
++;

1334 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].
a˘i⁄
 = 1;

1339 
	`edôobj_make_obj_œbñ
(
ds1_idx
);

1341 
	`¥ötf
("noÇpcÖaths\n");

1346 
	`edôobj_£t_døwög_‹dî
(
ds1_idx
);

1349 
glb_ds1
[
ds1_idx
].
cur_zoom
 = 
ZM_11
;

1350 
glb_ds1
[
ds1_idx
].
tûe_w
 = 160;

1351 
glb_ds1
[
ds1_idx
].
tûe_h
 = 80;

1352 
glb_ds1
[
ds1_idx
].
height_mul
 = 1;

1353 
glb_ds1
[
ds1_idx
].
height_div
 = 1;

1354 
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
x
 = 
glb_c⁄fig
.
s¸ﬁl
.keyb.x;

1355 
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
y
 = 
glb_c⁄fig
.
s¸ﬁl
.keyb.y;

1356 
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
x
 = 
glb_c⁄fig
.
s¸ﬁl
.mouse.x;

1357 
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
y
 = 
glb_c⁄fig
.
s¸ﬁl
.mouse.y;

1360 
cx
 = 
glb_ds1
[
ds1_idx
].
width
/2 + 1;

1361 
cy
 = 
glb_ds1
[
ds1_idx
].
height
/2;

1362 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 2);

1363 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 2);

1365 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
dx
 - 
glb_c⁄fig
.
s¸ìn
.
width
 / 2;

1366 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
dy
 - 
glb_c⁄fig
.
s¸ìn
.
height
 / 2;

1367 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
w
 = 
glb_c⁄fig
.
s¸ìn
.
width
;

1368 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
h
 = 
glb_c⁄fig
.
s¸ìn
.
height
;

1370 
	`ch™ge_zoom
(
ds1_idx
, 
ZM_14
);

1373 
˝å
 = 
glb_ds1
[
ds1_idx
].
fûe_buff
;

1374 
tûe_x
 = 
tûe_y
 = 
zoom
 = -1;

1377 if(
glb_c⁄fig
.
w‹k•a˚_íabÀ
){

1380 
x
=0; x<
glb_ds1
[
ds1_idx
].
fûe_num
; x++){

1384 
y
=0; y < 
WRKSPC_MAX
; y++){

1388 
o
 = 0;

1400  (
˝å
[
o
] !0x00Ë&& (
glb_wrk•c_d©as
[
y
].
id
[o] != 0x00) && (cptr[o] == glb_wrkspc_datas[y].id[o]) ){

1402 
o
++;

1404 if((
glb_wrk•c_d©as
[
y
].
id
[
o
] =0x00Ë&& (
˝å
[o]== '=')){

1407 
o
++;

1408 if(
˝å
[
o
] != 0x00){

1409 
y
){

1410 
WRKSPC_TILE_X
:

1411 
	`ssˇnf
(
˝å
 + 
o
, "%li", & 
tûe_x
);

1413 
WRKSPC_TILE_Y
:

1414 
	`ssˇnf
(
˝å
 + 
o
, "%li", & 
tûe_y
);

1416 
WRKSPC_ZOOM
:

1417 
	`ssˇnf
(
˝å
 + 
o
, "%li", & 
zoom
);

1419 
WRKSPC_VERSION
:

1422 
WRKSPC_SAVE_COUNT
:

1423 
	`ssˇnf
(
˝å
 + 
o
, "%lu", & 
glb_ds1
[
ds1_idx
].
ßve_cou¡
);

1431 
˝å
 +(
	`°æí
(cptr) + 1);

1435 if(
zoom
 != -1){

1436 
	`ch™ge_zoom
(
ds1_idx
, 
zoom
);

1438 if((
tûe_x
 !-1Ë&& (
tûe_y
 != -1)){

1439 if(
tûe_x
 < 0){

1440 
tûe_x
 = 0;

1442 if(
tûe_x
 >
glb_ds1
[
ds1_idx
].
width
){

1443 
tûe_x
 = 
glb_ds1
[
ds1_idx
].
width
 - 1;

1445 if(
tûe_y
 < 0){

1446 
tûe_y
 = 0;

1448 i‡(
tûe_y
 >
glb_ds1
[
ds1_idx
].
height
){

1449 
tûe_y
 = 
glb_ds1
[
ds1_idx
].
height
 - 1;

1452 
tûe_x
++;

1453 
dx
 = (
tûe_y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
tûe_x
 * glb_ds1[ds1_idx].tile_w / 2);

1454 
dy
 = (
tûe_y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
tûe_x
 * glb_ds1[ds1_idx].tile_h / 2);

1455 
tûe_x
--;

1457 if(
ds1_idx
 == 0){

1458 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
dx
 - glb_ds1edô.wö_¥evõw.
w
 / 2;

1459 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
dy
 - glb_ds1edô.wö_¥evõw.
h
 / 2;

1461 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
w
 / 2;

1462 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
h
 / 2;

1463 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
w
 = 
glb_ds1edô
.
wö_¥evõw
.w;

1464 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
h
 = 
glb_ds1edô
.
wö_¥evõw
.h;

1469 
	`‰ì
(
ds1_buff
);

1470 
	`°∫˝y
(
glb_ds1
[
ds1_idx
].
undo
.
èg
, "UNDO", (glb_ds1[ds1_idx].undo.tag));

1471 
glb_ds1
[
ds1_idx
].
undo
.
cur_buf_num
 = -1;

1472 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
.
obj_idx
 = -1;

1474 
	`DEBUG_MESSAGE
("ds1_ªad(\"%s\"):out\n", 
ds1«me
);

1476 
	}
}

	@ds1misc.h

1 #i‚de‡
_DS1MISC_H_


3 
	#_DS1MISC_H_


	)

5 
ds1_‰ì
 (
i
);

6 
w¥›_2_block
 (
i
, 
CELL_W_S
 * 
w_±r
);

7 
Âr›_2_block
 (
i
, 
CELL_F_S
 * 
f_±r
);

8 
•r›_2_block
 (
i
, 
CELL_S_S
 * 
s_±r
);

9 
ds1_make_¥›_2_block
 (
i
);

10 
ds1_ªad
 (c⁄° * 
ds1«me
, 
ds1_idx
, 
√w_width
, 
√w_height
);

	@ds1save.c

1 
	~"°ru˘s.h
"

2 
	~"îr‹.h
"

3 
	~"ds1ßve.h
"

4 
	~"w¥evõw.h
"

10 
	$ds1_ßve
(
ds1_idx
, 
is_tmp_fûe
)

12 
CELL_W_S
 * 
w_±r
;

13 
CELL_S_S
 * 
s_±r
;

14 
CELL_F_S
 * 
f_±r
;

15 
CELL_T_S
 * 
t_±r
;

16 
i
=0, 
x
, 
y
, 
t
, 
cur_o
=0, 
p
, 
u£d
, 
Êí
;

17 
FILE
 * 
out
;

18 
n
, 
≈c
 = 0, 
fûe_cou¡
,

19 
ßve_wÆl_num
, 
ßve_Êo‹_num
;

20 
tmp
[512], 
tmp_«me
[256], * 
˝å
;

21 
ax
, 
ay
, 
cx
, 
cy
, 
is_d©a
;

25 i‡(
	`°æí
(
glb_ds1
[
ds1_idx
].
«me
) == 0)

29 
	`°r˝y
(
tmp
, 
glb_ds1
[
ds1_idx
].
«me
);

30 i‡(
	`°æí
(
tmp
) < 4) {

31 
	`FATAL_EXIT
("ds1ßve(), glb_ds1[%i].ds1_«mê< 4 ch¨†: \"%s\" (is_tmp_fûê%i)", 
ds1_idx
, 
glb_ds1
[ds1_idx].
«me
, 
is_tmp_fûe
);

35 
tmp
[
	`°æí
(tmp)-4] = 0;

36 i‡(
is_tmp_fûe
)

39 
	`•rötf
(
tmp_«me
, "%s.tmp", 
tmp
);

40 i‡(
	`fûe_exi°s
(
tmp_«me
, -1, 
NULL
))

41 
	`ªmove
(
tmp_«me
);

49 
	`•rötf
(
tmp_«me
, "%s-%03i.ds1", 
tmp
, 
i
);

50 
	`fûe_exi°s
(
tmp_«me
, -1, 
NULL
))

52 
i
++;

53 
	`•rötf
(
tmp_«me
, "%s-%03i.ds1", 
tmp
, 
i
);

57 i‡(
	`ª«me
(
glb_ds1
[
ds1_idx
].
«me
, 
tmp_«me
)) {

58 
	`FATAL_EXIT
–"ds1ßve(), couldn'àª«mê%†tÿ%s", 
glb_ds1
[
ds1_idx
].
«me
, 
tmp_«me
);

62 
	`°r˝y
(
tmp_«me
, 
glb_ds1
[
ds1_idx
].
«me
);

66 
out
 = 
	`f›í
(
tmp_«me
, "wb");

67 i‡(
out
 =
NULL
) {

68 
	`FATAL_EXIT
("ds1ßve(), c™'àwrôê%s", 
tmp_«me
);

72 
n
 = 18;

73 
	`fwrôe
(& 
n
, 4, 1, 
out
);

76 
n
 = 
glb_ds1
[
ds1_idx
].
width
 - 1;

77 
	`fwrôe
(& 
n
, 4, 1, 
out
);

80 
n
 = 
glb_ds1
[
ds1_idx
].
height
 - 1;

81 
	`fwrôe
(& 
n
, 4, 1, 
out
);

84 
n
 = 
glb_ds1
[
ds1_idx
].
a˘
 - 1;

85 
	`fwrôe
(& 
n
, 4, 1, 
out
);

88 
	`fwrôe
(& 
glb_ds1
[
ds1_idx
].
èg_ty≥
, 4, 1, 
out
);

93 
fûe_cou¡
 = 0;

94 
˝å
 = 
glb_ds1
[
ds1_idx
].
fûe_buff
;

95 
i
=0; i < 
glb_ds1
[
ds1_idx
].
fûe_num
; i++)

97 
Êí
 = 
	`°æí
(
˝å
) + 1;

98 
is_d©a
 = 
FALSE
;

100 
y
=0; y < 
WRKSPC_MAX
; y++)

105 
x
 = 0;

106  (
˝å
[
x
] != 0x00) &&

107 (
glb_wrk•c_d©as
[
y
].
id
[
x
] != 0x00) &&

108 (
˝å
[
x
] =
glb_wrk•c_d©as
[
y
].
id
[x])

112 
x
++;

114 i‡((
glb_wrk•c_d©as
[
y
].
id
[
x
] =0x00Ë&& (
˝å
[x]== '='))

117 
is_d©a
 = 
TRUE
;

121 i‡(
is_d©a
 =
FALSE
)

122 
fûe_cou¡
++;

124 
˝å
 +
Êí
;

126 i‡(
glb_c⁄fig
.
w‹k•a˚_íabÀ
)

127 
fûe_cou¡
 +
WRKSPC_MAX
;

128 
	`fwrôe
(& 
fûe_cou¡
, 4, 1, 
out
);

131 
˝å
 = 
glb_ds1
[
ds1_idx
].
fûe_buff
;

132 
i
=0; i < 
glb_ds1
[
ds1_idx
].
fûe_num
; i++)

134 
Êí
 = 
	`°æí
(
˝å
) + 1;

135 
is_d©a
 = 
FALSE
;

137 
y
=0; y < 
WRKSPC_MAX
; y++)

142 
x
 = 0;

143  (
˝å
[
x
] != 0x00) &&

144 (
glb_wrk•c_d©as
[
y
].
id
[
x
] != 0x00) &&

145 (
˝å
[
x
] =
glb_wrk•c_d©as
[
y
].
id
[x])

149 
x
++;

151 i‡((
glb_wrk•c_d©as
[
y
].
id
[
x
] =0x00Ë&& (
˝å
[x]== '='))

154 
is_d©a
 = 
TRUE
;

158 i‡(
is_d©a
 =
FALSE
)

159 
	`fwrôe
(
˝å
, 
Êí
, 1, 
out
);

162 
˝å
 +
Êí
;

165 i‡(
glb_c⁄fig
.
w‹k•a˚_íabÀ
)

168 
ax
 = 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
 / 2;

169 
ay
 = 
glb_ds1edô
.
wö_¥evõw
.
y0
 + glb_ds1edô.wö_¥evõw.
h
 / 2;

170 
	`co‹d_to_tûe
(
ds1_idx
, 
ax
, 
ay
, & 
cx
, & 
cy
);

171 i‡–(
glb_ds1edô
.
mode
 =
MOD_O
) ||

172 (
glb_ds1edô
.
mode
 =
MOD_P
) ||

173 (
glb_ds1edô
.
mode
 =
MOD_L
) )

175 
cx
 /= 5;

176 
cy
 /= 5;

178 
i
=0; i < 
WRKSPC_MAX
; i++)

180 
i
)

182 
WRKSPC_TILE_X
 :

183 
	`•rötf
(
tmp
, "%s=%i", 
glb_wrk•c_d©as
[
i
].
id
, 
cx
);

184 
	`fwrôe
(
tmp
, 
	`°æí
—mpË+ 1, 1, 
out
);

187 
WRKSPC_TILE_Y
 :

188 
	`•rötf
(
tmp
, "%s=%i", 
glb_wrk•c_d©as
[
i
].
id
, 
cy
);

189 
	`fwrôe
(
tmp
, 
	`°æí
—mpË+ 1, 1, 
out
);

192 
WRKSPC_ZOOM
 :

193 
	`•rötf
(
tmp
, "%s=%i", 
glb_wrk•c_d©as
[
i
].
id
, 
glb_ds1
[
ds1_idx
].
cur_zoom
);

194 
	`fwrôe
(
tmp
, 
	`°æí
—mpË+ 1, 1, 
out
);

197 
WRKSPC_VERSION
 :

198 
	`•rötf
(
tmp
, "%s=Buûd YYYY/MM/DD", 
glb_wrk•c_d©as
[
i
].
id
);

199 
	`fwrôe
(
tmp
, 
	`°æí
—mpË+ 1, 1, 
out
);

202 
WRKSPC_SAVE_COUNT
 :

203 
glb_ds1
[
ds1_idx
].
ßve_cou¡
++;

204 
	`•rötf
(
tmp
, "%s=%lu", 
glb_wrk•c_d©as
[
i
].
id
, 
glb_ds1
[
ds1_idx
].
ßve_cou¡
);

205 
	`fwrôe
(
tmp
, 
	`°æí
—mpË+ 1, 1, 
out
);

212 
ßve_wÆl_num
 = 
glb_ds1
[
ds1_idx
].
wÆl_num
;

213 
ßve_Êo‹_num
 = 
glb_ds1
[
ds1_idx
].
Êo‹_num
;

214 i‡(
glb_c⁄fig
.
möimize_ds1
 =
TRUE
)

218 
i
 = 
ßve_wÆl_num
 - 1; i >= 1; i--)

220 
u£d
 = 
FALSE
;

222 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

224 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

226 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

227 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

228 i‡((
w_±r
->
¥›1
 | w_±r->
¥›2
 | w_±r->
¥›3
 | w_±r->
¥›4
 |

229 
w_±r
->
‹õ¡©i⁄
) != 0)

231 
u£d
 = 
TRUE
;

235 i‡(
u£d
)

238 i‡(
u£d
)

241 
ßve_wÆl_num
--;

246 
i
 = 
ßve_Êo‹_num
 - 1; i >= 1; i--)

248 
u£d
 = 
FALSE
;

250 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

252 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

254 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

255 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

256 i‡((
f_±r
->
¥›1
 | f_±r->
¥›2
 | f_±r->
¥›3
 | f_±r->
¥›4
) != 0)

258 
u£d
 = 
TRUE
;

262 i‡(
u£d
)

265 i‡(
u£d
)

268 
ßve_Êo‹_num
--;

274 
	`fwrôe
(& 
ßve_wÆl_num
, 4, 1, 
out
);

277 
	`fwrôe
(& 
ßve_Êo‹_num
, 4, 1, 
out
);

280 
i
=0; i < 
ßve_wÆl_num
; i++)

283 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

285 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

287 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

288 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

289 
	`Âutc
(
w_±r
->
¥›1
, 
out
);

290 
	`Âutc
(
w_±r
->
¥›2
, 
out
);

291 
	`Âutc
(
w_±r
->
¥›3
, 
out
);

292 
	`Âutc
(
w_±r
->
¥›4
, 
out
);

297 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

299 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

301 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

302 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

303 
	`Âutc
(
w_±r
->
‹õ¡©i⁄
, 
out
);

304 
	`Âutc
(0, 
out
);

305 
	`Âutc
(0, 
out
);

306 
	`Âutc
(0, 
out
);

312 
i
=0; i < 
ßve_Êo‹_num
; i++)

315 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

317 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

319 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

320 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

321 
	`Âutc
(
f_±r
->
¥›1
, 
out
);

322 
	`Âutc
(
f_±r
->
¥›2
, 
out
);

323 
	`Âutc
(
f_±r
->
¥›3
, 
out
);

324 
	`Âutc
(
f_±r
->
¥›4
, 
out
);

330 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

333 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

335 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

337 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

338 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
i
;

339 
	`Âutc
(
s_±r
->
¥›1
, 
out
);

340 
	`Âutc
(
s_±r
->
¥›2
, 
out
);

341 
	`Âutc
(
s_±r
->
¥›3
, 
out
);

342 
	`Âutc
(
s_±r
->
¥›4
, 
out
);

348 i‡(
glb_ds1
[
ds1_idx
].
èg_ty≥
)

350 
i
=0; i<
glb_ds1
[
ds1_idx
].
èg_num
; i++)

353 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

355 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

357 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
èg_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
èg_num
);

358 
t_±r
 = 
glb_ds1
[
ds1_idx
].
èg_buff
 + 
t
 + 
i
;

359 
	`fwrôe
–& 
t_±r
->
num
, 4, 1, 
out
);

366 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj_num
, 4, 1, 
out
);

367 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

369 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
i
].
ty≥
, 4, 1, 
out
);

370 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
i
].
id
, 4, 1, 
out
);

371 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
i
].
x
, 4, 1, 
out
);

372 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
i
].
y
, 4, 1, 
out
);

373 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
i
].
ds1_Êags
, 4, 1, 
out
);

374 i‡(
glb_ds1
[
ds1_idx
].
obj
[
i
].
∑th_num
)

375 
≈c
++;

379 i‡(
glb_ds1
[
ds1_idx
].
èg_ty≥
)

382 
n
 = 0;

383 
	`fwrôe
(&
n
, 4, 1, 
out
);

386 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
group_num
, 4, 1, 
out
);

389 
i
=0; i < 
glb_ds1
[
ds1_idx
].
group_num
; i++)

391 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
group
[
i
].
tûe_x
, 4, 1, 
out
);

392 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
group
[
i
].
tûe_y
, 4, 1, 
out
);

393 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
group
[
i
].
width
, 4, 1, 
out
);

394 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
group
[
i
].
height
, 4, 1, 
out
);

395 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
group
[
i
].
unk
, 4, 1, 
out
);

400 
	`fwrôe
(&
≈c
, 4, 1, 
out
);

401 
i
=0; i < 
≈c
; i++)

403  ! 
glb_ds1
[
ds1_idx
].
obj
[
cur_o
].
∑th_num
)

404 
cur_o
++;

405 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
cur_o
].
∑th_num
, 4, 1, 
out
);

406 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
cur_o
].
x
, 4, 1, 
out
);

407 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
cur_o
].
y
, 4, 1, 
out
);

408 
p
=0;Ö < 
glb_ds1
[
ds1_idx
].
obj
[
cur_o
].
∑th_num
;Ö++)

410 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
cur_o
].
∑th
[
p
].
x
, 4, 1, 
out
);

411 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
cur_o
].
∑th
[
p
].
y
, 4, 1, 
out
);

412 
	`fwrôe
(&
glb_ds1
[
ds1_idx
].
obj
[
cur_o
].
∑th
[
p
].
a˘i⁄
, 4, 1, 
out
);

414 
cur_o
++;

418 
	`f˛o£
(
out
);

419 
	}
}

	@ds1save.h

1 #i‚de‡
_DS1SAVE_H_


3 
	#_DS1SAVE_H_


	)

5 
ds1_ßve
(
ds1_idx
, 
is_tmp_fûe
);

	@dt1_draw.c

1 
	~"°ru˘s.h
"

2 
	~"dt1_døw.h
"

7 
	$døw_sub_tûe_isomëric
 (
BITMAP
 * 
d°
, 
x0
, 
y0
, 
UBYTE
 * 
d©a
, 
Àngth
)

9 
UBYTE
 * 
±r
 = 
d©a
;

10 
x
, 
y
=0, 
n
,

11 
xjump
[15] = {14, 12, 10, 8, 6, 4, 2, 0, 2, 4, 6, 8, 10, 12, 14},

12 
nbpix
[15] = {4, 8, 12, 16, 20, 24, 28, 32, 28, 24, 20, 16, 12, 8, 4};

15 i‡(
Àngth
 != 256)

19 
Àngth
 > 0)

21 
x
 = 
xjump
[
y
];

22 
n
 = 
nbpix
[
y
];

23 
Àngth
 -
n
;

24 
n
)

26 
	`puçixñ
(
d°
, 
x0
+
x
, 
y0
+
y
, * 
±r
);

27 
±r
++;

28 
x
++;

29 
n
--;

31 
y
++;

33 
	}
}

38 
	$døw_sub_tûe_n‹mÆ
 (
BITMAP
 * 
d°
, 
x0
, 
y0
, 
UBYTE
 * 
d©a
,

39 
Àngth
)

41 
UBYTE
 * 
±r
 = 
d©a
, 
b1
, 
b2
;

42 
x
=0, 
y
=0;

45 
Àngth
 > 0)

47 
b1
 = * 
±r
;

48 
b2
 = * (
±r
 + 1);

49 
±r
 += 2;

50 
Àngth
 -= 2;

51 i‡(
b1
 || 
b2
)

53 
x
 +
b1
;

54 
Àngth
 -
b2
;

55 
b2
)

57 
	`puçixñ
(
d°
, 
x0
+
x
, 
y0
+
y
, * 
±r
);

58 
±r
++;

59 
x
++;

60 
b2
--;

65 
x
 = 0;

66 
y
++;

69 
	}
}

	@dt1_draw.h

1 #i‚de‡
_DT1_DRAW_H_


3 
	#_DT1_DRAW_H_


	)

5 
døw_sub_tûe_isomëric
 (
BITMAP
 * 
d°
, 
x0
, 
y0
, 
UBYTE
 * 
d©a
, 
Àngth
);

6 
døw_sub_tûe_n‹mÆ
 (
BITMAP
 * 
d°
, 
x0
, 
y0
, 
UBYTE
 * 
d©a
, 
Àngth
);

	@dt1misc.c

1 
	~<°rög.h
>

2 
	~"°ru˘s.h
"

3 
	~"îr‹.h
"

4 
	~"dt1_døw.h
"

5 
	~"misc.h
"

6 
	~"mpqvõw.h
"

7 
	~"dt1misc.h
"

12 
	$dt1_Æªady_lﬂded
(* 
dt1«me
, * 
idx
)

14 
i
;

16 
i
=0; i<
DT1_MAX
; i++) {

17 i‡(
	`°ricmp
(
glb_dt1
[
i
].
«me
, 
dt1«me
) == 0) {

18 * 
idx
 = 
i
;

19  
TRUE
;

22 * 
idx
 = -1;

23  
FALSE
;

24 
	}
}

29 
	$dt1_‰ì
(
i
)

31 
BITMAP
 * 
bmp_±r
;

32 
size
 = 
glb_dt1
[
i
].
buff_Àn
 + glb_dt1[i].
bh_buff_Àn
;

33 
z
, 
b
;

36 i‡(
	`°æí
(
glb_dt1
[
i
].
«me
) == 0)

39 
	`Ârötf
(
°dîr
, " . %s\n", 
glb_dt1
[
i
].
«me
);

40 
	`fÊush
(
°dîr
);

43 
z
=0; z<
ZM_MAX
; z++)

45 i‡(
glb_dt1
[
i
].
block_zoom
[
z
] !
NULL
)

47 
b
=0; b < 
glb_dt1
[
i
].
block_num
; b++)

49 
bmp_±r
 = * (
glb_dt1
[
i
].
block_zoom
[
z
] + 
b
);

50 i‡(
bmp_±r
 !
NULL
)

52 
size
 +
bmp_±r
->
w
 * bmp_±r->
h
 + (
BITMAP
);

53 
	`de°roy_bôm≠
(
bmp_±r
);

56 
size
 +
glb_dt1
[
i
].
bz_size
[
z
];

57 
	`‰ì
(
glb_dt1
[
i
].
block_zoom
[
z
]);

62 i‡(
glb_dt1
[
i
].
bh_buf„r
 !
NULL
)

64 
	`‰ì
(
glb_dt1
[
i
].
bh_buf„r
);

68 i‡(
glb_dt1
[
i
].
buf„r
 !
NULL
)

70 
	`‰ì
(
glb_dt1
[
i
].
buf„r
);

74 
	`mem£t
(& 
glb_dt1
[
i
], 0, (
DT1_S
));

75  
size
;

76 
	}
}

83 
	$dt1_dñ
(
i
)

85 i‡–(
i
 < 0Ë|| (ò>
DT1_MAX
))

88 i‡(
glb_dt1
[
i
].
ds1_ußge
 <= 0)

91 
glb_dt1
[
i
].
ds1_ußge
--;

92 i‡(
glb_dt1
[
i
].
ds1_ußge
 == 0)

93 
	`dt1_‰ì
(
i
);

95 
	}
}

100 
	$dt1_bh_upd©e
(
i
)

102 
BLOCK_S
 * 
bh_±r
 = 
glb_dt1
[
i
].
bh_buf„r
;

103 
UBYTE
 * 
±r
;

104 
b
, 
t
, 
idxèbÀ
[25] = {20, 21, 22, 23, 24,

110 
±r
 = (
UBYTE
 *Ë
glb_dt1
[
i
].
buf„r
 + glb_dt1[i].
bh_°¨t
;

111 
b
=0; b < 
glb_dt1
[
i
].
block_num
; b++)

113 
bh_±r
->
dúe˘i⁄
 = * (*Ë
±r
;

114 
bh_±r
->
roof_y
 = * (
WORD
 *Ë(
±r
 + 4);

115 
bh_±r
->
sound
 = * (
UBYTE
 *Ë(
±r
 + 6);

116 
bh_±r
->
™im©ed
 = * (
UBYTE
 *Ë(
±r
 + 7);

117 
bh_±r
->
size_y
 = * (*Ë(
±r
 + 8);

118 
bh_±r
->
size_x
 = * (*Ë(
±r
 + 12);

120 
bh_±r
->
‹õ¡©i⁄
 = * (*Ë(
±r
 + 20);

121 
bh_±r
->
maö_ödex
 = * (*Ë(
±r
 + 24);

122 
bh_±r
->
sub_ödex
 = * (*Ë(
±r
 + 28);

123 
bh_±r
->
ørôy
 = * (*Ë(
±r
 + 32);

125 
t
=0;Å<25;Å++)

126 
bh_±r
->
sub_tûes_Êags
[
idxèbÀ
[
t
]] = * (
UBYTE
 *Ë(
±r
 + 40 +Å);

128 
bh_±r
->
tûes_±r
 = * (*Ë(
±r
 + 72);

129 
bh_±r
->
tûes_Àngth
 = * (*Ë(
±r
 + 76);

130 
bh_±r
->
tûes_numbî
 = * (*Ë(
±r
 + 80);

134 
bh_±r
++;

135 
±r
 += 96;

137 
	}
}

142 
	$dt1_fûl_subt
(
SUB_TILE_S
 * 
±r
, 
i
, 
tûes_±r
, 
s
)

144 
UBYTE
 * 
°_±r
;

146 
°_±r
 = (
UBYTE
 *Ë
glb_dt1
[
i
].
buf„r
 + 
tûes_±r
 + (20 * 
s
);

147 
±r
->
x_pos
 = * (
WORD
 *Ë
°_±r
;

148 
±r
->
y_pos
 = * (
WORD
 *Ë(
°_±r
 + 2);

150 
±r
->
x_grid
 = * (
UBYTE
 *Ë(
°_±r
 + 6);

151 
±r
->
y_grid
 = * (
UBYTE
 *Ë(
°_±r
 + 7);

152 
±r
->
f‹m©
 = * (
WORD
 *Ë(
°_±r
 + 8);

153 
±r
->
Àngth
 = * (*Ë(
°_±r
 + 10);

155 
±r
->
d©a_off£t
 = * (*Ë((
UBYTE
 *)
°_±r
 + 16);

156 
	}
}

161 
	$dt1_zoom
(
BITMAP
 * 
§c
, 
i
, 
b
, 
z
)

163 
BITMAP
 * 
d°
;

164 
w
 = 
§c
->w, 
h
 = src->h, 
d
=1;

165 
tmp_°r
[100];

167 
z
)

169 
ZM_11
 : ;

170 
ZM_12
 : 
d
 = 2; ;

171 
ZM_14
 : 
d
 = 4; ;

172 
ZM_18
 : 
d
 = 8; ;

173 
ZM_116
 : 
d
 = 16; ;

175 
w
 /
d
;

176 
h
 /
d
;

177 
d°
 = 
	`¸óã_bôm≠
(
w
, 
h
);

178 i‡(
d°
 =
NULL
)

180 
	`FATAL_EXIT
–"dt1_zoom(%i, %i, %i), c™'àmakê®bôm≠ o‡%ò* %òpixñs\n", 
i
, 
b
, 
z
, 
w
, 
h
);

182 
	`°ªtch_blô
(
§c
, 
d°
, 0, 0, src->
w
, src->
h
, 0, 0, w, h);

184 * (
glb_dt1
[
i
].
block_zoom
[
z
] + 
b
Ë
d°
;

185 
	}
}

196 
	$dt1_Æl_zoom_make
(
i
)

198 
BLOCK_S
 * 
b_±r
, * 
my_b_±r
;

199 
SUB_TILE_S
 
°_±r
;

200 
BITMAP
 * 
tmp_bmp
, * 
•rôe
;

201 
b
, 
w
, 
h
, 
s
, 
x0
, 
y0
, 
Àngth
, 
y_add
, 
z
, 
mem_size
;

202 
UBYTE
 * 
d©a
;

203 
WORD
 
f‹m©
;

204 
‹õ¡©i⁄
;

205 
tmp_°r
[100];

206 
t_mi
, 
t_si
, 
my_idx
;

208 
b_±r
 = (
BLOCK_S
 *Ë
glb_dt1
[
i
].
bh_buf„r
;

210 
	`Ârötf
(
°dîr
, "makög zoom f‹ glb_dt1[%i] (%sË", 
i
, 
glb_dt1
[i].
«me
);

211 
	`fÊush
(
°dîr
);

213 
z
=0; z<
ZM_MAX
; z++)

216 
mem_size
 = (
BITMAP
 *Ë* 
glb_dt1
[
i
].
block_num
;

217 
glb_dt1
[
i
].
block_zoom
[
z
] = (
BITMAP
 **Ë
	`mÆloc
(
mem_size
);

218 i‡(
glb_dt1
[
i
].
block_zoom
[
z
] =
NULL
) {

219 
	`FATAL_EXIT
("dt1_Æl_zoom_make(%i), zoom %i,ÇŸÉnough mem f‹ %òbyãs\n", 
i
, 
z
, 
mem_size
);

221 
	`mem£t
(
glb_dt1
[
i
].
block_zoom
[
z
], 0, 
mem_size
);

222 
glb_dt1
[
i
].
bz_size
[
z
] = 
mem_size
;

226 
b
=0; b < 
glb_dt1
[
i
].
block_num
; b++)

230 
‹õ¡©i⁄
 = 
b_±r
->orientation;

233 
w
 = 
b_±r
->
size_x
;

234 i‡((
‹õ¡©i⁄
 == 10) || (orientation == 11))

235 
w
 = 160;

237 
h
 = - 
b_±r
->
size_y
;

242 
y_add
 = 96;

243 i‡((
‹õ¡©i⁄
 == 0) || (orientation == 15))

245 i‡(
b_±r
->
size_y
)

247 
b_±r
->
size_y
 = - 80;

248 
h
 = 80;

249 
y_add
 = 0;

252 i‡(
‹õ¡©i⁄
 < 15)

254 i‡(
b_±r
->
size_y
)

256 
b_±r
->
size_y
 += 32;

257 
h
 -= 32;

258 
y_add
 = 
h
;

263 i‡((
w
 =0Ë|| (
h
 == 0))

265 
	`Ârötf
(
°dîr
, "0");

266 
	`fÊush
(
°dîr
);

267 
b_±r
 ++;

272 
tmp_bmp
 = 
	`¸óã_bôm≠
(
w
, 
h
);

273 i‡(
tmp_bmp
 =
NULL
) {

274 
	`FATAL_EXIT
("dt1_Æl_zoom_make(%i), c™'àmakê®bôm≠ o‡%ò* %òpixñs\n", 
i
, 
w
, 
h
);

276 
	`˛ór
(
tmp_bmp
);

279 
s
=0; s < 
b_±r
->
tûes_numbî
; s++)

283 
	`dt1_fûl_subt
(& 
°_±r
, 
i
, 
b_±r
->
tûes_±r
, 
s
);

286 
x0
 = 
°_±r
.
x_pos
;

287 
y0
 = 
y_add
 + 
°_±r
.
y_pos
;

288 
d©a
 = (
UBYTE
 *Ë((UBYTE *)
glb_dt1
[
i
].
buf„r
 + 
b_±r
->
tûes_±r
 + 
°_±r
.
d©a_off£t
);

289 
Àngth
 = 
°_±r
.length;

290 
f‹m©
 = 
°_±r
.format;

293 i‡(
f‹m©
 == 0x0001)

296 
	`døw_sub_tûe_isomëric
(
tmp_bmp
, 
x0
, 
y0
, 
d©a
, 
Àngth
);

298 
	`døw_sub_tûe_n‹mÆ
(
tmp_bmp
, 
x0
, 
y0
, 
d©a
, 
Àngth
);

302 i‡–(
glb_ds1edô
.
cmd_löe
.
no_vis_debug
 =
FALSE
) &&

303 (
i
 !0Ë&& ((
‹õ¡©i⁄
 == 10) || (orientation == 11))

307 
t_mi
 = 
b_±r
->
maö_ödex
;

308 
t_si
 = 
b_±r
->
sub_ödex
;

309 
my_b_±r
 = (
BLOCK_S
 *Ë
glb_dt1
[0].
bh_buf„r
;

312 
my_idx
=0; my_idx < 
glb_dt1
[0].
block_num
; my_idx++)

314 i‡–(
my_b_±r
[
my_idx
].
‹õ¡©i⁄
 == orientation) &&

315 (
my_b_±r
[
my_idx
].
maö_ödex
 =
t_mi
) &&

316 (
my_b_±r
[
my_idx
].
sub_ödex
 =
t_si
)

320 
•rôe
 = * (
glb_dt1
[0].
block_zoom
[
ZM_11
] + 
my_idx
);

321 i‡(
•rôe
 !
NULL
)

322 
	`døw_•rôe
(
tmp_bmp
, 
•rôe
, 0,Åmp_bmp->
h
 - sprite->h);

325 
my_idx
 = 
glb_dt1
[0].
block_num
;

331 
z
=0; z<
ZM_MAX
; z++)

332 
	`dt1_zoom
(
tmp_bmp
, 
i
, 
b
, 
z
);

335 
	`de°roy_bôm≠
(
tmp_bmp
);

338 
b_±r
 ++;

339 
	`Ârötf
(
°dîr
, ".");

340 
	`fÊush
(
°dîr
);

342 
	`Ârötf
(
°dîr
, "\n");

343 
	`fÊush
(
°dîr
);

344 
	}
}

349 
	$dt1_°ru˘_upd©e
(
i
)

351 * 
±r
 = 
glb_dt1
[
i
].
buf„r
;

352 
size
;

353 
tmp
[100];

355 i‡(
±r
 =
NULL
)

359 
glb_dt1
[
i
].
x1
 = * (*Ë
±r
;

360 
glb_dt1
[
i
].
x2
 = * (*Ë((
UBYTE
 *)
±r
 + 4);

361 
glb_dt1
[
i
].
block_num
 = * (*Ë((
UBYTE
 *)
±r
 + 268);

362 
glb_dt1
[
i
].
bh_°¨t
 = * (*Ë((
UBYTE
 *)
±r
 + 272);

365 
	`¥ötf
("°ru˘ d©®o‡glb_dt1[%i] :\n", 
i
);

366 
	`¥ötf
(" x1 = %li\n", 
glb_dt1
[
i
].
x1
);

367 
	`¥ötf
(" x2 = %li\n", 
glb_dt1
[
i
].
x2
);

368 
	`¥ötf
(" block_num = %li\n", 
glb_dt1
[
i
].
block_num
);

369 
	`¥ötf
(" bh_°¨à = 0x%0lX\n", 
glb_dt1
[
i
].
bh_°¨t
);

372 
size
 = (
BLOCK_S
Ë* 
glb_dt1
[
i
].
block_num
;

373 
glb_dt1
[
i
].
bh_buf„r
 = (*Ë
	`mÆloc
(
size
);

374 i‡(
glb_dt1
[
i
].
bh_buf„r
 =
NULL
) {

375 
	`FATAL_EXIT
("dt1_°ru˘_upd©e(%i),ÇŸÉnough mem‹y f‹ %òbyãs\n", 
i
, 
size
);

377 
glb_dt1
[
i
].
bh_buff_Àn
 = 
size
;

379 
	`dt1_bh_upd©e
(
i
);

380 
	`dt1_Æl_zoom_make
(
i
);

381 
	}
}

389 
	$dt1_add
(* 
dt1«me
)

391 
i
, 
idx
, 
íåy
;

392 
tmp
[256];

394 i‡(
	`dt1_Æªady_lﬂded
(
dt1«me
, & 
idx
Ë=
TRUE
)

396 
glb_dt1
[
idx
].
ds1_ußge
++;

397  
idx
;

402 
i
=0; i<
DT1_MAX
; i++)

404 i‡(
glb_dt1
[
i
].
ds1_ußge
 == 0)

407 
íåy
 = 
	`misc_lﬂd_mpq_fûe
(

408 
dt1«me
,

409 (**Ë& 
glb_dt1
[
i
].
buf„r
,

410 & 
glb_dt1
[
i
].
buff_Àn
,

411 
TRUE


413 i‡(
íåy
 == -1) {

414 
	`FATAL_EXIT
("dt1_add(Ë: fûê%†nŸ found", 
dt1«me
);

418 
	`°r˝y
(
glb_dt1
[
i
].
«me
, 
dt1«me
);

419 
glb_dt1
[
i
].
ds1_ußge
 = 1;

421 
	`dt1_°ru˘_upd©e
(
i
);

424 
	`‰ì
(
glb_dt1
[
i
].
buf„r
);

425 
glb_dt1
[
i
].
buf„r
 = 
NULL
;

426 
glb_dt1
[
i
].
buff_Àn
 = 0;

429  
i
;

432 
	`FATAL_EXIT
("ˇ¿nŸÜﬂd %†‰om mpq,\¡oÿmuch dt1áÃódyÜﬂded (%i)", 
dt1«me
, 
DT1_MAX
);

435 
	}
}

440 
	$dt1_add_•ecül
(* 
dt1«me
)

445 
i
, 
idx
, 
íåy
;

446 
tmp
[256];

448 i‡(
	`dt1_Æªady_lﬂded
(
dt1«me
, & 
idx
Ë=
TRUE
) {

449 
glb_dt1
[
idx
].
ds1_ußge
++;

450  
idx
;

453 
i
=0; i<
DT1_MAX
; i++) {

454 i‡(
glb_dt1
[
i
].
ds1_ußge
 == 0) {

456 
íåy
 = 
	`mod_lﬂd_ö_mem
(".", 
dt1«me
, & 
glb_dt1
[
i
].
buf„r
, & glb_dt1[i].
buff_Àn
);

457 i‡(
íåy
 == -1) {

458 
	`FATAL_EXIT
("(dt1_add_•ecülËfûê%†nŸ found", 
dt1«me
);

460 
	`¥ötf
(", found\n");

464 
	`°r˝y
(
glb_dt1
[
i
].
«me
, 
dt1«me
);

465 
glb_dt1
[
i
].
ds1_ußge
 = 1;

466 
	`dt1_°ru˘_upd©e
(
i
);

469 
	`‰ì
(
glb_dt1
[
i
].
buf„r
);

470 
glb_dt1
[
i
].
buf„r
 = 
NULL
;

471 
glb_dt1
[
i
].
buff_Àn
 = 0;

474  
i
;

477 
	`FATAL_EXIT
("ˇ¿nŸÜﬂd %†‰om mpq,\¡oÿmuch dt1áÃódyÜﬂded (%i)", 
dt1«me
, 
DT1_MAX
);

480 
	}
}

	@dt1misc.h

1 #i‚de‡
_DT1MISC_H_


3 
	#_DT1MISC_H_


	)

5 
dt1_Æªady_lﬂded
 (* 
dt1«me
, * 
idx
);

6 
dt1_‰ì
 (
i
);

7 
dt1_dñ
 (
i
);

8 
dt1_bh_upd©e
 (
i
);

9 
dt1_fûl_subt
 (
SUB_TILE_S
 * 
±r
, 
i
, 
tûes_±r
, 
s
);

10 
dt1_zoom
 (
BITMAP
 * 
§c
, 
i
, 
b
, 
z
);

11 
dt1_Æl_zoom_make
 (
i
);

12 
dt1_°ru˘_upd©e
 (
i
);

13 
dt1_add
 (* 
dt1«me
);

14 
dt1_add_•ecül
 (* 
dt1«me
);

	@editobj.c

1 
	~"°ru˘s.h
"

2 
	~"misc.h
"

3 
	~"îr‹.h
"

4 
	~"™im.h
"

5 
	~"edô∑th.h
"

6 
	~"edôobj.h
"

11 
	$edôobj_qs‹t_hñ≥r_døwög_‹dî
(c⁄° * 
e1
, c⁄° * 
e2
)

13 
ds1_idx
 = 
glb_ds1edô
.
obj_‹dî_ds1_idx
;

14 
i1
 = * ((*Ë
e1
),

15 
i2
 = * ((*Ë
e2
);

16 
OBJ_S
 * 
o1
, * 
o2
;

21 
o1
 = & 
glb_ds1
[
ds1_idx
].
obj
[
i1
];

22 
o2
 = & 
glb_ds1
[
ds1_idx
].
obj
[
i2
];

23 i‡(
o1
->
ty
 =
o2
->ty){

24 i‡(
o1
->
tx
 =
o2
->tx){

25 i‡(
glb_ds1edô
.
obj_sub_tûe_‹dî
[
o1
->
sx
][o1->
sy
] =glb_ds1edô.obj_sub_tûe_‹dî[
o2
->sx][o2->sy]){

26  
i1
 - 
i2
;

28  
glb_ds1edô
.
obj_sub_tûe_‹dî
[
o1
->
sy
][o1->
sx
] - glb_ds1edô.obj_sub_tûe_‹dî[
o2
->sy][o2->sx];

31  
o1
->
tx
 - 
o2
->tx;

34  
o1
->
ty
 - 
o2
->ty;

35 
	}
}

40 
	$edôobj_£t_døwög_‹dî
(
ds1_idx
)

42 
OBJ_S
 *
obj
;

43 
i
;

135 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++){

136 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
i
];

137 
obj
->
tx
 = obj->
x
 / 5L;

138 
obj
->
sx
 = obj->
x
 % 5L;

139 
obj
->
ty
 = obj->
y
 / 5L;

140 
obj
->
sy
 = obj->
y
 % 5L;

141 
	`¥ötf
–"obj = %4ld,Åx = %4ld,Åy = %4ld, sx = %4ld, sy = %4ld\n", 
i
, 
obj
->
tx
, obj->
ty
, obj->
sx
, obj->
sy
 );

148 
i
 = 
glb_ds1
[
ds1_idx
].
obj_num
; i < glb_ds1[ds1_idx].
cuºít_obj_max
; i++){

149 
glb_ds1
[
ds1_idx
].
obj
[
i
].
ty
 = 32000L;

153 
i
=0; i < 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
; i++){

154 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[
i
] = i;

158 
glb_ds1edô
.
obj_‹dî_ds1_idx
 = 
ds1_idx
;

165 
	`qs‹t
–
glb_ds1
[
ds1_idx
].
døwög_‹dî
, glb_ds1[ds1_idx].
obj_num
, (), 
edôobj_qs‹t_hñ≥r_døwög_‹dî
 );

168 
i
=0; i < 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
; i++){

169 
	`¥ötf
–"‹dî = %4d, idx = %4d\n", 
i
, 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[i] );

273 
	}
}

278 
	$edôobj_make_obj_œbñ
(
ds1_idx
)

280 
OBJ_LABEL_S
 * 
œbñ
;

281 
d
, 
o
, 
w
, 
wtmp
, 
h
;

282 
ty≥
, 
id
;

285 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

287 
ty≥
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].type;

288 
id
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].id;

289 
d
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
;

290 
œbñ
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
].label;

292 
w
 = 16 * 8;

293 
h
 = 2 * 8 + 2;

295 i‡(
d
 != -1)

297 
wtmp
 = 8 * 
	`°æí
(
glb_ds1edô
.
obj_desc
[
d
].
desc
);

298 i‡(
wtmp
 > 
w
)

299 
w
 = 
wtmp
;

301 
œbñ
->
rx
 = 0;

302 
œbñ
->
ry
 = 0;

303 
œbñ
->
w
 = w;

304 
œbñ
->
h
 = h;

305 
œbñ
->
Êags
 = 0;

307 
	}
}

313 
	$edôobj_døw_obj_œb
(
ds1_idx
, 
is_shadow
)

315 
OBJ_LABEL_S
 * 
œbñ
;

316 
d
, 
dx
, 
dy
, 
o
, 
cx
, 
cy
, 
w
, 
h
, 
p
, 
lo›
, 
f1
, 
f2
;

317 
ty≥
, 
id
, 
x
, 
y
;

318 
ox0
, 
oy0
, 
lx0
, 
ly0
;

319 
hm
 = 
glb_ds1
[
ds1_idx
].
height_mul
;

320 
hd
 = 
glb_ds1
[
ds1_idx
].
height_div
;

321 
x1
, 
x2
, 
x3
, 
x4
, 
y1
, 
y2
, 
y3
;

322 
cﬁ‹1
=0, 
cﬁ‹2
=0, 
cﬁ‹3
=0;

323 
o_idx
;

326 
lo›
=0;Üoop<3;Üoop++)

331 
o_idx
=0; o_idx < 
glb_ds1
[
ds1_idx
].
obj_num
; o_idx++)

333 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[
o_idx
];

335 
ty≥
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].type;

336 
id
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].id;

337 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].x;

338 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].y;

340 
d
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
;

341 
p
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
;

342 
f1
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
;

343 
œbñ
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
].label;

344 
w
 = 
œbñ
->w;

345 
h
 = 
œbñ
->h;

346 
f2
 = 
œbñ
->
Êags
;

348 i‡(
is_shadow
)

350 i‡–! 
	`IS_MOVING
(
f1
 | 
f2
))

353 
cﬁ‹1
 = 186;

354 
cﬁ‹2
 = 209;

355 
cﬁ‹3
 = 214;

357 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
ﬁd_x
;

358 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
ﬁd_y
;

362 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].x;

363 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].y;

367 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

368 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

369 
ox0
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

370 
oy0
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 16;

373 i‡(
is_shadow
)

375 
lx0
 = 
ox0
 + (
œbñ
->
ﬁd_rx
 * 
hm
 / 
hd
);

376 
ly0
 = 
oy0
 + (
œbñ
->
ﬁd_ry
 * 
hm
 / 
hd
);

380 
lx0
 = 
ox0
 + (
œbñ
->
rx
 * 
hm
 / 
hd
);

381 
ly0
 = 
oy0
 + (
œbñ
->
ry
 * 
hm
 / 
hd
);

385 i‡(
is_shadow
 =
FALSE
)

387 
cﬁ‹1
 = 0;

388 
cﬁ‹2
 = 255;

389 
cﬁ‹3
 = 255;

390 i‡(
	`IS_SELECTED
(
f1
))

392 
cﬁ‹1
 = 118;

393 
cﬁ‹2
 = 132;

394 
cﬁ‹3
 = 132;

396 i‡(
	`IS_MOUSE_OVER
(
f1
))

398 
cﬁ‹2
 = 129;

399 i‡(
	`IS_SELECTED
(
f2
))

401 
cﬁ‹1
 = 118;

402 
cﬁ‹3
 = 132;

405 
cﬁ‹3
 = 129;

407 i‡(
	`IS_SELECTED
(
f2
))

409 
cﬁ‹1
 = 118;

410 
cﬁ‹3
 = 132;

412 i‡(
	`IS_MOUSE_OVER
(
f2
))

413 
cﬁ‹3
 = 129;

416 
lo›
)

420 
cx
 = 
x
 + 2;

421 
cy
 = 
y
 - 2;

423 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 10);

424 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 10);

426 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

427 
x2
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 10 - 1;

428 
x3
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 10;

429 
x4
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 5 - 1;

431 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
;

432 
y2
 = 
y1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10 - 1;

433 
y3
 = 
y1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 5 - 2;

435 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y2
, 
x2
, 
y1
, 
cﬁ‹2
);

436 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x3
, 
y1
, 
x4
, 
y2
, 
cﬁ‹2
);

437 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x3
, 
y3
, 
x4
, 
y2
, 
cﬁ‹2
);

438 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y2
, 
x2
, 
y3
, 
cﬁ‹2
);

444 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ox0
+1, 
oy0
+17, ox0+1, oy0+1, 0);

445 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ox0
+1, 
oy0
+1, 
lx0
+1, 
ly0
+1, 0);

446 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
lx0
+1, 
ly0
+1,Üx0+1,Üy0-8, 0);

449 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ox0
, 
oy0
+16, ox0, oy0, 
cﬁ‹2
);

450 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ox0
, 
oy0
, 
lx0
, 
ly0
, 
cﬁ‹2
);

451 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
lx0
, 
ly0
,Üx0,Üy0-9, 
cﬁ‹2
);

453 i‡(
	`IS_SELECTED
(
f1
))

455 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ox0
-1, 
oy0
+16, ox0-1, oy0, 
cﬁ‹2
);

456 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ox0
-1, 
oy0
, 
lx0
-1, 
ly0
, 
cﬁ‹2
);

457 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
lx0
-1, 
ly0
,Üx0-1,Üy0-9, 
cﬁ‹2
);

458 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
ox0
-2, 
oy0
+14, ox0+1, oy0+16, 
cﬁ‹2
);

461 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
ox0
-1, 
oy0
+14, ox0+1, oy0+16, 
cﬁ‹2
);

468 
x1
 = 
lx0
 - (
w
/2) - 2;

469 
x2
 = 
x1
 + 
w
 + 4;

470 
y1
 = 
ly0
 - 8 - 
h
 - 4;

471 
y2
 = 
y1
 + 
h
 + 2;

473 i‡(
is_shadow
 =
FALSE
)

475 
œbñ
->
x0
 = 
x1
;

476 
œbñ
->
y0
 = 
y1
;

480 i‡((
x1
 >
glb_c⁄fig
.
s¸ìn
.
width
) ||

481 (
y1
 >
glb_c⁄fig
.
s¸ìn
.
height
) ||

482 (
x2
 < 0Ë|| (
y2
 < 0))

485 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
cﬁ‹1
);

486 
	`ª˘
 (
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
cﬁ‹3
);

489 
x2
 = 
x1
 + 2 + (
w
/2);

490 
y2
 = 
y1
 + 2;

491 i‡(
d
 == -1) {

492 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x2
 - 8, 
y2
, 255, "??");

494 
x2
 -(8 * 
	`°æí
(
glb_ds1edô
.
obj_desc
[
d
].
desc
) / 2);

495 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x2
, 
y2
, 255, "%s", glb_ds1edô.
obj_desc
[
d
].
desc
);

499 
x2
 = 
x1
 + 2;

500 
y2
 += 8 + 2;

501 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x2
, 
y2
, 
is_shadow
 ? 255 : 111, "#%i", 
o
);

504 i‡(
id
 <-100Ë
x2
 = 
lx0
 - 3 * 8;

505 i‡(
id
 <-10Ë
x2
 = 
lx0
 - 2 * 8 - 4;

506 i‡(
id
 < 0Ë
x2
 = 
lx0
 - 8 - 4;

507 i‡(
id
 < 10Ë
x2
 = 
lx0
 - 8 - 4;

508 i‡(
id
 < 100Ë
x2
 = 
lx0
 - 2 * 8;

509 
x2
 = 
lx0
 - 2 * 8 - 4;

510 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x2
, 
y2
, 
is_shadow
 ? 255 : 11, "%ld", 
ty≥
);

514 
x2
 += 1*8;

515 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x2
, 
y2
, 
is_shadow
 ? 255 : 255, " %ld", 
id
);

518 i‡(
p
 < 10)

519 
x2
 = 
x1
 + 
w
 + 4 - 2 * 8;

521 
x2
 = 
x1
 + 
w
 + 4 - 3 * 8;

522 i‡(
p
 == 0) {

523 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x2
, 
y2
, 
is_shadow
 ? 255 : 208, "P-");

525 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x2
, 
y2
, 
is_shadow
 ? 255 : 133, "P%i", 
p
);

531 
	}
}

536 
	$edôobj_make_obj_desc
(
ds1_idx
, 
obj_idx
)

538 *
nb_ty≥_≥r_a˘_±r
;

539 
a˘
, 
ty≥
, 
id
, 
i
;

541 
a˘
 = 
glb_ds1
[
ds1_idx
].act;

542 
ty≥
 = 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].type;

543 
id
 = 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].id;

546 
i
=0; i < 
glb_ds1edô
.
obj_desc_num
; i++){

547 if–(
glb_ds1edô
.
obj_desc
[
i
].
a˘
 =a˘Ë&& (glb_ds1edô.obj_desc[i].
ty≥
 =ty≥Ë&& (glb_ds1edô.obj_desc[i].
id
 == id) ){

549 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
desc_idx
 = 
i
;

558 i‡(
ty≥
 == 1){

559 
nb_ty≥_≥r_a˘_±r
 = & 
glb_c⁄fig
.
nb_ty≥1_≥r_a˘
;

560 }i‡(
ty≥
 == 2){

561 
nb_ty≥_≥r_a˘_±r
 = & 
glb_c⁄fig
.
nb_ty≥2_≥r_a˘
;

564 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
desc_idx
 = -1;

568 
id
 < 0){

570 
a˘
--;

571 
id
 +(* 
nb_ty≥_≥r_a˘_±r
);

573 
id
 >(* 
nb_ty≥_≥r_a˘_±r
)){

575 
a˘
++;

576 
id
 -(* 
nb_ty≥_≥r_a˘_±r
);

580 
i
=0; i < 
glb_ds1edô
.
obj_desc_num
; i++){

581 if–(
glb_ds1edô
.
obj_desc
[
i
].
a˘
 =a˘Ë&& (glb_ds1edô.obj_desc[i].
ty≥
 =ty≥Ë&& (glb_ds1edô.obj_desc[i].
id
 == id) ){

583 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
desc_idx
 = 
i
;

589 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
desc_idx
 = -1;

590 
	}
}

595 
	$edôobj_make_obj_√w_id
(
ds1_idx
, 
obj_idx
)

597 
a˘
, 
ty≥
, 
id
, 
d
, * 
nb_ty≥_≥r_a˘_±r
;

600 
d
 = 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
desc_idx
;

601 
a˘
 = 
glb_ds1edô
.
obj_desc
[
d
].act;

602 
ty≥
 = 
glb_ds1edô
.
obj_desc
[
d
].type;

603 
id
 = 
glb_ds1edô
.
obj_desc
[
d
].id;

605 i‡(
ty≥
 == 1)

606 
nb_ty≥_≥r_a˘_±r
 = & 
glb_c⁄fig
.
nb_ty≥1_≥r_a˘
;

607 i‡(
ty≥
 == 2)

608 
nb_ty≥_≥r_a˘_±r
 = & 
glb_c⁄fig
.
nb_ty≥2_≥r_a˘
;

612 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
ty≥
 =Åype;

613 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
id
 = id;

617 
a˘
 < 
glb_ds1
[
ds1_idx
].act)

620 
a˘
++;

621 
id
 -(* 
nb_ty≥_≥r_a˘_±r
);

623 
a˘
 > 
glb_ds1
[
ds1_idx
].act)

626 
a˘
--;

627 
id
 +(* 
nb_ty≥_≥r_a˘_±r
);

631 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
ty≥
 =Åype;

632 
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
id
 = id;

633 
	}
}

638 
	$edôobj_˛ór_obj_œb_£l
(
ds1_idx
)

640 
i
;

643 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

645 
	`DEL_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
œbñ
.
Êags
);

646 
	`DEL_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
Êags
);

648 
	}
}

653 
	$edôobj_˛ór_obj_œb_ovî
(
ds1_idx
)

655 
i
;

658 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

660 
	`DEL_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
œbñ
.
Êags
);

661 
	`DEL_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
Êags
);

663 
	}
}

668 
	$edôobj_˛ór_obj_œb_Êags
(
ds1_idx
)

670 
i
;

673 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

674 
glb_ds1
[
ds1_idx
].
obj
[
i
].
Êags
 = glb_ds1[ds1_idx].obj[i].
œbñ
.flags = 0;

675 
	}
}

684 
	$edôobj_ovî_obj_œb
(
ds1_idx
, * 
±r_t
, * 
±r_o
,

685 
cx
, 
cy
, 
mx
, 
my
)

687 
OBJ_LABEL_S
 * 
œbñ
;

688 
lo›
, 
o
, 
w
, 
h
, 
x
, 
y
, 
x0
, 
y0
, 
œ°_t
=0, 
œ°_o
 = -1;

689 
ªdøw
 = 
FALSE
, 
o_idx
;

692 
lo›
=0;Üoop<2;Üoop++)

694 
o_idx
=0; o_idx < 
glb_ds1
[
ds1_idx
].
obj_num
; o_idx++)

696 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[
o_idx
];

697 
lo›
)

701 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].x;

702 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].y;

703 i‡((
cx
 =
x
Ë&& (
cy
 =
y
))

706 
œ°_t
 = 2;

707 
œ°_o
 = 
o
;

712 i‡(
	`IS_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
))

715 
ªdøw
 = 
TRUE
;

722 
œbñ
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
].label;

723 
w
 = 
œbñ
->w;

724 
h
 = 
œbñ
->h;

725 
x0
 = 
œbñ
->x0;

726 
y0
 = 
œbñ
->y0;;

727 i‡((
mx
 >
x0
Ë&& (
my
 >
y0
Ë&& (mx < x0+
w
+4) &&

728 (
my
 < 
y0
+
h
+4))

731 
œ°_t
 = 1;

732 
œ°_o
 = 
o
;

737 i‡(
	`IS_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
œbñ
.
Êags
))

740 
ªdøw
 = 
TRUE
;

748 i‡(
ªdøw
 =
TRUE
)

751 
	`edôobj_˛ór_obj_œb_ovî
(
ds1_idx
);

752 i‡(
œ°_o
 != -1)

754 i‡(
œ°_t
 == 1)

755 
	`SET_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
œ°_o
].
œbñ
.
Êags
);

757 
	`SET_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
œ°_o
].
Êags
);

761 i‡(
œ°_o
 != -1)

764 i‡(
œ°_t
 == 1)

767 i‡–! 
	`IS_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
œ°_o
].
œbñ
.
Êags
))

770 
	`edôobj_˛ór_obj_œb_ovî
(
ds1_idx
);

771 
	`SET_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
œ°_o
].
œbñ
.
Êags
);

772 
ªdøw
 = 
TRUE
;

778 i‡–! 
	`IS_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
œ°_o
].
Êags
))

781 
	`edôobj_˛ór_obj_œb_ovî
(
ds1_idx
);

782 
	`SET_MOUSE_OVER
(
glb_ds1
[
ds1_idx
].
obj
[
œ°_o
].
Êags
);

783 
ªdøw
 = 
TRUE
;

789 * 
±r_t
 = 
œ°_t
;

790 * 
±r_o
 = 
œ°_o
;

791  
ªdøw
;

792 
	}
}

798 
	$edôobj_¥ï¨e_movög
(
ds1_idx
)

800 
OBJ_LABEL_S
 * 
œbñ
;

801 
OBJ_S
 * 
±r_obj
;

802 
o
;

805 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

807 
±r_obj
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
];

808 
œbñ
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
].label;

809 i‡(
	`IS_SELECTED
(
±r_obj
->
Êags
 | 
œbñ
->flags))

811 i‡(
	`IS_SELECTED
(
±r_obj
->
Êags
))

812 
	`SET_MOVING
(
±r_obj
->
Êags
);

814 i‡(
	`IS_SELECTED
(
œbñ
->
Êags
))

815 
	`SET_MOVING
(
œbñ
->
Êags
);

817 
±r_obj
->
ﬁd_x
 =Öå_obj->
x
;

818 
±r_obj
->
ﬁd_y
 =Öå_obj->
y
;

819 
œbñ
->
ﬁd_rx
 =Üabñ->
rx
;

820 
œbñ
->
ﬁd_ry
 =Üabñ->
ry
;

823 
	}
}

828 
	$edôobj_movög_obj_œb
(
ds1_idx
, 
dcx
, 
dcy
, 
dmx
, 
dmy
)

830 
OBJ_LABEL_S
 * 
œbñ
;

831 
OBJ_S
 * 
±r_obj
;

832 
ﬁd_dcx
, 
ﬁd_dcy
, 
ﬁd_dmx
, 
ﬁd_dmy
, 
ﬁd_ds1_idx
 = -1;

833 
o
, 
ªdøw
 = 
FALSE
, 
ßve_ﬁd
 = FALSE;

836 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

838 
±r_obj
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
];

839 i‡(
	`IS_MOVING
(
±r_obj
->
Êags
))

841 i‡((
ﬁd_dcx
 !
dcx
Ë|| (
ﬁd_dcy
 !
dcy
Ë|| (
ds1_idx
 !
ﬁd_ds1_idx
))

843 
±r_obj
->
x
 =Öå_obj->
ﬁd_x
 + 
dcx
;

844 
±r_obj
->
y
 =Öå_obj->
ﬁd_y
 + 
dcy
;

846 i‡(
±r_obj
->
x
 < 0)

847 
±r_obj
->
x
 = 0;

848 i‡(
±r_obj
->
x
 >
glb_ds1
[
ds1_idx
].
width
 * 5)

849 
±r_obj
->
x
 = 
glb_ds1
[
ds1_idx
].
width
 * 5 - 1;

851 i‡(
±r_obj
->
y
 < 0)

852 
±r_obj
->
y
 = 0;

853 i‡(
±r_obj
->
y
 >
glb_ds1
[
ds1_idx
].
height
 * 5)

854 
±r_obj
->
y
 = 
glb_ds1
[
ds1_idx
].
height
 * 5 - 1;

856 
ßve_ﬁd
 = 
TRUE
;

860 
œbñ
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
].label;

861 i‡(
	`IS_MOVING
(
œbñ
->
Êags
))

863 i‡((
ﬁd_dmx
 !
dmx
Ë|| (
ﬁd_dmy
 !
dmy
Ë|| (
ds1_idx
 !
ﬁd_ds1_idx
))

865 
œbñ
->
rx
 =Üabñ->
ﬁd_rx
 + 
dmx
;

866 
œbñ
->
ry
 =Üabñ->
ﬁd_ry
 + 
dmy
;

868 
ßve_ﬁd
 = 
TRUE
;

872 i‡((
ßve_ﬁd
Ë|| (
ds1_idx
 !
ﬁd_ds1_idx
))

874 
ﬁd_ds1_idx
 = 
ds1_idx
;

875 
ﬁd_dcx
 = 
dcx
;

876 
ﬁd_dcy
 = 
dcy
;

877 
ﬁd_dmx
 = 
dmx
;

878 
ﬁd_dmy
 = 
dmy
;

879 
ªdøw
 = 
TRUE
;

881  
ªdøw
;

882 
	}
}

887 
	$edôobj_íd_move_obj_œb
(
ds1_idx
)

889 
OBJ_LABEL_S
 * 
œbñ
;

890 
OBJ_S
 * 
±r_obj
;

891 
o
;

894 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

896 
±r_obj
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
];

897 
	`DEL_MOVING
(
±r_obj
->
Êags
);

899 
œbñ
 = & 
±r_obj
->label;

900 
	`DEL_MOVING
(
œbñ
->
Êags
);

902 
	}
}

907 
	$edôobj_¥ï¨e_undo
(
ds1_idx
)

909 
OBJ_S
 * 
±r_s
, * 
±r_d
;

910 
o
;

913 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

915 
±r_s
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
];

916 
±r_d
 = & 
glb_ds1
[
ds1_idx
].
obj_undo
[
o
];

917 
	`mem˝y
(
±r_d
, 
±r_s
,  (
OBJ_S
));

919 
glb_ds1
[
ds1_idx
].
obj_num_undo
 = glb_ds1[ds1_idx].
obj_num
;

920 
glb_ds1
[
ds1_idx
].
ˇn_undo_obj
 = 
TRUE
;

921 
	}
}

926 
	$edôobj_undo
(
ds1_idx
)

928 
OBJ_S
 * 
±r_s
, * 
±r_d
;

929 
o
;

933 i‡(
glb_ds1
[
ds1_idx
].
ˇn_undo_obj
 =
FALSE
)

936 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num_undo
; o++)

938 
±r_s
 = & 
glb_ds1
[
ds1_idx
].
obj_undo
[
o
];

939 
±r_d
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
];

940 
	`mem˝y
(
±r_d
, 
±r_s
,  (
OBJ_S
));

942 
glb_ds1
[
ds1_idx
].
obj_num
 = glb_ds1[ds1_idx].
obj_num_undo
;

943 
	}
}

949 
	$edôobj_dñ_obj
(
ds1_idx
)

951 
OBJ_S
 * 
±r_s
, * 
±r_d
;

952 
s
=0, 
d
=0, 
n
=0, 
max
 = 
glb_ds1
[
ds1_idx
].
obj_num
, 
d⁄e
 = 
FALSE
;

955  ! 
d⁄e
)

957 
±r_d
 = & 
glb_ds1
[
ds1_idx
].
obj
[
d
];

958 i‡(
	`IS_SELECTED
(
±r_d
->
Êags
))

961 (
s
 < 
max
Ë&& 
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[s].
Êags
))

962 
s
++;

964 i‡(
s
 < 
max
)

967 
±r_s
 = & 
glb_ds1
[
ds1_idx
].
obj
[
s
];

968 
	`mem˝y
(
±r_d
, 
±r_s
,  (
OBJ_S
));

969 
	`SET_SELECTED
(
±r_s
->
Êags
);

972 
d⁄e
 = 
TRUE
;

974 i‡(
d⁄e
 =
FALSE
)

976 
n
++;

977 
d
++;

978 
s
++;

979 i‡(
d
 >
max
)

980 
d⁄e
 = 
TRUE
;

985 
s
=
n
; s < 
max
; s++)

986 
	`mem£t
–& 
glb_ds1
[
ds1_idx
].
obj
[
s
], 0, (
OBJ_S
));

989 
glb_ds1
[
ds1_idx
].
obj_num
 = 
n
;

990 
	}
}

996 
	$edôobj_c›y_obj
(
ds1_idx
)

998 
OBJ_S
 * 
±r_s
, * 
±r_d
;

999 
o
, 
d
, 
nb
=0, 
max
 = 
glb_ds1
[
ds1_idx
].
obj_num
;

1000 
ö¸
;

1004 
o
=0; o < 
max
; o++)

1005 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
))

1006 
nb
++;

1009 i‡(
nb
 <= 0)

1013 i‡((
max
 + 
nb
Ë>
glb_ds1
[
ds1_idx
].
cuºít_obj_max
)

1015 
ö¸
 = 1 + (
max
 + 
nb
Ë- 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
;

1016 i‡(
	`misc_ö¸ó£_ds1_obje˘s_max
(
ds1_idx
, 
ö¸
) != 0)

1021 
d
 = 
max
;

1022 
o
=0; o < 
max
; o++)

1024 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
))

1026 
±r_s
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
];

1027 
±r_d
 = & 
glb_ds1
[
ds1_idx
].
obj
[
d
];

1028 
	`mem˝y
(
±r_d
, 
±r_s
,  (
OBJ_S
));

1029 
	`DEL_SELECTED
(
±r_s
->
Êags
);

1030 
	`SET_MOUSE_OVER
(
±r_s
->
Êags
);

1031 
±r_d
->
‰ame_dñè
 = 
	`ønd
()%256;;

1032 
d
++;

1035 
glb_ds1
[
ds1_idx
].
obj_num
 = 
max
 + 
nb
;

1036 
	}
}

1103 
	$edôobj_cou¡_£l_obj
(
ds1_idx
)

1105 
o
, 
nb
=0;

1108 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

1109 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
))

1110 
nb
++;

1112  
nb
;

1113 
	}
}

1119 
	$edôobj_ö£π_obj
(
ds1_idx
, 
cx
, 
cy
)

1121 
OBJ_LABEL_S
 * 
œbñ
;

1122 
OBJ_S
 * 
±r_o
;

1123 
d
, 
id
, 
ty≥
, 
obj
, 
w
, 
wtmp
, 
h
;

1124 
ö¸
;

1127 
obj
 = 
glb_ds1
[
ds1_idx
].
obj_num
;

1128 i‡(
obj
 >
glb_ds1
[
ds1_idx
].
cuºít_obj_max
)

1130 
ö¸
 = 1 + 
obj
 - 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
;

1131 i‡(
	`misc_ö¸ó£_ds1_obje˘s_max
(
ds1_idx
, 
ö¸
) != 0)

1135 
glb_ds1
[
ds1_idx
].
obj_num
++;

1136 
±r_o
 = & 
glb_ds1
[
ds1_idx
].
obj
[obj];

1138 
±r_o
->
ty≥
 = 1;

1139 
±r_o
->
id
 = 0;

1140 
±r_o
->
x
 = 
cx
;

1141 
±r_o
->
y
 = 
cy
;

1142 
±r_o
->
∑th_num
 = 0;

1143 
±r_o
->
Êags
 = 0;

1144 
	`SET_SELECTED
(
±r_o
->
Êags
);

1145 
±r_o
->
‰ame_dñè
 = 
	`ønd
()%256;

1146 
	`edôobj_make_obj_desc
(
ds1_idx
, 
obj
);

1148 
ty≥
 = 
±r_o
->type;

1149 
id
 = 
±r_o
->id;

1150 
d
 = 
±r_o
->
desc_idx
;

1151 
œbñ
 = & 
±r_o
->label;

1153 
w
 = 16 * 8;

1154 
h
 = 2 * 8 + 2;

1156 i‡(
d
 != -1)

1158 
wtmp
 = 8 * 
	`°æí
(
glb_ds1edô
.
obj_desc
[
d
].
desc
);

1159 i‡(
wtmp
 > 
w
)

1160 
w
 = 
wtmp
;

1162 
œbñ
->
rx
 = 0;

1163 
œbñ
->
ry
 = 0;

1164 
œbñ
->
w
 = w;

1165 
œbñ
->
h
 = h;

1166 
œbñ
->
Êags
 = 0;

1169 
	}
}

1174 
	$edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
obj_idx
)

1176 
WIN_EDT_OBJ_S
 * 
±r_w
 = & 
glb_ds1
[
ds1_idx
].
wö_edt_obj
;

1177 
OBJ_DESC_S
 * 
±r_d
;

1178 
EDT_BUT_S
 * 
b
;

1179 
a˘
, 
w
, 
h
, 
desc_Àn
 = 0, 
Àn
, 
n
, 
d
, 
i
, 
x0
, 
y0
, 
typ
;

1180 
myb‹dî
 = 2;

1182 
x1
, 
y1
, 
x2
, 
y2
, 
x
, 
y
;

1184 
«me
[10];

1185 } 
but_öô
[
EB_MAX
] = {

1199 
w
 = 
glb_c⁄fig
.
s¸ìn
.
width
;

1200 
h
 = 
glb_c⁄fig
.
s¸ìn
.
height
;

1201 
a˘
 = 
±r_w
->
cur_a˘
;

1202 
typ
 = 
±r_w
->
cur_ty≥
;

1205 
±r_w
->
desc_íd
 =Öå_w->
desc_°¨t
 = -1;

1206 
d
=0; d < 
glb_ds1edô
.
obj_desc_num
; d++)

1208 
±r_d
 = & 
glb_ds1edô
.
obj_desc
[
d
];

1209 i‡((
±r_d
->
a˘
 =a˘Ë&& (±r_d->
ty≥
 =
typ
))

1211 
Àn
 = 1 + 
	`°æí
(
±r_d
->
desc
);

1212 i‡(
Àn
 > 
desc_Àn
)

1213 
desc_Àn
 = 
Àn
;

1214 i‡(
±r_w
->
desc_°¨t
 == -1)

1215 
±r_w
->
desc_°¨t
 = 
d
;

1216 
±r_w
->
desc_íd
 = 
d
;

1219 
n
 = 
	`°æí
(" Description");

1220 i‡(
n
 > 
desc_Àn
)

1221 
desc_Àn
 = 
n
;

1222 
±r_w
->
desc_ch¨
 = 
desc_Àn
;

1223 
±r_w
->
desc_num
 =Öå_w->
desc_íd
 -Öå_w->
desc_°¨t
 + 1;

1224 
±r_w
->
obj_idx
 = obj_idx;

1227 
±r_w
->
x0
 = 5;

1228 
±r_w
->
y0
 = 15;

1229 
±r_w
->
h
 = 
glb_c⁄fig
.
s¸ìn
.
height
 -Öå_w->
y0
 - 20;

1230 
±r_w
->
num
 = (’å_w->
h
 - 69 - (3 * 10)Ë/ 10Ë- 
myb‹dî
;

1231 i‡(
±r_w
->
num
 < 1)

1232 
±r_w
->
num
 = 1;

1233 
±r_w
->
h
 = 69 + 10 * (3 +Öå_w->
num
 + 
myb‹dî
) + 5;

1235 i‡(
glb_ds1edô
.
obj_desc
[
±r_w
->
desc_cur
].
a˘
 !±r_w->
cur_a˘
)

1236 
±r_w
->
°¨t
 =Öå_w->
desc_°¨t
;

1237 i‡(
glb_ds1
[
ds1_idx
].
obj
[
obj_idx
].
desc_idx
 == -1)

1239 
±r_w
->
°¨t
 =Öå_w->
desc_°¨t
;

1243 
±r_w
->
°¨t
 =Öå_w->
desc_cur
 - (±r_w->
num
 / 2);

1244 i‡(
±r_w
->
°¨t
 +Öå_w->
num
 >Öå_w->
desc_íd
)

1245 
±r_w
->
°¨t
 =Öå_w->
desc_íd
 -Öå_w->
num
 + 1;

1246 i‡(
±r_w
->
°¨t
 <Öå_w->
desc_°¨t
)

1247 
±r_w
->
°¨t
 =Öå_w->
desc_°¨t
;

1250 
±r_w
->
w
 = 8 * (4 + 3 + 
desc_Àn
 + 5);

1251 i‡(
±r_w
->
w
 < 358)

1252 
±r_w
->
w
 = 358;

1255 
x0
 = 
±r_w
->x0 + 8;

1256 
y0
 = 
±r_w
->y0 + 8;

1257 
i
=0; i<
EB_MAX
; i++)

1259 
b
 = & 
±r_w
->
buâ⁄
[
i
];

1260 
b
->
box
.
x1
 = 
x0
 + 
but_öô
[
i
].x1;

1261 
b
->
box
.
y1
 = 
y0
 + 
but_öô
[
i
].y1;

1262 
b
->
box
.
x2
 = 
x0
 + 
but_öô
[
i
].x2;

1263 
b
->
box
.
y2
 = 
y0
 + 
but_öô
[
i
].y2;

1264 
b
->
txt
.
x
 = 
x0
 + 
but_öô
[
i
].x;

1265 
b
->
txt
.
y
 = 
y0
 + 
but_öô
[
i
].y;

1266 
	`°r˝y
(
b
->
«me
, 
but_öô
[
i
].name);

1267 
b
->
Êags
 = 0;

1271 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_OK
].
Êags
);

1272 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_CANCEL
].
Êags
);

1273 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_TYPE1
].
Êags
);

1274 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_TYPE2
].
Êags
);

1276 i‡(
typ
 == 1)

1278 
	`SET_SELECTED
(
±r_w
->
buâ⁄
[
EB_TYPE1
].
Êags
);

1280 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT1
].
Êags
);

1281 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT2
].
Êags
);

1282 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT3
].
Êags
);

1283 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT4
].
Êags
);

1284 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT5
].
Êags
);

1288 
	`SET_SELECTED
(
±r_w
->
buâ⁄
[
EB_TYPE2
].
Êags
);

1289 i‡(
glb_c⁄fig
.
n‹mÆ_ty≥2
 =
TRUE
)

1292 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT1
].
Êags
);

1295 i‡(
glb_ds1
[
ds1_idx
].
a˘
 >= 2)

1296 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT2
].
Êags
);

1298 i‡(
glb_ds1
[
ds1_idx
].
a˘
 >= 3)

1299 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT3
].
Êags
);

1301 i‡(
glb_ds1
[
ds1_idx
].
a˘
 >= 4)

1302 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT4
].
Êags
);

1304 i‡(
glb_ds1
[
ds1_idx
].
a˘
 >= 5)

1305 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT5
].
Êags
);

1309 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT1
].
Êags
);

1310 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT2
].
Êags
);

1311 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT3
].
Êags
);

1312 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT4
].
Êags
);

1313 
	`SET_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT5
].
Êags
);

1317 
a˘
)

1319 1 : 
	`SET_SELECTED
(
±r_w
->
buâ⁄
[
EB_ACT1
].
Êags
); ;

1320 2 : 
	`SET_SELECTED
(
±r_w
->
buâ⁄
[
EB_ACT2
].
Êags
); ;

1321 3 : 
	`SET_SELECTED
(
±r_w
->
buâ⁄
[
EB_ACT3
].
Êags
); ;

1322 4 : 
	`SET_SELECTED
(
±r_w
->
buâ⁄
[
EB_ACT4
].
Êags
); ;

1323 5 : 
	`SET_SELECTED
(
±r_w
->
buâ⁄
[
EB_ACT5
].
Êags
); ;

1327 
glb_ds1
[
ds1_idx
].
døw_edô_obj
 = 
TRUE
;

1328 
	}
}

1333 
	$edôobj_døw_edô_obj
(
ds1_idx
)

1335 
WIN_EDT_OBJ_S
 * 
±r_w
 = & 
glb_ds1
[
ds1_idx
].
wö_edt_obj
;

1336 
OBJ_DESC_S
 * 
±r_d
=
NULL
;

1337 
EDT_BUT_S
 * 
b
;

1338 
x1
, 
x2
, 
y1
, 
y2
, 
x
, 
y
, 
d
, 
löe
, 
bg_cﬁ‹
, 
c
, 
i
, 
size
;

1339 * 
möus_tmp
, 
tmp
[150];

1342 
size
 = 
glb_ds1edô
.
obj_buff
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Description")].size + 1;

1343 
möus_tmp
 = (*Ë
	`mÆloc
(
size
);

1344 i‡(
möus_tmp
 =
NULL
) {

1345 
	`FATAL_EXIT
("edôobj_døw_edô_obj(Ë: c™'àÆloˇã %òbyãs", 
size
);

1348 
x1
 = 
±r_w
->
x0
;

1349 
y1
 = 
±r_w
->
y0
;

1350 
x2
 = 
x1
 + 
±r_w
->
w
;

1351 
y2
 = 
y1
 + 
±r_w
->
h
;

1352 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 0);

1353 
	`ª˘
 (
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 255);

1355 
i
=0; i < 
EB_MAX
; i++)

1357 
b
 = & 
±r_w
->
buâ⁄
[
i
];

1358 
x1
 = 
b
->
box
.x1;

1359 
y1
 = 
b
->
box
.y1;

1360 
x2
 = 
b
->
box
.x2;

1361 
y2
 = 
b
->
box
.y2;

1362 
x
 = 
b
->
txt
.x;

1363 
y
 = 
b
->
txt
.y;

1364 i‡(
	`IS_ACTIVATED
(
b
->
Êags
))

1366 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 129);

1367 i‡(
	`IS_SELECTED
(
b
->
Êags
))

1369 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
+2, 
y1
+2, 
x2
-2, 
y2
-2, 116);

1370 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
+1, 
y
 + 1, 0, 
b
->
«me
);

1372 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
, 
y
, 132, 
b
->
«me
);

1374 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 186);

1375 i‡(
	`IS_SELECTED
(
b
->
Êags
))

1377 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
+2, 
y1
+2, 
x2
-2, 
y2
-2, 209);

1378 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
+1, 
y
 + 1, 0, 
b
->
«me
);

1380 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
, 
y
, 214, 
b
->
«me
);

1384 
x1
 = 
±r_w
->
x0
 + (8 * 2);

1385 
y1
 = 
±r_w
->
y0
 + 69;

1386 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 11, "Type");

1388 
x1
 += 8 * 5;

1389 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 255, " Id");

1390 
x1
 += 8 * 4;

1391 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 255, " Description");

1393 
x1
 = 
±r_w
->
x0
 + (8 * 2);

1394 
y1
 += 10;

1395 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 210, "---- --- -----------");

1397 
	`°r˝y
(
möus_tmp
, "");

1398 
c
=0; c < 
±r_w
->
desc_ch¨
 - 11; c++)

1399 
	`°rˇt
(
möus_tmp
, "-");

1400 
x1
 += 20 * 8;

1401 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 210, "%s", 
möus_tmp
);

1404 
löe
=0;Üöê< 
±r_w
->
num
;Üine++)

1406 
x1
 = 
±r_w
->
x0
 + (8 * 2);

1407 
y1
 += 10;

1408 
d
 = 
±r_w
->
°¨t
 + 
löe
;

1409 i‡–(
d
 >0Ë&& (d < 
glb_ds1edô
.
obj_desc_num
) &&

1410 (
d
 >
±r_w
->
desc_°¨t
Ë&& (d <±r_w->
desc_íd
)

1413 i‡(
d
 =
±r_w
->
desc_cur
)

1414 
bg_cﬁ‹
 = 121;

1415 i‡(
d
 =
±r_w
->
cur
)

1416 
bg_cﬁ‹
 = 71;

1417 i‡(
löe
 % 2)

1418 
bg_cﬁ‹
 = 1;

1420 
bg_cﬁ‹
 = 0;

1421 i‡(
bg_cﬁ‹
)

1422 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
±r_w
->
x0
+8, 
y1
-1,Öå_w->x0 +Öå_w->
w
 - 8, y1+8, 
bg_cﬁ‹
);

1424 
±r_d
 = & 
glb_ds1edô
.
obj_desc
[
d
];

1426 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 11, "%3i", 
±r_d
->
ty≥
);

1427 
x1
 += 8 * 5;

1428 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 255, "%3i", 
±r_d
->
id
);

1429 
x1
 += 8 * 4;

1430 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 255, " %s", 
±r_d
->
desc
);

1433 
x1
 = 
±r_w
->
x0
 + (8 * 2);

1434 
y1
 += 25;

1435 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 214, "(scroll down here)");

1437 
	`‰ì
(
möus_tmp
);

1438 
	}
}

1443 
	$edôobj_edô_obj
(
ds1_idx
, * 
edô_íd
, 
mx
, 
my
, 
mb
)

1445 
WIN_EDT_OBJ_S
 * 
±r_w
 = & 
glb_ds1
[
ds1_idx
].
wö_edt_obj
;

1446 
ªdøw
 = 
FALSE
, 
√w_cur
, 
íd
, 
w
, 
wtmp
;

1449 * 
edô_íd
 = 
FALSE
;

1452 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_OK
].
box
.
x1
) &&

1453 (
mx
 <
±r_w
->
buâ⁄
[
EB_OK
].
box
.
x2
) &&

1454 (
my
 >
±r_w
->
buâ⁄
[
EB_OK
].
box
.
y1
) &&

1455 (
my
 <
±r_w
->
buâ⁄
[
EB_OK
].
box
.
y2
)

1459 i‡(
mb
 & 1)

1461 
glb_ds1
[
ds1_idx
].
døw_edô_obj
 = 
FALSE
;

1462 
ªdøw
 = 
TRUE
;

1463 * 
edô_íd
 = 
TRUE
;

1464 
glb_ds1
[
ds1_idx
].
obj
[
±r_w
->
obj_idx
].
ty≥
 = 
glb_ds1edô
.
obj_desc
[±r_w->
desc_cur
].type;

1465 
glb_ds1
[
ds1_idx
].
obj
[
±r_w
->
obj_idx
].
id
 = 
glb_ds1edô
.
obj_desc
[±r_w->
desc_cur
].id;

1466 
glb_ds1
[
ds1_idx
].
obj
[
±r_w
->
obj_idx
].
desc_idx
 =Öå_w->
desc_cur
;

1467 
	`edôobj_make_obj_√w_id
(
ds1_idx
, 
±r_w
->
obj_idx
);

1468 
w
 = 16 * 8;

1469 i‡(
±r_w
->
desc_cur
 != -1)

1471 
wtmp
 = 8 * 
	`°æí
(
glb_ds1edô
.
obj_desc
[
±r_w
->
desc_cur
].
desc
);

1472 i‡(
wtmp
 > 
w
)

1473 
w
 = 
wtmp
;

1475 
glb_ds1
[
ds1_idx
].
obj
[
±r_w
->
obj_idx
].
œbñ
.
w
 = w;

1478 i‡(
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

1481 
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

1483 
glb_ds1
[
ds1_idx
].
døw_edô_obj
 = 
FALSE
;

1484 
ªdøw
 = 
TRUE
;

1485 * 
edô_íd
 = 
TRUE
;

1486 
glb_ds1
[
ds1_idx
].
obj
[
±r_w
->
obj_idx
].
ty≥
 = 
glb_ds1edô
.
obj_desc
[±r_w->
desc_cur
].type;

1487 
glb_ds1
[
ds1_idx
].
obj
[
±r_w
->
obj_idx
].
id
 = 
glb_ds1edô
.
obj_desc
[±r_w->
desc_cur
].id;

1488 
glb_ds1
[
ds1_idx
].
obj
[
±r_w
->
obj_idx
].
desc_idx
 =Öå_w->
desc_cur
;

1489 
	`edôobj_make_obj_√w_id
(
ds1_idx
, 
±r_w
->
obj_idx
);

1490 
w
 = 16 * 8;

1491 i‡(
±r_w
->
desc_cur
 != -1)

1493 
wtmp
 = 8 * 
	`°æí
(
glb_ds1edô
.
obj_desc
[
±r_w
->
desc_cur
].
desc
);

1494 i‡(
wtmp
 > 
w
)

1495 
w
 = 
wtmp
;

1497 
glb_ds1
[
ds1_idx
].
obj
[
±r_w
->
obj_idx
].
œbñ
.
w
 = w;

1499 i‡((
glb_c⁄fig
.
wöobj_s¸ﬁl_keyb
 =
FALSE
Ë&& 
key
[
KEY_UP
])

1502 
±r_w
->
°¨t
 -
glb_c⁄fig
.
s¸ﬁl
.
obj_edô
;

1503 i‡(
±r_w
->
°¨t
 <Öå_w->
desc_°¨t
)

1504 
±r_w
->
°¨t
 =Öå_w->
desc_°¨t
;

1505 
±r_w
->
cur
 = -1;

1506 
ªdøw
 = 
TRUE
;

1508 i‡((
glb_c⁄fig
.
wöobj_s¸ﬁl_keyb
 =
FALSE
Ë&& 
key
[
KEY_DOWN
])

1511 
±r_w
->
°¨t
 +
glb_c⁄fig
.
s¸ﬁl
.
obj_edô
;

1512 i‡–(
±r_w
->
°¨t
 +Öå_w->
num
 - 1Ë>Öå_w->
desc_íd
)

1513 
±r_w
->
°¨t
 =Öå_w->
desc_íd
 -Öå_w->
num
 + 1;

1514 i‡(
±r_w
->
°¨t
 <Öå_w->
desc_°¨t
)

1515 
±r_w
->
°¨t
 =Öå_w->
desc_°¨t
;

1516 
±r_w
->
cur
 = -1;

1517 
ªdøw
 = 
TRUE
;

1519 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_CANCEL
].
box
.
x1
) &&

1520 (
mx
 <
±r_w
->
buâ⁄
[
EB_CANCEL
].
box
.
x2
) &&

1521 (
my
 >
±r_w
->
buâ⁄
[
EB_CANCEL
].
box
.
y1
) &&

1522 (
my
 <
±r_w
->
buâ⁄
[
EB_CANCEL
].
box
.
y2
)

1526 i‡(
mb
 & 1)

1528 
glb_ds1
[
ds1_idx
].
døw_edô_obj
 = 
FALSE
;

1529 
ªdøw
 = 
TRUE
;

1530 * 
edô_íd
 = 
TRUE
;

1533 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_TYPE1
].
box
.
x1
) &&

1534 (
mx
 <
±r_w
->
buâ⁄
[
EB_TYPE1
].
box
.
x2
) &&

1535 (
my
 >
±r_w
->
buâ⁄
[
EB_TYPE1
].
box
.
y1
) &&

1536 (
my
 <
±r_w
->
buâ⁄
[
EB_TYPE1
].
box
.
y2
)

1540 i‡(
mb
 & 1)

1542 
mou£_b
 & 1)

1546 i‡(
±r_w
->
cur_ty≥
 != 1)

1547 
±r_w
->
cur_a˘
 = 
glb_ds1
[
ds1_idx
].
a˘
;

1548 
±r_w
->
cur_ty≥
 = 1;

1549 
	`edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
±r_w
->
obj_idx
);

1550 
ªdøw
 = 
TRUE
;

1553 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_TYPE2
].
box
.
x1
) &&

1554 (
mx
 <
±r_w
->
buâ⁄
[
EB_TYPE2
].
box
.
x2
) &&

1555 (
my
 >
±r_w
->
buâ⁄
[
EB_TYPE2
].
box
.
y1
) &&

1556 (
my
 <
±r_w
->
buâ⁄
[
EB_TYPE2
].
box
.
y2
)

1560 i‡(
mb
 & 1)

1562 
mou£_b
 & 1)

1566 
±r_w
->
cur_ty≥
 = 2;

1567 
±r_w
->
cur_a˘
 = 
glb_ds1
[
ds1_idx
].
a˘
;

1568 
	`edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
±r_w
->
obj_idx
);

1569 
ªdøw
 = 
TRUE
;

1572 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_ACT1
].
box
.
x1
) &&

1573 (
mx
 <
±r_w
->
buâ⁄
[
EB_ACT1
].
box
.
x2
) &&

1574 (
my
 >
±r_w
->
buâ⁄
[
EB_ACT1
].
box
.
y1
) &&

1575 (
my
 <
±r_w
->
buâ⁄
[
EB_ACT1
].
box
.
y2
)

1579 i‡((
mb
 & 1Ë&& (
	`IS_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT1
].
Êags
)))

1581 
mou£_b
 & 1)

1585 
±r_w
->
cur_a˘
 = 1;

1586 
	`edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
±r_w
->
obj_idx
);

1587 
ªdøw
 = 
TRUE
;

1590 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_ACT2
].
box
.
x1
) &&

1591 (
mx
 <
±r_w
->
buâ⁄
[
EB_ACT2
].
box
.
x2
) &&

1592 (
my
 >
±r_w
->
buâ⁄
[
EB_ACT2
].
box
.
y1
) &&

1593 (
my
 <
±r_w
->
buâ⁄
[
EB_ACT2
].
box
.
y2
)

1597 i‡((
mb
 & 1Ë&& (
	`IS_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT2
].
Êags
)))

1599 
mou£_b
 & 1)

1603 
±r_w
->
cur_a˘
 = 2;

1604 
	`edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
±r_w
->
obj_idx
);

1605 
ªdøw
 = 
TRUE
;

1608 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_ACT3
].
box
.
x1
) &&

1609 (
mx
 <
±r_w
->
buâ⁄
[
EB_ACT3
].
box
.
x2
) &&

1610 (
my
 >
±r_w
->
buâ⁄
[
EB_ACT3
].
box
.
y1
) &&

1611 (
my
 <
±r_w
->
buâ⁄
[
EB_ACT3
].
box
.
y2
)

1615 i‡((
mb
 & 1Ë&& (
	`IS_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT3
].
Êags
)))

1617 
mou£_b
 & 1)

1621 
±r_w
->
cur_a˘
 = 3;

1622 
	`edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
±r_w
->
obj_idx
);

1623 
ªdøw
 = 
TRUE
;

1626 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_ACT4
].
box
.
x1
) &&

1627 (
mx
 <
±r_w
->
buâ⁄
[
EB_ACT4
].
box
.
x2
) &&

1628 (
my
 >
±r_w
->
buâ⁄
[
EB_ACT4
].
box
.
y1
) &&

1629 (
my
 <
±r_w
->
buâ⁄
[
EB_ACT4
].
box
.
y2
)

1633 i‡((
mb
 & 1Ë&& (
	`IS_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT4
].
Êags
)))

1635 
mou£_b
 & 1)

1639 
±r_w
->
cur_a˘
 = 4;

1640 
	`edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
±r_w
->
obj_idx
);

1641 
ªdøw
 = 
TRUE
;

1644 i‡((
mx
 >
±r_w
->
buâ⁄
[
EB_ACT5
].
box
.
x1
) &&

1645 (
mx
 <
±r_w
->
buâ⁄
[
EB_ACT5
].
box
.
x2
) &&

1646 (
my
 >
±r_w
->
buâ⁄
[
EB_ACT5
].
box
.
y1
) &&

1647 (
my
 <
±r_w
->
buâ⁄
[
EB_ACT5
].
box
.
y2
)

1651 i‡((
mb
 & 1Ë&& (
	`IS_ACTIVATED
(
±r_w
->
buâ⁄
[
EB_ACT5
].
Êags
)))

1653 
mou£_b
 & 1)

1657 
±r_w
->
cur_a˘
 = 5;

1658 
	`edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
±r_w
->
obj_idx
);

1659 
ªdøw
 = 
TRUE
;

1664 
√w_cur
 = (
my
 - 
±r_w
->
y0
 - 69 - (2 * 10)) / 10;

1665 
√w_cur
 +
±r_w
->
°¨t
;

1666 i‡–(
mx
 >
±r_w
->
x0
Ë&& (mx < (±r_w->x0 +Öå_w->
w
)) &&

1667 (
my
 >
±r_w
->
x0
Ë&& (my < (±r_w->
y0
 +Öå_w->
h
))

1672 
íd
 = 
±r_w
->
°¨t
 +Öå_w->
num
 - 1;

1673 i‡((
√w_cur
 < 
±r_w
->
°¨t
Ë&& (±r_w->°¨à>Öå_w->
desc_°¨t
))

1676 
±r_w
->
°¨t
 -
glb_c⁄fig
.
s¸ﬁl
.
obj_edô
;

1677 i‡(
±r_w
->
°¨t
 <Öå_w->
desc_°¨t
)

1678 
±r_w
->
°¨t
 =Öå_w->
desc_°¨t
;

1679 
±r_w
->
cur
 = -1;

1680 
ªdøw
 = 
TRUE
;

1682 i‡((
√w_cur
 > 
íd
Ë&& (íd < 
±r_w
->
desc_íd
))

1685 
±r_w
->
°¨t
 +
glb_c⁄fig
.
s¸ﬁl
.
obj_edô
;

1686 i‡–(
±r_w
->
°¨t
 +Öå_w->
num
 - 1Ë>Öå_w->
desc_íd
)

1687 
±r_w
->
°¨t
 =Öå_w->
desc_íd
 -Öå_w->
num
 + 1;

1688 i‡(
±r_w
->
°¨t
 <Öå_w->
desc_°¨t
)

1689 
±r_w
->
°¨t
 =Öå_w->
desc_°¨t
;

1690 
±r_w
->
cur
 = -1;

1691 
ªdøw
 = 
TRUE
;

1697 i‡(
√w_cur
 !
±r_w
->
cur
)

1700 
±r_w
->
cur
 = 
√w_cur
;

1701 
ªdøw
 = 
TRUE
;

1704 i‡(
mb
 & 1)

1706 i‡–(
√w_cur
 !
±r_w
->
desc_cur
) &&

1707 (
√w_cur
 >
±r_w
->
desc_°¨t
) &&

1708 (
√w_cur
 <
±r_w
->
desc_íd
)

1712 
±r_w
->
desc_cur
 = 
√w_cur
;

1713 
ªdøw
 = 
TRUE
;

1721 i‡(
±r_w
->
cur
 != -1)

1723 
±r_w
->
cur
 = -1;

1724 
ªdøw
 = 
TRUE
;

1729  
ªdøw
;

1730 
	}
}

1737 
	$edôobj_idítiˇl_obj_√w
(
ds1_idx
, 
o
)

1739 
i
;

1743 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

1746 i‡(
glb_ds1
[
ds1_idx
].
obj
[
i
].
desc_idx
 =glb_ds1[ds1_idx].obj[
o
].desc_idx)

1749 
	`SET_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
Êags
);

1752 
	}
}

1758 
	$edôobj_idítiˇl_obj_add
(
ds1_idx
, 
o
)

1760 
√ed_ªdøw
 = 
FALSE
, 
i
;

1764 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

1767 i‡(
glb_ds1
[
ds1_idx
].
obj
[
i
].
desc_idx
 =glb_ds1[ds1_idx].obj[
o
].desc_idx)

1770 i‡–! 
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
Êags
))

1773 
	`SET_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
Êags
);

1774 
√ed_ªdøw
 = 
TRUE
;

1778  
√ed_ªdøw
;

1779 
	}
}

1785 
	$edôobj_idítiˇl_obj_dñ
(
ds1_idx
, 
o
)

1787 
√ed_ªdøw
 = 
FALSE
, 
i
;

1791 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

1794 i‡(
glb_ds1
[
ds1_idx
].
obj
[
i
].
desc_idx
 =glb_ds1[ds1_idx].obj[
o
].desc_idx)

1797 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
Êags
))

1800 
	`DEL_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
Êags
);

1801 
√ed_ªdøw
 = 
TRUE
;

1805  
√ed_ªdøw
;

1806 
	}
}

1813 
	$edôobj_idítiˇl_œb_√w
(
ds1_idx
, 
o
)

1815 
i
;

1819 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

1822 i‡(
glb_ds1
[
ds1_idx
].
obj
[
i
].
desc_idx
 =glb_ds1[ds1_idx].obj[
o
].desc_idx)

1825 
	`SET_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
œbñ
.
Êags
);

1828 
	}
}

1834 
	$edôobj_idítiˇl_œb_add
(
ds1_idx
, 
o
)

1836 
√ed_ªdøw
 = 
FALSE
, 
i
;

1840 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

1843 i‡(
glb_ds1
[
ds1_idx
].
obj
[
i
].
desc_idx
 =glb_ds1[ds1_idx].obj[
o
].desc_idx)

1846 i‡–! 
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
œbñ
.
Êags
))

1849 
	`SET_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
œbñ
.
Êags
);

1850 
√ed_ªdøw
 = 
TRUE
;

1854  
√ed_ªdøw
;

1855 
	}
}

1861 
	$edôobj_idítiˇl_œb_dñ
(
ds1_idx
, 
o
)

1863 
√ed_ªdøw
 = 
FALSE
, 
i
;

1867 
i
=0; i < 
glb_ds1
[
ds1_idx
].
obj_num
; i++)

1870 i‡(
glb_ds1
[
ds1_idx
].
obj
[
i
].
desc_idx
 =glb_ds1[ds1_idx].obj[
o
].desc_idx)

1873 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
œbñ
.
Êags
))

1876 
	`DEL_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
i
].
œbñ
.
Êags
);

1877 
√ed_ªdøw
 = 
TRUE
;

1881  
√ed_ªdøw
;

1882 
	}
}

1887 
	$edôobj_h™dÀr
(
ds1_idx
, 
cx
, 
cy
, 
mx
, 
my
, 
mb
)

1889 
ﬁd_ds1_idx
 = -1, 
ﬁd_t
, 
ﬁd_o
, 
cur_ty≥
;

1890 íum {
OM_NONE
, 
OM_NEW
, 
OM_ADD
, 
OM_DEL
, 
OM_MOV
, 
OM_EDT
, 
OM_INS
} 
ﬁd_mode
;

1891 
t
=0, 
o
=0, 
ªdøw
 = 
FALSE
;

1892 
°¨t_cx
, 
°¨t_cy
, 
°¨t_mx
, 
°¨t_my
;

1893 
dif_cx
=0, 
dif_cy
=0, 
dif_mx
=0, 
dif_my
=0;

1894 
hm
 = 
glb_ds1
[
ds1_idx
].
height_mul
;

1895 
hd
 = 
glb_ds1
[
ds1_idx
].
height_div
;

1896 
edô_íd
=0;

1897 
i
;

1900 
ﬁd_t
, 
ﬁd_o
, 
cur_ty≥
;

1901 
ﬁd_mode
;

1902 
t
, 
o
;

1903 
°¨t_cx
, 
°¨t_cy
, 
°¨t_mx
, 
°¨t_my
;

1904 
dif_cx
, 
dif_cy
, 
dif_mx
, 
dif_my
;

1905 
edô_íd
;

1906 } 
backup
[
DS1_MAX
];

1910 i‡(
ds1_idx
 !
ﬁd_ds1_idx
)

1913 i‡(
ﬁd_ds1_idx
 == -1)

1915 
i
=0; i<
DS1_MAX
; i++)

1917 
backup
[
i
].
ﬁd_t
 = -1;

1918 
backup
[
i
].
ﬁd_o
 = -1;

1919 
backup
[
i
].
cur_ty≥
 = 0;

1920 
backup
[
i
].
ﬁd_mode
 = 
OM_NONE
;

1922 
t
 = 
o
 = 
dif_cx
 = 
dif_cy
 = 
dif_mx
 = 
dif_my
 = 
edô_íd
 = -1;

1926 i‡(
ﬁd_ds1_idx
 != -1)

1928 
backup
[
ﬁd_ds1_idx
].
ﬁd_t
 = old_t;

1929 
backup
[
ﬁd_ds1_idx
].
ﬁd_o
 = old_o;

1930 
backup
[
ﬁd_ds1_idx
].
cur_ty≥
 = cur_type;

1931 
backup
[
ﬁd_ds1_idx
].
ﬁd_mode
 = old_mode;

1932 
backup
[
ﬁd_ds1_idx
].
t
 =Å;

1933 
backup
[
ﬁd_ds1_idx
].
o
 = o;

1934 
backup
[
ﬁd_ds1_idx
].
°¨t_cx
 = start_cx;

1935 
backup
[
ﬁd_ds1_idx
].
°¨t_cy
 = start_cy;

1936 
backup
[
ﬁd_ds1_idx
].
°¨t_mx
 = start_mx;

1937 
backup
[
ﬁd_ds1_idx
].
°¨t_my
 = start_my;

1938 
backup
[
ﬁd_ds1_idx
].
dif_cx
 = dif_cx;

1939 
backup
[
ﬁd_ds1_idx
].
dif_cy
 = dif_cy;

1940 
backup
[
ﬁd_ds1_idx
].
dif_mx
 = dif_mx;

1941 
backup
[
ﬁd_ds1_idx
].
dif_my
 = dif_my;

1942 
backup
[
ﬁd_ds1_idx
].
edô_íd
 =Édit_end;

1946 
ﬁd_t
 = 
backup
[
ds1_idx
].old_t;

1947 
ﬁd_o
 = 
backup
[
ds1_idx
].old_o;

1948 
cur_ty≥
 = 
backup
[
ds1_idx
].cur_type;

1949 
ﬁd_mode
 = 
backup
[
ds1_idx
].old_mode;

1950 
t
 = 
backup
[
ds1_idx
].t;

1951 
o
 = 
backup
[
ds1_idx
].o;

1952 
°¨t_cx
 = 
backup
[
ds1_idx
].start_cx;

1953 
°¨t_cy
 = 
backup
[
ds1_idx
].start_cy;

1954 
°¨t_mx
 = 
backup
[
ds1_idx
].start_mx;

1955 
°¨t_my
 = 
backup
[
ds1_idx
].start_my;

1956 
dif_cx
 = 
backup
[
ds1_idx
].dif_cx;

1957 
dif_cy
 = 
backup
[
ds1_idx
].dif_cy;

1958 
dif_mx
 = 
backup
[
ds1_idx
].dif_mx;

1959 
dif_my
 = 
backup
[
ds1_idx
].dif_my;

1960 
edô_íd
 = 
backup
[
ds1_idx
].edit_end;

1963 
ﬁd_ds1_idx
 = 
ds1_idx
;

1966 i‡(
ﬁd_mode
 =
OM_EDT
)

1969 i‡(
	`edôobj_edô_obj
(
ds1_idx
, & 
edô_íd
, 
mx
, 
my
, 
mb
))

1970 
ªdøw
 = 
TRUE
;

1972 i‡(
edô_íd
)

1974 
ﬁd_mode
 = 
OM_NONE
;

1975 
mou£_b
 & 1)

1979 
	`™im_upd©e_gfx
(
FALSE
);

1982 i‡(
ﬁd_mode
 !
OM_MOV
)

1986 i‡(
	`edôobj_ovî_obj_œb
(
ds1_idx
, & 
t
, & 
o
, 
cx
, 
cy
, 
mx
, 
my
))

1987 
ªdøw
 = 
TRUE
;

1989 i‡(
mb
 & 1)

1993 i‡(
key
[
KEY_ALT
] || key[
KEY_ALTGR
])

1995 i‡(
o
 != -1)

1998 
°¨t_cx
 = 
cx
;

1999 
°¨t_cy
 = 
cy
;

2000 
°¨t_mx
 = (
mx
 + 
glb_ds1edô
.
wö_¥evõw
.
x0
Ë* 
hd
 / 
hm
;

2001 
°¨t_my
 = (
my
 + 
glb_ds1edô
.
wö_¥evõw
.
y0
Ë* 
hd
 / 
hm
;

2003 i‡((
cur_ty≥
 =1Ë&& (
t
 == 1))

2005 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
œbñ
.
Êags
))

2007 
	`edôobj_¥ï¨e_undo
(
ds1_idx
);

2008 
	`edôobj_¥ï¨e_movög
(
ds1_idx
);

2009 
ﬁd_mode
 = 
OM_MOV
;

2010 
mou£_b
 & 1)

2016 i‡((
cur_ty≥
 =2Ë&& (
t
 == 2))

2018 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
))

2020 
	`edôobj_¥ï¨e_undo
(
ds1_idx
);

2021 
	`edôobj_¥ï¨e_movög
(
ds1_idx
);

2022 
ﬁd_mode
 = 
OM_MOV
;

2023 
mou£_b
 & 1)

2031 i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
])

2034 i‡((
cur_ty≥
 =0Ë|| (
t
 == cur_type))

2036 
cur_ty≥
 = 
t
;

2037 i‡(
o
 != -1)

2039 i‡(
t
 == 1)

2042 i‡(
key
[
KEY_I
])

2045 i‡(
	`edôobj_idítiˇl_œb_add
(
ds1_idx
, 
o
))

2048 
ªdøw
 = 
TRUE
;

2049 
ﬁd_mode
 = 
OM_ADD
;

2050 
ﬁd_o
 = 
o
;

2051 
ﬁd_t
 = 
t
;

2054 i‡–! 
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
œbñ
.
Êags
))

2056 
	`SET_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
œbñ
.
Êags
);

2057 
ªdøw
 = 
TRUE
;

2058 
ﬁd_mode
 = 
OM_ADD
;

2059 
ﬁd_o
 = 
o
;

2060 
ﬁd_t
 = 
t
;

2066 i‡(
key
[
KEY_I
])

2069 i‡(
	`edôobj_idítiˇl_obj_add
(
ds1_idx
, 
o
))

2072 
ªdøw
 = 
TRUE
;

2073 
ﬁd_mode
 = 
OM_ADD
;

2074 
ﬁd_o
 = 
o
;

2075 
ﬁd_t
 = 
t
;

2078 i‡–! 
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
))

2080 
	`SET_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
);

2081 
ªdøw
 = 
TRUE
;

2082 
ﬁd_mode
 = 
OM_ADD
;

2083 
ﬁd_o
 = 
o
;

2084 
ﬁd_t
 = 
t
;

2090 i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
])

2093 i‡(
o
 != -1)

2095 i‡((
ﬁd_t
 =1Ë&& (
t
 == 1))

2098 i‡(
key
[
KEY_I
])

2101 i‡(
	`edôobj_idítiˇl_œb_dñ
(
ds1_idx
, 
o
))

2104 
ªdøw
 = 
TRUE
;

2105 
ﬁd_o
 = 
o
;

2106 
ﬁd_mode
 = 
OM_DEL
;

2109 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
œbñ
.
Êags
))

2111 
	`DEL_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
œbñ
.
Êags
);

2112 
ªdøw
 = 
TRUE
;

2113 
ﬁd_o
 = 
o
;

2114 
ﬁd_mode
 = 
OM_DEL
;

2117 i‡((
ﬁd_t
 =2Ë&& (
t
 == 2))

2120 i‡(
key
[
KEY_I
])

2123 i‡(
	`edôobj_idítiˇl_obj_dñ
(
ds1_idx
, 
o
))

2126 
ªdøw
 = 
TRUE
;

2127 
ﬁd_o
 = 
o
;

2128 
ﬁd_mode
 = 
OM_DEL
;

2131 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
))

2133 
	`DEL_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
);

2134 
ªdøw
 = 
TRUE
;

2135 
ﬁd_o
 = 
o
;

2136 
ﬁd_mode
 = 
OM_DEL
;

2145 i‡((
ﬁd_o
 !
o
Ë|| (
ﬁd_t
 !
t
Ë|| (
ﬁd_mode
 !
OM_NEW
))

2147 
ﬁd_t
 = 
t
;

2148 
cur_ty≥
 = 
t
;

2149 
ﬁd_o
 = 
o
;

2150 
ﬁd_mode
 = 
OM_NEW
;

2151 
ªdøw
 = 
TRUE
;

2152 
	`edôobj_˛ór_obj_œb_£l
(
ds1_idx
);

2153 i‡(
o
 != -1)

2155 i‡(
t
 == 1)

2158 i‡(
key
[
KEY_I
])

2159 
	`edôobj_idítiˇl_œb_√w
(
ds1_idx
, 
o
);

2163 
	`SET_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
œbñ
.
Êags
);

2169 i‡(
key
[
KEY_I
])

2172 
	`edôobj_idítiˇl_obj_√w
(
ds1_idx
, 
o
);

2177 
	`SET_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
);

2182 
cur_ty≥
 = 0;

2187 
	`edô∑th_£¨ch_£À˘ed_obj
(
ds1_idx
);

2189 i‡(
mb
 & 2)

2191 i‡(
o
 != -1)

2195 
	`edôobj_¥ï¨e_undo
(
ds1_idx
);

2197 i‡(
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
 == -1)

2199 
glb_ds1
[
ds1_idx
].
wö_edt_obj
.
°¨t_a˘
 =

2200 
glb_ds1
[
ds1_idx
].
wö_edt_obj
.
cur_a˘
 =

2201 
glb_ds1
[
ds1_idx
].
a˘
;

2203 
glb_ds1
[
ds1_idx
].
wö_edt_obj
.
cur_ty≥
 = glb_ds1[ds1_idx].
obj
[
o
].
ty≥
;

2207 
glb_ds1
[
ds1_idx
].
wö_edt_obj
.
°¨t_a˘
 =

2208 
glb_ds1
[
ds1_idx
].
wö_edt_obj
.
cur_a˘
 =

2209 
glb_ds1edô
.
obj_desc
[
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
].
a˘
;

2211 
glb_ds1
[
ds1_idx
].
wö_edt_obj
.
cur_ty≥
 =

2212 
glb_ds1edô
.
obj_desc
[
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
].
ty≥
;

2216 
glb_ds1
[
ds1_idx
].
wö_edt_obj
.
desc_cur
 = glb_ds1[ds1_idx].
obj
[
o
].
desc_idx
;

2218 
	`edôobj_¥ï¨e_edô_obj_wö
(
ds1_idx
, 
o
);

2219 
ﬁd_mode
 = 
OM_EDT
;

2221 
ªdøw
 = 
TRUE
;

2228 i‡(
key
[
KEY_DEL
] || key[
KEY_DEL_PAD
])

2231 
key
[
KEY_DEL
] || key[
KEY_DEL_PAD
])

2235 
	`edôobj_¥ï¨e_undo
(
ds1_idx
);

2236 
	`edôobj_dñ_obj
(
ds1_idx
);

2237 
ªdøw
 = 
TRUE
;

2238 
	`™im_upd©e_gfx
(
FALSE
);

2240 i‡(
key
[
KEY_U
] && (key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]))

2243 i‡(
glb_ds1
[
ds1_idx
].
ˇn_undo_obj
)

2245 
key
[
KEY_U
])

2249 
	`edôobj_undo
(
ds1_idx
);

2250 
ªdøw
 = 
TRUE
;

2252 
	`™im_upd©e_gfx
(
FALSE
);

2254 i‡(
key
[
KEY_C
] && (key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]))

2260 i‡(
	`edôobj_cou¡_£l_obj
(
ds1_idx
))

2262 
key
[
KEY_C
])

2266 
	`edôobj_¥ï¨e_undo
(
ds1_idx
);

2267 
	`edôobj_c›y_obj
(
ds1_idx
);

2268 
ﬁd_mode
 = 
OM_MOV
;

2269 
ªdøw
 = 
TRUE
;

2270 
°¨t_cx
 = 
cx
;

2271 
°¨t_cy
 = 
cy
;

2272 
°¨t_mx
 = (
mx
 + 
glb_ds1edô
.
wö_¥evõw
.
x0
Ë* 
hd
 / 
hm
;

2273 
°¨t_my
 = (
my
 + 
glb_ds1edô
.
wö_¥evõw
.
y0
Ë* 
hd
 / 
hm
;

2274 
	`edôobj_¥ï¨e_movög
(
ds1_idx
);

2277 i‡(
key
[
KEY_INSERT
])

2280 
key
[
KEY_INSERT
])

2282 
	`edôobj_¥ï¨e_undo
(
ds1_idx
);

2283 
	`edôobj_˛ór_obj_œb_£l
(
ds1_idx
);

2284 i‡(
	`edôobj_ö£π_obj
(
ds1_idx
, 
cx
, 
cy
) == 0)

2286 
ﬁd_mode
 = 
OM_INS
;

2287 
ªdøw
 = 
TRUE
;

2288 
	`™im_upd©e_gfx
(
FALSE
);

2297 i‡–! 
mb
 & 1)

2300 
dif_cx
 = 
cx
 - 
°¨t_cx
;

2301 
dif_cy
 = 
cy
 - 
°¨t_cy
;

2303 
dif_mx
 = ((
mx
 + 
glb_ds1edô
.
wö_¥evõw
.
x0
Ë* 
hd
 / 
hm
Ë- 
°¨t_mx
;

2304 
dif_my
 = ((
my
 + 
glb_ds1edô
.
wö_¥evõw
.
y0
Ë* 
hd
 / 
hm
Ë- 
°¨t_my
;

2306 i‡(
	`edôobj_movög_obj_œb
(
ds1_idx
, 
dif_cx
, 
dif_cy
, 
dif_mx
, 
dif_my
))

2307 
ªdøw
 = 
TRUE
;

2312 
	`edôobj_íd_move_obj_œb
(
ds1_idx
);

2313 
ﬁd_mode
 = 
OM_NONE
;

2314 
ªdøw
 = 
TRUE
;

2315 
mou£_b
 & 1)

2322 i‡(
ªdøw
)

2323 
	`edôobj_£t_døwög_‹dî
(
ds1_idx
);

2325  
ªdøw
;

2326 
	}
}

	@editobj.h

1 #i‚de‡
_EDITOBJ_H_


3 
	#_EDITOBJ_H_


	)

5 
edôobj_qs‹t_hñ≥r_døwög_‹dî
 (c⁄° * 
e1
, c⁄° * 
e2
);

6 
edôobj_£t_døwög_‹dî
 (
ds1_idx
);

7 
edôobj_make_obj_œbñ
 (
ds1_idx
);

8 
edôobj_døw_obj_œb
 (
ds1_idx
, 
is_shadow
);

9 
edôobj_make_obj_desc
 (
ds1_idx
, 
obj_idx
);

10 
edôobj_make_obj_√w_id
 (
ds1_idx
, 
obj_idx
);

11 
edôobj_˛ór_obj_œb_£l
 (
ds1_idx
);

12 
edôobj_˛ór_obj_œb_ovî
 (
ds1_idx
);

13 
edôobj_˛ór_obj_œb_Êags
 (
ds1_idx
);

14 
edôobj_ovî_obj_œb
 (
ds1_idx
, * 
±r_t
, * 
±r_o
, 
cx
, 
cy
, 
mx
, 
my
);

15 
edôobj_¥ï¨e_movög
 (
ds1_idx
);

16 
edôobj_movög_obj_œb
 (
ds1_idx
, 
dcx
, 
dcy
, 
dmx
, 
dmy
);

17 
edôobj_íd_move_obj_œb
 (
ds1_idx
);

18 
edôobj_¥ï¨e_undo
 (
ds1_idx
);

19 
edôobj_undo
 (
ds1_idx
);

20 
edôobj_dñ_obj
 (
ds1_idx
);

21 
edôobj_c›y_obj
 (
ds1_idx
);

24 
edôobj_cou¡_£l_obj
 (
ds1_idx
);

25 
edôobj_ö£π_obj
 (
ds1_idx
, 
cx
, 
cy
);

26 
edôobj_¥ï¨e_edô_obj_wö
 (
ds1_idx
, 
obj_idx
);

27 
edôobj_døw_edô_obj
 (
ds1_idx
);

28 
edôobj_edô_obj
 (
ds1_idx
, * 
edô_íd
, 
mx
, 
my
, 
mb
);

29 
edôobj_h™dÀr
 (
ds1_idx
, 
cx
, 
cy
, 
mx
, 
my
, 
mb
);

	@editpath.c

1 
	~"°ru˘s.h
"

2 
	~"edô∑th.h
"

3 
	~"misc.h
"

7 
	$edô∑th_mou£_ö
(
ds1_idx
, 
mx
, 
my
)

9 
PATH_EDIT_WIN_S
 * 
pwö
 = & 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
;

12 i‡–(
mx
 >
pwö
->
x0
Ë&& (mx <pwö->x0 +Öwö->
w
 - 1) &&

13 (
my
 >
pwö
->
y0
Ë&& (my <pwö->y0 +Öwö->
h
 - 1))

14  
TRUE
;

16  
FALSE
;

17 
	}
}

21 
	$edô∑th_mou£_cmdbut_ö
(
ds1_idx
, 
mx
, 
my
)

23 
PATH_EDIT_WIN_S
 * 
pwö
 = & 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
;

26 i‡–(
mx
 >
pwö
->
but_x0
Ë&& (mx <pwö->but_x0 +Öwö->
but_w
 - 1) &&

27 (
my
 >
pwö
->
but_y0
Ë&& (my <pwö->but_y0 +Öwö->
but_h
 - 1))

28  
TRUE
;

30  
FALSE
;

31 
	}
}

35 
	$edô∑th_öô
(
ds1_idx
)

37 
PATH_EDIT_WIN_S
 * 
pwö
 = & 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
;

38 
i
;

41 
pwö
->
but_x0
 = 10;

42 
pwö
->
but_y0
 = 2 * 10;

43 
pwö
->
but_w
 = 49 * 8;

44 
pwö
->
but_h
 = 80;

46 
pwö
->
x0
 = 10;

47 
pwö
->
y0
 =Öwö->
but_y0
 +Öwö->
but_h
 + 10;

48 
pwö
->
w
 = 23 * 8;

49 
pwö
->
h
 = 
glb_c⁄fig
.
s¸ìn
.
height
 -Öwö->
y0
 - 20;

51 
pwö
->
c_bœck
 = 
	`makecﬁ
( 0, 0, 0);

52 
pwö
->
c_whôe
 = 
	`makecﬁ
(255, 255, 255);

53 
pwö
->
c_gªí
 = 
	`makecﬁ
( 0, 255, 0);

54 
pwö
->
c_d¨kgªí
 = 
	`makecﬁ
( 0, 128, 0);

55 
pwö
->
c_yñlow
 = 
	`makecﬁ
(255, 255, 0);

56 
pwö
->
c_gøy
 = 
	`makecﬁ
(128, 128, 128);

57 
pwö
->
c_d¨kgøy
 = 
	`makecﬁ
( 64, 64, 64);

60 
pwö
->
buâ⁄
[
PEB_OK
].
show
 = 
FALSE
;

61 
pwö
->
buâ⁄
[
PEB_OK
].
ãxt
 = "OK";

62 
pwö
->
buâ⁄
[
PEB_OK
].
ãxt_x0
 = 3 * 8 + 1;

63 
pwö
->
buâ⁄
[
PEB_OK
].
x0
 = 10;

64 
pwö
->
buâ⁄
[
PEB_OK
].
y0
 = 10;

65 
pwö
->
buâ⁄
[
PEB_OK
].
w
 = 8 * 8;

66 
pwö
->
buâ⁄
[
PEB_OK
].
h
 = 20;

67 
pwö
->
buâ⁄
[
PEB_OK
].
cﬁ_⁄
.
fg
 =Öwö->
c_bœck
;

68 
pwö
->
buâ⁄
[
PEB_OK
].
cﬁ_⁄
.
bg
 =Öwö->
c_d¨kgªí
;

69 
pwö
->
buâ⁄
[
PEB_OK
].
cﬁ_⁄
.
b‹dî
 =Öwö->
c_whôe
;

70 
pwö
->
buâ⁄
[
PEB_OK
].
cﬁ_off
.
fg
 =Öwö->
c_gªí
;

71 
pwö
->
buâ⁄
[
PEB_OK
].
cﬁ_off
.
bg
 =Öwö->
c_bœck
;

72 
pwö
->
buâ⁄
[
PEB_OK
].
cﬁ_off
.
b‹dî
 =Öwö->
c_gªí
;

75 
pwö
->
buâ⁄
[
PEB_CANCEL
].
show
 = 
FALSE
;

76 
pwö
->
buâ⁄
[
PEB_CANCEL
].
ãxt
 = "CANCEL";

77 
pwö
->
buâ⁄
[
PEB_CANCEL
].
ãxt_x0
 = 1 * 8 + 1;

78 
pwö
->
buâ⁄
[
PEB_CANCEL
].
x0
 = 80;

79 
pwö
->
buâ⁄
[
PEB_CANCEL
].
y0
 = 10;

80 
pwö
->
buâ⁄
[
PEB_CANCEL
].
w
 = 8 * 8;

81 
pwö
->
buâ⁄
[
PEB_CANCEL
].
h
 = 20;

82 
pwö
->
buâ⁄
[
PEB_CANCEL
].
cﬁ_⁄
.
fg
 =Öwö->
c_bœck
;

83 
pwö
->
buâ⁄
[
PEB_CANCEL
].
cﬁ_⁄
.
bg
 =Öwö->
c_d¨kgªí
;

84 
pwö
->
buâ⁄
[
PEB_CANCEL
].
cﬁ_⁄
.
b‹dî
 =Öwö->
c_whôe
;

85 
pwö
->
buâ⁄
[
PEB_CANCEL
].
cﬁ_off
.
fg
 =Öwö->
c_gªí
;

86 
pwö
->
buâ⁄
[
PEB_CANCEL
].
cﬁ_off
.
bg
 =Öwö->
c_bœck
;

87 
pwö
->
buâ⁄
[
PEB_CANCEL
].
cﬁ_off
.
b‹dî
 =Öwö->
c_gªí
;

90 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
show
 = 
TRUE
;

91 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
ãxt
 = "ALL NEW";

92 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
ãxt_x0
 = 1 * 8 + 1;

93 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
x0
 = 10;

94 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
y0
 = 50;

95 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
w
 = 9 * 8;

96 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
h
 = 20;

97 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
cﬁ_⁄
.
fg
 =Öwö->
c_bœck
;

98 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
cﬁ_⁄
.
bg
 =Öwö->
c_d¨kgªí
;

99 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
cﬁ_⁄
.
b‹dî
 =Öwö->
c_whôe
;

100 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
cﬁ_off
.
fg
 =Öwö->
c_gªí
;

101 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
cﬁ_off
.
bg
 =Öwö->
c_bœck
;

102 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
cﬁ_off
.
b‹dî
 =Öwö->
c_gªí
;

105 
pwö
->
buâ⁄
[
PEB_STOP
].
show
 = 
FALSE
;

106 
pwö
->
buâ⁄
[
PEB_STOP
].
ãxt
 = "STOP";

107 
pwö
->
buâ⁄
[
PEB_STOP
].
ãxt_x0
 = 2 * 8 + 5;

108 
pwö
->
buâ⁄
[
PEB_STOP
].
x0
 = 10;

109 
pwö
->
buâ⁄
[
PEB_STOP
].
y0
 = 50;

110 
pwö
->
buâ⁄
[
PEB_STOP
].
w
 = 9 * 8;

111 
pwö
->
buâ⁄
[
PEB_STOP
].
h
 = 20;

112 
pwö
->
buâ⁄
[
PEB_STOP
].
cﬁ_⁄
.
fg
 =Öwö->
c_bœck
;

113 
pwö
->
buâ⁄
[
PEB_STOP
].
cﬁ_⁄
.
bg
 =Öwö->
c_d¨kgªí
;

114 
pwö
->
buâ⁄
[
PEB_STOP
].
cﬁ_⁄
.
b‹dî
 =Öwö->
c_whôe
;

115 
pwö
->
buâ⁄
[
PEB_STOP
].
cﬁ_off
.
fg
 =Öwö->
c_gªí
;

116 
pwö
->
buâ⁄
[
PEB_STOP
].
cﬁ_off
.
bg
 =Öwö->
c_bœck
;

117 
pwö
->
buâ⁄
[
PEB_STOP
].
cﬁ_off
.
b‹dî
 =Öwö->
c_gªí
;

120 
pwö
->
buâ⁄
[
PEB_SETACTION
].
show
 = 
TRUE
;

121 
pwö
->
buâ⁄
[
PEB_SETACTION
].
ãxt
 = "(Enter) SET ACTION";

122 
pwö
->
buâ⁄
[
PEB_SETACTION
].
ãxt_x0
 = 1 * 8 + 1;

123 
pwö
->
buâ⁄
[
PEB_SETACTION
].
x0
 = 160;

124 
pwö
->
buâ⁄
[
PEB_SETACTION
].
y0
 = 50;

125 
pwö
->
buâ⁄
[
PEB_SETACTION
].
w
 = 20 * 8 + 1;

126 
pwö
->
buâ⁄
[
PEB_SETACTION
].
h
 = 20;

127 
pwö
->
buâ⁄
[
PEB_SETACTION
].
cﬁ_⁄
.
fg
 =Öwö->
c_bœck
;

128 
pwö
->
buâ⁄
[
PEB_SETACTION
].
cﬁ_⁄
.
bg
 =Öwö->
c_d¨kgªí
;

129 
pwö
->
buâ⁄
[
PEB_SETACTION
].
cﬁ_⁄
.
b‹dî
 =Öwö->
c_whôe
;

130 
pwö
->
buâ⁄
[
PEB_SETACTION
].
cﬁ_off
.
fg
 =Öwö->
c_gªí
;

131 
pwö
->
buâ⁄
[
PEB_SETACTION
].
cﬁ_off
.
bg
 =Öwö->
c_bœck
;

132 
pwö
->
buâ⁄
[
PEB_SETACTION
].
cﬁ_off
.
b‹dî
 =Öwö->
c_gªí
;

134 i‡(
pwö
->
obj_idx
 == -1)

136 
i
=0; i < 
PEB_MAX
; i++)

138 i‡(
i
 !
PEB_SETACTION
)

139 
pwö
->
buâ⁄
[
i
].
show
 = 
FALSE
;

143 
pwö
->
cuº_a˘i⁄
 = 1;

144 
	}
}

148 
	$edô∑th_£¨ch_£À˘ed_obj
(
ds1_idx
)

150 
PATH_EDIT_WIN_S
 * 
pwö
 = & 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
;

151 
OBJ_S
 * 
pobj
 = 
NULL
;

152 
o
, 
nb
=0, 
√w_obj_idx
=0, 
i
;

155 i‡(
glb_ds1
[
ds1_idx
].
∑th_edô_wö
.
obj_dúty
 !
FALSE
)

158 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

160 
pobj
 = & 
glb_ds1
[
ds1_idx
].
obj
[
o
];

161 i‡(
	`IS_SELECTED
(
pobj
->
Êags
Ë|| IS_SELECTED’obj->
œbñ
.flags))

163 
nb
++;

164 
√w_obj_idx
 = 
o
;

167 i‡(
nb
 == 1)

169 i‡(
pwö
->
obj_idx
 !
√w_obj_idx
)

171 
pwö
->
obj_idx
 = 
√w_obj_idx
;

172 
pobj
 = & 
glb_ds1
[
ds1_idx
].
obj
[
√w_obj_idx
];

173 
i
=0; i < 
WINDS1EDIT_PATH_MAX
; i++)

175 
pwö
->
∑th_c›y
[
i
].
x
 = 
pobj
->
∑th
[i].x;

176 
pwö
->
∑th_c›y
[
i
].
y
 = 
pobj
->
∑th
[i].y;

177 
pwö
->
∑th_c›y
[
i
].
a˘i⁄
 = 
pobj
->
∑th
[i].action;

179 
pwö
->
∑th_c›y_num
 = 
pobj
->
∑th_num
;

183 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
show
 = 
TRUE
;

187 
pwö
->
obj_idx
 = -1;

188 
i
=0; i < 
PEB_MAX
; i++)

190 i‡(
i
 !
PEB_SETACTION
)

191 
pwö
->
buâ⁄
[
i
].
show
 = 
FALSE
;

194 
	}
}

198 
	$edô∑th_íãr_a˘i⁄
(
ds1_idx
, * 
∑˘i⁄
)

200 
PATH_EDIT_WIN_S
 * 
pwö
 = & 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
;

201 
x1
, 
y1
, 
w
, 
h
, 
x2
, 
y2
,

202 
tx1
, 
ty1
, 
tx2
, 
ty2
, 
tw
, 
th
,

203 
d⁄e
, 
add_x
, 
nb_ch¨
;

204 
BITMAP
 * 
bmp
;

205 
lvÆue
 = 0;

206 
svÆue
[30];

211 
w
 = 200;

212 
h
 = 80;

213 
x1
 = (
glb_c⁄fig
.
s¸ìn
.
width
 - 
w
) / 2;

214 
y1
 = (
glb_c⁄fig
.
s¸ìn
.
height
 - 
h
) / 2;

215 
x2
 = 
x1
 + 
w
 - 1;

216 
y2
 = 
y1
 + 
h
 - 1;

218 
tw
 = 11 * 8 + 4;

219 
th
 = 16;

220 
tx1
 = 
x1
 + (
w
 - 
tw
) / 2;

221 
ty1
 = 
y1
 + 40;

222 
tx2
 = 
tx1
 + 
tw
 - 1;

223 
ty2
 = 
ty1
 + 
th
 - 1;

226 
	`•rötf
–
svÆue
, "%ld",
lvÆue
 );

227 
nb_ch¨
 = 
	`°æí
(
svÆue
);

230 
bmp
 = 
	`¸óã_bôm≠
(
w
, 
h
);

231 
	`blô
(
glb_ds1edô
.
s¸ìn_buff
, 
bmp
, 
x1
, 
y1
, 0, 0, 
w
, 
h
);

234 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pwö
->
c_bœck
);

235 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pwö
->
c_whôe
);

238 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, y1 + 18, 
pwö
->
c_gªí
);

239 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Ty≥Çew ACTION vÆue", 
x1
 + 8, 
y1
+6, 
pwö
->
c_bœck
);

240 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, y1 + 18, 
pwö
->
c_whôe
);

243 
d⁄e
 = 
FALSE
;

244  ! 
d⁄e
)

246 i‡(
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

248 
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

250 
d⁄e
 = 
TRUE
;

251 * 
∑˘i⁄
 = 
lvÆue
;

253 i‡(
key
[
KEY_ESC
])

255 
key
[
KEY_ESC
])

257 
d⁄e
 = 
TRUE
;

259 i‡(
key
[
KEY_MINUS
] || key[
KEY_MINUS_PAD
] || key[
KEY_EQUALS
])

261 
key
[
KEY_MINUS
] || key[
KEY_MINUS_PAD
] || key[
KEY_EQUALS
])

263 
lvÆue
 = -lvalue;

265 i‡((
lvÆue
 >= -99999999) && (lvalue <= 99999999))

267 i‡(
key
[
KEY_1
] || key[
KEY_1_PAD
])

269 
key
[
KEY_1
] || key[
KEY_1_PAD
])

271 
lvÆue
 *= 10;

272 i‡(
lvÆue
 < 0)

273 
lvÆue
 -= 1;

275 
lvÆue
 += 1;

277 i‡(
key
[
KEY_2
] || key[
KEY_2_PAD
])

279 
key
[
KEY_2
] || key[
KEY_2_PAD
])

281 
lvÆue
 *= 10;

282 i‡(
lvÆue
 < 0)

283 
lvÆue
 -= 2;

285 
lvÆue
 += 2;

287 i‡(
key
[
KEY_3
] || key[
KEY_3_PAD
])

289 
key
[
KEY_3
] || key[
KEY_3_PAD
])

291 
lvÆue
 *= 10;

292 i‡(
lvÆue
 < 0)

293 
lvÆue
 -= 3;

295 
lvÆue
 += 3;

297 i‡(
key
[
KEY_4
] || key[
KEY_4_PAD
])

299 
key
[
KEY_4
] || key[
KEY_4_PAD
])

301 
lvÆue
 *= 10;

302 i‡(
lvÆue
 < 0)

303 
lvÆue
 -= 4;

305 
lvÆue
 += 4;

307 i‡(
key
[
KEY_5
] || key[
KEY_5_PAD
])

309 
key
[
KEY_5
] || key[
KEY_5_PAD
])

311 
lvÆue
 *= 10;

312 i‡(
lvÆue
 < 0)

313 
lvÆue
 -= 5;

315 
lvÆue
 += 5;

317 i‡(
key
[
KEY_6
] || key[
KEY_6_PAD
])

319 
key
[
KEY_6
] || key[
KEY_6_PAD
])

321 
lvÆue
 *= 10;

322 i‡(
lvÆue
 < 0)

323 
lvÆue
 -= 6;

325 
lvÆue
 += 6;

327 i‡(
key
[
KEY_7
] || key[
KEY_7_PAD
])

329 
key
[
KEY_7
] || key[
KEY_7_PAD
])

331 
lvÆue
 *= 10;

332 i‡(
lvÆue
 < 0)

333 
lvÆue
 -= 7;

335 
lvÆue
 += 7;

337 i‡(
key
[
KEY_8
] || key[
KEY_8_PAD
])

339 
key
[
KEY_8
] || key[
KEY_8_PAD
])

341 
lvÆue
 *= 10;

342 i‡(
lvÆue
 < 0)

343 
lvÆue
 -= 8;

345 
lvÆue
 += 8;

347 i‡(
key
[
KEY_9
] || key[
KEY_9_PAD
])

349 
key
[
KEY_9
] || key[
KEY_9_PAD
])

351 
lvÆue
 *= 10;

352 i‡(
lvÆue
 < 0)

353 
lvÆue
 -= 9;

355 
lvÆue
 += 9;

357 i‡(
key
[
KEY_0
] || key[
KEY_0_PAD
])

359 
key
[
KEY_0
] || key[
KEY_0_PAD
])

361 
lvÆue
 *= 10;

362 i‡(
lvÆue
 < 0)

363 
lvÆue
 -= 0;

365 
lvÆue
 += 0;

372 
	`•rötf
–
svÆue
, "%ld",
lvÆue
 );

373 
nb_ch¨
 = 
	`°æí
(
svÆue
);

375 
add_x
 = 2 + (11 - 
nb_ch¨
) * 8;

376 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
tx1
, 
ty1
, 
tx2
, 
ty2
, 
pwö
->
c_d¨kgøy
);

377 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

378 
tx1
 + 
add_x
,

379 
ty1
 + 4,

380 
pwö
->
c_whôe
,

382 
lvÆue


386 i‡–! 
d⁄e
)

388 
	`vsync
();

389 
	`blô
(
glb_ds1edô
.
s¸ìn_buff
, 
s¸ìn
, 
x1
, 
y1
, x1, y1, 
w
, 
h
);

394 
	`vsync
();

395 
	`blô
(
bmp
, 
s¸ìn
, 0, 0, 
x1
, 
y1
, 
w
, 
h
);

398 
	`de°roy_bôm≠
(
bmp
);

399 
	}
}

404 
	$edô∑th_døw
(
ds1_idx
, 
mx
, 
my
, 
mb
, 
tx
, 
ty
)

406 
PATH_EDIT_WIN_S
 * 
pwö
 = & 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
;

407 
PATH_EDIT_BUT_S
 * 
pbut
 = 
NULL
;

408 
OBJ_S
 * 
pobj
 = 
NULL
;

409 
PATH_S
 * 
µ©h
 = 
NULL
;

410 
x1
, 
y1
, 
x2
, 
y2
, 
i
, 
d⁄e
, 
y
, 
xt
;

414 i‡(
pwö
->
w
 == 0)

415 
	`edô∑th_öô
(
ds1_idx
);

418 i‡(
pwö
->
obj_idx
 != -1)

419 
pobj
 = & 
glb_ds1
[
ds1_idx
].
obj
[
pwö
->
obj_idx
];

422 i‡(
pwö
->
mode
)

424 
pwö
->
mode
)

426 
PEM_NONE
 :

429 
PEM_ALLNEW
 :

430 i‡(
mb
 & 1)

432 i‡(
	`edô∑th_mou£_cmdbut_ö
(
ds1_idx
, 
mx
, 
my
Ë=
FALSE
)

434 i‡(
	`edô∑th_mou£_ö
(
ds1_idx
, 
mx
, 
my
Ë=
FALSE
)

437 
mou£_b
 & 1)

439 
mb
 = 0;

442 i‡(
pobj
->
∑th_num
 < 
WINDS1EDIT_PATH_MAX
)

444 
i
 = 
pobj
->
∑th_num
;

445 
pobj
->
∑th
[
i
].
x
 = 
tx
;

446 
pobj
->
∑th
[
i
].
y
 = 
ty
;

447 
pobj
->
∑th
[
i
].
a˘i⁄
 = 
pwö
->
cuº_a˘i⁄
;

448 
pobj
->
∑th
[
i
].
Êags
 = 0;

449 
pobj
->
∑th_num
++;

461 
x1
 = 
pwö
->
but_x0
;

462 
y1
 = 
pwö
->
but_y0
;

463 
x2
 = 
x1
 + 
pwö
->
but_w
;

464 
y2
 = 
y1
 + 
pwö
->
but_h
;

465 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pwö
->
c_bœck
);

466 i‡(
	`edô∑th_mou£_cmdbut_ö
(
ds1_idx
, 
mx
, 
my
))

467 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pwö
->
c_yñlow
);

469 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pwö
->
c_whôe
);

472 i‡(
mb
 & 1)

475 
mou£_b
 & 1)

477 
mb
 = 0;

480 
d⁄e
 = 
FALSE
;

481 
i
=0; (ò< 
PEB_MAX
Ë&& ! 
d⁄e
; i++)

483 
pbut
 = & 
pwö
->
buâ⁄
[
i
];

485 i‡(
pbut
->
show
 !
TRUE
)

488 
x1
 = 
pwö
->
but_x0
 + 
pbut
->
x0
;

489 
y1
 = 
pwö
->
but_y0
 + 
pbut
->
y0
;

490 
x2
 = 
x1
 + 
pbut
->
w
;

491 
y2
 = 
y1
 + 
pbut
->
h
;

493 i‡((
mx
 >
x1
Ë&& (mx <
x2
Ë&& (
my
 >
y1
Ë&& (my <
y2
))

495 
i
)

497 
PEB_OK
 :

500 
i
=0; i < 
WINDS1EDIT_PATH_MAX
; i++)

502 
pwö
->
∑th_c›y
[
i
].
x
 = 
pobj
->
∑th
[i].x;

503 
pwö
->
∑th_c›y
[
i
].
y
 = 
pobj
->
∑th
[i].y;

504 
pwö
->
∑th_c›y
[
i
].
a˘i⁄
 = 
pobj
->
∑th
[i].action;

506 
pwö
->
∑th_c›y_num
 = 
pobj
->
∑th_num
;

509 
pwö
->
buâ⁄
[
PEB_OK
].
show
 = 
FALSE
;

510 
pwö
->
buâ⁄
[
PEB_CANCEL
].
show
 = 
FALSE
;

511 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
show
 = 
TRUE
;

512 
pwö
->
buâ⁄
[
PEB_STOP
].
show
 = 
FALSE
;

514 
d⁄e
 = 
TRUE
;

515 
pwö
->
mode
 = 
PEM_NONE
;

516 
pwö
->
obj_dúty
 = 
FALSE
;

519 
PEB_CANCEL
 :

521 
i
=0; i < 
WINDS1EDIT_PATH_MAX
; i++)

523 
pobj
->
∑th
[
i
].
x
 = 
pwö
->
∑th_c›y
[i].x;

524 
pobj
->
∑th
[
i
].
y
 = 
pwö
->
∑th_c›y
[i].y;

525 
pobj
->
∑th
[
i
].
a˘i⁄
 = 
pwö
->
∑th_c›y
[i].action;

526 
pobj
->
∑th
[
i
].
Êags
 = 0;

528 
pobj
->
∑th_num
 = 
pwö
->
∑th_c›y_num
;

531 
pwö
->
buâ⁄
[
PEB_OK
].
show
 = 
FALSE
;

532 
pwö
->
buâ⁄
[
PEB_CANCEL
].
show
 = 
FALSE
;

533 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
show
 = 
TRUE
;

534 
pwö
->
buâ⁄
[
PEB_STOP
].
show
 = 
FALSE
;

536 
d⁄e
 = 
TRUE
;

537 
pwö
->
mode
 = 
PEM_NONE
;

538 
pwö
->
obj_dúty
 = 
FALSE
;

541 
PEB_ALLNEW
 :

543 
pwö
->
buâ⁄
[
PEB_OK
].
show
 = 
TRUE
;

544 
pwö
->
buâ⁄
[
PEB_CANCEL
].
show
 = 
TRUE
;

545 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
show
 = 
FALSE
;

546 
pwö
->
buâ⁄
[
PEB_STOP
].
show
 = 
TRUE
;

548 
d⁄e
 = 
TRUE
;

549 
pwö
->
mode
 = 
PEM_ALLNEW
;

550 
pwö
->
obj_dúty
 = 
TRUE
;

551 
pobj
->
∑th_num
 = 0;

554 
PEB_STOP
 :

556 
pwö
->
buâ⁄
[
PEB_OK
].
show
 = 
TRUE
;

557 
pwö
->
buâ⁄
[
PEB_CANCEL
].
show
 = 
TRUE
;

558 
pwö
->
buâ⁄
[
PEB_ALLNEW
].
show
 = 
TRUE
;

559 
pwö
->
buâ⁄
[
PEB_STOP
].
show
 = 
FALSE
;

561 
d⁄e
 = 
TRUE
;

562 
pwö
->
mode
 = 
PEM_NONE
;

565 
PEB_SETACTION
 :

566 
	`edô∑th_íãr_a˘i⁄
(
ds1_idx
, & 
pwö
->
cuº_a˘i⁄
);

573 i‡(
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

575 
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

577 
	`edô∑th_íãr_a˘i⁄
(
ds1_idx
, & 
pwö
->
cuº_a˘i⁄
);

581 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

582 
pwö
->
x0
 + 160,

583 
pwö
->
x0
 + 27,

584 
pwö
->
c_gøy
,

586 
pwö
->
cuº_a˘i⁄


590 
i
=0; i < 
PEB_MAX
; i++)

592 
pbut
 = & 
pwö
->
buâ⁄
[
i
];

594 i‡(
pbut
->
show
 !
TRUE
)

597 
x1
 = 
pwö
->
but_x0
 + 
pbut
->
x0
;

598 
xt
 = 
x1
 + 
pbut
->
ãxt_x0
;

599 
y1
 = 
pwö
->
but_y0
 + 
pbut
->
y0
;

600 
x2
 = 
x1
 + 
pbut
->
w
;

601 
y2
 = 
y1
 + 
pbut
->
h
;

603 i‡((
mx
 >
x1
Ë&& (mx <
x2
Ë&& (
my
 >
y1
Ë&& (my <
y2
))

605 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pbut
->
cﬁ_⁄
.
bg
);

606 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
pbut
->
ãxt
, 
xt
, 
y1
+7,Öbut->
cﬁ_⁄
.
fg
);

607 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pbut
->
cﬁ_⁄
.
b‹dî
);

611 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pbut
->
cﬁ_off
.
bg
);

612 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
pbut
->
ãxt
, 
xt
, 
y1
+7,Öbut->
cﬁ_off
.
fg
);

613 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pbut
->
cﬁ_off
.
b‹dî
);

620 
x1
 = 
pwö
->
x0
;

621 
y1
 = 
pwö
->
y0
;

622 
x2
 = 
x1
 + 
pwö
->
w
;

623 
y2
 = 
y1
 + 
pwö
->
h
;

624 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pwö
->
c_bœck
);

625 i‡(
	`edô∑th_mou£_ö
(
ds1_idx
, 
mx
, 
my
))

626 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pwö
->
c_yñlow
);

628 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
pwö
->
c_whôe
);

631 
pwö
->
c_gªí
 = 
	`makecﬁ
(0, 255, 0);

632 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

634 
x1
 + 8, 
y1
 + 10, 
pwö
->
c_gªí


636 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

638 
x1
 + 8, 
y1
 + 20, 
pwö
->
c_gªí


681 i‡((
pwö
->
obj_idx
 < 0Ë|| (pwö->obj_idx >
glb_ds1
[
ds1_idx
].
cuºít_obj_max
))

685 
d⁄e
 = 
FALSE
;

686 
i
 = 
pwö
->
∑th_°¨t_idx
;

687 
y
 = 
y1
 + 35;

688 
µ©h
 = & 
pobj
->
∑th
[
i
];

690 i‡(
i
 >
pobj
->
∑th_num
)

691 
d⁄e
 = 
TRUE
;

693  ! 
d⁄e
)

695 i‡(
y
 + 10 < 
pwö
->
y0
 +Öwö->
h
)

698 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

699 
pwö
->
x0
 + 8, 
y
,

700 
pwö
->
c_whôe
,

702 
i
 + 1,

703 
µ©h
->
x
,

704 
µ©h
->
y
,

705 
µ©h
->
a˘i⁄


707 
i
++;

708 i‡(
i
 >
pobj
->
∑th_num
)

709 
d⁄e
 = 
TRUE
;

710 
y
 += 20;

711 
µ©h
++;

714 
d⁄e
 = 
TRUE
;

716 
	}
}

	@editpath.h

1 #i‚de‡
_EDITPATH_H_


3 
	#_EDITPATH_H_


	)

5 
edô∑th_mou£_ö
 (
ds1_idx
, 
mx
, 
my
);

6 
edô∑th_öô
 (
ds1_idx
);

7 
edô∑th_£¨ch_£À˘ed_obj
 (
ds1_idx
);

8 
edô∑th_døw
 (
ds1_idx
, 
mx
, 
my
, 
mb
, 
tx
, 
ty
);

	@edittile.c

1 
	~"°ru˘s.h
"

2 
	~"ds1misc.h
"

3 
	~"undo.h
"

4 
	~"edôtûe.h
"

16 
	$edôtûe_middÀ_£À˘
(
ds1_idx
, * 
°¨t_x
, * 
°¨t_y
)

18 
CELL_F_S
 * 
f_±r
;

19 
CELL_S_S
 * 
s_±r
;

20 
CELL_W_S
 * 
w_±r
;

21 
x
, 
y
, 
t
, 
i
;

22 
möx
, 
möy
, 
maxx
, 
maxy
;

25 
maxx
 = 0;

26 
maxy
 = 0;

27 
möx
 = 
glb_ds1
[
ds1_idx
].
width
 - 1;

28 
möy
 = 
glb_ds1
[
ds1_idx
].
height
 - 1;

30 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

32 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

35 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

36 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

38 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

39 i‡(
	`IS_SELECTED
(
f_±r
->
Êags
))

41 i‡(
x
 < 
möx
) minx = x;

42 i‡(
x
 > 
maxx
) maxx = x;

43 i‡(
y
 < 
möy
) miny = y;

44 i‡(
y
 > 
maxy
) maxy = y;

49 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

50 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

52 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
i
;

53 i‡(
	`IS_SELECTED
(
s_±r
->
Êags
))

55 i‡(
x
 < 
möx
) minx = x;

56 i‡(
x
 > 
maxx
) maxx = x;

57 i‡(
y
 < 
möy
) miny = y;

58 i‡(
y
 > 
maxy
) maxy = y;

63 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

64 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

66 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

67 i‡(
	`IS_SELECTED
(
w_±r
->
Êags
))

69 i‡(
x
 < 
möx
) minx = x;

70 i‡(
x
 > 
maxx
) maxx = x;

71 i‡(
y
 < 
möy
) miny = y;

72 i‡(
y
 > 
maxy
) maxy = y;

78 i‡(
möx
 < 
maxx
)

79 * 
°¨t_x
 = 
möx
 + ((
maxx
 - minx) / 2);

81 * 
°¨t_x
 = 
maxx
 + ((
möx
 - maxx) / 2);

83 i‡(
möy
 < 
maxy
)

84 * 
°¨t_y
 = 
möy
 + ((
maxy
 - miny) / 2);

86 * 
°¨t_y
 = 
maxy
 + ((
möy
 - maxy) / 2);

87 
	}
}

93 
	$edôtûe_∑°e_¥ï¨e
(
ds1_idx
)

95 
CELL_F_S
 * 
§c_f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
,

96 * 
d°_f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff2
;

97 
CELL_S_S
 * 
§c_s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
,

98 * 
d°_s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff2
;

99 
CELL_W_S
 * 
§c_w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
,

100 * 
d°_w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff2
;

101 
i
;

105 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_Àn
; i++)

107 
d°_f_±r
->
¥›1
 = 
§c_f_±r
->prop1;

108 
d°_f_±r
->
¥›2
 = 
§c_f_±r
->prop2;

109 
d°_f_±r
->
¥›3
 = 
§c_f_±r
->prop3;

110 
d°_f_±r
->
¥›4
 = 
§c_f_±r
->prop4;

111 
d°_f_±r
->
bt_idx
 = 
§c_f_±r
->bt_idx;

112 
d°_f_±r
->
Êags
 = 
§c_f_±r
->flags;

113 
d°_f_±r
++;

114 
§c_f_±r
++;

118 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_Àn
; i++)

120 
d°_s_±r
->
¥›1
 = 
§c_s_±r
->prop1;

121 
d°_s_±r
->
¥›2
 = 
§c_s_±r
->prop2;

122 
d°_s_±r
->
¥›3
 = 
§c_s_±r
->prop3;

123 
d°_s_±r
->
¥›4
 = 
§c_s_±r
->prop4;

124 
d°_s_±r
->
bt_idx
 = 
§c_s_±r
->bt_idx;

125 
d°_s_±r
->
Êags
 = 
§c_s_±r
->flags;

126 
d°_s_±r
++;

127 
§c_s_±r
++;

131 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_Àn
; i++)

133 
d°_w_±r
->
¥›1
 = 
§c_w_±r
->prop1;

134 
d°_w_±r
->
¥›2
 = 
§c_w_±r
->prop2;

135 
d°_w_±r
->
¥›3
 = 
§c_w_±r
->prop3;

136 
d°_w_±r
->
¥›4
 = 
§c_w_±r
->prop4;

137 
d°_w_±r
->
‹õ¡©i⁄
 = 
§c_w_±r
->orientation;

138 
d°_w_±r
->
bt_idx
 = 
§c_w_±r
->bt_idx;

139 
d°_w_±r
->
Êags
 = 
§c_w_±r
->flags;

140 
d°_w_±r
++;

141 
§c_w_±r
++;

143 
	}
}

148 
	$edôtûe_∑°e_undo
(
ds1_idx
)

150 
CELL_F_S
 * 
§c_f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff2
,

151 * 
d°_f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
;

152 
CELL_S_S
 * 
§c_s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff2
,

153 * 
d°_s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
;

154 
CELL_W_S
 * 
§c_w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff2
,

155 * 
d°_w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
;

156 
i
;

160 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_Àn
; i++)

162 
d°_f_±r
->
¥›1
 = 
§c_f_±r
->prop1;

163 
d°_f_±r
->
¥›2
 = 
§c_f_±r
->prop2;

164 
d°_f_±r
->
¥›3
 = 
§c_f_±r
->prop3;

165 
d°_f_±r
->
¥›4
 = 
§c_f_±r
->prop4;

166 
d°_f_±r
->
bt_idx
 = 
§c_f_±r
->bt_idx;

167 
d°_f_±r
->
Êags
 = 
§c_f_±r
->flags;

168 
d°_f_±r
++;

169 
§c_f_±r
++;

173 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_Àn
; i++)

175 
d°_s_±r
->
¥›1
 = 
§c_s_±r
->prop1;

176 
d°_s_±r
->
¥›2
 = 
§c_s_±r
->prop2;

177 
d°_s_±r
->
¥›3
 = 
§c_s_±r
->prop3;

178 
d°_s_±r
->
¥›4
 = 
§c_s_±r
->prop4;

179 
d°_s_±r
->
bt_idx
 = 
§c_s_±r
->bt_idx;

180 
d°_s_±r
->
Êags
 = 
§c_s_±r
->flags;

181 
d°_s_±r
++;

182 
§c_s_±r
++;

186 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_Àn
; i++)

188 
d°_w_±r
->
¥›1
 = 
§c_w_±r
->prop1;

189 
d°_w_±r
->
¥›2
 = 
§c_w_±r
->prop2;

190 
d°_w_±r
->
¥›3
 = 
§c_w_±r
->prop3;

191 
d°_w_±r
->
¥›4
 = 
§c_w_±r
->prop4;

192 
d°_w_±r
->
‹õ¡©i⁄
 = 
§c_w_±r
->orientation;

193 
d°_w_±r
->
bt_idx
 = 
§c_w_±r
->bt_idx;

194 
d°_w_±r
->
Êags
 = 
§c_w_±r
->flags;

195 
d°_w_±r
++;

196 
§c_w_±r
++;

198 
	}
}

203 
	$edôtûe_∑°e_¥evõw
(
ds1_idx
, 
dx
, 
dy
, 
PASTE_POS_S
 * 
p
)

205 
CELL_F_S
 * 
§c_f_±r
, * 
d°_f_±r
;

206 
CELL_S_S
 * 
§c_s_±r
, * 
d°_s_±r
;

207 
CELL_W_S
 * 
§c_w_±r
, * 
d°_w_±r
;

208 
x
, 
y
, 
ts
, 
td
, 
i
, 
f
;

212 i‡(
p
->
is_cut
 =
TRUE
)

214 i‡(
p
->
cut_ßved
 =
FALSE
)

217 
	`edôtûe_dñëe_£À˘ed_tûes
(
p
->
§c_ds1_idx
);

218 
p
->
cut_ßved
 = 
TRUE
;

223 
	`edôtûe_dñëe_£À˘ed_tûes2
(
p
->
§c_ds1_idx
);

228 
y
=0; y < 
glb_ds1
[
p
->
§c_ds1_idx
].
height
; y++)

230 i‡–((
y
+
dy
Ë< 0Ë|| ((y+dyË>
glb_ds1
[
ds1_idx
].
height
) )

233 
x
=0; x < 
glb_ds1
[
p
->
§c_ds1_idx
].
width
; x++)

235 i‡–((
x
+
dx
Ë< 0Ë|| ((x+dxË>
glb_ds1
[
ds1_idx
].
width
) )

239 
ts
 = (
y
 * 
glb_ds1
[
p
->
§c_ds1_idx
].
Êo‹_löe
) +

240 (
x
 * 
glb_ds1
[
p
->
§c_ds1_idx
].
Êo‹_num
);

241 
td
 = ((
y
+
dy
Ë* 
glb_ds1
[
ds1_idx
].
Êo‹_löe
) +

242 ((
x
+
dx
Ë* 
glb_ds1
[
ds1_idx
].
Êo‹_num
);

243 
i
=0; (i<
glb_ds1
[
ds1_idx
].
Êo‹_num
) &&

244 (
i
<
glb_ds1
[
p
->
§c_ds1_idx
].
Êo‹_num
); i++)

246 
§c_f_±r
 = 
glb_ds1
[
p
->
§c_ds1_idx
].
Êo‹_buff2
 + 
ts
 + 
i
;

247 
d°_f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
td
 + 
i
;

249 
f
 = 
§c_f_±r
->
Êags
;

250 i‡(
	`IS_SELECTED
(
f
Ë&& (
§c_f_±r
->
bt_idx
 != 0))

252 
	`SET_COPY_INFO
(
f
);

253 i‡(
d°_f_±r
->
bt_idx
 != 0)

255 i‡–(
d°_f_±r
->
¥›1
 !
§c_f_±r
->prop1) ||

256 (
d°_f_±r
->
¥›2
 !
§c_f_±r
->prop2) ||

257 (
d°_f_±r
->
¥›3
 !
§c_f_±r
->prop3) ||

258 (
d°_f_±r
->
¥›4
 !
§c_f_±r
->prop4)

261 
	`SET_COPY_STATE
(
f
);

264 
d°_f_±r
->
¥›1
 = 
§c_f_±r
->prop1;

265 
d°_f_±r
->
¥›2
 = 
§c_f_±r
->prop2;

266 
d°_f_±r
->
¥›3
 = 
§c_f_±r
->prop3;

267 
d°_f_±r
->
¥›4
 = 
§c_f_±r
->prop4;

268 
d°_f_±r
->
Êags
 = 
f
;

269 
	`Âr›_2_block
(
ds1_idx
, 
d°_f_±r
);

274 
ts
 = (
y
 * 
glb_ds1
[
p
->
§c_ds1_idx
].
shadow_löe
) +

275 (
x
 * 
glb_ds1
[
p
->
§c_ds1_idx
].
shadow_num
);

276 
td
 = ((
y
+
dy
Ë* 
glb_ds1
[
ds1_idx
].
shadow_löe
) +

277 ((
x
+
dx
Ë* 
glb_ds1
[
ds1_idx
].
shadow_num
);

278 
i
=0; (i<
glb_ds1
[
ds1_idx
].
shadow_num
) &&

279 (
i
<
glb_ds1
[
p
->
§c_ds1_idx
].
shadow_num
); i++)

281 
§c_s_±r
 = 
glb_ds1
[
p
->
§c_ds1_idx
].
shadow_buff2
 + 
ts
 + 
i
;

282 
d°_s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
td
 + 
i
;

284 
f
 = 
§c_s_±r
->
Êags
;

285 i‡(
	`IS_SELECTED
(
f
Ë&& (
§c_s_±r
->
bt_idx
 != 0))

287 
	`SET_COPY_INFO
(
f
);

288 i‡(
d°_s_±r
->
bt_idx
 != 0)

290 i‡–(
d°_s_±r
->
¥›1
 !
§c_s_±r
->prop1) ||

291 (
d°_s_±r
->
¥›2
 !
§c_s_±r
->prop2) ||

292 (
d°_s_±r
->
¥›3
 !
§c_s_±r
->prop3) ||

293 (
d°_s_±r
->
¥›4
 !
§c_s_±r
->prop4)

296 
	`SET_COPY_STATE
(
f
);

299 
d°_s_±r
->
¥›1
 = 
§c_s_±r
->prop1;

300 
d°_s_±r
->
¥›2
 = 
§c_s_±r
->prop2;

301 
d°_s_±r
->
¥›3
 = 
§c_s_±r
->prop3;

302 
d°_s_±r
->
¥›4
 = 
§c_s_±r
->prop4;

303 
d°_s_±r
->
Êags
 = 
f
;

304 
	`•r›_2_block
(
ds1_idx
, 
d°_s_±r
);

309 
ts
 = (
y
 * 
glb_ds1
[
p
->
§c_ds1_idx
].
wÆl_löe
) +

310 (
x
 * 
glb_ds1
[
p
->
§c_ds1_idx
].
wÆl_num
);

311 
td
 = ((
y
+
dy
Ë* 
glb_ds1
[
ds1_idx
].
wÆl_löe
) +

312 ((
x
+
dx
Ë* 
glb_ds1
[
ds1_idx
].
wÆl_num
);

313 
i
=0; (i<
glb_ds1
[
ds1_idx
].
wÆl_num
) &&

314 (
i
<
glb_ds1
[
p
->
§c_ds1_idx
].
wÆl_num
); i++)

316 
§c_w_±r
 = 
glb_ds1
[
p
->
§c_ds1_idx
].
wÆl_buff2
 + 
ts
 + 
i
;

317 
d°_w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
td
 + 
i
;

319 
f
 = 
§c_w_±r
->
Êags
;

320 i‡(
	`IS_SELECTED
(
f
Ë&& (
§c_w_±r
->
bt_idx
 != 0) )

322 
	`SET_COPY_INFO
(
f
);

323 i‡(
d°_w_±r
->
bt_idx
 != 0)

325 i‡–(
d°_w_±r
->
¥›1
 !
§c_w_±r
->prop1) ||

326 (
d°_w_±r
->
¥›2
 !
§c_w_±r
->prop2) ||

327 (
d°_w_±r
->
¥›3
 !
§c_w_±r
->prop3) ||

328 (
d°_w_±r
->
¥›4
 !
§c_w_±r
->prop4) ||

329 (
d°_w_±r
->
‹õ¡©i⁄
 !
§c_w_±r
->orientation)

332 
	`SET_COPY_STATE
(
f
);

335 
d°_w_±r
->
¥›1
 = 
§c_w_±r
->prop1;

336 
d°_w_±r
->
¥›2
 = 
§c_w_±r
->prop2;

337 
d°_w_±r
->
¥›3
 = 
§c_w_±r
->prop3;

338 
d°_w_±r
->
¥›4
 = 
§c_w_±r
->prop4;

339 
d°_w_±r
->
‹õ¡©i⁄
 = 
§c_w_±r
->orientation;

340 
d°_w_±r
->
Êags
 = 
f
;

341 
	`w¥›_2_block
(
ds1_idx
, 
d°_w_±r
);

346 
	}
}

351 
	$edôtûe_∑°e_föÆ
(
ds1_idx
)

353 
CELL_F_S
 * 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
, * 
f2
;

354 
CELL_S_S
 * 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
, * 
s2
;

355 
CELL_W_S
 * 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
, * 
w2
;

356 
i
, 
f
, 
tf
, 
ts
, 
tw
, 
x
, 
y
, 
make_undo
;

357 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

360 
	`undo_√w_tûe_buf„r
(
ds1_idx
);

361 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

363 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

365 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

366 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

367 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

368 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

369 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

370 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

371 
f2
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff2
 + 
tf
;

372 
s2
 = 
glb_ds1
[
ds1_idx
].
shadow_buff2
 + 
ts
;

373 
w2
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff2
 + 
tw
;

376 
make_undo
 = 
FALSE
;

377 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

379 i‡(
f_±r
[
i
].
¥›1
 !
f2
[i].prop1)

380 
u
->
d©_Êg
.
f
[
i
] |
DF_P1
;

382 i‡(
f_±r
[
i
].
¥›2
 !
f2
[i].prop2)

383 
u
->
d©_Êg
.
f
[
i
] |
DF_P2
;

385 i‡(
f_±r
[
i
].
¥›3
 !
f2
[i].prop3)

386 
u
->
d©_Êg
.
f
[
i
] |
DF_P3
;

388 i‡(
f_±r
[
i
].
¥›4
 !
f2
[i].prop4)

389 
u
->
d©_Êg
.
f
[
i
] |
DF_P4
;

391 i‡(
f_±r
[
i
].
bt_idx
 !
f2
[i].bt_idx)

392 
u
->
d©_Êg
.
f
[
i
] |
DF_BT
;

394 
f
 = 
f_±r
[
i
].
Êags
;

395 i‡(
	`IS_COPY_INFO
(
f
))

396 
	`SET_SELECTED
(
f
);

398 
	`DEL_SELECTED
(
f
);

399 
f_±r
[
i
].
Êags
 = 
	`IS_SELECTED
(
f
Ë| 
	`IS_HIDE
(f);

401 i‡(
f_±r
[
i
].
Êags
 !
f2
[i].flags)

402 
u
->
d©_Êg
.
f
[
i
] |
DF_FL
;

404 i‡(
u
->
d©_Êg
.
f
[
i
])

405 
make_undo
 = 
TRUE
;

407 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

409 i‡(
s_±r
[
i
].
¥›1
 !
s2
[i].prop1)

410 
u
->
d©_Êg
.
s
[
i
] |
DF_P1
;

412 i‡(
s_±r
[
i
].
¥›2
 !
s2
[i].prop2)

413 
u
->
d©_Êg
.
s
[
i
] |
DF_P2
;

415 i‡(
s_±r
[
i
].
¥›3
 !
s2
[i].prop3)

416 
u
->
d©_Êg
.
s
[
i
] |
DF_P3
;

418 i‡(
s_±r
[
i
].
¥›4
 !
s2
[i].prop4)

419 
u
->
d©_Êg
.
s
[
i
] |
DF_P4
;

421 i‡(
s_±r
[
i
].
bt_idx
 !
s2
[i].bt_idx)

422 
u
->
d©_Êg
.
s
[
i
] |
DF_BT
;

424 
f
 = 
s_±r
[
i
].
Êags
;

425 i‡(
	`IS_COPY_INFO
(
f
))

426 
	`SET_SELECTED
(
f
);

428 
	`DEL_SELECTED
(
f
);

429 
s_±r
[
i
].
Êags
 = 
	`IS_SELECTED
(
f
Ë| 
	`IS_HIDE
(f);

431 i‡(
s_±r
[
i
].
Êags
 !
s2
[i].flags)

432 
u
->
d©_Êg
.
s
[
i
] |
DF_FL
;

434 i‡(
u
->
d©_Êg
.
s
[
i
])

435 
make_undo
 = 
TRUE
;

437 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

439 i‡(
w_±r
[
i
].
¥›1
 !
w2
[i].prop1)

440 
u
->
d©_Êg
.
w
[
i
] |
DF_P1
;

442 i‡(
w_±r
[
i
].
¥›2
 !
w2
[i].prop2)

443 
u
->
d©_Êg
.
w
[
i
] |
DF_P2
;

445 i‡(
w_±r
[
i
].
¥›3
 !
w2
[i].prop3)

446 
u
->
d©_Êg
.
w
[
i
] |
DF_P3
;

448 i‡(
w_±r
[
i
].
¥›4
 !
w2
[i].prop4)

449 
u
->
d©_Êg
.
w
[
i
] |
DF_P4
;

451 i‡(
w_±r
[
i
].
‹õ¡©i⁄
 !
w2
[i].orientation)

452 
u
->
d©_Êg
.
w
[
i
] |
DF_OR
;

454 i‡(
w_±r
[
i
].
bt_idx
 !
w2
[i].bt_idx)

455 
u
->
d©_Êg
.
w
[
i
] |
DF_BT
;

457 
f
 = 
w_±r
[
i
].
Êags
;

458 i‡(
	`IS_COPY_INFO
(
f
))

459 
	`SET_SELECTED
(
f
);

461 
	`DEL_SELECTED
(
f
);

462 
w_±r
[
i
].
Êags
 = 
	`IS_SELECTED
(
f
Ë| 
	`IS_HIDE
(f);

464 i‡(
w_±r
[
i
].
Êags
 !
w2
[i].flags)

465 
u
->
d©_Êg
.
w
[
i
] |
DF_FL
;

467 i‡(
u
->
d©_Êg
.
w
[
i
])

468 
make_undo
 = 
TRUE
;

470 i‡(
make_undo
)

471 
	`undo_add_this_tûe_to_buf„r
(
ds1_idx
, 
x
, 
y
, 
f2
, 
w2
, 
s2
);

475 
	`undo_˛o£_tûe_buf„r
(
ds1_idx
);

476 
	}
}

490 
	$edôtûe_dñëe_£À˘ed_tûes
(
ds1_idx
)

492 
CELL_W_S
 * 
w_±r
;

493 
CELL_F_S
 * 
f_±r
;

494 
CELL_S_S
 * 
s_±r
;

495 
i
, 
tf
, 
ts
, 
tw
, 
x
, 
y
, 
make_undo
;

496 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

499 
	`undo_√w_tûe_buf„r
(
ds1_idx
);

500 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

502 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

504 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

505 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

506 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

507 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

508 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

509 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

512 
make_undo
 = 
FALSE
;

513 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

515 i‡(
	`IS_SELECTED
(
f_±r
[
i
].
Êags
))

517 i‡(
f_±r
[
i
].
¥›1
)

518 
u
->
d©_Êg
.
f
[
i
] |
DF_P1
;

520 i‡(
f_±r
[
i
].
¥›2
)

521 
u
->
d©_Êg
.
f
[
i
] |
DF_P2
;

523 i‡(
f_±r
[
i
].
¥›3
)

524 
u
->
d©_Êg
.
f
[
i
] |
DF_P3
;

526 i‡(
f_±r
[
i
].
¥›4
)

527 
u
->
d©_Êg
.
f
[
i
] |
DF_P4
;

529 i‡(
f_±r
[
i
].
bt_idx
 != 0)

530 
u
->
d©_Êg
.
f
[
i
] |
DF_BT
;

532 i‡(
f_±r
[
i
].
Êags
)

533 
u
->
d©_Êg
.
f
[
i
] |
DF_FL
;

535 i‡(
u
->
d©_Êg
.
f
[
i
])

536 
make_undo
 = 
TRUE
;

539 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

541 i‡(
	`IS_SELECTED
(
s_±r
[
i
].
Êags
))

543 i‡(
s_±r
[
i
].
¥›1
)

544 
u
->
d©_Êg
.
s
[
i
] |
DF_P1
;

546 i‡(
s_±r
[
i
].
¥›2
)

547 
u
->
d©_Êg
.
s
[
i
] |
DF_P2
;

549 i‡(
s_±r
[
i
].
¥›3
)

550 
u
->
d©_Êg
.
s
[
i
] |
DF_P3
;

552 i‡(
s_±r
[
i
].
¥›4
)

553 
u
->
d©_Êg
.
s
[
i
] |
DF_P4
;

555 i‡(
s_±r
[
i
].
bt_idx
 != 0)

556 
u
->
d©_Êg
.
s
[
i
] |
DF_BT
;

558 i‡(
s_±r
[
i
].
Êags
)

559 
u
->
d©_Êg
.
s
[
i
] |
DF_FL
;

561 i‡(
u
->
d©_Êg
.
s
[
i
])

562 
make_undo
 = 
TRUE
;

565 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

567 i‡(
	`IS_SELECTED
(
w_±r
[
i
].
Êags
))

569 i‡(
w_±r
[
i
].
¥›1
)

570 
u
->
d©_Êg
.
w
[
i
] |
DF_P1
;

572 i‡(
w_±r
[
i
].
¥›2
)

573 
u
->
d©_Êg
.
w
[
i
] |
DF_P2
;

575 i‡(
w_±r
[
i
].
¥›3
)

576 
u
->
d©_Êg
.
w
[
i
] |
DF_P3
;

578 i‡(
w_±r
[
i
].
¥›4
)

579 
u
->
d©_Êg
.
w
[
i
] |
DF_P4
;

581 i‡(
w_±r
[
i
].
‹õ¡©i⁄
)

582 
u
->
d©_Êg
.
w
[
i
] |
DF_OR
;

584 i‡(
w_±r
[
i
].
bt_idx
 != 0)

585 
u
->
d©_Êg
.
w
[
i
] |
DF_BT
;

587 i‡(
w_±r
[
i
].
Êags
)

588 
u
->
d©_Êg
.
w
[
i
] |
DF_FL
;

590 i‡(
u
->
d©_Êg
.
w
[
i
])

591 
make_undo
 = 
TRUE
;

594 i‡(
make_undo
)

595 
	`undo_add_to_tûe_buf„r
(
ds1_idx
, 
x
, 
y
);

598 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

600 i‡(
	`IS_SELECTED
(
f_±r
[
i
].
Êags
))

602 
f_±r
[
i
].
¥›1
 = 0;

603 
f_±r
[
i
].
¥›2
 = 0;

604 
f_±r
[
i
].
¥›3
 = 0;

605 
f_±r
[
i
].
¥›4
 = 0;

606 
f_±r
[
i
].
bt_idx
 = 0;

607 
f_±r
[
i
].
Êags
 = 0;

612 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

614 i‡(
	`IS_SELECTED
(
s_±r
[
i
].
Êags
))

616 
s_±r
[
i
].
¥›1
 = 0;

617 
s_±r
[
i
].
¥›2
 = 0;

618 
s_±r
[
i
].
¥›3
 = 0;

619 
s_±r
[
i
].
¥›4
 = 0;

620 
s_±r
[
i
].
bt_idx
 = 0;

621 
s_±r
[
i
].
Êags
 = 0;

626 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

628 i‡(
	`IS_SELECTED
(
w_±r
[
i
].
Êags
))

630 
w_±r
[
i
].
¥›1
 = 0;

631 
w_±r
[
i
].
¥›2
 = 0;

632 
w_±r
[
i
].
¥›3
 = 0;

633 
w_±r
[
i
].
¥›4
 = 0;

634 
w_±r
[
i
].
‹õ¡©i⁄
 = 0;

635 
w_±r
[
i
].
bt_idx
 = 0;

636 
w_±r
[
i
].
Êags
 = 0;

641 
	`undo_˛o£_tûe_buf„r
(
ds1_idx
);

642 
	}
}

648 
	$edôtûe_dñëe_£À˘ed_tûes2
(
ds1_idx
)

650 
CELL_W_S
 * 
w_±r
;

651 
CELL_F_S
 * 
f_±r
;

652 
CELL_S_S
 * 
s_±r
;

653 
i
, 
tf
, 
ts
, 
tw
, 
x
, 
y
;

656 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

658 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

660 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

661 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

662 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

663 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

664 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

665 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

668 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

670 i‡(
	`IS_SELECTED
(
f_±r
[
i
].
Êags
))

672 
f_±r
[
i
].
¥›1
 = 0;

673 
f_±r
[
i
].
¥›2
 = 0;

674 
f_±r
[
i
].
¥›3
 = 0;

675 
f_±r
[
i
].
¥›4
 = 0;

676 
f_±r
[
i
].
bt_idx
 = 0;

677 
f_±r
[
i
].
Êags
 = 0;

682 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

684 i‡(
	`IS_SELECTED
(
s_±r
[
i
].
Êags
))

686 
s_±r
[
i
].
¥›1
 = 0;

687 
s_±r
[
i
].
¥›2
 = 0;

688 
s_±r
[
i
].
¥›3
 = 0;

689 
s_±r
[
i
].
¥›4
 = 0;

690 
s_±r
[
i
].
bt_idx
 = 0;

691 
s_±r
[
i
].
Êags
 = 0;

696 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

698 i‡(
	`IS_SELECTED
(
w_±r
[
i
].
Êags
))

700 
w_±r
[
i
].
¥›1
 = 0;

701 
w_±r
[
i
].
¥›2
 = 0;

702 
w_±r
[
i
].
¥›3
 = 0;

703 
w_±r
[
i
].
¥›4
 = 0;

704 
w_±r
[
i
].
‹õ¡©i⁄
 = 0;

705 
w_±r
[
i
].
bt_idx
 = 0;

706 
w_±r
[
i
].
Êags
 = 0;

711 
	}
}

725 
	$edôtûe_de£À˘_⁄e
(
ds1_idx
, 
x
, 
y
)

727 
CELL_F_S
 * 
f_±r
;

728 
CELL_S_S
 * 
s_±r
;

729 
CELL_W_S
 * 
w_±r
;

730 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

731 
n
, 
tf
, 
ts
, 
tw
, 
make_undo
 = 
FALSE
;

734 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

735 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

736 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

737 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

738 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

739 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

742 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

744 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
n
] != 0)

746 i‡(
	`IS_SELECTED
(
f_±r
[
n
].
Êags
))

748 
u
->
d©_Êg
.
f
[
n
] |
DF_FL
;

749 
make_undo
 = 
TRUE
;

753 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

755 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] != 0)

757 i‡(
	`IS_SELECTED
(
s_±r
[
n
].
Êags
))

759 
u
->
d©_Êg
.
s
[
n
] |
DF_FL
;

760 
make_undo
 = 
TRUE
;

764 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

766 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
n
] != 0)

768 i‡(
	`IS_SELECTED
(
w_±r
[
n
].
Êags
))

770 
u
->
d©_Êg
.
w
[
n
] |
DF_FL
;

771 
make_undo
 = 
TRUE
;

775 i‡(
make_undo
)

776 
	`undo_add_to_tûe_buf„r
(
ds1_idx
, 
x
, 
y
);

779 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

780 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
n
] != 0)

781 
	`DEL_SELECTED
(
f_±r
[
n
].
Êags
);

784 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

785 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] != 0)

786 
	`DEL_SELECTED
(
s_±r
[
n
].
Êags
);

789 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

790 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
n
] != 0)

791 
	`DEL_SELECTED
(
w_±r
[
n
].
Êags
);

792 
	}
}

797 
	$edôtûe_de£À˘_⁄e_com∂ëly
(
ds1_idx
, 
x
, 
y
)

799 
CELL_F_S
 * 
f_±r
;

800 
CELL_S_S
 * 
s_±r
;

801 
CELL_W_S
 * 
w_±r
;

802 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

803 
n
, 
tf
, 
ts
, 
tw
, 
make_undo
 = 
FALSE
;

806 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

807 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

808 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

809 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

810 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

811 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

814 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

816 i‡(
	`IS_SELECTED
(
f_±r
[
n
].
Êags
))

818 
u
->
d©_Êg
.
f
[
n
] |
DF_FL
;

819 
make_undo
 = 
TRUE
;

822 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

824 i‡(
	`IS_SELECTED
(
s_±r
[
n
].
Êags
))

826 
u
->
d©_Êg
.
s
[
n
] |
DF_FL
;

827 
make_undo
 = 
TRUE
;

830 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

832 i‡(
	`IS_SELECTED
(
w_±r
[
n
].
Êags
))

834 
u
->
d©_Êg
.
w
[
n
] |
DF_FL
;

835 
make_undo
 = 
TRUE
;

838 i‡(
make_undo
)

839 
	`undo_add_to_tûe_buf„r
(
ds1_idx
, 
x
, 
y
);

842 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

843 
	`DEL_SELECTED
(
f_±r
[
n
].
Êags
);

846 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

847 
	`DEL_SELECTED
(
s_±r
[
n
].
Êags
);

850 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

851 
	`DEL_SELECTED
(
w_±r
[
n
].
Êags
);

852 
	}
}

857 
	$edôtûe_£À˘_⁄e
(
ds1_idx
, 
x
, 
y
)

859 
CELL_F_S
 * 
f_±r
;

860 
CELL_S_S
 * 
s_±r
;

861 
CELL_W_S
 * 
w_±r
;

862 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

863 
n
, 
tf
, 
ts
, 
tw
, 
make_undo
 = 
FALSE
;

866 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

867 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

868 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

869 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

870 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

871 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

874 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

876 i‡((
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
n
] !0Ë&& (
f_±r
[n].
¥›1
 != 0))

878 i‡–! 
	`IS_SELECTED
(
f_±r
[
n
].
Êags
))

880 
u
->
d©_Êg
.
f
[
n
] |
DF_FL
;

881 
make_undo
 = 
TRUE
;

885 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

887 i‡((
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] !0Ë&& (
s_±r
[n].
¥›1
 != 0))

889 i‡–! 
	`IS_SELECTED
(
s_±r
[
n
].
Êags
))

891 
u
->
d©_Êg
.
s
[
n
] |
DF_FL
;

892 
make_undo
 = 
TRUE
;

896 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

898 i‡((
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
n
] !0Ë&& (
w_±r
[n].
¥›1
 != 0))

900 i‡–! 
	`IS_SELECTED
(
w_±r
[
n
].
Êags
))

902 
u
->
d©_Êg
.
w
[
n
] |
DF_FL
;

903 
make_undo
 = 
TRUE
;

907 i‡(
make_undo
)

908 
	`undo_add_to_tûe_buf„r
(
ds1_idx
, 
x
, 
y
);

911 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

912 i‡((
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
n
] !0Ë&& (
f_±r
[n].
¥›1
 != 0))

913 
	`SET_SELECTED
(
f_±r
[
n
].
Êags
);

916 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

917 i‡((
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] !0Ë&& (
s_±r
[n].
¥›1
 != 0))

918 
	`SET_SELECTED
(
s_±r
[
n
].
Êags
);

921 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

922 i‡((
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
n
] !0Ë&& (
w_±r
[n].
¥›1
 != 0))

923 
	`SET_SELECTED
(
w_±r
[
n
].
Êags
);

924 
	}
}

929 
	$edôtûe_£À˘_√w_⁄e
(
ds1_idx
, 
x
, 
y
)

931 
CELL_F_S
 * 
f_±r
;

932 
CELL_S_S
 * 
s_±r
;

933 
CELL_W_S
 * 
w_±r
;

934 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

935 
n
, 
tf
, 
ts
, 
tw
, 
make_undo
 = 
FALSE
;

938 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

939 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

940 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

941 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

942 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

943 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

946 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

948 i‡((
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
n
] !0Ë&& (
f_±r
[n].
¥›1
 != 0))

951 i‡–! 
	`IS_SELECTED
(
f_±r
[
n
].
Êags
))

954 
u
->
d©_Êg
.
f
[
n
] |
DF_FL
;

955 
make_undo
 = 
TRUE
;

961 i‡–
	`IS_SELECTED
(
f_±r
[
n
].
Êags
))

964 
u
->
d©_Êg
.
f
[
n
] |
DF_FL
;

965 
make_undo
 = 
TRUE
;

969 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

971 i‡((
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] !0Ë&& (
s_±r
[n].
¥›1
 != 0))

973 i‡–! 
	`IS_SELECTED
(
s_±r
[
n
].
Êags
))

975 
u
->
d©_Êg
.
s
[
n
] |
DF_FL
;

976 
make_undo
 = 
TRUE
;

981 i‡–
	`IS_SELECTED
(
s_±r
[
n
].
Êags
))

983 
u
->
d©_Êg
.
s
[
n
] |
DF_FL
;

984 
make_undo
 = 
TRUE
;

988 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

990 i‡((
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
n
] !0Ë&& (
w_±r
[n].
¥›1
 != 0))

992 i‡–! 
	`IS_SELECTED
(
w_±r
[
n
].
Êags
))

994 
u
->
d©_Êg
.
w
[
n
] |
DF_FL
;

995 
make_undo
 = 
TRUE
;

1000 i‡–
	`IS_SELECTED
(
w_±r
[
n
].
Êags
))

1002 
u
->
d©_Êg
.
w
[
n
] |
DF_FL
;

1003 
make_undo
 = 
TRUE
;

1007 i‡(
make_undo
)

1008 
	`undo_add_to_tûe_buf„r
(
ds1_idx
, 
x
, 
y
);

1011 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

1012 i‡((
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
n
] !0Ë&& (
f_±r
[n].
¥›1
 != 0))

1013 
	`SET_SELECTED
(
f_±r
[
n
].
Êags
);

1015 
	`DEL_SELECTED
(
f_±r
[
n
].
Êags
);

1018 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

1019 i‡((
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] !0Ë&& (
s_±r
[n].
¥›1
 != 0))

1020 
	`SET_SELECTED
(
s_±r
[
n
].
Êags
);

1022 
	`DEL_SELECTED
(
s_±r
[
n
].
Êags
);

1025 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

1026 i‡((
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
n
] !0Ë&& (
w_±r
[n].
¥›1
 != 0))

1027 
	`SET_SELECTED
(
w_±r
[
n
].
Êags
);

1029 
	`DEL_SELECTED
(
w_±r
[
n
].
Êags
);

1030 
	}
}

1035 
	$edôtûe_idítiˇl
(
ds1_idx
, 
IT_ENUM
 
ôy≥
, 
tx
, 
ty
)

1037 
CELL_F_S
 * 
f_±r
;

1038 
CELL_S_S
 * 
s_±r
;

1039 
CELL_W_S
 * 
w_±r
;

1040 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

1041 
x
, 
y
, 
n
, 
t
, 
i
, 
make_undo
, 
is_ßme
;

1042 
Ê_ªf
[
FLOOR_MAX_LAYER
],

1043 
sh_ªf
[
SHADOW_MAX_LAYER
],

1044 
wa_ªf
[
WALL_MAX_LAYER
];

1048 
	`undo_√w_tûe_buf„r
(
ds1_idx
);

1051 
n
=0;Ç < 
FLOOR_MAX_LAYER
;Ç++Ë
Ê_ªf
[n] = 0;

1052 
n
=0;Ç < 
SHADOW_MAX_LAYER
;Ç++Ë
sh_ªf
[n] = 0;

1053 
n
=0;Ç < 
WALL_MAX_LAYER
;Ç++Ë
wa_ªf
[n] = 0;

1058 
y
 = 0;

1059 
t
 = (
ty
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
tx
 * glb_ds1[ds1_idx].
Êo‹_num
);

1060 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

1062 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
i
] != 0)

1064 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

1065 i‡(
f_±r
->
bt_idx
 >= 1)

1067 
Ê_ªf
[
y
] = 
f_±r
->
bt_idx
;

1068 
y
++;

1074 
y
 = 0;

1075 
t
 = (
ty
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
tx
 * glb_ds1[ds1_idx].
shadow_num
);

1076 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

1078 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
i
] != 0)

1080 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
i
;

1081 i‡(
s_±r
->
bt_idx
 >= 1)

1083 
sh_ªf
[
y
] = 
s_±r
->
bt_idx
;

1084 
y
++;

1090 
y
 = 0;

1091 
t
 = (
ty
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
tx
 * glb_ds1[ds1_idx].
wÆl_num
);

1092 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

1094 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
i
] != 0)

1096 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

1097 i‡(
w_±r
->
bt_idx
 >= 1)

1099 
wa_ªf
[
y
] = 
w_±r
->
bt_idx
;

1100 
y
++;

1106 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

1108 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

1111 
make_undo
 = 
FALSE
;

1116 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1117 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

1119 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

1120 
u
->
d©_Êg
.
f
[
i
] = 0;

1123 
is_ßme
 = 
FALSE
;

1124 
n
=0;Ç < 
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

1126 i‡(
Ê_ªf
[
n
])

1128 i‡(
Ê_ªf
[
n
] =
f_±r
->
bt_idx
)

1131 
is_ßme
 = 
TRUE
;

1133 i‡((
ôy≥
 =
IT_NEW
Ë|| (ôy≥ =
IT_ADD
))

1138 i‡(
	`IS_SELECTED
(
f_±r
->
Êags
))

1145 
u
->
d©_Êg
.
f
[
i
] |
DF_FL
;

1146 
make_undo
 = 
TRUE
;

1149 
	`SET_SELECTED
(
f_±r
->
Êags
);

1152 i‡(
ôy≥
 =
IT_DEL
)

1157 i‡–! 
	`IS_SELECTED
(
f_±r
->
Êags
))

1164 
u
->
d©_Êg
.
f
[
i
] |
DF_FL
;

1165 
make_undo
 = 
TRUE
;

1168 
	`DEL_SELECTED
(
f_±r
->
Êags
);

1174 i‡(
is_ßme
 =
FALSE
)

1178 i‡(
ôy≥
 =
IT_NEW
)

1183 i‡–! 
	`IS_SELECTED
(
f_±r
->
Êags
))

1190 
u
->
d©_Êg
.
f
[
i
] |
DF_FL
;

1191 
make_undo
 = 
TRUE
;

1194 
	`DEL_SELECTED
(
f_±r
->
Êags
);

1201 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1202 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

1204 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
i
;

1205 
u
->
d©_Êg
.
s
[
i
] = 0;

1208 
is_ßme
 = 
FALSE
;

1209 
n
=0;Ç < 
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

1211 i‡(
sh_ªf
[
n
])

1213 i‡(
sh_ªf
[
n
] =
s_±r
->
bt_idx
)

1216 
is_ßme
 = 
TRUE
;

1218 i‡((
ôy≥
 =
IT_NEW
Ë|| (ôy≥ =
IT_ADD
))

1223 i‡(
	`IS_SELECTED
(
s_±r
->
Êags
))

1230 
u
->
d©_Êg
.
s
[
i
] |
DF_FL
;

1231 
make_undo
 = 
TRUE
;

1234 
	`SET_SELECTED
(
s_±r
->
Êags
);

1237 i‡(
ôy≥
 =
IT_DEL
)

1242 i‡–! 
	`IS_SELECTED
(
s_±r
->
Êags
))

1249 
u
->
d©_Êg
.
s
[
i
] |
DF_FL
;

1250 
make_undo
 = 
TRUE
;

1253 
	`DEL_SELECTED
(
s_±r
->
Êags
);

1259 i‡(
is_ßme
 =
FALSE
)

1263 i‡(
ôy≥
 =
IT_NEW
)

1268 i‡–! 
	`IS_SELECTED
(
s_±r
->
Êags
))

1275 
u
->
d©_Êg
.
s
[
i
] |
DF_FL
;

1276 
make_undo
 = 
TRUE
;

1279 
	`DEL_SELECTED
(
s_±r
->
Êags
);

1286 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1287 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

1289 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

1290 
u
->
d©_Êg
.
w
[
i
] = 0;

1293 
is_ßme
 = 
FALSE
;

1294 
n
=0;Ç < 
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

1296 i‡(
wa_ªf
[
n
])

1298 i‡(
wa_ªf
[
n
] =
w_±r
->
bt_idx
)

1301 
is_ßme
 = 
TRUE
;

1303 i‡((
ôy≥
 =
IT_NEW
Ë|| (ôy≥ =
IT_ADD
))

1308 i‡(
	`IS_SELECTED
(
w_±r
->
Êags
))

1315 
u
->
d©_Êg
.
w
[
i
] |
DF_FL
;

1316 
make_undo
 = 
TRUE
;

1319 
	`SET_SELECTED
(
w_±r
->
Êags
);

1322 i‡(
ôy≥
 =
IT_DEL
)

1327 i‡–! 
	`IS_SELECTED
(
w_±r
->
Êags
))

1334 
u
->
d©_Êg
.
w
[
i
] |
DF_FL
;

1335 
make_undo
 = 
TRUE
;

1338 
	`DEL_SELECTED
(
w_±r
->
Êags
);

1344 i‡(
is_ßme
 =
FALSE
)

1348 i‡(
ôy≥
 =
IT_NEW
)

1353 i‡–! 
	`IS_SELECTED
(
w_±r
->
Êags
))

1360 
u
->
d©_Êg
.
w
[
i
] |
DF_FL
;

1361 
make_undo
 = 
TRUE
;

1364 
	`DEL_SELECTED
(
w_±r
->
Êags
);

1371 i‡(
make_undo
)

1372 
	`undo_add_to_tûe_buf„r
(
ds1_idx
, 
x
, 
y
);

1377 
	`undo_˛o£_tûe_buf„r
(
ds1_idx
);

1378 
	}
}

1392 
	$edôtûe_unhide_Æl
(
ds1_idx
)

1394 
CELL_F_S
 * 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
;

1395 
CELL_S_S
 * 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
;

1396 
CELL_W_S
 * 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
;

1397 
i
;

1401 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_Àn
; i++)

1403 
	`DEL_HIDE
(
f_±r
->
Êags
);

1404 
f_±r
++;

1408 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_Àn
; i++)

1410 
	`DEL_HIDE
(
s_±r
->
Êags
);

1411 
s_±r
++;

1415 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_Àn
; i++)

1417 
	`DEL_HIDE
(
w_±r
->
Êags
);

1418 
w_±r
++;

1420 
	}
}

1425 
	$edôtûe_hide_add_⁄e
(
ds1_idx
, 
x
, 
y
)

1427 
CELL_F_S
 * 
f_±r
;

1428 
CELL_S_S
 * 
s_±r
;

1429 
CELL_W_S
 * 
w_±r
;

1430 
n
, 
tf
, 
ts
, 
tw
;

1433 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1434 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1435 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1436 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

1437 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

1438 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

1441 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

1443 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
n
] != 0)

1444 
	`SET_HIDE
(
f_±r
->
Êags
);

1445 
f_±r
++;

1449 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

1451 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] != 0)

1452 
	`SET_HIDE
(
s_±r
->
Êags
);

1453 
s_±r
++;

1457 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

1459 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
n
] != 0)

1460 
	`SET_HIDE
(
w_±r
->
Êags
);

1461 
w_±r
++;

1463 
	}
}

1484 
	$edôtûe_dñëe_Æl_tmp£l
(
ds1_idx
)

1486 
CELL_F_S
 * 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
;

1487 
CELL_S_S
 * 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
;

1488 
CELL_W_S
 * 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
;

1489 
i
;

1493 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_Àn
; i++)

1495 
	`DEL_TMP_SELECT
(
f_±r
->
Êags
);

1496 
f_±r
++;

1500 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_Àn
; i++)

1502 
	`DEL_TMP_SELECT
(
s_±r
->
Êags
);

1503 
s_±r
++;

1507 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_Àn
; i++)

1509 
	`DEL_TMP_SELECT
(
w_±r
->
Êags
);

1510 
w_±r
++;

1512 
	}
}

1517 
	$edôtûe_add_tmp£l_⁄e
(
ds1_idx
, 
x
, 
y
)

1519 
CELL_F_S
 * 
f_±r
;

1520 
CELL_S_S
 * 
s_±r
;

1521 
CELL_W_S
 * 
w_±r
;

1522 
n
, 
tf
, 
ts
, 
tw
;

1525 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1526 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1527 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1528 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

1529 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

1530 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

1533 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

1535 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
n
] != 0)

1536 
	`SET_TMP_SELECT
(
f_±r
->
Êags
);

1537 
f_±r
++;

1541 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

1543 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] != 0)

1544 
	`SET_TMP_SELECT
(
s_±r
->
Êags
);

1545 
s_±r
++;

1549 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

1551 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
n
] != 0)

1552 
	`SET_TMP_SELECT
(
w_±r
->
Êags
);

1553 
w_±r
++;

1555 
	}
}

1560 
	$edôtûe_£t_tmp£l
(
ds1_idx
, 
TMP_SEL_S
 * 
s
)

1562 
x
, 
y
, 
x1
, 
y1
, 
x2
, 
y2
;

1565 
x1
 = 
s
->x1;

1566 
x2
 = 
s
->x2;

1567 i‡(
s
->
x2
 < s->
x1
)

1569 
x1
 = 
s
->
x2
;

1570 
x2
 = 
s
->
x1
;

1572 
y1
 = 
s
->y1;

1573 
y2
 = 
s
->y2;

1574 i‡(
s
->
y2
 < s->
y1
)

1576 
y1
 = 
s
->
y2
;

1577 
y2
 = 
s
->
y1
;

1580 
y
 = 
y1
; y <
y2
; y++)

1581 
x
 = 
x1
; x <
x2
; x++)

1582 
	`edôtûe_add_tmp£l_⁄e
(
ds1_idx
, 
x
, 
y
);

1583 
	}
}

1588 
	$edôtûe_ch™ge_to_√w_≥rm™ít_£l
(
ds1_idx
, 
TMP_SEL_S
 * 
s
)

1590 
x
, 
y
, 
x1
, 
y1
, 
x2
, 
y2
;

1593 
x1
 = 
s
->x1;

1594 
x2
 = 
s
->x2;

1595 i‡(
s
->
x2
 < s->
x1
)

1597 
x1
 = 
s
->
x2
;

1598 
x2
 = 
s
->
x1
;

1600 
y1
 = 
s
->y1;

1601 
y2
 = 
s
->y2;

1602 i‡(
s
->
y2
 < s->
y1
)

1604 
y1
 = 
s
->
y2
;

1605 
y2
 = 
s
->
y1
;

1608 
	`undo_√w_tûe_buf„r
(
ds1_idx
);

1609 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

1611 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

1613 i‡((
x
 >
x1
Ë&& (x <
x2
Ë&& (
y
 >
y1
Ë&& (y <
y2
))

1614 
	`edôtûe_£À˘_√w_⁄e
(
ds1_idx
, 
x
, 
y
);

1616 
	`edôtûe_de£À˘_⁄e_com∂ëly
(
ds1_idx
, 
x
, 
y
);

1619 
	`undo_˛o£_tûe_buf„r
(
ds1_idx
);

1620 
	}
}

1625 
	$edôtûe_ch™ge_to_add_≥rm™ít_£l
(
ds1_idx
, 
TMP_SEL_S
 * 
s
)

1627 
x
, 
y
, 
x1
, 
y1
, 
x2
, 
y2
;

1630 
x1
 = 
s
->x1;

1631 
x2
 = 
s
->x2;

1632 i‡(
s
->
x2
 < s->
x1
)

1634 
x1
 = 
s
->
x2
;

1635 
x2
 = 
s
->
x1
;

1637 
y1
 = 
s
->y1;

1638 
y2
 = 
s
->y2;

1639 i‡(
s
->
y2
 < s->
y1
)

1641 
y1
 = 
s
->
y2
;

1642 
y2
 = 
s
->
y1
;

1645 
	`undo_√w_tûe_buf„r
(
ds1_idx
);

1646 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

1647 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

1648 i‡((
x
 >
x1
Ë&& (x <
x2
Ë&& (
y
 >
y1
Ë&& (y <
y2
))

1649 
	`edôtûe_£À˘_⁄e
(
ds1_idx
, 
x
, 
y
);

1650 
	`undo_˛o£_tûe_buf„r
(
ds1_idx
);

1651 
	}
}

1656 
	$edôtûe_ch™ge_to_hide_£l
(
ds1_idx
, 
TMP_SEL_S
 * 
s
)

1658 
x
, 
y
, 
x1
, 
y1
, 
x2
, 
y2
;

1661 
x1
 = 
s
->x1;

1662 
x2
 = 
s
->x2;

1663 i‡(
s
->
x2
 < s->
x1
)

1665 
x1
 = 
s
->
x2
;

1666 
x2
 = 
s
->
x1
;

1668 
y1
 = 
s
->y1;

1669 
y2
 = 
s
->y2;

1670 i‡(
s
->
y2
 < s->
y1
)

1672 
y1
 = 
s
->
y2
;

1673 
y2
 = 
s
->
y1
;

1676 
y
 = 
y1
; y <
y2
; y++)

1677 
x
 = 
x1
; x <
x2
; x++)

1678 
	`edôtûe_hide_add_⁄e
(
ds1_idx
, 
x
, 
y
);

1679 
	}
}

1684 
	$edôtûe_ch™ge_to_dñ_£l
(
ds1_idx
, 
TMP_SEL_S
 * 
s
)

1686 
x
, 
y
, 
x1
, 
y1
, 
x2
, 
y2
;

1689 
x1
 = 
s
->x1;

1690 
x2
 = 
s
->x2;

1691 i‡(
s
->
x2
 < s->
x1
)

1693 
x1
 = 
s
->
x2
;

1694 
x2
 = 
s
->
x1
;

1696 
y1
 = 
s
->y1;

1697 
y2
 = 
s
->y2;

1698 i‡(
s
->
y2
 < s->
y1
)

1700 
y1
 = 
s
->
y2
;

1701 
y2
 = 
s
->
y1
;

1704 
	`undo_√w_tûe_buf„r
(
ds1_idx
);

1705 
y
 = 
y1
; y <
y2
; y++)

1706 
x
 = 
x1
; x <
x2
; x++)

1707 
	`edôtûe_de£À˘_⁄e
(
ds1_idx
, 
x
, 
y
);

1708 
	`undo_˛o£_tûe_buf„r
(
ds1_idx
);

1709 
	}
}

	@edittile.h

1 #i‚de‡
_EDITTILE_H_


3 
	#_EDITTILE_H_


	)

6 
edôtûe_middÀ_£À˘
 (
ds1_idx
, * 
°¨t_x
, * 
°¨t_y
);

7 
edôtûe_∑°e_¥ï¨e
 (
ds1_idx
);

8 
edôtûe_∑°e_undo
 (
ds1_idx
);

9 
edôtûe_∑°e_¥evõw
 (
ds1_idx
, 
dx
, 
dy
, 
PASTE_POS_S
 * 
p
);

10 
edôtûe_∑°e_föÆ
 (
ds1_idx
);

13 
edôtûe_dñëe_£À˘ed_tûes
 (
ds1_idx
);

14 
edôtûe_dñëe_£À˘ed_tûes2
 (
ds1_idx
);

17 
edôtûe_de£À˘_⁄e
 (
ds1_idx
, 
x
, 
y
);

18 
edôtûe_de£À˘_⁄e_com∂ëly
 (
ds1_idx
, 
x
, 
y
);

19 
edôtûe_£À˘_⁄e
 (
ds1_idx
, 
x
, 
y
);

20 
edôtûe_£À˘_√w_⁄e
 (
ds1_idx
, 
x
, 
y
);

21 
edôtûe_idítiˇl
 (
ds1_idx
, 
IT_ENUM
 
ôy≥
, 
tx
, 
ty
);

24 
edôtûe_unhide_Æl
 (
ds1_idx
);

25 
edôtûe_hide_add_⁄e
 (
ds1_idx
, 
x
, 
y
);

28 
edôtûe_dñëe_Æl_tmp£l
 (
ds1_idx
);

29 
edôtûe_add_tmp£l_⁄e
 (
ds1_idx
, 
x
, 
y
);

30 
edôtûe_£t_tmp£l
 (
ds1_idx
, 
TMP_SEL_S
 * 
s
);

31 
edôtûe_ch™ge_to_√w_≥rm™ít_£l
 (
ds1_idx
, 
TMP_SEL_S
 * 
s
);

32 
edôtûe_ch™ge_to_add_≥rm™ít_£l
 (
ds1_idx
, 
TMP_SEL_S
 * 
s
);

33 
edôtûe_ch™ge_to_hide_£l
 (
ds1_idx
, 
TMP_SEL_S
 * 
s
);

34 
edôtûe_ch™ge_to_dñ_£l
 (
ds1_idx
, 
TMP_SEL_S
 * 
s
);

	@error.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~"°ru˘s.h
"

4 
	~"îr‹.h
"

	@error.h

1 #i‚de‡
_ERROR_H_


3 
	#_ERROR_H_


	)

7 
	#FATAL_EXIT
(...Ëdo{ 
	`Ârötf
–
°dîr
, "FATAL ERROR:::" ); f¥ötf–°dîr, 
__VA_ARGS__
 ); 
	`fÊush
(°dîr); 
	`exô
(255); }0)

	)

8 
	#DEBUG_MESSAGE
(...Ëdo{ 
	`Ârötf
–
°dîr
, "DEBUG MESSAGE:::"); f¥ötf–°dîr, 
__VA_ARGS__
 ); 
	`fÊush
(°dîr); }0)

	)

9 
	#WARNING_MESSAGE
(...Ëdo{ 
	`Ârötf
–
°dîr
, "WARNING:::"); f¥ötf–°dîr, 
__VA_ARGS__
 ); 
	`fÊush
(°dîr); }0)

	)

	@gfx_custom.c

1 
	~"°ru˘s.h
"

2 
	~"gfx_cu°om.h
"

10 
	$°ªtch_å™s_•rôe_8bµ
(
BITMAP
 * 
d°
, BITMAP * 
•rôe
, 
x0
, 
y0
, 
div
)

12 
dx1
, 
dy1
, 
dx2
, 
dy2
, 
sx1
, 
sy1
, 
dw
, 
dh
, 
sw
, 
sh
;

16 i‡((
	`bôm≠_cﬁ‹_dïth
(
d°
Ë!8Ë|| (bôm≠_cﬁ‹_dïth(
•rôe
) != 8))

18 i‡(–! 
	`is_löór_bôm≠
(
d°
)Ë|| ( ! is_löór_bôm≠(
•rôe
)))

23 
dw
 = 
d°
->
w
;

24 
dh
 = 
d°
->
h
;

25 i‡((
x0
 >
dw
Ë|| (
y0
 >
dh
))

28 
sw
 = 
•rôe
->
w
;

29 
sh
 = 
•rôe
->
h
;

32 i‡(
x0
 < 0)

34 
dx1
 = 0;

35 
sx1
 = (-
x0
Ë* 
div
;

36 i‡(
sx1
 >
sw
)

41 
dx1
 = 
x0
;

42 
sx1
 = 0;

45 i‡(
y0
 < 0)

47 
dy1
 = 0;

48 
sy1
 = (-
y0
Ë* 
div
;

49 i‡(
sy1
 >
sh
)

54 
dy1
 = 
y0
;

55 
sy1
 = 0;

59 
sw
 /
div
;

60 
sh
 /
div
;

62 
dx2
 = 
dx1
 + 
sw
 - 1 - (
sx1
 / 
div
);

63 i‡(
dx2
 >
dw
)

64 
dx2
 = 
dw
 - 1;

66 
dy2
 = 
dy1
 + 
sh
 - 1 - (
sy1
 / 
div
);

67 i‡(
dy2
 >
dh
)

68 
dy2
 = 
dh
 - 1;

70 i‡((
dx2
 < 0Ë|| (
dy2
 < 0))

75 
dx
, 
dy
, 
sx
, 
sy
;

77 
dx
 = 
dx1
;

78 
dy
 = 
dy1
;

79 
sx
 = 
sx1
;

80 
sy
 = 
sy1
;

81 i‡(
cﬁ‹_m≠
 =
NULL
)

86 i‡(
•rôe
->
löe
[
sy
][
sx
])

87 
d°
->
löe
[
dy
][
dx
] = 
•rôe
->löe[
sy
][
sx
];

88 
dx
++;

89 i‡(
dx
 > 
dx2
)

91 
dx
 = 
dx1
;

92 
sx
 = 
sx1
;

93 
dy
++;

94 i‡(
dy
 > 
dy2
)

97 
sy
 +
div
;

100 
sx
 +
div
;

108 i‡(
•rôe
->
löe
[
sy
][
sx
])

110 
d°
->
löe
[
dy
][
dx
] = 
cﬁ‹_m≠
->
d©a


111 [ 
d°
->
löe
[
dy
][
dx
] ]

112 [ 
•rôe
->
löe
[
sy
][
sx
] ];

114 
dx
++;

115 i‡(
dx
 > 
dx2
)

117 
dx
 = 
dx1
;

118 
sx
 = 
sx1
;

119 
dy
++;

120 i‡(
dy
 > 
dy2
)

123 
sy
 +
div
;

126 
sx
 +
div
;

130 
	}
}

139 
	$°ªtch_å™s_shadow_8bµ
(
BITMAP
 * 
d°
, BITMAP * 
•rôe
, 
x0
, 
y0
, 
div
,

140 
UBYTE
 * 
cm≠
, 
offy
)

142 
dx1
, 
dy1
, 
dx2
, 
dy2
, 
sx1
, 
sy1
, 
sw
, 
sh
;

146 i‡((
	`bôm≠_cﬁ‹_dïth
(
d°
Ë!8Ë|| (bôm≠_cﬁ‹_dïth(
•rôe
) != 8))

148 i‡(–! 
	`is_löór_bôm≠
(
d°
)Ë|| ( ! is_löór_bôm≠(
•rôe
)))

151 
sx1
 = 0;

152 
sy1
 = 0;

153 
sw
 = 
•rôe
->
w
 / 
div
;

154 
sh
 = 
•rôe
->
h
 / (
div
 * 2);

156 
dy1
 = 
y0
 + ((
offy
 - y0) / 2);

157 
dx1
 = 
x0
 - ((
offy
 - 
y0
) / 2);

159 
dx2
 = 
dx1
 + 
sw
 - 1;

160 
dy2
 = 
dy1
 + 
sh
 - 1;

164 
dx
, 
dy
, 
sx
, 
sy
;

166 
dx
 = 
dx1
;

167 
dy
 = 
dy1
;

168 
sx
 = 
sx1
;

169 
sy
 = 
sy1
;

172 i‡((
dx
 >0Ë&& (
dy
 >0Ë&& (dx < 
d°
->
w
Ë&& (dy < d°->
h
))

174 i‡(
•rôe
->
löe
[
sy
][
sx
])

175 
d°
->
löe
[
dy
][
dx
] = 
cm≠
[ dst->line[dy][dx] ];

177 
dx
++;

178 i‡(
dx
 > 
dx2
)

180 
dx1
++;

181 
dx2
++;

182 
dx
 = 
dx1
;

183 
sx
 = 
sx1
;

184 
dy
++;

185 i‡(
dy
 > 
dy2
)

188 
sy
 +
div
 * 2;

191 
sx
 +
div
;

194 
	}
}

	@gfx_custom.h

1 #i‚de‡
_GFX_CUSTOM_H_


3 
	#_GFX_CUSTOM_H_


	)

5 
°ªtch_å™s_•rôe_8bµ
(
BITMAP
 * 
d°
, BITMAP * 
•rôe
, 
x0
, 
y0
, 
div
);

6 
°ªtch_å™s_shadow_8bµ
(
BITMAP
 * 
d°
, BITMAP * 
•rôe
, 
x0
, 
y0
, 
div
, 
UBYTE
 * 
cm≠_±r
, 
offy
);

	@inicreat.c

1 
	~<°dio.h
>

2 
	~"ty≥s.h
"

3 
	~"îr‹.h
"

4 
	~"öi¸ót.h
"

9 
	$öi_¸óã
(* 
ööame
)

11 
FILE
 * 
out
;

12 
tmp
[80];

14 
	`¥ötf
("ˇn'à›í %s, cª©ög it\n", 
ööame
);

15 
out
 = 
	`f›í
(
ööame
, "wt");

16 i‡(
out
 =
NULL
) {

17 
	`FATAL_EXIT
("ˇ¿nŸ cª©ê%s", 
ööame
);

19 
	`Âuts
(

149 , 
out


152 
	`f˛o£
(
out
);

153 
	`¥ötf
("new ds1edit.ini was created\n");

154 
	`Ârötf
(
°dîr
, "new ds1edit.ini was created\n");

155 
	}
}

	@inicreat.h

1 #i‚de‡
_INICREAT_H_


3 
	#_INICREAT_H_


	)

5 
öi_¸óã
 (* 
ööame
);

	@iniread.c

1 
	~"°ru˘s.h
"

2 
	~"îr‹.h
"

3 
	~<°rög.h
>

4 
	~"öúód.h
"

8 
	$öi_ªad
(* 
ööame
)

10 
i
;

11 
vÆ
;

12 
n
;

13 
Àn
;

14 
is_ok
 = 
TRUE
;

16 
tmp
[256];

17 *
buf
;

18 **
tmµå
;

20 c⁄° *
°r
;

22 íum {
T_NULL
, 
T_MPQ
, 
T_MOD
, 
T_STR
, 
T_INT
, 
T_GAM
, 
T_YES
, 
T_ZOOM
} 
	tTYPE_E
;

25 
«me
[30];

26 
TYPE_E
 
ty≥
;

27 *
d©a_±r
;

28 *
def
;

29 }
d©as
[] = {

30 { ( "d2ch¨" ), 
T_MPQ
, &–
glb_c⁄fig
.
mpq_fûe
[3] ), (*)( "" ) },

31 { ( "d2d©a" ), 
T_MPQ
, &–
glb_c⁄fig
.
mpq_fûe
[2] ), (*)( "" ) },

32 { ( "d2exp" ), 
T_MPQ
, &–
glb_c⁄fig
.
mpq_fûe
[1] ), (*)( "" ) },

33 { ( "∑tch_d2" ), 
T_MPQ
, &–
glb_c⁄fig
.
mpq_fûe
[0] ), (*)( "" ) },

34 { ( "mod_dú" ), 
T_MOD
, &–
glb_c⁄fig
.
mod_dú
[0] ), (*)( "" ) },

35 { ( "fuŒ_s¸ìn" ), 
T_YES
, &–
glb_c⁄fig
.
fuŒs¸ìn
 ), (*)( "YES" ) },

36 { ( "s¸ìn_width" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ìn
.
width
 ), (*)( 800 ) },

37 { ( "s¸ìn_height" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ìn
.
height
 ), (*)( 600 ) },

38 { ( "s¸ìn_dïth" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ìn
.
dïth
 ), (*)( 8 ) },

39 { ( "ª‰esh_øã" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ìn
.
ª‰esh
 ), (*)( 60 ) },

40 { ( "keyb_s¸ﬁl_x" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ﬁl
.
keyb
.
x
 ), (*)( 40 ) },

41 { ( "keyb_s¸ﬁl_y" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ﬁl
.
keyb
.
y
 ), (*)( 20 ) },

42 { ( "mou£_s¸ﬁl_x" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ﬁl
.
mou£
.
x
 ), (*)( 20 ) },

43 { ( "mou£_s¸ﬁl_y" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ﬁl
.
mou£
.
y
 ), (*)( 10 ) },

44 { ( "edô_s¸ﬁl_x" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ﬁl
.
edô
.
x
 ), (*)( 20 ) },

45 { ( "edô_s¸ﬁl_y" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ﬁl
.
edô
.
y
 ), (*)( 20 ) },

46 { ( "obj_edô_s¸ﬁl" ), 
T_INT
, &–
glb_c⁄fig
.
s¸ﬁl
.
obj_edô
 ), (*)( 2 ) },

47 { ( "mou£_•ìd_x" ), 
T_INT
, &–
glb_c⁄fig
.
mou£_•ìd
.
x
 ), (*)( 2 ) },

48 { ( "mou£_•ìd_y" ), 
T_INT
, &–
glb_c⁄fig
.
mou£_•ìd
.
y
 ), (*)( 2 ) },

49 { ( "gamma_c‹ª˘i⁄" ), 
T_GAM
, &–
glb_c⁄fig
.
gamma
 ), (*)( "1.30" ) },

50 { ( "⁄ly_n‹mÆ_ty≥2" ), 
T_YES
, &–
glb_c⁄fig
.
n‹mÆ_ty≥2
 ), (*)( "YES" ) },

51 { ( "Æways_max_œyîs" ), 
T_YES
, &–
glb_c⁄fig
.
Æways_max_œyîs
 ), (*)( "YES" ) },

52 { ( "°ªtch_•rôe" ), 
T_YES
, &–
glb_c⁄fig
.
°ªtch_•rôes
 ), (*)( "YES" ) },

53 { ( "wöobj_ˇn_s¸ﬁl_keyb" ), 
T_YES
, &–
glb_c⁄fig
.
wöobj_s¸ﬁl_keyb
 ), (*)( "YES" ) },

54 { ( "wöobj_ˇn_s¸ﬁl_mou£" ), 
T_YES
, &–
glb_c⁄fig
.
wöobj_s¸ﬁl_mou£
 ), (*)( "NO" ) },

55 { ( "˚¡î_zoom" ), 
T_ZOOM
, &–
glb_c⁄fig
.
˚¡î_zoom
 ), (*)( "1:1" ) },

56 { ( "nb_ty≥1_≥r_a˘" ), 
T_INT
, &–
glb_c⁄fig
.
nb_ty≥1_≥r_a˘
 ), (*)( 60 ) },

57 { ( "nb_ty≥2_≥r_a˘" ), 
T_INT
, &–
glb_c⁄fig
.
nb_ty≥2_≥r_a˘
 ), (*)( 150 ) },

58 { ( "ds1_ßved_möimize" ), 
T_YES
, &–
glb_c⁄fig
.
möimize_ds1
 ), (*)( "YES" ) },

59 { ( "lowî_•ìd_zoom_out" ), 
T_YES
, &–
glb_c⁄fig
.
lowî_•ìd_zoom_out
 ), (*)( "NO" ) },

60 { ( "w‹k•a˚_íabÀ" ), 
T_YES
, &–
glb_c⁄fig
.
w‹k•a˚_íabÀ
 ), (*)( "YES" ) },

61 { ( "" ), 
T_NULL
, 
NULL
, NULL }

65 
	`DEBUG_MESSAGE
("ini_read():in\n");

66 
	`DEBUG_MESSAGE
("ini_read(),Üoad ds1edit.ini\n");

68 
	`£t_c⁄fig_fûe
(
ööame
);

69 
i
 = 0;

71 
d©as
[
i
].
ty≥
 !
T_NULL
) {

72 
°r
 = 
	`gë_c⁄fig_°rög
(
NULL
, 
d©as
[
i
].
«me
, (c⁄° *Ëd©as[i].
def
);

73 i‡(
°r
 =
NULL
) {

74 
	`WARNING_MESSAGE
("löênŸ found : <%s>\n", 
d©as
[
i
].
«me
);

75 
is_ok
 = 
FALSE
;

77 
d©as
[
i
].
ty≥
) {

79 
T_STR
 :

80 i‡(
	`°æí
(
°r
)){

81 
d©as
[
i
].
d©a_±r
 = (*Ë
°r
;

85 
T_INT
 :

86 
vÆ
 = 
	`gë_c⁄fig_öt
(
NULL
, 
d©as
[
i
].
«me
, (Ëd©as[i].
def
);

87 * ((*Ë
d©as
[
i
].
d©a_±r
Ë
vÆ
;

91 
T_GAM
 :

92 
n
=0;

93  (
n
 < 
GC_MAX
Ë&& (
	`°rcmp
(
°r
, 
glb_gamma_°r
[n].str) != 0) ){

94 
n
++;

96 i‡(
n
 < 
GC_MAX
){

97 
glb_c⁄fig
.
gamma
 = 
glb_gamma_°r
[
n
].
vÆ
;

102 
T_MPQ
 :

103 
Àn
 = 
	`°æí
(
°r
);

104 i‡(
Àn
) {

105 
buf
 = (*Ë
	`mÆloc
((Ë* (
Àn
+1));

106 i‡(
buf
 =
NULL
){

107 
	`FATAL_EXIT
("read_ini(), malloc()Érror on MpqÇame");

109 
	`°r˝y
(
buf
, 
°r
);

110 
tmµå
 = 
d©as
[
i
].
d©a_±r
;

111 * 
tmµå
 = 
buf
;

117 
T_MOD
 :

118 
Àn
 = 
	`°æí
(
°r
);

119 i‡(
Àn
) {

120 
buf
 = (*Ë
	`mÆloc
((Ë* (
Àn
+1));

121 if(
buf
 =
NULL
){

122 
	`FATAL_EXIT
("read_ini(), malloc()Érror on ModÇame");

124 
	`°r˝y
(
buf
, 
°r
);

125 i‡((
buf
[
	`°æí
(buf)-1] == '\\') || (buf[strlen(buf)-1] == '/')){

126 
buf
[
	`°æí
(buf)-1] = 0;

128 
tmµå
 = 
d©as
[
i
].
d©a_±r
;

129 * 
tmµå
 = 
buf
;

135 
T_YES
 :

136 i‡(
	`°æí
(
°r
)){

137 i‡(
	`°ricmp
(
°r
, "YES") == 0){

138 *((*Ë
d©as
[
i
].
d©a_±r
Ë
TRUE
;

140 *((*Ë
d©as
[
i
].
d©a_±r
Ë
FALSE
;

146 
T_ZOOM
 :

147 i‡(
	`°æí
(
°r
)){

149 * ((*Ë
d©as
[
i
].
d©a_±r
) = -1;

152 i‡(
	`°ricmp
(
°r
, "1:1") == 0){

153 * ((*Ë
d©as
[
i
].
d©a_±r
Ë
ZM_11
;

154 }i‡(
	`°ricmp
(
°r
, "1:2") == 0){

155 * ((*Ë
d©as
[
i
].
d©a_±r
Ë
ZM_12
;

156 }i‡(
	`°ricmp
(
°r
, "1:4") == 0){

157 * ((*Ë
d©as
[
i
].
d©a_±r
Ë
ZM_14
;

158 }i‡(
	`°ricmp
(
°r
, "1:8") == 0){

159 * ((*Ë
d©as
[
i
].
d©a_±r
Ë
ZM_18
;

160 }i‡(
	`°ricmp
(
°r
, "1:16") == 0){

161 * ((*Ë
d©as
[
i
].
d©a_±r
Ë
ZM_116
;

164 
d©as
[
i
].
d©a_±r
 = (*Ë
°r
;

168 
i
++;

170 if(
is_ok
 !
TRUE
){

171 
	`FATAL_EXIT
("%†i†nŸ vÆid.\ndñëêô,ándÑñaunchÅhi†¥ogÅÿ¸óãáÇew good o√,\¡híÉdô iàtÿmakêch™ge†whîê√˚sßry,ÅhíÑñaunchÅhi†¥og", 
ööame
);

173 
	}
}

	@iniread.h

1 #i‚de‡
_INIREAD_H_


3 
	#_INIREAD_H_


	)

5 
öi_ªad
 (* 
ööame
);

	@interfac.c

1 
	~"°ru˘s.h
"

2 
	~"w¥evõw.h
"

3 
	~"edôobj.h
"

4 
	~"misc.h
"

5 
	~"ds1ßve.h
"

6 
	~"msg_ßve.h
"

7 
	~"edôtûe.h
"

8 
	~"undo.h
"

9 
	~"™imd©a.h
"

10 
	~"™im.h
"

11 
	~"txåód.h
"

12 
	~"wbôs.h
"

13 
	~"wedô.h
"

14 
	~"msg_quô.h
"

15 
	~"öãrÁc.h
"

20 
	$öãrÁc_u£r_h™dÀr
(
°¨t_ds1_idx
)

22 
ds1_idx
, 
d⁄e
, 
cx
, 
cy
, 
n
, 
i
, 
dx
, 
dy
, 
ﬁd_ds1_idx
=0;

23 
ﬁd_mou£_x
 = 
mou£_x
, 
ﬁd_mou£_y
=
mou£_y
, 
ﬁd_mou£_b
=0;

24 
cur_mou£_z
 = 0, 
ﬁd_mou£_z
 = 0;

25 
ﬁd_˚Œ_x
 = -1, 
ﬁd_˚Œ_y
 = -1;

26 
ﬁd_idítiˇl_x
 = -1, 
ﬁd_idítiˇl_y
 = -1;

27 
ticks_ñ≠£d
, 
ªt
;

28 
ˇn_swich_mode
, 
key_func_code
[7] = {
KEY_F1
, 
KEY_F2
, 
KEY_F5
, 
KEY_F6
, 
KEY_F7
, 
KEY_F8
, 
KEY_F11
};

29 
TMP_SEL_S
 
tmp_£l
;

30 
PASTE_POS_S
 
∑°e_pos
;

31 
tmp
[150];

32 
MODE_E
 
ﬁd_mode
 = 0;

33 
IT_ENUM
 
ôy≥
 = 
IT_NULL
;

34 
group_ch™ged
, 
ﬁd_group
, 
found
;

35 
BITMAP
 * 
ﬁd_s¸ìn_buff
 = 
NULL
;

39 
tmp_£l
.
x1
 =Åmp_£l.
x2
 =Åmp_£l.
y1
 =Åmp_£l.
y2
 = 0;

40 
tmp_£l
.
ﬁd_x2
 =Åmp_£l.
ﬁd_y2
 = 0;

41 
tmp_£l
.
ty≥
 = 
TMP_NULL
;

42 
tmp_£l
.
°¨t
 = 
FALSE
;

43 
∑°e_pos
.
ﬁd_ds1_idx
 = 0;

44 
∑°e_pos
.
ﬁd_x
 = 0;

45 
∑°e_pos
.
ﬁd_y
 = 0;

46 
∑°e_pos
.
§c_ds1_idx
 = 0;

47 
∑°e_pos
.
°¨t_x
 = 0;

48 
∑°e_pos
.
°¨t_y
 = 0;

49 
∑°e_pos
.
°¨t
 = 
FALSE
;

50 
∑°e_pos
.
is_cut
 = 
FALSE
;

51 
∑°e_pos
.
cut_ßved
 = 
FALSE
;

52 
ds1_idx
 = 
°¨t_ds1_idx
;

53 
d⁄e
 = 
FALSE
;

66 ! 
d⁄e
) {

67 
ˇn_swich_mode
 = 
TRUE
;

68 i‡(
glb_ds1edô
.
mode
 =
MOD_P
) {

70 i‡(
glb_ds1
[
ds1_idx
].
∑th_edô_wö
.
mode
 !
PEM_NONE
) {

71 
ˇn_swich_mode
 = 
FALSE
;

72 } i‡(
glb_ds1
[
ds1_idx
].
∑th_edô_wö
.
obj_dúty
 =
TRUE
) {

73 
ˇn_swich_mode
 = 
FALSE
;

77 
ﬁd_mou£_x
 = 
mou£_x
;

78 
ﬁd_mou£_y
 = 
mou£_y
;

79 
ﬁd_mou£_b
 = 
mou£_b
;

81 
cur_mou£_z
 = 
mou£_z
;

86 
	`mou£_to_tûe
(
ds1_idx
, &
cx
, &
cy
);

87 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

88 i‡(
cx
 < 0) {

89 
cx
 = 0;

90 } i‡(
cx
 >
glb_ds1
[
ds1_idx
].
width
) {

91 
cx
 = 
glb_ds1
[
ds1_idx
].
width
 - 1;

93 i‡(
cy
 < 0) {

94 
cy
 = 0;

95 } i‡(
cy
 >
glb_ds1
[
ds1_idx
].
height
) {

96 
cy
 = 
glb_ds1
[
ds1_idx
].
height
 - 1;

99 
cx
 -= 2;

100 
cy
 += 2;

101 i‡(
cx
 < 0) {

102 
cx
 = 0;

103 } i‡(
cx
 >
glb_ds1
[
ds1_idx
].
width
 * 5 - 1) {

104 
cx
 = 
glb_ds1
[
ds1_idx
].
width
 * 5 - 1;

106 i‡(
cy
 < 0) {

107 
cy
 = 0;

108 } i‡(
cy
 >
glb_ds1
[
ds1_idx
].
height
 * 5 - 1) {

109 
cy
 = 
glb_ds1
[
ds1_idx
].
height
 * 5 - 1;

118 i‡(
glb_ds1edô
.
mode
 =
MOD_O
) {

119 
	`edôobj_h™dÀr
–
ds1_idx
, 
cx
, 
cy
, 
ﬁd_mou£_x
, 
ﬁd_mou£_y
, 
ﬁd_mou£_b
 );

122 i‡((
cx
 !
ﬁd_˚Œ_x
Ë|| (
cy
 !
ﬁd_˚Œ_y
)) {

123 
ﬁd_˚Œ_x
 = 
cx
;

124 
ﬁd_˚Œ_y
 = 
cy
;

125 
ﬁd_idítiˇl_x
 = -1;

126 
ﬁd_idítiˇl_y
 = -1;

130 
ticks_ñ≠£d
 = 
glb_ds1edô
.ticks_elapsed;

131 i‡–
ticks_ñ≠£d
 && (
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
 == 1)) {

135 
glb_ds1
[
ds1_idx
].
cur_™im_Êo‹_‰ame
 +
ticks_ñ≠£d
 * 2;

137 
glb_ds1edô
.
ticks_ñ≠£d
 = 0;

141 
	`w¥evõw_døw_tûes
(
ds1_idx
);

142 
glb_ds1edô
.
Âs
++;

150 i‡(
glb_ds1
[
ds1_idx
].
døw_edô_obj
 =
TRUE
) {

152 i‡(
glb_c⁄fig
.
wöobj_s¸ﬁl_keyb
 =
TRUE
) {

154 i‡(
key
[
KEY_UP
]) {

155 
glb_ds1edô
.
wö_¥evõw
.
y0
 -
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
y
;

157 i‡(
key
[
KEY_DOWN
]) {

158 
glb_ds1edô
.
wö_¥evõw
.
y0
 +
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
y
;

160 i‡(
key
[
KEY_LEFT
]) {

161 
glb_ds1edô
.
wö_¥evõw
.
x0
 -
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
x
;

163 i‡(
key
[
KEY_RIGHT
]) {

164 
glb_ds1edô
.
wö_¥evõw
.
x0
 +
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
x
;

168 i‡(
glb_c⁄fig
.
wöobj_s¸ﬁl_mou£
 =
TRUE
) {

170 i‡(
ﬁd_mou£_y
 == 0) {

171 
glb_ds1edô
.
wö_¥evõw
.
y0
 -
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
y
;

173 i‡(
ﬁd_mou£_y
 =
glb_c⁄fig
.
s¸ìn
.
height
 - 1) {

174 
glb_ds1edô
.
wö_¥evõw
.
y0
 +
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
y
;

176 i‡(
ﬁd_mou£_x
 == 0) {

177 
glb_ds1edô
.
wö_¥evõw
.
x0
 -
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
x
;

179 i‡(
ﬁd_mou£_x
 =
glb_c⁄fig
.
s¸ìn
.
width
 - 1) {

180 
glb_ds1edô
.
wö_¥evõw
.
x0
 +
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
x
;

185 i‡(
key
[
KEY_UP
]) {

186 
glb_ds1edô
.
wö_¥evõw
.
y0
 -
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
y
;

187 } i‡(
ﬁd_mou£_y
 == 0) {

188 
glb_ds1edô
.
wö_¥evõw
.
y0
 -
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
y
;

191 i‡(
key
[
KEY_DOWN
]) {

192 
glb_ds1edô
.
wö_¥evõw
.
y0
 +
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
y
;

193 } i‡(
ﬁd_mou£_y
 =
glb_c⁄fig
.
s¸ìn
.
height
 - 1) {

194 
glb_ds1edô
.
wö_¥evõw
.
y0
 +
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
y
;

197 i‡(
key
[
KEY_LEFT
]) {

198 
glb_ds1edô
.
wö_¥evõw
.
x0
 -
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
x
;

199 } i‡(
ﬁd_mou£_x
 == 0) {

200 
glb_ds1edô
.
wö_¥evõw
.
x0
 -
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
x
;

203 i‡(
key
[
KEY_RIGHT
]) {

204 
glb_ds1edô
.
wö_¥evõw
.
x0
 +
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
x
;

205 } i‡(
ﬁd_mou£_x
 =
glb_c⁄fig
.
s¸ìn
.
width
 - 1) {

206 
glb_ds1edô
.
wö_¥evõw
.
x0
 +
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
x
;

211 i‡–(
key
[
KEY_MINUS_PAD
] || key[
KEY_MINUS
] || (
cur_mou£_z
 < 
ﬁd_mou£_z
ËË&& 
glb_ds1
[
ds1_idx
].
cur_zoom
 < 
ZM_116
 ) {

212 i‡(
key
[
KEY_MINUS_PAD
] || key[
KEY_MINUS
]) {

213 
key
[
KEY_MINUS_PAD
] || key[
KEY_MINUS
]) {

217 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
glb_ds1edô
.
wö_¥evõw
.x0;

218 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
glb_ds1edô
.
wö_¥evõw
.y0;

219 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
w
 = 
glb_ds1edô
.
wö_¥evõw
.w;

220 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
h
 = 
glb_ds1edô
.
wö_¥evõw
.h;

221 
	`ch™ge_zoom
(
ds1_idx
, 
glb_ds1
[ds1_idx].
cur_zoom
 + 1);

222 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.x0;

223 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.y0;

226 i‡–(
key
[
KEY_PLUS_PAD
] || key[
KEY_EQUALS
] || (
cur_mou£_z
 > 
ﬁd_mou£_z
ËË&& 
glb_ds1
[
ds1_idx
].
cur_zoom
 > 
ZM_11
 ) {

227 i‡(
key
[
KEY_PLUS_PAD
] || key[
KEY_EQUALS
]) {

228 
key
[
KEY_PLUS_PAD
] || key[
KEY_EQUALS
]) {

232 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
glb_ds1edô
.
wö_¥evõw
.x0;

233 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
glb_ds1edô
.
wö_¥evõw
.y0;

234 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
w
 = 
glb_ds1edô
.
wö_¥evõw
.w;

235 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
h
 = 
glb_ds1edô
.
wö_¥evõw
.h;

236 
	`ch™ge_zoom
(
ds1_idx
, 
glb_ds1
[ds1_idx].
cur_zoom
 - 1);

237 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.x0;

238 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.y0;

241 i‡(
ﬁd_mou£_z
 !
cur_mou£_z
) {

242 
ﬁd_mou£_z
 = 
cur_mou£_z
;

243 i‡(
mou£_b
 & 4) {

244 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

246 
cx
++;

247 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 2);

248 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 2);

249 
cx
--;

250 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
glb_ds1edô
.
wö_¥evõw
.x0 = 
dx
 - glb_ds1edô.wö_¥evõw.
w
 / 2;

251 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
glb_ds1edô
.
wö_¥evõw
.y0 = 
dy
 - glb_ds1edô.wö_¥evõw.
h
 / 2;

252 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
w
 = 
glb_ds1edô
.
wö_¥evõw
.w;

253 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
h
 = 
glb_ds1edô
.
wö_¥evõw
.h;

254 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.x0;

255 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.y0;

256 
	`posôi⁄_mou£
(
glb_ds1edô
.
wö_¥evõw
.
w
 / 2, glb_ds1edô.wö_¥evõw.
h
 / 2);

259 
cx
 /= 5;

260 
cy
 /= 5;

261 
cx
++;

262 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 2);

263 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 2);

264 
cx
--;

265 
cx
 *= 5;

266 
cy
 *= 5;

267 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
glb_ds1edô
.
wö_¥evõw
.x0 = 
dx
 - glb_ds1edô.wö_¥evõw.
w
 / 2;

268 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
glb_ds1edô
.
wö_¥evõw
.y0 = 
dy
 - glb_ds1edô.wö_¥evõw.
h
 / 2;

269 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
w
 = 
glb_ds1edô
.
wö_¥evõw
.w;

270 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
h
 = 
glb_ds1edô
.
wö_¥evõw
.h;

271 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.x0;

272 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.y0;

273 
	`posôi⁄_mou£
(
glb_ds1edô
.
wö_¥evõw
.
w
 / 2, glb_ds1edô.wö_¥evõw.
h
 / 2);

279 i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) {

281 
n
=0;Ç<7;Ç++) {

282 i‡(
key
[
key_func_code
[
n
]]) {

283 
i
=0; i<
FLOOR_MAX_LAYER
; i++) {

284 
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
i
] = 0;

287 i‡(
key
[
KEY_F11
]) {

288 
i
=0; i<
SHADOW_MAX_LAYER
; i++) {

289 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
i
] = 3;

292 
i
=0; i<
SHADOW_MAX_LAYER
; i++) {

293 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
i
] = 0;

297 
i
=0; i<
WALL_MAX_LAYER
; i++) {

298 
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
i
] = 0;

305 i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

307 
n
=0;Ç<7;Ç++) {

308 i‡(
key
[
key_func_code
[
n
]]) {

309 
i
=0; i<
FLOOR_MAX_LAYER
; i++) {

310 
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
i
] = 1;

313 
i
=0; i<
SHADOW_MAX_LAYER
; i++) {

314 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
i
] = 3;

317 
i
=0; i<
WALL_MAX_LAYER
; i++) {

318 
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
i
] = 1;

325 i‡(
key
[
KEY_F1
]) {

326 
key
[
KEY_F1
]) {

329 
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[0] = 1 - glb_ds1[ds1_idx].floor_layer_mask[0];

331 i‡(
key
[
KEY_F2
]) {

332 
key
[
KEY_F2
]) {

335 
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[1] = 1 - glb_ds1[ds1_idx].floor_layer_mask[1];

337 i‡(
key
[
KEY_F5
]) {

338 
key
[
KEY_F5
]) {

341 
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[0] = 1 - glb_ds1[ds1_idx].wall_layer_mask[0];

343 i‡(
key
[
KEY_F6
]) {

344 
key
[
KEY_F6
]) {

347 
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[1] = 1 - glb_ds1[ds1_idx].wall_layer_mask[1];

349 i‡(
key
[
KEY_F7
]) {

350 
key
[
KEY_F7
]) {

353 
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[2] = 1 - glb_ds1[ds1_idx].wall_layer_mask[2];

355 i‡(
key
[
KEY_F8
]) {

356 
key
[
KEY_F8
]) {

359 
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[3] = 1 - glb_ds1[ds1_idx].wall_layer_mask[3];

363 i‡(
key
[
KEY_F9
]) {

364 
key
[
KEY_F9
]) {

367 
glb_ds1
[
ds1_idx
].
•ecül_œyî_mask
 = 1 - glb_ds1[ds1_idx].special_layer_mask;

371 i‡(
key
[
KEY_F3
]) {

372 
key
[
KEY_F3
]) {

375 
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
++;

376 i‡(
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
 == 3) {

377 
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
 = 0;

382 i‡(
key
[
KEY_F4
] && (
glb_ds1edô
.
mode
 !
MOD_O
)) {

383 
key
[
KEY_F4
]) {

386 
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
++;

387 i‡(
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
 >
OL_MAX
) {

388 
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
 = 
OL_NONE
;

393 i‡(
key
[
KEY_F10
] && (
glb_ds1edô
.
mode
 !
MOD_P
)) {

394 
key
[
KEY_F10
]) {

397 
glb_ds1
[
ds1_idx
].
∑ths_œyî_mask
 = 1 - glb_ds1[ds1_idx].paths_layer_mask;

401 i‡(
key
[
KEY_F11
]) {

402 
key
[
KEY_F11
]) {

405 i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) {

406 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0]--;

407 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0] < 0) {

408 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0] = 3;

411 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0]++;

412 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0] >= 4) {

413 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0] = 0;

419 i‡(
key
[
KEY_SPACE
]) {

420 
key
[
KEY_SPACE
]) {

423 
glb_ds1
[
ds1_idx
].
wÆkabÀ_œyî_mask
++;

424 i‡(
glb_ds1
[
ds1_idx
].
wÆkabÀ_œyî_mask
 >= 3) {

425 
glb_ds1
[
ds1_idx
].
wÆkabÀ_œyî_mask
 = 0;

429 i‡(
key
[
KEY_T
]) {

430 
key
[
KEY_T
]) {

433 
glb_ds1
[
ds1_idx
].
subtûe_hñp_di•œy
 = 1 - glb_ds1[ds1_idx].subtile_help_display;

437 i‡(
key
[
KEY_F12
]) {

438 i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) {

439 i‡(
glb_ds1edô
.
cur_gamma
 > 
GC_060
) {

440 
	`ª°
(80);

441 
glb_ds1edô
.
cur_gamma
--;

442 
	`misc_upd©e_∑l_wôh_gamma
();

443 
	`£t_∑Àâe
(
glb_ds1edô
.
vga_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1]);

446 i‡(
glb_ds1edô
.
cur_gamma
 < 
GC_300
) {

447 
	`ª°
(80);

448 
glb_ds1edô
.
cur_gamma
++;

449 
	`misc_upd©e_∑l_wôh_gamma
();

450 
	`£t_∑Àâe
(
glb_ds1edô
.
vga_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1]);

456 i‡(
key
[
KEY_HOME
]) {

457 
key
[
KEY_HOME
]) {

460 
cx
 = 
glb_ds1
[
ds1_idx
].
width
/2 + 1;

461 
cy
 = 
glb_ds1
[
ds1_idx
].
height
/2;

462 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 2);

463 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 2);

464 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
glb_ds1edô
.
wö_¥evõw
.x0 = 
dx
 - glb_ds1edô.wö_¥evõw.
w
 / 2;

465 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
glb_ds1edô
.
wö_¥evõw
.y0 = 
dy
 - glb_ds1edô.wö_¥evõw.
h
 / 2;

469 i‡(
key
[
KEY_BACKSPACE
]) {

470 
key
[
KEY_BACKSPACE
]) {

473 
i
=0; i<
FLOOR_MAX_LAYER
; i++) {

474 
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
i
] = 1;

476 
i
=0; i<
WALL_MAX_LAYER
; i++) {

477 
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
i
] = 1;

479 
i
=0; i<
SHADOW_MAX_LAYER
; i++) {

480 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
i
] = 3;

485 i‡(
key
[
KEY_P
]) {

486 i‡((
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
])) {

488 
ﬁd_s¸ìn_buff
 = 
glb_ds1edô
.
s¸ìn_buff
;

489 i‡(
	`w¥evõw_døw_tûes_big_s¸ìnshŸ
(
ds1_idx
) == 0) {

491 
	`•rötf
(
tmp
, "s¸ìnshŸ-%05i.bmp", 
glb_ds1edô
.
s¸ìnshŸ_num
);

492 
	`fûe_exi°s
(
tmp
, -1, 
NULL
)) {

493 
glb_ds1edô
.
s¸ìnshŸ_num
++;

494 
	`•rötf
(
tmp
, "s¸ìnshŸ-%05i.bmp", 
glb_ds1edô
.
s¸ìnshŸ_num
);

498 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1) {

500 
	`ßve_bmp
(
tmp
, 
glb_ds1edô
.
s¸ìn_buff
, glb_ds1edô.
vga_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1]);

503 
	`ßve_bmp
(
tmp
, 
glb_ds1edô
.
s¸ìn_buff
, glb_ds1edô.
vga_∑l
[glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1]);

507 
	`de°roy_bôm≠
(
glb_ds1edô
.
s¸ìn_buff
);

510 (
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
])) {

513 
glb_ds1edô
.
s¸ìn_buff
 = 
ﬁd_s¸ìn_buff
;

516 
	`•rötf
(
tmp
, "s¸ìnshŸ-%05i.pcx", 
glb_ds1edô
.
s¸ìnshŸ_num
);

517 
	`fûe_exi°s
(
tmp
, -1, 
NULL
)) {

518 
glb_ds1edô
.
s¸ìnshŸ_num
++;

519 
	`•rötf
(
tmp
, "s¸ìnshŸ-%05i.pcx", 
glb_ds1edô
.
s¸ìnshŸ_num
);

523 
	`døw_•rôe
–
glb_ds1edô
.
s¸ìn_buff
, glb_ds1edô.
mou£_curs‹
[glb_ds1edô.
mode
], 
ﬁd_mou£_x
 - 1, 
ﬁd_mou£_y
 - 1 );

526 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1) {

528 
	`ßve_pcx
(
tmp
, 
glb_ds1edô
.
s¸ìn_buff
, glb_ds1edô.
vga_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1]);

529 
	`misc_pcx_put_d2_∑Àâe
(
tmp
, 
glb_ds1
[
ds1_idx
].
a˘
 - 1);

532 
	`ßve_pcx
(
tmp
, 
glb_ds1edô
.
s¸ìn_buff
, glb_ds1edô.
vga_∑l
[glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1]);

533 
	`misc_pcx_put_d2_∑Àâe
(
tmp
, 
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 - 1);

537 
key
[
KEY_P
]) {

542 
glb_ds1edô
.
s¸ìnshŸ_num
++;

546 i‡(
key
[
KEY_S
]) {

547 i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

549 
	`ds1_ßve
(
ds1_idx
, 
FALSE
);

550 
key
[
KEY_S
]) {

553 
ªt
 = 
	`msg_ßve_maö
();

554 
ªt
) {

557 
d⁄e
 = 
TRUE
;

564 } i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

566 
key
[
KEY_S
]) {

569 
	`edôtûe_unhide_Æl
(
ds1_idx
);

574 i‡(
key
[
KEY_C
]) {

575 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

577 i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

579 i‡(
∑°e_pos
.
°¨t
 =
FALSE
) {

580 
i
=0; i<
DS1_MAX
; i++) {

581 i‡(
	`°æí
(
glb_ds1
[
i
].
«me
)) {

582 
	`edôtûe_∑°e_¥ï¨e
(
i
);

585 
∑°e_pos
.
§c_ds1_idx
 = 
ds1_idx
;

586 
∑°e_pos
.
ﬁd_ds1_idx
 = 
ds1_idx
;

587 
∑°e_pos
.
°¨t
 = 
TRUE
;

588 
∑°e_pos
.
is_cut
 = 
FALSE
;

589 
∑°e_pos
.
cut_ßved
 = 
FALSE
;

590 
∑°e_pos
.
ﬁd_x
 = 
cx
;

591 
∑°e_pos
.
ﬁd_y
 = 
cy
;

592 
	`edôtûe_middÀ_£À˘
–
ds1_idx
, & 
∑°e_pos
.
°¨t_x
, &Öa°e_pos.
°¨t_y
);

593 
	`edôtûe_∑°e_¥evõw
(
ds1_idx
, 
cx
 - 
∑°e_pos
.
°¨t_x
, 
cy
 -Öa°e_pos.
°¨t_y
, &Öaste_pos);

595 
key
[
KEY_C
]) {

601 
key
[
KEY_C
]) {

604 
cx
++;

605 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 2);

606 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 2);

607 
cx
--;

608 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
glb_ds1edô
.
wö_¥evõw
.x0 = 
dx
 - glb_ds1edô.wö_¥evõw.
w
 / 2;

609 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
glb_ds1edô
.
wö_¥evõw
.y0 = 
dy
 - glb_ds1edô.wö_¥evõw.
h
 / 2;

610 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
w
 = 
glb_ds1edô
.
wö_¥evõw
.w;

611 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
h
 = 
glb_ds1edô
.
wö_¥evõw
.h;

612 i‡(
glb_c⁄fig
.
˚¡î_zoom
 != -1) {

613 
	`ch™ge_zoom
(
ds1_idx
, 
glb_c⁄fig
.
˚¡î_zoom
);

615 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.x0;

616 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.y0;

617 
	`posôi⁄_mou£
(
glb_ds1edô
.
wö_¥evõw
.
w
 / 2, glb_ds1edô.wö_¥evõw.
h
 / 2);

620 i‡–! 
key
[
KEY_LCONTROL
] && ! key[
KEY_RCONTROL
]) {

622 
key
[
KEY_C
]) {

625 
cx
 /= 5;

626 
cy
 /= 5;

627 
cx
++;

628 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 2);

629 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 2);

630 
cx
--;

631 
cx
 *= 5;

632 
cy
 *= 5;

633 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
glb_ds1edô
.
wö_¥evõw
.x0 = 
dx
 - glb_ds1edô.wö_¥evõw.
w
 / 2;

634 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
glb_ds1edô
.
wö_¥evõw
.y0 = 
dy
 - glb_ds1edô.wö_¥evõw.
h
 / 2;

635 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
w
 = 
glb_ds1edô
.
wö_¥evõw
.w;

636 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
h
 = 
glb_ds1edô
.
wö_¥evõw
.h;

637 i‡(
glb_c⁄fig
.
˚¡î_zoom
 != -1) {

638 
	`ch™ge_zoom
(
ds1_idx
, 
glb_c⁄fig
.
˚¡î_zoom
);

640 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.x0;

641 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.y0;

642 
	`posôi⁄_mou£
(
glb_ds1edô
.
wö_¥evõw
.
w
 / 2, glb_ds1edô.wö_¥evõw.
h
 / 2);

648 i‡(
key
[
KEY_X
] && (key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
])) {

649 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

651 i‡(
∑°e_pos
.
°¨t
 =
FALSE
) {

652 
i
=0; i<
DS1_MAX
; i++) {

653 i‡(
	`°æí
(
glb_ds1
[
i
].
«me
)) {

654 
	`edôtûe_∑°e_¥ï¨e
(
i
);

657 
∑°e_pos
.
§c_ds1_idx
 = 
ds1_idx
;

658 
∑°e_pos
.
ﬁd_ds1_idx
 = 
ds1_idx
;

659 
∑°e_pos
.
°¨t
 = 
TRUE
;

660 
∑°e_pos
.
is_cut
 = 
TRUE
;

661 
∑°e_pos
.
cut_ßved
 = 
FALSE
;

662 
∑°e_pos
.
ﬁd_x
 = 
cx
;

663 
∑°e_pos
.
ﬁd_y
 = 
cy
;

664 
	`edôtûe_middÀ_£À˘
–
ds1_idx
, & 
∑°e_pos
.
°¨t_x
, &Öa°e_pos.
°¨t_y
);

665 
	`edôtûe_∑°e_¥evõw
(
ds1_idx
, 
cx
 - 
∑°e_pos
.
°¨t_x
, 
cy
 -Öa°e_pos.
°¨t_y
, &Öaste_pos);

666 
key
[
KEY_X
]) {

674 i‡(
key
[
KEY_DEL
] || key[
KEY_DEL_PAD
]) {

675 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

676 i‡(
∑°e_pos
.
°¨t
 =
FALSE
) {

677 
	`edôtûe_dñëe_£À˘ed_tûes
(
ds1_idx
);

678 
key
[
KEY_DEL
] || key[
KEY_DEL_PAD
]) {

686 i‡(
key
[
KEY_U
] && (key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
])) {

687 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

688 i‡(
∑°e_pos
.
°¨t
 =
FALSE
) {

689 
	`undo_≠∂y_tûe_buf„r
(
ds1_idx
);

690 
key
[
KEY_U
]) {

698 i‡(
key
[
KEY_G
]) {

700 i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) {

701 
glb_ds1edô
.
di•œy_tûe_grid
 --;

703 
glb_ds1edô
.
di•œy_tûe_grid
 ++;

706 i‡(
glb_ds1edô
.
di•œy_tûe_grid
 < 
TG_OFF
) {

707 
glb_ds1edô
.
di•œy_tûe_grid
 = 
TG_MAX
 - 1;

709 i‡(
glb_ds1edô
.
di•œy_tûe_grid
 >
TG_MAX
) {

710 
glb_ds1edô
.
di•œy_tûe_grid
 = 
TG_OFF
;

712 
key
[
KEY_G
]) {

718 
group_ch™ged
 = 
FALSE
;

719 
ﬁd_group
 = 
glb_ds1edô
.
ds1_group_idx
;

720 i‡(
ˇn_swich_mode
)

722 i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
])

724 i‡(
key
[
KEY_1
])

726 
key
[
KEY_1
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
])

730 
glb_ds1edô
.
ds1_group_idx
 = 0;

731 
group_ch™ged
 = 
TRUE
;

732 } i‡(
key
[
KEY_2
]) {

733 
key
[
KEY_2
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

736 
glb_ds1edô
.
ds1_group_idx
 = 1;

737 
group_ch™ged
 = 
TRUE
;

738 } i‡(
key
[
KEY_3
]) {

739 
key
[
KEY_3
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

742 
glb_ds1edô
.
ds1_group_idx
 = 2;

743 
group_ch™ged
 = 
TRUE
;

744 } i‡(
key
[
KEY_4
]) {

745 
key
[
KEY_4
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

748 
glb_ds1edô
.
ds1_group_idx
 = 3;

749 
group_ch™ged
 = 
TRUE
;

750 } i‡(
key
[
KEY_5
]) {

751 
key
[
KEY_5
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
])

755 
glb_ds1edô
.
ds1_group_idx
 = 4;

756 
group_ch™ged
 = 
TRUE
;

757 } i‡(
key
[
KEY_6
]) {

758 
key
[
KEY_6
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

761 
glb_ds1edô
.
ds1_group_idx
 = 5;

762 
group_ch™ged
 = 
TRUE
;

763 } i‡(
key
[
KEY_7
]) {

764 
key
[
KEY_7
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

767 
glb_ds1edô
.
ds1_group_idx
 = 6;

768 
group_ch™ged
 = 
TRUE
;

769 } i‡(
key
[
KEY_8
]) {

770 
key
[
KEY_8
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

773 
glb_ds1edô
.
ds1_group_idx
 = 7;

774 
group_ch™ged
 = 
TRUE
;

775 } i‡(
key
[
KEY_9
]) {

776 
key
[
KEY_9
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

779 
glb_ds1edô
.
ds1_group_idx
 = 8;

780 
group_ch™ged
 = 
TRUE
;

781 } i‡(
key
[
KEY_0
]) {

782 
key
[
KEY_0
] || key[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

785 
glb_ds1edô
.
ds1_group_idx
 = 9;

786 
group_ch™ged
 = 
TRUE
;

790 i‡(
group_ch™ged
 =
TRUE
) {

792 
found
 = 
FALSE
;

793 
i
=0; i < 10; i++) {

794 i‡(
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 
i
].
«me
)) {

796 
ﬁd_ds1_idx
 = 
ds1_idx
;

797 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 
i
;

798 
found
 = 
TRUE
;

802 i‡(
found
 =
FALSE
) {

804 
glb_ds1edô
.
ds1_group_idx
 = 
ﬁd_group
;

805 
group_ch™ged
 = 
FALSE
;

810 i‡(
key
[
KEY_1
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10].
«me
)) {

811 
ﬁd_ds1_idx
 = 
ds1_idx
;

812 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10;

813 
key
[
KEY_1
]) {

817 i‡(
key
[
KEY_2
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 1].
«me
)) {

818 
ﬁd_ds1_idx
 = 
ds1_idx
;

819 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 1;

820 
key
[
KEY_2
]) {

824 i‡(
key
[
KEY_3
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 2].
«me
)) {

825 
ﬁd_ds1_idx
 = 
ds1_idx
;

826 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 2;

827 
key
[
KEY_3
]) {

831 i‡(
key
[
KEY_4
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 3].
«me
)) {

832 
ﬁd_ds1_idx
 = 
ds1_idx
;

833 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 3;

834 
key
[
KEY_4
]) {

838 i‡(
key
[
KEY_5
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 4].
«me
)) {

839 
ﬁd_ds1_idx
 = 
ds1_idx
;

840 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 4;

841 
key
[
KEY_5
]) {

845 i‡(
key
[
KEY_6
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 5].
«me
)) {

846 
ﬁd_ds1_idx
 = 
ds1_idx
;

847 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 5;

848 
key
[
KEY_6
]) {

852 i‡(
key
[
KEY_7
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 6].
«me
)) {

853 
ﬁd_ds1_idx
 = 
ds1_idx
;

854 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 6;

855 
key
[
KEY_7
]) {

859 i‡(
key
[
KEY_8
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 7].
«me
)) {

860 
ﬁd_ds1_idx
 = 
ds1_idx
;

861 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 7;

862 
key
[
KEY_8
]) {

866 i‡(
key
[
KEY_9
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 8].
«me
)) {

867 
ﬁd_ds1_idx
 = 
ds1_idx
;

868 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 8;

869 
key
[
KEY_9
]) {

873 i‡(
key
[
KEY_0
] && 
	`°æí
(
glb_ds1
[
glb_ds1edô
.
ds1_group_idx
 * 10 + 9].
«me
)) {

874 
ﬁd_ds1_idx
 = 
ds1_idx
;

875 
ds1_idx
 = 
glb_ds1edô
.
ds1_group_idx
 * 10 + 9;

876 
key
[
KEY_0
]) {

882 i‡(
ﬁd_ds1_idx
 !
ds1_idx
) {

884 
glb_ds1
[
ﬁd_ds1_idx
].
own_w¥evõw
.
x0
 = 
glb_ds1edô
.
wö_¥evõw
.x0;

885 
glb_ds1
[
ﬁd_ds1_idx
].
own_w¥evõw
.
y0
 = 
glb_ds1edô
.
wö_¥evõw
.y0;

886 
glb_ds1
[
ﬁd_ds1_idx
].
own_w¥evõw
.
w
 = 
glb_ds1edô
.
wö_¥evõw
.w;

887 
glb_ds1
[
ﬁd_ds1_idx
].
own_w¥evõw
.
h
 = 
glb_ds1edô
.
wö_¥evõw
.h;

890 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.x0;

891 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.y0;

892 
glb_ds1edô
.
wö_¥evõw
.
w
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.w;

893 
glb_ds1edô
.
wö_¥evõw
.
h
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.h;

896 
ﬁd_ds1_idx
 = 
ds1_idx
;

900 i‡(
key
[
KEY_TILDE
]) {

901 
key
[
KEY_TILDE
]) {

904 i‡(
glb_ds1edô
.
show_2nd_row
 =
FALSE
) {

905 
glb_ds1edô
.
show_2nd_row
 = 
TRUE
;

907 
glb_ds1edô
.
show_2nd_row
 = 
FALSE
;

912 i‡(
key
[
KEY_TAB
]) {

913 
key
[
KEY_TAB
]) {

916 i‡(
glb_ds1edô
.
mode
 =
MOD_L
) {

917 
glb_ds1edô
.
mode
 = 
ﬁd_mode
;

919 i‡(
ˇn_swich_mode
) {

920 i‡((
key
[
KEY_LSHIFT
]Ë|| (key[
KEY_RSHIFT
])) {

921 
glb_ds1edô
.
mode
--;

923 
glb_ds1edô
.
mode
++;

927 i‡(
glb_ds1edô
.
mode
 < 
MOD_T
) {

928 
glb_ds1edô
.
mode
 = 
MOD_P
;

930 i‡((
glb_ds1edô
.
mode
 >
MOD_MAX
Ë|| (glb_ds1edô.modê=
MOD_L
)) {

931 
glb_ds1edô
.
mode
 = 
MOD_T
;

936 
ﬁd_˚Œ_x
 = -1;

937 
ﬁd_˚Œ_y
 = -1;

941 i‡(
key
[
KEY_N
]) {

942 
key
[
KEY_N
]) {

945 i‡(
glb_ds1edô
.
mode
 =
MOD_L
) {

946 
glb_ds1edô
.
night_mode
++;

947 i‡(
glb_ds1edô
.
night_mode
 >= 2) {

948 
glb_ds1edô
.
night_mode
 = 0;

949 
glb_ds1edô
.
mode
 = 
ﬁd_mode
;

952 
ﬁd_mode
 = 
glb_ds1edô
.
mode
;

953 
glb_ds1edô
.
mode
 = 
MOD_L
;

956 
ﬁd_˚Œ_x
 = -1;

957 
ﬁd_˚Œ_y
 = -1;

961 i‡(
key
[
KEY_R
]) {

962 
key
[
KEY_R
]) {

967 
	`™imd©a_lﬂd
();

970 
	`™im_exô
();

973 
glb_ds1edô
.
obj_buff
 = 
	`txt_de°roy
(glb_ds1edit.obj_buff);

974 
glb_ds1edô
.
obje˘s_buff
 = 
	`txt_de°roy
(glb_ds1edô.
obj_buff
);

977 
	`ªad_obje˘s_txt
();

978 
	`ªad_obj_txt
();

981 
	`™im_upd©e_gfx
(
FALSE
);

984 
glb_ds1edô
.
ticks_ñ≠£d
 = 0;

988 i‡(
ﬁd_mou£_b
 & 1) {

990 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

991 i‡(
∑°e_pos
.
°¨t
 =
TRUE
) {

993 
	`edôtûe_∑°e_föÆ
(
ds1_idx
);

994 
∑°e_pos
.
°¨t
 = 
FALSE
;

995 
mou£_b
 & 1) {

999 } i‡(
tmp_£l
.
°¨t
 =
FALSE
) {

1000 i‡–(
key
[
KEY_I
]Ë&& (
cx
 !
ﬁd_idítiˇl_x
Ë&& (
cy
 !
ﬁd_idítiˇl_y
)) {

1003 i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) {

1005 
ôy≥
 = 
IT_ADD
;

1006 } i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

1008 
ôy≥
 = 
IT_DEL
;

1011 
ôy≥
 = 
IT_NEW
;

1013 
	`edôtûe_idítiˇl
(
ds1_idx
, 
ôy≥
, 
cx
, 
cy
);

1014 
ﬁd_idítiˇl_x
 = 
cx
;

1015 
ﬁd_idítiˇl_y
 = 
cy
;

1016 } i‡–! 
key
[
KEY_I
]) {

1018 
ﬁd_idítiˇl_x
 = -1;

1019 
ﬁd_idítiˇl_y
 = -1;

1021 
tmp_£l
.
°¨t
 = 
TRUE
;

1022 
tmp_£l
.
x1
 =Åmp_£l.
x2
 =Åmp_£l.
ﬁd_x2
 = 
cx
;

1023 
tmp_£l
.
y1
 =Åmp_£l.
y2
 =Åmp_£l.
ﬁd_y2
 = 
cy
;

1024 
	`edôtûe_dñëe_Æl_tmp£l
(
ds1_idx
);

1025 
	`edôtûe_£t_tmp£l
(
ds1_idx
, & 
tmp_£l
);

1028 i‡((
tmp_£l
.
ﬁd_x2
 !
cx
Ë|| (tmp_£l.
ﬁd_y2
 !
cy
)) {

1030 
tmp_£l
.
x2
 =Åmp_£l.
ﬁd_x2
 = 
cx
;

1031 
tmp_£l
.
y2
 =Åmp_£l.
ﬁd_y2
 = 
cy
;

1032 
	`edôtûe_dñëe_Æl_tmp£l
(
ds1_idx
);

1033 
	`edôtûe_£t_tmp£l
(
ds1_idx
, & 
tmp_£l
);

1039 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

1040 i‡(
tmp_£l
.
°¨t
 =
TRUE
) {

1042 i‡(
key
[
KEY_H
]) {

1043 
tmp_£l
.
ty≥
 = 
TMP_HIDE
;

1044 } i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) {

1045 
tmp_£l
.
ty≥
 = 
TMP_ADD
;

1046 } i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

1047 
tmp_£l
.
ty≥
 = 
TMP_DEL
;

1049 
tmp_£l
.
ty≥
 = 
TMP_NEW
;

1051 
tmp_£l
.
ty≥
) {

1052 
TMP_NEW
 :

1053 
	`edôtûe_dñëe_Æl_tmp£l
(
ds1_idx
);

1054 
	`edôtûe_ch™ge_to_√w_≥rm™ít_£l
(
ds1_idx
, & 
tmp_£l
);

1055 
tmp_£l
.
°¨t
 = 
FALSE
;

1056 
tmp_£l
.
ty≥
 = 
TMP_NULL
;

1057 
tmp_£l
.
x1
 =Åmp_£l.
x2
 =Åmp_£l.
y1
 =Åmp_£l.
y2
 = 0;

1058 
tmp_£l
.
ﬁd_x2
 =Åmp_£l.
ﬁd_y2
 = 0;

1061 
TMP_ADD
 :

1062 
	`edôtûe_dñëe_Æl_tmp£l
(
ds1_idx
);

1063 
	`edôtûe_ch™ge_to_add_≥rm™ít_£l
(
ds1_idx
, & 
tmp_£l
);

1064 
tmp_£l
.
°¨t
 = 
FALSE
;

1065 
tmp_£l
.
ty≥
 = 
TMP_NULL
;

1066 
tmp_£l
.
x1
 =Åmp_£l.
x2
 =Åmp_£l.
y1
 =Åmp_£l.
y2
 = 0;

1067 
tmp_£l
.
ﬁd_x2
 =Åmp_£l.
ﬁd_y2
 = 0;

1070 
TMP_HIDE
 :

1071 
	`edôtûe_dñëe_Æl_tmp£l
(
ds1_idx
);

1072 
	`edôtûe_ch™ge_to_hide_£l
(
ds1_idx
, & 
tmp_£l
);

1073 
tmp_£l
.
°¨t
 = 
FALSE
;

1074 
tmp_£l
.
ty≥
 = 
TMP_NULL
;

1075 
tmp_£l
.
x1
 =Åmp_£l.
x2
 =Åmp_£l.
y1
 =Åmp_£l.
y2
 = 0;

1076 
tmp_£l
.
ﬁd_x2
 =Åmp_£l.
ﬁd_y2
 = 0;

1079 
TMP_DEL
 :

1080 
	`edôtûe_dñëe_Æl_tmp£l
(
ds1_idx
);

1081 
	`edôtûe_ch™ge_to_dñ_£l
(
ds1_idx
, & 
tmp_£l
);

1082 
tmp_£l
.
°¨t
 = 
FALSE
;

1083 
tmp_£l
.
ty≥
 = 
TMP_NULL
;

1084 
tmp_£l
.
x1
 =Åmp_£l.
x2
 =Åmp_£l.
y1
 =Åmp_£l.
y2
 = 0;

1085 
tmp_£l
.
ﬁd_x2
 =Åmp_£l.
ﬁd_y2
 = 0;

1088 } i‡(
∑°e_pos
.
°¨t
 =
TRUE
) {

1089 i‡((
∑°e_pos
.
ﬁd_x
 !
cx
Ë|| (∑°e_pos.
ﬁd_y
 !
cy
Ë|| (∑°e_pos.
ﬁd_ds1_idx
 !
ds1_idx
)) {

1090 
	`edôtûe_∑°e_undo
(
∑°e_pos
.
ﬁd_ds1_idx
);

1091 
	`edôtûe_∑°e_¥evõw
(
ds1_idx
, 
cx
 - 
∑°e_pos
.
°¨t_x
, 
cy
 -Öa°e_pos.
°¨t_y
, &Öaste_pos);

1092 
∑°e_pos
.
ﬁd_x
 = 
cx
;

1093 
∑°e_pos
.
ﬁd_y
 = 
cy
;

1094 
∑°e_pos
.
ﬁd_ds1_idx
 = 
ds1_idx
;

1106 
_WEDIT_TEST
;

1107 i‡(
ﬁd_mou£_b
 & 2) {

1108 i‡(
glb_ds1edô
.
mode
 =
MOD_T
) {

1109 
mou£_b
 & 2) {

1113 i‡–(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]Ë&& (key[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) ) {

1115 
	`wbôs_maö
(
ds1_idx
, 
cx
, 
cy
);

1116 
	`posôi⁄_mou£
(
ﬁd_mou£_x
, 
ﬁd_mou£_y
);

1118 
_WEDIT_TEST
:

1119 
	`wedô_ã°
(
ds1_idx
, 
cx
, 
cy
);

1120 
	`£t_cﬁ‹_dïth
(8);

1121 
	`posôi⁄_mou£
(
ﬁd_mou£_x
, 
ﬁd_mou£_y
);

1127 i‡(
key
[
KEY_ESC
] && (
glb_ds1
[
ds1_idx
].
døw_edô_obj
 =
FALSE
)) {

1128 
key
[
KEY_ESC
]) {

1131 
ªt
 = 
	`msg_quô_maö
();

1132 
ªt
) {

1135 
	`ds1_ßve
(
ds1_idx
, 
TRUE
);

1136 
d⁄e
 = 
TRUE
;

1141 
i
=0; i < 
DS1_MAX
; i++) {

1142 i‡(
	`°æí
(
glb_ds1
[
ds1_idx
].
«me
)) {

1143 
	`ds1_ßve
(
i
, 
FALSE
);

1146 
d⁄e
 = 
TRUE
;

1151 
	`ds1_ßve
(
ds1_idx
, 
TRUE
);

1152 
d⁄e
 = 
TRUE
;

1162 
	}
}

	@interfac.h

1 #i‚de‡
_INTERFAC_H_


3 
	#_INTERFAC_H_


	)

5 
öãrÁc_u£r_h™dÀr
 (
°¨t_ds1_idx
);

	@main.c

1 
	~"°ru˘s.h
"

2 
	~"îr‹.h
"

3 
	~"mpqvõw.h
"

4 
	~"dt1misc.h
"

5 
	~"ds1misc.h
"

6 
	~"™im.h
"

7 
	~"wedô.h
"

8 
	~"undo.h
"

9 
	~"txåód.h
"

10 
	~"misc.h
"

11 
	~"öi¸ót.h
"

12 
	~"öúód.h
"

13 
	~"™imd©a.h
"

14 
	~"öãrÁc.h
"

22 
WRKSPC_DATAS_S
 
	gglb_wrk•c_d©as
[
WRKSPC_MAX
] = {

31 
GAMMA_S
 
	gglb_gamma_°r
[
GC_MAX
] = {

32 {"0.60", 
GC_060
}, {"0.62", 
GC_062
}, {"0.64", 
GC_064
},

33 {"0.66", 
GC_066
}, {"0.68", 
GC_068
}, {"0.70", 
GC_070
},

34 {"0.72", 
GC_072
}, {"0.74", 
GC_074
}, {"0.76", 
GC_076
},

35 {"0.78", 
GC_078
}, {"0.80", 
GC_080
}, {"0.82", 
GC_082
},

36 {"0.84", 
GC_084
}, {"0.86", 
GC_086
}, {"0.88", 
GC_088
},

37 {"0.90", 
GC_090
}, {"0.92", 
GC_092
}, {"0.94", 
GC_094
},

38 {"0.96", 
GC_096
}, {"0.98", 
GC_098
}, {"1.00", 
GC_100
},

39 {"1.10", 
GC_110
}, {"1.20", 
GC_120
}, {"1.30", 
GC_130
},

40 {"1.40", 
GC_140
}, {"1.50", 
GC_150
}, {"1.60", 
GC_160
},

41 {"1.70", 
GC_170
}, {"1.80", 
GC_180
}, {"1.90", 
GC_190
},

42 {"2.00", 
GC_200
}, {"2.10", 
GC_210
}, {"2.20", 
GC_220
},

43 {"2.30", 
GC_230
}, {"2.40", 
GC_240
}, {"2.50", 
GC_250
},

44 {"2.60", 
GC_260
}, {"2.70", 
GC_270
}, {"2.80", 
GC_280
},

45 {"2.90", 
GC_290
}, {"3.00", 
GC_300
}

48 * 
	gtxt_def_lv…y≥_ªq
[] = {

57 
NULL


60 * 
	gtxt_def_lvÕª°_ªq
[] = {

63 
NULL


66 * 
	gtxt_def_obj_ªq
[] = {

86 
NULL


89 * 
	gtxt_def_obje˘s_ªq
[] = {

188 
NULL


191 ** 
	gglb_txt_ªq_±r
[
RQ_MAX
] = {
NULL
, NULL, NULL, NULL};

193 
CONFIG_S
 
	gglb_c⁄fig
;

194 
GLB_DS1EDIT_S
 
	gglb_ds1edô
;

195 
GLB_MPQ_S
 
	gglb_mpq_°ru˘
 [
MAX_MPQ_FILE
];

196 
DS1_S
 * 
	gglb_ds1
 = 
NULL
;

197 
DT1_S
 * 
	gglb_dt1
 = 
NULL
;

198 
	gglb_tûes_∑th
 [] = "data/global/tiles/";

199 
	gglb_ds1edô_d©a_dú
 [] = "./res/data";

200 
	gglb_ds1edô_tmp_dú
 [] = "tmp";

203 * 
	gglb_∑th_lv…y≥s_mem
 = "debug/editor.lvltypes.memory.bin";

204 * 
	gglb_∑th_lv…y≥s_def
 = "debug/d2.lvltypes.headers.txt";

205 * 
	gglb_∑th_lvÕª°_mem
 = "debug/editor.lvlprest.memory.bin";

206 * 
	gglb_∑th_lvÕª°_def
 = "debug/d2.lvlprest.headers.txt";

207 * 
	gglb_∑th_obj_mem
 = "debug/editor.obj.memory.bin";

208 * 
	gglb_∑th_obj_def
 = "debug/editor.obj.headers.txt";

209 * 
	gglb_∑th_obje˘s_mem
 = "debug/editor.objects.memory.bin";

210 * 
	gglb_∑th_obje˘s_def
 = "debug/d2.objects.headers.txt";

215 
	$ds1edô_öô
()

217 
FILE
 *
out
;

218 
i
;

219 
o
;

220 
tmp
[80];

223 
«me
[40];

224 
MODE_E
 
idx
;

225 }
curs‹
[
MOD_MAX
] = {

226 {"ªs/pcx/curs‹_t.pcx", 
MOD_T
},

227 {"ªs/pcx/curs‹_o.pcx", 
MOD_O
},

228 {"ªs/pcx/curs‹_p.pcx", 
MOD_P
},

229 {"ªs/pcx/curs‹_l.pcx", 
MOD_L
}

232 
dú4
[4] = { 0, 1, 2, 3};

233 
dú8
[8] = { 4, 0, 5, 1, 6, 2, 7, 3 };

234 
dú16
[16] = { 4, 8, 0, 9, 5, 10, 1, 11,

236 
dú32
[32] = { 4, 16, 8, 17, 0, 18, 9, 19,

240 
obj_sub_tûe
[5][5] = {

247 
	`DEBUG_MESSAGE
("ds1edit_init()\n");

249 
	`mem£t
–& 
glb_c⁄fig
, 0, (glb_config) );

250 
	`mem£t
–& 
glb_ds1edô
, 0, (glb_ds1edit) );

253 
i
 = (
DS1_S
Ë* 
DS1_MAX
;

254 
	`DEBUG_MESSAGE
("Æloˇã %òbyã†f‹ glb_ds1[%i]\n", 
i
, 
DS1_MAX
);

255 
glb_ds1
 = (
DS1_S
 *Ë
	`mÆloc
(
i
);

256 if(!
glb_ds1
){

257 
	`FATAL_EXIT
("couldÇŸáŒoˇã %òbyã†f‹Åhêglb_ds1[%i]ÅabÀ.\n", 
i
, 
DS1_MAX
 );

259 
	`mem£t
(
glb_ds1
, 0, 
i
);

261 
i
 = (
DT1_S
Ë* 
DT1_MAX
;

262 
	`DEBUG_MESSAGE
("Æloˇã %òbyã†f‹ glb_dt1[%i]\n", 
i
, 
DT1_MAX
);

263 
glb_dt1
 = (
DT1_S
 *Ë
	`mÆloc
(
i
);

264 if(!
glb_dt1
){

265 
	`FATAL_EXIT
("couldÇŸáŒoˇã %òbyã†f‹Åhêglb_dt1[%i]ÅabÀ.\n", 
i
, 
DT1_MAX
 );

267 
	`mem£t
(
glb_dt1
, 0, 
i
);

269 
i
=0; i<
MAX_MPQ_FILE
; i++) {

270 
	`mem£t
–& 
glb_mpq_°ru˘
[
i
], 0, (
GLB_MPQ_S
));

271 
glb_mpq_°ru˘
[
i
].
is_›í
 = 
FALSE
;

275 
i
=0; i<
MOD_MAX
; i++) {

276 
glb_ds1edô
.
mou£_curs‹
[
i
] = 
	`lﬂd_pcx
(
curs‹
[i].
«me
, glb_ds1edô.
dummy_∑l
);

277 if(
glb_ds1edô
.
mou£_curs‹
[
i
] =
NULL
){

278 
	`FATAL_EXIT
("couldÇŸ o≥¿thêfûê\"%s\".\n", 
curs‹
[
i
].
«me
);

297 
glb_txt_ªq_±r
[
RQ_LVLTYPE
] = 
txt_def_lv…y≥_ªq
;

298 
glb_txt_ªq_±r
[
RQ_LVLPREST
] = 
txt_def_lvÕª°_ªq
;

299 
glb_txt_ªq_±r
[
RQ_OBJ
] = 
txt_def_obj_ªq
;

300 
glb_txt_ªq_±r
[
RQ_OBJECTS
] = 
txt_def_obje˘s_ªq
;

303 
	`ªmove
(
glb_∑th_lv…y≥s_mem
);

304 
	`ªmove
(
glb_∑th_lv…y≥s_def
);

305 
	`ªmove
(
glb_∑th_lvÕª°_mem
);

306 
	`ªmove
(
glb_∑th_lvÕª°_def
);

307 
	`ªmove
(
glb_∑th_obj_mem
);

308 
	`ªmove
(
glb_∑th_obj_def
);

309 
	`ªmove
(
glb_∑th_obje˘s_mem
);

310 
	`ªmove
(
glb_∑th_obje˘s_def
);

313 
glb_ds1edô
.
√w_dú1
[0] = 0;

314 
i
=0; i < 4; i++){

315 
glb_ds1edô
.
√w_dú4
[
i
] = 
dú4
[i];

317 
i
=0; i < 8; i++){

318 
glb_ds1edô
.
√w_dú8
[
i
] = 
dú8
[i];

320 
i
=0; i < 16; i++){

321 
glb_ds1edô
.
√w_dú16
[
i
] = 
dú16
[i];

323 
i
=0; i < 32; i++){

324 
glb_ds1edô
.
√w_dú32
[
i
] = 
dú32
[i];

341 
i
=0; i < 5; i++){

342 
o
=0; o < 5; o++){

343 
glb_ds1edô
.
obj_sub_tûe_‹dî
[
i
][
o
] = 
obj_sub_tûe
[i][o];

348 
glb_ds1edô
.
cmd_löe
.
ds1_fûíame
 = 
NULL
;

349 
glb_ds1edô
.
cmd_löe
.
öi_fûíame
 = 
NULL
;

350 
glb_ds1edô
.
cmd_löe
.
lv…y≥_id
 = -1;

351 
glb_ds1edô
.
cmd_löe
.
lvÕª°_def
 = -1;

352 
glb_ds1edô
.
cmd_löe
.
ªsize_width
 = -1;

353 
glb_ds1edô
.
cmd_löe
.
ªsize_height
 = -1;

354 
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 = -1;

355 
glb_ds1edô
.
cmd_löe
.
no_check_a˘
 = 
FALSE
;

356 
glb_ds1edô
.
cmd_löe
.
dt1_li°_num
 = -1;

357 
i
=0; i < 
DT1_IN_DS1_MAX
; i++){

358 
glb_ds1edô
.
cmd_löe
.
dt1_li°_fûíame
[
i
] = 
NULL
;

362 
glb_ds1edô
.
show_2nd_row
 = 
FALSE
;

365 
glb_ds1edô
.
video_∑ge_num
 = 0;

367 
	`DEBUG_MESSAGE
("ds1edit_init():out\n");

368 
	}
}

372 
UDWORD
 
	$ds1edô_gë_bôm≠_size
(
BITMAP
 * 
bmp
)

374 
UDWORD
 
size
 = 0;

376 i‡(
bmp
 =
NULL
)

379 
size
 +(
BITMAP
);

380 
size
 +((
UBYTE
 *Ë* 
bmp
->
h
);

382 
	`bôm≠_cﬁ‹_dïth
(
bmp
))

384 8 : 
size
 +
bmp
->
w
 * bmp->
h
; ;

386 16 : 
size
 +2 * (
bmp
->
w
 * bmp->
h
); ;

387 24 : 
size
 +3 * (
bmp
->
w
 * bmp->
h
); ;

388 32 : 
size
 +4 * (
bmp
->
w
 * bmp->
h
); ;

393  
size
;

394 
	}
}

399 
UDWORD
 
	$ds1edô_gë_RLE_bôm≠_size
(
RLE_SPRITE
 * 
æe
)

401 
UDWORD
 
size
 = 0;

403 i‡(
æe
 =
NULL
)

406 
size
 +(
RLE_SPRITE
);

407 
size
 +
æe
->size;

409  
size
;

410 
	}
}

415 
	$ds1edô_exô
()

417 
i
, 
z
, 
b
;

420 
	`¥ötf
("\nds1edit_exit()\n");

423 
i
=0; i<
MAX_MPQ_FILE
; i++)

425 i‡(
glb_mpq_°ru˘
[
i
].
is_›í
 !
FALSE
)

427 
	`Ârötf
(
°dîr
, "˛osög %s\n", 
glb_mpq_°ru˘
[
i
].
fûe_«me
);

428 
	`fÊush
(
°dîr
);

430 
glb_mpq
 = & 
glb_mpq_°ru˘
[
i
];

431 
	`mpq_b©ch_˛o£
();

433 
	`mem£t
–& 
glb_mpq_°ru˘
[
i
], 0, (
GLB_MPQ_S
));

434 
glb_mpq_°ru˘
[
i
].
is_›í
 = 
FALSE
;

439 
	`Ârötf
(
°dîr
, "exit, memory free :\n");

440 
	`fÊush
(
°dîr
);

443 
	`Ârötf
(
°dîr
, " * mouse cursor...\n");

444 
	`fÊush
(
°dîr
);

445 
	`show_mou£
(
NULL
);

446 
i
=0; i<
MOD_MAX
; i++)

448 i‡(
glb_ds1edô
.
mou£_curs‹
[
i
] !
NULL
)

450 
	`de°roy_bôm≠
(
glb_ds1edô
.
mou£_curs‹
[
i
]);

451 
glb_ds1edô
.
mou£_curs‹
[
i
] = 
NULL
;

456 
	`Ârötf
(
°dîr
, " * screen buffer...\n");

457 
	`fÊush
(
°dîr
);

458 i‡(
glb_ds1edô
.
s¸ìn_buff
 !
NULL
)

460 
	`de°roy_bôm≠
(
glb_ds1edô
.
s¸ìn_buff
);

461 
glb_ds1edô
.
s¸ìn_buff
 = 
NULL
;

464 i‡(
glb_ds1edô
.
big_s¸ìn_buff
 !
NULL
)

466 
	`de°roy_bôm≠
(
glb_ds1edô
.
big_s¸ìn_buff
);

467 
glb_ds1edô
.
big_s¸ìn_buff
 = 
NULL
;

471 
	`Ârötf
(
°dîr
, " * config, mpqÇames...\n");

472 
	`fÊush
(
°dîr
);

473 
i
=0; i<
MAX_MPQ_FILE
; i++)

475 if(
glb_c⁄fig
.
mpq_fûe
[
i
] !
NULL
)

476 
	`‰ì
(
glb_c⁄fig
.
mpq_fûe
[
i
]);

480 
	`Ârötf
(
°dîr
, " * config, mod directoryÇame...\n");

481 
	`fÊush
(
°dîr
);

482 
i
=0; i<
MAX_MOD_DIR
; i++)

484 if(
glb_c⁄fig
.
mod_dú
[
i
] !
NULL
)

485 
	`‰ì
(
glb_c⁄fig
.
mod_dú
[
i
]);

489 
	`Ârötf
(
°dîr
, " *Öalettes...\n");

490 
	`fÊush
(
°dîr
);

491 
i
=0; i<
ACT_MAX
; i++)

493 if(
glb_ds1edô
.
d2_∑l
[
i
] !
NULL
)

495 
	`‰ì
(
glb_ds1edô
.
d2_∑l
[
i
]);

496 
glb_ds1edô
.
d2_∑l
[
i
] = 
NULL
;

497 
glb_ds1edô
.
∑l_size
[
i
] = 0;

502 
	`Ârötf
(
°dîr
, " * DT1 files...\n");

503 
	`fÊush
(
°dîr
);

504 i‡(
glb_dt1
 !
NULL
)

506 
i
=0; i<
DT1_MAX
; i++)

507 
	`dt1_‰ì
(
i
);

511 
	`Ârötf
(
°dîr
, " * DS1 files...\n");

512 
	`fÊush
(
°dîr
);

513 i‡(
glb_ds1
 !
NULL
)

515 
i
=0; i<
DS1_MAX
; i++)

516 
	`ds1_‰ì
(
i
);

520 
	`Ârötf
(
°dîr
, " * objects descriptions...\n");

521 
	`fÊush
(
°dîr
);

522 i‡(
glb_ds1edô
.
obj_desc
 !
NULL
)

524 
	`™im_exô
();

525 
	`‰ì
(
glb_ds1edô
.
obj_desc
);

526 
glb_ds1edô
.
obj_desc
 = 
NULL
;

527 
glb_ds1edô
.
obj_desc_num
 = 0;

531 
	`Ârötf
(
°dîr
, " * buttons &Åab...\n");

532 
	`fÊush
(
°dîr
);

533 
	`wedô_‰ì
();

536 
	`Ârötf
(
°dîr
, " * undo buffers...\n");

537 
	`fÊush
(
°dîr
);

538 i‡(
glb_ds1
 !
NULL
)

539 
	`undo_exô
();

542 
	`Ârötf
(
°dîr
, " * walkable infoÅiles...\n");

543 
	`fÊush
(
°dîr
);

544 
z
=0; z<
ZM_MAX
; z++)

546 
i
=0; i<25; i++)

548 i‡(
glb_ds1edô
.
subtûe_nowÆk
[
z
][
i
] !
NULL
)

550 
	`de°roy_æe_•rôe
(
glb_ds1edô
.
subtûe_nowÆk
[
z
][
i
]);

551 
glb_ds1edô
.
subtûe_nowÆk
[
z
][
i
] = 
NULL
;

554 i‡(
glb_ds1edô
.
subtûe_nojump
[
z
][
i
] !
NULL
)

556 
	`de°roy_æe_•rôe
(
glb_ds1edô
.
subtûe_nojump
[
z
][
i
]);

557 
glb_ds1edô
.
subtûe_nojump
[
z
][
i
] = 
NULL
;

562 i‡(
glb_ds1edô
.
subtûe_hñp
 !
NULL
)

564 
	`de°roy_bôm≠
(
glb_ds1edô
.
subtûe_hñp
);

565 
glb_ds1edô
.
subtûe_hñp
 = 
NULL
;

570 
	`Ârötf
(
°dîr
, " * walkable infoÅiles combinations...\n");

571 
	`fÊush
(
°dîr
);

572 
b
=0; b<256; b++)

574 
z
=0; z<
ZM_MAX
; z++)

576 
i
=0; i<25; i++)

578 i‡(
glb_ds1edô
.
subtûe_Êag
[
b
][
z
][
i
] !
NULL
)

580 
	`de°roy_æe_•rôe
(
glb_ds1edô
.
subtûe_Êag
[
b
][
z
][
i
]);

581 
glb_ds1edô
.
subtûe_Êag
[
b
][
z
][
i
] = 
NULL
;

588 
	`Ârötf
(
°dîr
, " * .txt buffers ...\n");

589 
	`fÊush
(
°dîr
);

590 i‡(
glb_ds1edô
.
lv…y≥s_buff
 !
NULL
)

591 
glb_ds1edô
.
lv…y≥s_buff
 = 
	`txt_de°roy
(glb_ds1edit.lvltypes_buff);

592 i‡(
glb_ds1edô
.
lvÕª°_buff
 !
NULL
)

593 
glb_ds1edô
.
lvÕª°_buff
 = 
	`txt_de°roy
(glb_ds1edit.lvlprest_buff);

594 i‡(
glb_ds1edô
.
obj_buff
 !
NULL
)

595 
glb_ds1edô
.
obj_buff
 = 
	`txt_de°roy
(glb_ds1edit.obj_buff);

598 
	`Ârötf
(
°dîr
, " *ánimdata.d2 buffer ...\n");

599 
	`fÊush
(
°dîr
);

600 i‡(
glb_ds1edô
.
™im_d©a
.
buf„r
)

601 
	`‰ì
(
glb_ds1edô
.
™im_d©a
.
buf„r
);

604 
	`Ârötf
(
°dîr
, " * glb_ds1[] & glb_dt1[] & glb_ds1[].obj & glb_ds1[].obj_undo ...\n");

605 
	`fÊush
(
°dîr
);

608 i‡(
glb_ds1
 !
NULL
)

610 
i
=0; i < 
DS1_MAX
; i++)

612 i‡(
glb_ds1
[
i
].
obj
 !
NULL
)

613 
	`‰ì
(
glb_ds1
[
i
].
obj
);

614 i‡(
glb_ds1
[
i
].
obj_undo
 !
NULL
)

615 
	`‰ì
(
glb_ds1
[
i
].
obj_undo
);

617 
	`‰ì
(
glb_ds1
);

619 i‡(
glb_dt1
 !
NULL
)

620 
	`‰ì
(
glb_dt1
);

622 
	`fÊush
(
°dîr
);

623 
	}
}

630 
	$ds1edô_cou¡î_tick
()

632 
glb_ds1edô
.
ticks_ñ≠£d
++;

633 
	}
}

634 
END_OF_FUNCTION
(
ds1edô_cou¡î_tick
);

639 
	$ds1edô_cou¡î_Âs
()

641 
glb_ds1edô
.
ﬁd_Âs
 = glb_ds1edô.
Âs
;

642 
glb_ds1edô
.
Âs
 = 0;

643 
	}
}

644 
END_OF_FUNCTION
(
ds1edô_cou¡î_Âs
);

649 
	$ds1edô_›í_Æl_mpq
()

651 
i
;

653 
	`DEBUG_MESSAGE
("ds1edit_open_all_mpq():in\n");

654 
i
=0; i<
MAX_MPQ_FILE
; i++){

655 if(
glb_c⁄fig
.
mpq_fûe
[
i
] !
NULL
){

656 
	`DEBUG_MESSAGE
("›íög mpq %ò: %s\n", 
i
, 
glb_c⁄fig
.
mpq_fûe
[i]);

657 
glb_mpq
 = & 
glb_mpq_°ru˘
[
i
];

658 
	`mpq_b©ch_›í
(
glb_c⁄fig
.
mpq_fûe
[
i
]);

661 
	`DEBUG_MESSAGE
("ds1edit_open_all_mpq():out\n");

662 
	}
}

667 
	$ds1edô_lﬂd_∑Àâes
()

669 
i
, 
íåy
;

670 
∑ ame
[80], 
tmp
[150];

672 
	`DEBUG_MESSAGE
("ds1edit_load_palettes():in\n");

679 
i
=0; i<
ACT_MAX
; i++){

680 
glb_ds1edô
.
∑l_lﬂded
[
i
] = 
TRUE
;

685 if(
	`misc_lﬂd_∑l_‰om_disk
(
i
Ë=
FALSE
) {

687 
glb_ds1edô
.
∑l_lﬂded
[
i
] = 
FALSE
;

689 
	`•rötf
(
∑ ame
, "d©a/globÆ/∑Àâe/a˘%i/∑l.∂2", 
i
+1);

691 
	`DEBUG_MESSAGE
("w™àtÿªadáÖÆëã from mpq : %s\n", 
∑ ame
);

692 
íåy
 = 
	`misc_lﬂd_mpq_fûe
–
∑ ame
, (**Ë& 
glb_ds1edô
.
d2_∑l
[
i
], & glb_ds1edô.
∑l_size
[i], 
TRUE
 );

693 if(
íåy
 == -1){

694 
	`DEBUG_MESSAGE
("fûê\"%s\"ÇŸ found.", 
∑ ame
 );

695 i‡(
i
 < 4){

696 
	`Ârötf
(
°dîr
, 
tmp
);

698 
	`¥ötf
("w¨nög :\n%s\n", 
tmp
);

702 
	`misc_ßve_∑l_⁄_disk
(
i
, 
glb_ds1edô
.
d2_∑l
[i]);

706 
	`misc_∂2_c‹ª˘
(
i
);

707 
	`misc_∑l_d2_2_vga
(
i
);

709 
	`DEBUG_MESSAGE
("ds1edit_load_palettes():out\n");

710 
	}
}

715 
	$maö
(
¨gc
, * 
¨gv
[])

717 
i
;

718 
mpq_num
 = 0;

719 
mod_num
 = 0;

720 
ds1_idx
 = 0;

721 
ªs_w
;

722 
ªs_h
;

724 
tmp
 [512];

725 
tmp2
[512];

727 *
ööame
 = "./ds1edit.ini";

730 
	`DEBUG_MESSAGE
("main():in\n");

732 
	`§™d
(
	`time
(
NULL
));

733 
	`ÆÀgro_öô
();

734 
	`£t_gfx_mode
(
GFX_TEXT
, 80, 25, 0, 0);

736 if(
	`ö°Æl_keybﬂrd
() != 0){

737 
	`FATAL_EXIT
("main(),Érror.\ncouldÇot installÅhe Keyboard Handler.");

739 if(
	`ö°Æl_timî
() != 0){

740 
	`FATAL_EXIT
("main(),Érror.\ncouldÇot installÅhe Timer Handler.");

743 
	`£t_cﬁ‹_dïth
(8);

746 if(
	`©exô
(
ds1edô_exô
) != 0){

747 
	`FATAL_EXIT
("main(),Érror.\ncouldÇot installÅhe 'atexit' Handler.");

750 
	`ds1edô_öô
();

752 
	`gë_deskt›_ªsﬁuti⁄
–& 
ªs_w
, & 
ªs_h
);

753 
	`DEBUG_MESSAGE
("deskt›_ªsﬁuti⁄ = %ò* %i\n", 
ªs_w
, 
ªs_h
);

755 
	`£t_wödow_tôÀ
("D2IM-MAPEDITOR");

759 
	`•rötf
(
tmp
, "%s/%s/.", 
glb_ds1edô_d©a_dú
, 
glb_ds1edô_tmp_dú
);

760 i‡(
	`fûe_exi°s
(
tmp
, -1, 
NULL
) == 0){

762 
	`•rötf
(
tmp
, "%s%s", 
glb_ds1edô_d©a_dú
, 
glb_ds1edô_tmp_dú
);

763 if(
	`°æí
(
tmp
)){

764 
tmp
[
	`°æí
(tmp) - 1] = 0;

766 if(
	`mkdú
(
tmp
) != 0){

768 
	`FATAL_EXIT
("couldÇŸ cª©êdúe˘‹y \"%s%s\".", 
glb_ds1edô_d©a_dú
, 
glb_ds1edô_tmp_dú
 );

773 
	`•rötf
(
tmp
, "./ds1edit.ini");

774 if(
	`fûe_exi°s
(
tmp
, -1, 
NULL
) == 0){

775 
	`öi_¸óã
(
tmp
);

776 
	`FATAL_EXIT
("no 'ds1edit.ini' file, createándÑeconfigure it.\n");

780 
	`öi_ªad
(
ööame
);

782 
	`DEBUG_MESSAGE
("==================================================================\n");

783 
	`DEBUG_MESSAGE
("d2ch¨ = %s\n", 
glb_c⁄fig
.
mpq_fûe
[3]);

784 
	`DEBUG_MESSAGE
("d2d©® = %s\n", 
glb_c⁄fig
.
mpq_fûe
[2]);

785 
	`DEBUG_MESSAGE
("d2ex∞ = %s\n", 
glb_c⁄fig
.
mpq_fûe
[1]);

786 
	`DEBUG_MESSAGE
("∑tch_d2 = %s\n", 
glb_c⁄fig
.
mpq_fûe
[0]);

787 
	`DEBUG_MESSAGE
("mod_dú = %s\n", 
glb_c⁄fig
.
mod_dú
[0]);

788 
	`DEBUG_MESSAGE
("fuŒs¸ì¿ = %s\n", 
glb_c⁄fig
.
fuŒs¸ìn
 ? "YES" : "NO");

789 
	`DEBUG_MESSAGE
("s¸ìn_width = %i\n", 
glb_c⁄fig
.
s¸ìn
.
width
);

790 
	`DEBUG_MESSAGE
("s¸ìn_heighà = %i\n", 
glb_c⁄fig
.
s¸ìn
.
height
);

791 
	`DEBUG_MESSAGE
("s¸ìn_dïth = %i\n", 
glb_c⁄fig
.
s¸ìn
.
dïth
);

792 
	`DEBUG_MESSAGE
("ª‰esh_øã = %i\n", 
glb_c⁄fig
.
s¸ìn
.
ª‰esh
);

793 
	`DEBUG_MESSAGE
("keyb_s¸ﬁl_x = %i\n", 
glb_c⁄fig
.
s¸ﬁl
.
keyb
.
x
);

794 
	`DEBUG_MESSAGE
("keyb_s¸ﬁl_y = %i\n", 
glb_c⁄fig
.
s¸ﬁl
.
keyb
.
y
);

795 
	`DEBUG_MESSAGE
("mou£_s¸ﬁl_x = %i\n", 
glb_c⁄fig
.
s¸ﬁl
.
mou£
.
x
);

796 
	`DEBUG_MESSAGE
("mou£_s¸ﬁl_y = %i\n", 
glb_c⁄fig
.
s¸ﬁl
.
mou£
.
y
);

797 
	`DEBUG_MESSAGE
("edô_s¸ﬁl_x = %i\n", 
glb_c⁄fig
.
s¸ﬁl
.
edô
.
x
);

798 
	`DEBUG_MESSAGE
("edô_s¸ﬁl_y = %i\n", 
glb_c⁄fig
.
s¸ﬁl
.
edô
.
y
);

799 
	`DEBUG_MESSAGE
("obj_edô_s¸ﬁ» = %i\n", 
glb_c⁄fig
.
s¸ﬁl
.
obj_edô
);

800 
	`DEBUG_MESSAGE
("mou£_•ìd_x = %i\n", 
glb_c⁄fig
.
mou£_•ìd
.
x
);

801 
	`DEBUG_MESSAGE
("mou£_•ìd_y = %i\n", 
glb_c⁄fig
.
mou£_•ìd
.
y
);

802 
	`DEBUG_MESSAGE
("gamma_c‹ª˘i⁄ = %s\n", 
glb_gamma_°r
[
glb_c⁄fig
.
gamma
].
°r
);

803 
	`DEBUG_MESSAGE
("⁄ly_n‹mÆ_ty≥2 = %s\n", 
glb_c⁄fig
.
n‹mÆ_ty≥2
 ? "YES" : "NO");

804 
	`DEBUG_MESSAGE
("Æways_max_œyî† = %s\n", 
glb_c⁄fig
.
Æways_max_œyîs
 ? "YES" : "NO");

805 
	`DEBUG_MESSAGE
("°ªtch_•rôe† = %s\n", 
glb_c⁄fig
.
°ªtch_•rôes
 ? "YES" : "NO");

806 
	`DEBUG_MESSAGE
("wöobj_ˇn_s¸ﬁl_keyb = %s\n", 
glb_c⁄fig
.
wöobj_s¸ﬁl_keyb
 ? "YES" : "NO");

807 
	`DEBUG_MESSAGE
("wöobj_ˇn_s¸ﬁl_mou£ = %s\n", 
glb_c⁄fig
.
wöobj_s¸ﬁl_mou£
 ? "YES" : "NO");

809 
glb_c⁄fig
.
˚¡î_zoom
)

811 -1 : 
	`DEBUG_MESSAGE
("center_zoom = ERROR\n"); ;

812 
ZM_11
 : 
	`DEBUG_MESSAGE
("center_zoom = 1:1\n" ); ;

813 
ZM_12
 : 
	`DEBUG_MESSAGE
("center_zoom = 1:2\n" ); ;

814 
ZM_14
 : 
	`DEBUG_MESSAGE
("center_zoom = 1:4\n" ); ;

815 
ZM_18
 : 
	`DEBUG_MESSAGE
("center_zoom = 1:8\n" ); ;

816 
ZM_116
 : 
	`DEBUG_MESSAGE
("center_zoom = 1:16\n" ); ;

817  : 
	`DEBUG_MESSAGE
("center_zoom = ?\n" ); ;

820 
	`DEBUG_MESSAGE
("nb_ty≥1_≥r_a˘ = %i\n", 
glb_c⁄fig
.
nb_ty≥1_≥r_a˘
);

821 
	`DEBUG_MESSAGE
("nb_ty≥2_≥r_a˘ = %i\n", 
glb_c⁄fig
.
nb_ty≥2_≥r_a˘
);

822 
	`DEBUG_MESSAGE
("ds1_ßved_möimizê = %s\n", 
glb_c⁄fig
.
möimize_ds1
 ? "YES" : "NO");

823 
	`DEBUG_MESSAGE
("lowî_•ìd_zoom_ouà = %s\n", 
glb_c⁄fig
.
lowî_•ìd_zoom_out
 ? "YES" : "NO");

824 
	`DEBUG_MESSAGE
("w‹k•a˚_íabÀ = %s\n", 
glb_c⁄fig
.
w‹k•a˚_íabÀ
 ? "YES" : "NO");

825 
	`DEBUG_MESSAGE
("==================================================================\n");

829 
mod_num
 = 0;

830 if(
glb_c⁄fig
.
mod_dú
[0] !
NULL
){

831 
	`•rötf
(
tmp
, "%s/.", 
glb_c⁄fig
.
mod_dú
[0]);

832 i‡(
	`fûe_exi°s
(
tmp
, -1, 
NULL
) == 0){

833 
	`WARNING_MESSAGE
("couldÇŸ födÅhêmod dúe˘‹y deföed i¿'ds1edô.öi' :\n" "%s", 
tmp
 );

835 
mod_num
 = 1;

839 
i
=0; i<
MAX_MPQ_FILE
; i++){

840 i‡(
glb_c⁄fig
.
mpq_fûe
[
i
] !
NULL
){

841 if(
	`fûe_exi°s
(
glb_c⁄fig
.
mpq_fûe
[
i
], -1, 
NULL
) == 0){

842 
	`WARNING_MESSAGE
("couldÇŸ födÅhi†mpq deföed i¿'ds1edô.öi' :%s\n", 
glb_c⁄fig
.
mpq_fûe
[
i
] );

844 
mpq_num
++;

848 i‡((
mod_num
 =0Ë&& (
mpq_num
 == 0)){

849 
	`FATAL_EXIT
("no mod directoryándÇo mpq filesávailable : it can't work.\n" );

850 }i‡(
mpq_num
 < 4){

851 
	`WARNING_MESSAGE
("notállÅhe 4 mpq have been found\n");

855 
glb_ds1edô
.
cur_gamma
 = 
glb_c⁄fig
.
gamma
;

856 
	`misc_ªad_gamma
();

859 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 0;

860 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 0;

861 
glb_ds1edô
.
wö_¥evõw
.
w
 = 
glb_c⁄fig
.
s¸ìn
.
width
;

862 
glb_ds1edô
.
wö_¥evõw
.
h
 = 
glb_c⁄fig
.
s¸ìn
.
height
;

868 
	`wedô_ªad_pcx
();

869 
	`wedô_make_2nd_buâ⁄s
();

870 
	`misc_wÆkabÀ_tûe_öfo_pcx
();

878 
glb_c⁄fig
.
s¸ìn
.
width
 += 600;

879 
glb_c⁄fig
.
s¸ìn
.
height
 += 600;

880 
glb_ds1edô
.
big_s¸ìn_buff
 = 
	`¸óã_bôm≠
–
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
 );

881 i‡(
glb_ds1edô
.
big_s¸ìn_buff
 =
NULL
){

882 
	`FATAL_EXIT
("couldÇŸ cª©êbig_s¸ìn_buf‡(%i*%òpixñs).", 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
 );

884 
glb_c⁄fig
.
s¸ìn
.
width
 -= 600;

885 
glb_c⁄fig
.
s¸ìn
.
height
 -= 600;

887 
glb_ds1edô
.
s¸ìn_buff
 = 
	`¸óã_sub_bôm≠
–glb_ds1edô.
big_s¸ìn_buff
, 300, 300, 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
 );

888 i‡(
glb_ds1edô
.
s¸ìn_buff
 =
NULL
){

889 
	`FATAL_EXIT
("couldÇŸ cª©êsub-bôm≠ s¸ìn_buf‡(%i*%òpixñs).", 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
 );

893 
	`ds1edô_›í_Æl_mpq
();

896 
	`ds1edô_lﬂd_∑Àâes
();

900 i‡(
	`misc_cmd_löe_∑r£
 (
¨gc
, 
¨gv
)){

903 
	`FATAL_EXIT
("problem inÅhe commandÜine.");

907 i‡(
glb_ds1edô
.
cmd_löe
.
debug_mode
 =
TRUE
){

908 
	`mkdú
("debug");

912 
	`ªad_obje˘s_txt
();

915 
	`ªad_obj_txt
();

917 if(
glb_ds1edô
.
cmd_löe
.
ds1_fûíame
 !
NULL
){

921 if(
glb_ds1edô
.
cmd_löe
.
dt1_li°_num
 != -1){

923 
	`misc_›í_1_ds1_f‹˚_dt1
(
ds1_idx
);

926 
	`misc_›í_1_ds1
(

927 
ds1_idx
,

928 
glb_ds1edô
.
cmd_löe
.
ds1_fûíame
,

929 
glb_ds1edô
.
cmd_löe
.
lv…y≥_id
,

930 
glb_ds1edô
.
cmd_löe
.
lvÕª°_def
,

931 
glb_ds1edô
.
cmd_löe
.
ªsize_width
,

932 
glb_ds1edô
.
cmd_löe
.
ªsize_height


935 }if(
glb_ds1edô
.
cmd_löe
.
öi_fûíame
 !
NULL
){

939 
glb_ds1edô
.
show_2nd_row
 = 
TRUE
;

941 
	`misc_›í_£vîÆ_ds1
(
¨gv
[1]);

944 
	`Ârötf
(
°dîr
, "main(),Érror.\nBug :Çeither .DS1Çorá .INI inÅhe commandÜine.");

948 
	`¥ötf
("============================================================\n");

949 i‡(
¨gc
 >= 4){

951 } i‡(
¨gc
 == 2) {

955 
	`¥ötf
("syntaxe 1 : ds1edit <file.ds1> <lvlTypes.txt Id> <lvlPrest.txt Def> [options]\n");

956 
	`¥ötf
("syntaxe 2 : ds1edit <file.ini>\n"

960 
	`exô
(
DS1ERR_CMDLINE
);

962 
	`¥ötf
("============================================================\n");

965 
	`¥ötf
("\nanimdata_load()\n");

966 
	`fÊush
(
°dout
);

967 
	`fÊush
(
°dîr
);

969 
	`™imd©a_lﬂd
();

972 
	`¥ötf
("loading ds1 objectsánimations :\n");

973 
	`Ârötf
(
°dîr
, "loading ds1 objectsánimations : ");

974 
	`fÊush
(
°dout
);

975 
	`fÊush
(
°dîr
);

977 
	`™im_upd©e_gfx
(
TRUE
);

979 
	`¥ötf
("\n");

980 
	`Ârötf
(
°dîr
, "\n");

981 
	`fÊush
(
°dout
);

982 
	`fÊush
(
°dîr
);

985 
	`¥ötf
("\ncolor maps...");

986 
	`Ârötf
(
°dîr
, "color maps");

987 
	`misc_make_cm≠s
();

988 
	`¥ötf
("done\n");

989 
	`Ârötf
(
°dîr
, "done\n");

992 
	`fÊush
(
°dout
);

993 
	`fÊush
(
°dîr
);

994 i‡–(
glb_c⁄fig
.
s¸ìn
.
dïth
 != 8) && (glb_config.screen.depth != 15) && (glb_config.screen.depth != 16) && (glb_config.screen.depth != 24) && (glb_config.screen.depth != 32)) {

995 
	`•rötf
–
tmp
, "maö(),Éº‹.\nInvÆid cﬁ‹ dïth (%i).\nVÆid vÆue†¨ê: 8, 15, 16, 24ánd 32.\nCheckÅhê'Ds1edô.öi' fûe,áàthê's¸ìn_dïth'Üöe", 
glb_c⁄fig
.
s¸ìn
.
dïth
);

996 
	`Ârötf
(
°dîr
, 
tmp
);

1000 
	`£t_cﬁ‹_dïth
(
glb_c⁄fig
.
s¸ìn
.
dïth
);

1002 
	`ªque°_ª‰esh_øã
(
glb_c⁄fig
.
s¸ìn
.
ª‰esh
);

1003 i‡(
glb_c⁄fig
.
fuŒs¸ìn
 =
TRUE
) {

1004 i‡(
	`£t_gfx_mode
(
GFX_AUTODETECT_FULLSCREEN
, 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
, 0, 0) != 0) {

1005 
	`•rötf
–
tmp
, "maö(),Éº‹.\ncouldÇŸ inôülizêthi†gøphiˇ»modê: " "%i*%ò%ibµ %iHz %s.\nAŒegro_îr‹ = \"%s\".", 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
, glb_c⁄fig.s¸ìn.
dïth
, glb_c⁄fig.s¸ìn.
ª‰esh
, "FuŒs¸ìn", 
ÆÀgro_îr‹
);

1006 
	`Ârötf
(
°dîr
, 
tmp
);

1009 i‡(
	`£t_gfx_mode
(
GFX_AUTODETECT_WINDOWED
, 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
, 0, 0) != 0) {

1010 
	`•rötf
–
tmp
, "maö(),Éº‹.\ncouldÇŸ inôülizêthi†gøphiˇ»modê: " "%i*%ò%ibµ %iHz %s.\nAŒegro_îr‹ = \"%s\".", 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
, glb_c⁄fig.s¸ìn.
dïth
, glb_c⁄fig.s¸ìn.
ª‰esh
, "Wödowed", 
ÆÀgro_îr‹
);

1011 
	`Ârötf
(
°dîr
, 
tmp
);

1014 
glb_ds1edô
.
cuºít_ª‰esh_øã
 = 
	`gë_ª‰esh_øã
();

1017 
glb_ds1edô
.
video_∑ge
[0] = 
	`¸óã_video_bôm≠
–
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
);

1018 i‡(
glb_ds1edô
.
video_∑ge
[0] =
NULL
) {

1019 
	`•rötf
(
tmp
, "maö(),Éº‹.\ncouldÇŸ cª©êvideÿ∑gê1.", 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
);

1020 
	`Ârötf
(
°dîr
, 
tmp
);

1023 
glb_ds1edô
.
video_∑ge
[1] = 
	`¸óã_video_bôm≠
–
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
);

1024 i‡(
glb_ds1edô
.
video_∑ge
[1] =
NULL
) {

1025 
	`•rötf
(
tmp
, "maö(),Éº‹.\ncouldÇŸ cª©êvideÿ∑gê2.", 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
);

1026 
	`Ârötf
(
°dîr
, 
tmp
);

1030 
	`£t_di•œy_swôch_mode
(
SWITCH_PAUSE
);

1033 
	`£t_cﬁ‹_dïth
(8);

1035 
	`ãxt_mode
(-1);

1037 
	`LOCK_VARIABLE
(
glb_ds1edô
.
ﬁd_Âs
);

1038 
	`LOCK_VARIABLE
(
glb_ds1edô
.
Âs
);

1039 
	`LOCK_VARIABLE
(
glb_ds1edô
.
ticks_ñ≠£d
);

1040 
	`LOCK_FUNCTION
(
ds1edô_cou¡î_tick
);

1041 
	`LOCK_FUNCTION
(
ds1edô_cou¡î_Âs
);

1043 i‡(
	`ö°Æl_öt
(
ds1edô_cou¡î_tick
, 1000 / 25) != 0) {

1044 
	`•rötf
–
tmp
, "main(),Érror.\ncouldÇot installÅhe 'counter_tick'Åimer handlerát 25Hz.");

1045 
	`Ârötf
(
°dîr
, 
tmp
);

1047 i‡(
	`ö°Æl_öt
(
ds1edô_cou¡î_Âs
, 1000) != 0) {

1048 
	`•rötf
–
tmp
, "main(),Érror.\ncouldÇot installÅhe 'counter_fps'Åimer handlerát 1Hz.");

1049 
	`Ârötf
(
°dîr
, 
tmp
);

1052 i‡(
	`ö°Æl_mou£
() == -1) {

1053 
	`•rötf
–
tmp
, "main(),Érror.\ncouldÇot installÅhe Mouse handler.");

1054 
	`Ârötf
(
°dîr
, 
tmp
);

1056 
	`£t_mou£_•ìd
(
glb_c⁄fig
.
mou£_•ìd
.
x
, glb_c⁄fig.mou£_•ìd.
y
);

1060 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.x0;

1061 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.y0;

1062 
glb_ds1edô
.
wö_¥evõw
.
w
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.w ;

1063 
glb_ds1edô
.
wö_¥evõw
.
h
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.h ;

1067 
	`‰e›í
("°dîr.txt", "wt", 
°dîr
);

1068 
	`öãrÁc_u£r_h™dÀr
(
ds1_idx
);

1070 i‡(
glb_ds1edô
.
video_∑ge
[0] !
NULL
)

1071 
	`de°roy_bôm≠
(
glb_ds1edô
.
video_∑ge
[0]);

1073 i‡(
glb_ds1edô
.
video_∑ge
[1] !
NULL
)

1074 
	`de°roy_bôm≠
(
glb_ds1edô
.
video_∑ge
[1]);

1077 
	`£t_gfx_mode
(
GFX_TEXT
, 80, 25, 0, 0);

1079 
	`fÊush
(
°dout
);

1080 
	`fÊush
(
°dîr
);

1081  
DS1ERR_OK
;

1082 
	}
}

1083 
END_OF_MAIN
();

	@misc.c

96 
	~<°rög.h
>

97 
	~"°ru˘s.h
"

98 
	~"îr‹.h
"

99 
	~"ds1misc.h
"

100 
	~"txåód.h
"

101 
	~"dt1misc.h
"

102 
	~"mpq/mpqvõw.h
"

103 
	~"misc.h
"

108 
	$misc_∑l_d2_2_vga
(
∑l_idx
)

110 
UBYTE
 
r
, 
g
, 
b
;

111 
i
, 
ridx
;

113 if(
glb_ds1edô
.
d2_∑l
[
∑l_idx
] =
NULL
){

114 
i
=0; i<256; i++){

115 
glb_ds1edô
.
vga_∑l
[
∑l_idx
][
i
].
r
 = i >> 2;

116 
glb_ds1edô
.
vga_∑l
[
∑l_idx
][
i
].
g
 = i >> 2;

117 
glb_ds1edô
.
vga_∑l
[
∑l_idx
][
i
].
b
 = i >> 2;

122 
i
=0; i<256; i++){

125 
ridx
 = 4 * 
i
;

126 
r
 = 
glb_ds1edô
.
d2_∑l
[
∑l_idx
][
ridx
];

127 
g
 = 
glb_ds1edô
.
d2_∑l
[
∑l_idx
][
ridx
 + 1];

128 
b
 = 
glb_ds1edô
.
d2_∑l
[
∑l_idx
][
ridx
 + 2];

129 
r
 = 
glb_ds1edô
.
gamma_èbÀ
[glb_ds1edô.
cur_gamma
][r];

130 
g
 = 
glb_ds1edô
.
gamma_èbÀ
[glb_ds1edô.
cur_gamma
][g];

131 
b
 = 
glb_ds1edô
.
gamma_èbÀ
[glb_ds1edô.
cur_gamma
][b];

134 
glb_ds1edô
.
vga_∑l
[
∑l_idx
][
i
].
r
 =Ñ >> 2;

135 
glb_ds1edô
.
vga_∑l
[
∑l_idx
][
i
].
g
 = g >> 2;

136 
glb_ds1edô
.
vga_∑l
[
∑l_idx
][
i
].
b
 = b >> 2;

138 
	}
}

143 
	$misc_qs‹t_hñ≥r_block_èbÀ_1
(c⁄° * 
e1
, c⁄° * 
e2
)

145 
BLOCK_TABLE_S
 * 
bt1
, * 
bt2
;

146 
n1
=0, 
n2
=0;

148 
bt1
 = (
BLOCK_TABLE_S
 *Ë
e1
;

149 
bt2
 = (
BLOCK_TABLE_S
 *Ë
e2
;

152 i‡(
bt1
->
‹õ¡©i⁄
 !
bt2
->orientation)

154 
n1
 = 
bt1
->
‹õ¡©i⁄
;

155 
n2
 = 
bt2
->
‹õ¡©i⁄
;

157 i‡(
bt1
->
maö_ödex
 !
bt2
->main_index)

159 
n1
 = 
bt1
->
maö_ödex
;

160 
n2
 = 
bt2
->
maö_ödex
;

162 i‡(
bt1
->
sub_ödex
 !
bt2
->sub_index)

164 
n1
 = 
bt1
->
sub_ödex
;

165 
n2
 = 
bt2
->
sub_ödex
;

167 i‡(
bt1
->
dt1_idx
 !
bt2
->dt1_idx)

169 
n1
 = 
bt1
->
dt1_idx_f‹_ds1
;

170 
n2
 = 
bt2
->
dt1_idx_f‹_ds1
;

172 i‡(
n1
 =0Ën1 = 
DT1_MAX
;

173 i‡(
n2
 =0Ën2 = 
DT1_MAX
;

175 i‡(
bt1
->
ørôy
 !
bt2
->rarity)

177 
n1
 = 
bt1
->
ørôy
;

178 
n2
 = 
bt2
->
ørôy
;

180 i‡(
bt1
->
block_idx
 !
bt2
->block_idx)

182 
n1
 = 
bt1
->
block_idx
;

183 
n2
 = 
bt2
->
block_idx
;

185  
n1
 - 
n2
;

186 
	}
}

192 
	$misc_qs‹t_hñ≥r_block_èbÀ_2
(c⁄° * 
e1
, c⁄° * 
e2
)

194 
BLOCK_TABLE_S
 * 
bt1
, * 
bt2
;

195 
n1
=0, 
n2
=0;

197 
bt1
 = (
BLOCK_TABLE_S
 *Ë
e1
;

198 
bt2
 = (
BLOCK_TABLE_S
 *Ë
e2
;

208 i‡(
bt1
->
maö_ödex
 !
bt2
->main_index)

210 
n1
 = 
bt1
->
maö_ödex
;

211 
n2
 = 
bt2
->
maö_ödex
;

213 i‡(
bt1
->
‹õ¡©i⁄
 !
bt2
->orientation)

215 
n1
 = 
bt1
->
‹õ¡©i⁄
;

216 
n2
 = 
bt2
->
‹õ¡©i⁄
;

218 i‡(
bt1
->
sub_ödex
 !
bt2
->sub_index)

220 
n1
 = 
bt1
->
sub_ödex
;

221 
n2
 = 
bt2
->
sub_ödex
;

225 i‡(
bt1
->
dt1_idx
 !
bt2
->dt1_idx)

227 
n1
 = 
bt1
->
dt1_idx
;

228 
n2
 = 
bt2
->
dt1_idx
;

232 i‡(
bt1
->
ørôy
 !
bt2
->rarity)

234 
n1
 = 
bt1
->
ørôy
;

235 
n2
 = 
bt2
->
ørôy
;

237 i‡(
bt1
->
block_idx
 !
bt2
->block_idx)

239 
n1
 = 
bt1
->
block_idx
;

240 
n2
 = 
bt2
->
block_idx
;

242  
n1
 - 
n2
;

243 
	}
}

251 
	$misc_check_tûes_c⁄Êi˘s
(
ds1_idx
)

253 
BLOCK_TABLE_S
 * 
bt
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

254 
ﬁd_o
, 
ﬁd_m
, 
ﬁd_s
, 
o
, 
m
, 
s
;

255 
ﬁd_d
, 
d
, 
d⁄e
 = 
FALSE
, 
d⁄e2
, 
°¨t_i
 = 0, 
i
, 
íd_i
, 
r
;

256 
œ°_block
, 
fú°_block
;

257 
bt_max
 = 
glb_ds1
[
ds1_idx
].
bt_num
, 
b
;

258 
sum_ørôy
, 
max_ørôy
;

261  ! 
d⁄e
)

263 
ﬁd_o
 = 
bt
[
°¨t_i
].
‹õ¡©i⁄
;

264 
ﬁd_m
 = 
bt
[
°¨t_i
].
maö_ödex
;

265 
ﬁd_s
 = 
bt
[
°¨t_i
].
sub_ödex
;

266 
ﬁd_d
 = 
bt
[
°¨t_i
].
dt1_idx
;

268 
bt
[
°¨t_i
].
u£d_by_game
 = bt[°¨t_i].
u£d_by_edô‹
 = 
FALSE
;

271 
d⁄e2
 = 
FALSE
;

272 
sum_ørôy
 = 
bt
[
°¨t_i
].
ørôy
;

273 
œ°_block
 = 
°¨t_i
;

274 
i
 = 
°¨t_i
 + 1;

275 
max_ørôy
 = -1;

276 i‡(
bt
[
°¨t_i
].
ørôy
)

277 
fú°_block
 = 
°¨t_i
;

279 
fú°_block
 = -1;

280  ! 
d⁄e2
)

282 
o
 = 
bt
[
i
].
‹õ¡©i⁄
;

283 
m
 = 
bt
[
i
].
maö_ödex
;

284 
s
 = 
bt
[
i
].
sub_ödex
;

285 
d
 = 
bt
[
i
].
dt1_idx
;

286 
r
 = 
bt
[
i
].
ørôy
;

290 i‡((
ﬁd_o
 !
o
Ë|| (
ﬁd_m
 !
m
Ë|| (
ﬁd_s
 !
s
Ë|| (
i
 >
bt_max
))

291 
d⁄e2
 = 
TRUE
;

294 
bt
[
i
].
u£d_by_game
 = bt[i].
u£d_by_edô‹
 = 
FALSE
;

295 i‡(
d
 =
ﬁd_d
)

296 
œ°_block
 = 
i
;

297 i‡(
r
)

299 i‡(
fú°_block
 == -1)

300 
fú°_block
 = 
i
;

302 i‡(
r
 > 
max_ørôy
)

304 
fú°_block
 = 
i
;

305 
max_ørôy
 = 
r
;

308 
sum_ørôy
 +
r
;

309 
i
++;

312 
íd_i
 = 
i
 - 1;

315 i‡(
sum_ørôy
 == 0)

318 
bt
[
œ°_block
].
u£d_by_game
 = bt[œ°_block].
u£d_by_edô‹
 = 
TRUE
;

323 
bt
[
fú°_block
].
u£d_by_edô‹
 = 
TRUE
;

326 
b
 = 
°¨t_i
; b <
íd_i
; b++)

328 i‡(
bt
[
b
].
ørôy
)

329 
bt
[
b
].
u£d_by_game
 = 
TRUE
;

334 i‡(
i
 >
bt_max
)

335 
d⁄e
 = 
TRUE
;

337 
°¨t_i
 = 
i
;

339 
	}
}

344 
	$misc_make_block_èbÀ
(
ds1_idx
)

410 
BLOCK_TABLE_S
 *
bt_±r
;

411 
BLOCK_S
 *
b_±r
;

412 
tmp_°r
[80];

413 
i
, 
d
, 
b
, 
size
;

414 
n
 = 0;

418 
i
=0; i<
DT1_IN_DS1_MAX
; i++){

419 
d
 = 
glb_ds1
[
ds1_idx
].
dt1_idx
[
i
];

420 if(
d
 != -1){

421 
n
 +
glb_dt1
[
d
].
block_num
;

426 
n
++;

428 
size
 = (
BLOCK_TABLE_S
Ë* 
n
;

429 
glb_ds1
[
ds1_idx
].
block_èbÀ
 = (
BLOCK_TABLE_S
 *Ë
	`mÆloc
(
size
);

430 if(
glb_ds1
[
ds1_idx
].
block_èbÀ
 =
NULL
){

431 
	`FATAL_EXIT
("make_block_èbÀ(%i),ÇŸÉnough mem f‹ %òbyãs\n", 
ds1_idx
, 
size
 );

433 
	`mem£t
(
glb_ds1
[
ds1_idx
].
block_èbÀ
, 0, 
size
);

435 
glb_ds1
[
ds1_idx
].
bt_num
 = 
n
;

438 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

445 
bt_±r
->
‹õ¡©i⁄
 = -1;

446 
bt_±r
->
maö_ödex
 = -1;

447 
bt_±r
->
sub_ödex
 = -1;

448 
bt_±r
->
ørôy
 = -1;

449 
bt_±r
->
dt1_idx_f‹_ds1
 = -1;

450 
bt_±r
->
dt1_idx
 = -1;

451 
bt_±r
->
block_idx
 = -1;

452 
bt_±r
->
roof_y
 = -1;

453 
bt_±r
->
ty≥
 = -1;

454 
bt_±r
->
zîo_löe
 = -1;

457 
bt_±r
++;

462 
i
=0; i<
DT1_IN_DS1_MAX
; i++){

463 
d
 = 
glb_ds1
[
ds1_idx
].
dt1_idx
[
i
];

464 if(
d
 != -1){

465 
b_±r
 = 
glb_dt1
[
d
].
bh_buf„r
;

466 
b
=0; b<
glb_dt1
[
d
].
block_num
; b++){

470 
bt_±r
->
‹õ¡©i⁄
 = 
b_±r
->orientation;

471 
bt_±r
->
maö_ödex
 = 
b_±r
->main_index;

472 
bt_±r
->
sub_ödex
 = 
b_±r
->sub_index;

473 
bt_±r
->
ørôy
 = 
b_±r
->rarity;

485 
bt_±r
->
dt1_idx_f‹_ds1
 = 
i
;

486 
bt_±r
->
dt1_idx
 = 
d
;

487 
bt_±r
->
block_idx
 = 
b
;

488 
bt_±r
->
roof_y
 = 0;

489 
bt_±r
->
zîo_löe
 = 0;

492 i‡(
bt_±r
->
‹õ¡©i⁄
 == 0){

494 
bt_±r
->
zîo_löe
 = 0;

496 i‡(
b_±r
->
™im©ed
 == 0x01){

497 
bt_±r
->
ty≥
 = 
BT_ANIMATED
;

499 
bt_±r
->
ty≥
 = 
BT_STATIC
;

501 }if(
bt_±r
->
‹õ¡©i⁄
 == 13){

503 
bt_±r
->
ty≥
 = 
BT_SHADOW
;

504 
bt_±r
->
zîo_löe
 = - 
b_±r
->
size_y
;

507 i‡((
bt_±r
->
‹õ¡©i⁄
 == 10) || (bt_ptr->orientation == 11)) {

509 
bt_±r
->
ty≥
 = 
BT_SPECIAL
;

510 
bt_±r
->
zîo_löe
 = - 
b_±r
->
size_y
;

511 } i‡(
bt_±r
->
‹õ¡©i⁄
 == 15) {

513 
bt_±r
->
ty≥
 = 
BT_ROOF
;

514 
bt_±r
->
roof_y
 = 
b_±r
->roof_y;

515 
bt_±r
->
zîo_löe
 = 0;

516 } i‡(
bt_±r
->
‹õ¡©i⁄
 < 15) {

518 
bt_±r
->
ty≥
 = 
BT_WALL_UP
;

519 
bt_±r
->
zîo_löe
 = - 
b_±r
->
size_y
;

520 } i‡(
bt_±r
->
‹õ¡©i⁄
 > 15) {

522 
bt_±r
->
ty≥
 = 
BT_WALL_DOWN
;

523 
bt_±r
->
zîo_löe
 = 96;

528 
bt_±r
++;

529 
b_±r
++;

535 
	`¥ötf
("\ndt1_idx file\n" "------- ---------------------------------------------------------------------\n");

536 
d
=0; d<
DT1_IN_DS1_MAX
; d++) {

537 i‡(
glb_ds1
[
ds1_idx
].
dt1_idx
[
d
] != -1) {

538 
i
=0; i<
DT1_MAX
; i++) {

539 i‡(
i
 =
glb_ds1
[
ds1_idx
].
dt1_idx
[
d
]) {

540 i‡(
glb_dt1
[
i
].
ds1_ußge
 > 0) {

541 
	`¥ötf
("%7ò%s\n", 
i
, 
glb_dt1
[i].
«me
);

549 
	`qs‹t
(
glb_ds1
[
ds1_idx
].
block_èbÀ
, 
n
, (
BLOCK_TABLE_S
), 
misc_qs‹t_hñ≥r_block_èbÀ_1
);

553 
	`misc_check_tûes_c⁄Êi˘s
(
ds1_idx
);

556 
	`qs‹t
(
glb_ds1
[
ds1_idx
].
block_èbÀ
, 
n
, (
BLOCK_TABLE_S
), 
misc_qs‹t_hñ≥r_block_èbÀ_2
);

559 
	`¥ötf
("\ns‹ãd block_èbÀ o‡glb_ds1[%i] (%òblocksË:\n", 
ds1_idx
, 
n
);

560 
	`¥ötf
("block orientation main_idx sub_idx frame dt1_idx blk_idxÑoof_yÅypeÜine0\n");

561 
	`¥ötf
("----- ----------- -------- ------- ----- ------- ------- ------ ---- -----\n");

562 
b
=0; b<
glb_ds1
[
ds1_idx
].
bt_num
; b++) {

563 
	`¥ötf
("%5i %11li %8li %7li %5li %7li %7li %6i %4i %5i",

564 
b
,

565 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
‹õ¡©i⁄
,

566 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
maö_ödex
,

567 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
sub_ödex
,

568 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
ørôy
,

569 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
dt1_idx
,

570 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
block_idx
,

571 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
roof_y
,

572 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
ty≥
,

573 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
zîo_löe


575 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
c⁄Êi˘
 = 
FALSE
;

576 i‡(
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
ørôy
 == 0) {

577 i‡(
b
>1) {

578 i‡–(
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
‹õ¡©i⁄
 == glb_ds1[ds1_idx].block_table[b-1].orientation) &&

579 (
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
maö_ödex
 == glb_ds1[ds1_idx].block_table[b-1].main_index) &&

580 (
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
sub_ödex
 == glb_ds1[ds1_idx].block_table[b-1].sub_index)

583 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
c⁄Êi˘
 = 
TRUE
;

586 i‡(
b
 < (
glb_ds1
[
ds1_idx
].
bt_num
-1)) {

587 i‡–(
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
‹õ¡©i⁄
 == glb_ds1[ds1_idx].block_table[b+1].orientation) &&

588 (
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
maö_ödex
 == glb_ds1[ds1_idx].block_table[b+1].main_index) &&

589 (
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
sub_ödex
 == glb_ds1[ds1_idx].block_table[b+1].sub_index)

591 
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
c⁄Êi˘
 = 
TRUE
;

595 i‡(
glb_ds1
[
ds1_idx
].
block_èbÀ
[
b
].
c⁄Êi˘
) {

596 
	`¥ötf
(" *");

598 
	`¥ötf
("\n");

600 
	}
}

605 
	$misc_ªad_gamma
()

607 
FILE
 *
ö
;

608 
gt
;

609 
i
;

610 
v
;

611 
tmp
[150];

612 
gamma_∑th
[100];

614 
	`DEBUG_MESSAGE
("misc_read_gamma():in\n");

616 
	`•rötf
(
gamma_∑th
, "%s/%s", 
glb_ds1edô_d©a_dú
, "gamma.dat");

617 
	`DEBUG_MESSAGE
("ªad gamm®c‹ª˘i⁄ÅabÀ (%s)\n", 
gamma_∑th
);

618 
ö
 = 
	`f›í
(
gamma_∑th
, "rb");

619 if(
ö
 =
NULL
){

620 
	`FATAL_EXIT
("misc_ªad_gamma(Ë: c™'à›í %s", 
gamma_∑th
);

623 
gt
=
GC_060
; gt<
GC_MAX
; gt++){

624 
i
=0; i<256; i++){

625 
v
 = 
	`fgëc
(
ö
);

626 
glb_ds1edô
.
gamma_èbÀ
[
gt
][
i
] = 
v
;

629 
	`f˛o£
(
ö
);

630 
	`DEBUG_MESSAGE
("misc_read_gamma():out\n");

631 
	}
}

636 
	$misc_upd©e_∑l_wôh_gamma
()

638 
i
;

640 
i
=0; i<
ACT_MAX
; i++)

641 
	`misc_∑l_d2_2_vga
(
i
);

642 
	}
}

649 
	$misc_pcx_put_d2_∑Àâe
(* 
«me
, 
∑l_idx
)

651 
FILE
 * 
ö
;

652 
i
, 
r
, 
g
, 
b
, 
ridx
;

654 
ö
 = 
	`f›í
(
«me
, "rb+");

655 i‡(
ö
 =
NULL
)

657 
	`¥ötf
("w¨nög : c™'àmodifyÖÆëã o‡fûê%s\n", 
«me
);

661 
	`f£ek
(
ö
, -768, 
SEEK_END
);

662 
i
=0; i<256; i++)

664 
ridx
 = 4 * 
i
;

665 
r
 = 
glb_ds1edô
.
d2_∑l
[
∑l_idx
][
ridx
];

666 
g
 = 
glb_ds1edô
.
d2_∑l
[
∑l_idx
][
ridx
 + 1];

667 
b
 = 
glb_ds1edô
.
d2_∑l
[
∑l_idx
][
ridx
 + 2];

668 
	`Âutc
(
glb_ds1edô
.
gamma_èbÀ
[glb_ds1edô.
cur_gamma
][
r
], 
ö
);

669 
	`Âutc
(
glb_ds1edô
.
gamma_èbÀ
[glb_ds1edô.
cur_gamma
][
g
], 
ö
);

670 
	`Âutc
(
glb_ds1edô
.
gamma_èbÀ
[glb_ds1edô.
cur_gamma
][
b
], 
ö
);

672 
	`f˛o£
(
ö
);

673 
	}
}

678 
	$misc_make_cm≠s_hñ≥r
(c⁄° 
PALETTE
 
∑l
, 
x
, 
y
, 
RGB
 * 
rgb
)

680 i‡(
x
 =
COL_SHADOW
)

683 
rgb
->
r
 = 63;

684 
rgb
->
g
 = 63;

685 
rgb
->
b
 = 63;

687 i‡(
x
 =
COL_MOUSE
)

691 
rgb
->
r
 = (
∑l
[
x
].∏+ÖÆ[
y
].r * 4) / 3;

692 
rgb
->
g
 = (
∑l
[
x
].g +ÖÆ[
y
].g * 4) / 3;

693 
rgb
->
b
 = (
∑l
[
x
].b +ÖÆ[
y
].b * 4) / 3;

694 i‡(
rgb
->
r
 > 63)Ñgb->r = 63;

695 i‡(
rgb
->
g
 > 63)Ñgb->g = 63;

696 i‡(
rgb
->
b
 > 63)Ñgb->b = 63;

701 
rgb
->
r
 = (
∑l
[
x
].∏+ÖÆ[
y
].r) >> 1;

702 
rgb
->
g
 = (
∑l
[
x
].g +ÖÆ[
y
].g) >> 1;

703 
rgb
->
b
 = (
∑l
[
x
].b +ÖÆ[
y
].b) >> 1;

705 
	}
}

710 
	$misc_make_cm≠s
()

712 
CMAP_E
 
cm
;

713 
a
, 
cm≠_ok
, 
i
, 
c
, 
°¨t
;

714 
tmp
[100];

715 
FILE
 * 
out
, * 
ö
;

717 
	`¥ötf
("\n");

718 
cm
=0; cm < 
CM_MAX
; cm++)

720 
a
=0;á < 
ACT_MAX
;á++)

722 
	`Ârötf
(
°dîr
, ".");

723 
	`•rötf
(
tmp
, "%scm≠%i_%i.bö", 
glb_ds1edô_d©a_dú
, 
a
, 
cm
);

724 
cm≠_ok
 = 
FALSE
;

725 i‡(
	`fûe_exi°s
(
tmp
, -1, 
NULL
Ë&& (
glb_ds1edô
.
∑l_lﬂded
[
a
] =
TRUE
))

728 
ö
 = 
	`f›í
(
tmp
, "rb");

729 i‡(
ö
 =
NULL
)

730 
	`¥ötf
("ˇn'àªad %s\n", 
tmp
);

733 
	`¥ötf
("lﬂdög %s\n", 
tmp
);

734 
	`‰ód
(& 
glb_ds1edô
.
cm≠
[
cm
][
a
], (
COLOR_MAP
), 1, 
ö
);

735 
	`f˛o£
(
ö
);

736 
cm≠_ok
 = 
TRUE
;

740 i‡(
cm≠_ok
 =
FALSE
)

744 i‡(
cm
 =
CM_SELECT
)

747 
	`¸óã_cﬁ‹_èbÀ
(& 
glb_ds1edô
.
cm≠
[
cm
][
a
],

748 
glb_ds1edô
.
vga_∑l
[
a
],

749 
misc_make_cm≠s_hñ≥r
,

750 
NULL
);

753 i‡(
cm
 =
CM_TRANS
)

755 
	`¸óã_å™s_èbÀ
(& 
glb_ds1edô
.
cm≠
[
cm
][
a
],

756 
glb_ds1edô
.
vga_∑l
[
a
],

758 
NULL
);

760 i‡(
cm
 =
CM_SHADOW
)

762 
c
=0; c < 256; c++)

764 
°¨t
 = 1024 + (256 * (
c
/8));

765 
i
=0; i<256; i++)

767 
glb_ds1edô
.
cm≠
[
cm
][
a
].
d©a
[
c
][
i
] =

768 
glb_ds1edô
.
d2_∑l
[
a
][
°¨t
 + 
i
];

773 
out
 = 
	`f›í
(
tmp
, "wb");

774 i‡(
out
 =
NULL
)

775 
	`¥ötf
("ˇn'àwrôê%s\n", 
tmp
);

778 
	`¥ötf
("ßvög %s\n", 
tmp
);

779 
	`fwrôe
(& 
glb_ds1edô
.
cm≠
[
cm
][
a
], (
COLOR_MAP
), 1, 
out
);

780 
	`f˛o£
(
out
);

785 
	}
}

790 
	$misc_lﬂd_∑l_‰om_disk
(
∑l_idx
)

792 
tmp
[100];

793 
FILE
 *
ö
;

794 
size
;

796 
	`•rötf
(
tmp
, "%s/∑l%i.bö", 
glb_ds1edô_d©a_dú
, 
∑l_idx
);

797 if(
	`fûe_exi°s
(
tmp
, -1, 
NULL
)){

799 
ö
 = 
	`f›í
(
tmp
, "rb");

800 i‡(
ö
 =
NULL
){

801 
	`DEBUG_MESSAGE
("couldÇŸÑód %s\n", 
tmp
);

804 
	`f£ek
(
ö
, 0, 
SEEK_END
);

805 
size
 = 
	`·ñl
(
ö
);

806 
	`f£ek
(
ö
, 0, 
SEEK_SET
);

809 
glb_ds1edô
.
d2_∑l
[
∑l_idx
] = (
UBYTE
 *Ë
	`mÆloc
(
size
);

810 i‡(
glb_ds1edô
.
d2_∑l
[
∑l_idx
] =
NULL
){

811 
	`FATAL_EXIT
("misc_lﬂd_∑l_‰om_disk(Ë:ÇŸÉnough mem (%lòbyãsËf‹ÖÆëã %i", 
size
, 
∑l_idx
);

814 
	`DEBUG_MESSAGE
("lﬂdög %s\n", 
tmp
);

815 
	`‰ód
(
glb_ds1edô
.
d2_∑l
[
∑l_idx
], 
size
, 1, 
ö
);

816 
	`f˛o£
(
ö
);

817 
glb_ds1edô
.
∑l_size
[
∑l_idx
] = 
size
;

818  
TRUE
;

821  
FALSE
;

822 
	}
}

827 
	$misc_ßve_∑l_⁄_disk
(
∑l_idx
, 
UBYTE
 * 
d2_∑l_±r
)

829 
tmp
[100];

830 
FILE
 * 
out
;

832 
	`•rötf
(
tmp
, "%•Æ%i.bö", 
glb_ds1edô_d©a_dú
, 
∑l_idx
);

833 
out
 = 
	`f›í
(
tmp
, "wb");

834 i‡(
out
 =
NULL
)

835 
	`¥ötf
("ˇn'àwrôê%s\n", 
tmp
);

838 
	`¥ötf
("ßvög %s\n", 
tmp
);

839 
	`fwrôe
(
d2_∑l_±r
, 
glb_ds1edô
.
∑l_size
[
∑l_idx
], 1, 
out
);

840 
	`f˛o£
(
out
);

842 
	}
}

848 
	$misc_my_fgës
(* 
d°
, 
max
, 
FILE
 * 
ö
)

850 
i
 = 0;

851 
c
;

853 i‡(
max
 <= 0){

858 
c
 = 
	`fgëc
(
ö
);

859 i‡(
c
 =
EOF
) {

860 
d°
[
i
] = 0;

861 i‡(
i
){

867 i‡((
i
 >(
max
 - 1)Ë|| (
c
 < 32)){

868 
d°
[
i
] = 0;

869 (
c
 < 32Ë&& (¯!
EOF
)){

870 
c
 = 
	`fgëc
(
ö
);

872 i‡(
c
 !
EOF
){

873 
	`ungëc
(
c
, 
ö
);

877 
d°
[
i
] = 
c
;

878 
i
++;

880 
	}
}

885 * 
	$misc_£¨ch_«me
(* 
tmp
)

887 
max
, 
i
=0;

889 
max
 = 
	`°æí
(
tmp
);

890 i‡(
max
 < 1)

891  
NULL
;

894 (
i
 < 
max
Ë&& (
tmp
[i] <= 32))

895 
i
++;

896 i‡(
i
 >
max
)

897  
NULL
;

900 (
i
 < 
max
Ë&& (
tmp
[i] > 32))

901 
i
++;

902 i‡(
i
 >
max
)

903  
NULL
;

906 (
i
 < 
max
Ë&& (
tmp
[i] <= 32))

907 
i
++;

908 i‡(
i
 >
max
)

909  
NULL
;

912 (
i
 < 
max
Ë&& (
tmp
[i] > 32))

913 
i
++;

914 i‡(
i
 >
max
)

915  
NULL
;

918 (
i
 < 
max
Ë&& (
tmp
[i] <= 32))

919 
i
++;

920 i‡(
i
 >
max
)

921  
NULL
;

924  & 
tmp
[
i
];

925 
	}
}

930 
	$misc_›í_1_ds1
(
ds1_idx
, * 
«me
, 
ty≥
, 
def
, 
√w_width
, 
√w_height
)

935 
	`DEBUG_MESSAGE
("misc_›í_1_ds1(\"%s\"):ö\n", 
«me
 );

937 
	`ds1_ªad
(
«me
, 
ds1_idx
, 
√w_width
, 
√w_height
);

940 
	`DEBUG_MESSAGE
("searching Dt1Mask...\n");

942 
	`ªad_lvÕª°_txt
(
ds1_idx
, 
def
);

944 
	`DEBUG_MESSAGE
("loading dt1 from mpq...\n");

946 
glb_ds1
[
ds1_idx
].
txt_a˘
 = 
	`ªad_lv…y≥s_txt
(ds1_idx, 
ty≥
);

947 
	`DEBUG_MESSAGE
("txt_a˘ = %i\n", 
glb_ds1
[
ds1_idx
].
txt_a˘
);

950 
	`misc_make_block_èbÀ
(
ds1_idx
);

953 
	`ds1_make_¥›_2_block
(
ds1_idx
);

954 
	`DEBUG_MESSAGE
("misc_›í_1_ds1(\"%s\"):out\n", 
«me
 );

955 
	}
}

960 
	$misc_›í_1_ds1_f‹˚_dt1
(
ds1_idx
)

962 
d
;

963 * 
ds1_«me
 = 
glb_ds1edô
.
cmd_löe
.
ds1_fûíame
;

964 
√w_width
 = 
glb_ds1edô
.
cmd_löe
.
ªsize_width
;

965 
√w_height
 = 
glb_ds1edô
.
cmd_löe
.
ªsize_height
;

966 
ds1edt_fûe
[] = "ds1edit.dt1";

967 
tmp
[150];

971 
	`¥ötf
("\ƒódög ds1 : %s\n", 
ds1_«me
);

972 
	`fÊush
(
°dout
);

973 
	`Ârötf
(
°dîr
, "ªadög %s...", 
ds1_«me
);

974 
	`ds1_ªad
(
ds1_«me
, 
ds1_idx
, 
√w_width
, 
√w_height
);

975 
	`Ârötf
(
°dîr
, "done\n");

978 
	`•rötf
(
tmp
, "%s%s", 
glb_ds1edô_d©a_dú
, 
ds1edt_fûe
);

979 
	`¥ötf
("\nw™àtÿªadá dt1 : %s\n", 
tmp
);

980 
glb_ds1
[
ds1_idx
].
dt1_idx
[0] = 
	`dt1_add_•ecül
(
tmp
);

983 
d
=0; d < 
DT1_IN_DS1_MAX
; d++)

984 
glb_ds1
[
ds1_idx
].
dt1_idx
[
d
 + 1] = -1;

986 
	`¥ötf
("\nloading dt1 from disk...\n");

988 
d
=0; d < 
glb_ds1edô
.
cmd_löe
.
dt1_li°_num
; d++)

990 
	`¥ötf
("\nw™àtÿªadá dt1 : %s\n", 
glb_ds1edô
.
cmd_löe
.
dt1_li°_fûíame
[
d
]);

991 
glb_ds1
[
ds1_idx
].
dt1_idx
[
d
 + 1] = 
	`dt1_add_•ecül
(
glb_ds1edô
.
cmd_löe
.
dt1_li°_fûíame
[d]);

994 
glb_ds1
[
ds1_idx
].
txt_a˘
 = glb_ds1[ds1_idx].
a˘
;

995 
	`¥ötf
("\ndone\n");

998 
	`misc_make_block_èbÀ
(
ds1_idx
);

1001 
	`ds1_make_¥›_2_block
(
ds1_idx
);

1002 
	}
}

1007 
	$misc_›í_£vîÆ_ds1
(* 
fûíame
)

1009 
FILE
 *
ö
;

1010 *
«me
;

1012 
ty≥
;

1013 
def
;

1014 
ªt
;

1015 
tmp
[1000];

1016 
ds1_idx
 = 0;

1018 
ö
 = 
	`f›í
(
fûíame
, "rt");

1019 if(
ö
 =
NULL
){

1020 
	`FATAL_EXIT
("misc_›í_£vîÆ_ds1(), c™'à›í %s", 
fûíame
);

1025 
ªt
 = 
	`misc_my_fgës
(
tmp
, —mp), 
ö
);

1026 
ªt
 != 0){

1028 
	`ssˇnf
(
tmp
, "%ò%i", &
ty≥
, &
def
);

1031 
«me
 = 
	`misc_£¨ch_«me
(
tmp
);

1034 if(
glb_ds1edô
.
cmd_löe
.
dt1_li°_num
 != -1){

1036 
	`misc_›í_1_ds1_f‹˚_dt1
(
ds1_idx
);

1043 
	`misc_›í_1_ds1
(

1044 
ds1_idx
,

1045 
«me
,

1046 
ty≥
,

1047 
def
,

1048 
glb_ds1edô
.
cmd_löe
.
ªsize_width
,

1049 
glb_ds1edô
.
cmd_löe
.
ªsize_height


1053 
ds1_idx
++;

1054 
ªt
 = 
	`misc_my_fgës
(
tmp
, —mp), 
ö
);

1057 
	`f˛o£
(
ö
);

1058 
	}
}

1063 
	$misc_wÆkabÀ_tûe_öfo_pcx
()

1065 
pcx«me
[11][30] = {

1077 
lo›
, 
i
, 
x0
, 
y0
, 
z
;

1078 
w
=0;

1079 
h
=0;

1080 
b
=0;

1081 
BITMAP
 * 
tmpbmp
, * 
subtûe
, * 
subtûe2
;

1082 
tmp
[150];

1086 
	`DEBUG_MESSAGE
("misc_walkable_tile_info_pcx():in\n");

1087 
glb_ds1edô
.
subtûe_hñp
 = 
	`lﬂd_pcx
("./ªs/pcx/°_hñp.pcx", glb_ds1edô.
dummy_∑l
);

1088 i‡(
glb_ds1edô
.
subtûe_hñp
 =
NULL
) {

1089 
	`FATAL_EXIT
("couldÇot open st_help.pcx\n");

1092 
lo›
=0;Üoop<11;Üoop++) {

1093 
tmpbmp
 = 
	`lﬂd_pcx
(
pcx«me
[
lo›
], 
glb_ds1edô
.
dummy_∑l
);

1094 i‡(
tmpbmp
 =
NULL
) {

1095 
	`FATAL_EXIT
("couldÇŸ o≥¿%s\n", 
pcx«me
[
lo›
]);

1097 
i
=0; i<25; i++) {

1098 
subtûe
 = 
	`¸óã_bôm≠
(160, 80);

1099 i‡(
subtûe
 =
NULL
) {

1100 
	`FATAL_EXIT
("couldÇŸ cª©êthê(%ò- %iËbôm≠ ", 
lo›
, 
i
);

1102 
	`˛ór
(
subtûe
);

1103 
x0
 = 64 - ((
i
/5) * 16) + ((i%5) * 16);

1104 
y0
 = ((
i
/5) * 8) + ((i%5) * 8);

1105 
	`døw_•rôe
(
subtûe
, 
tmpbmp
, 
x0
, 
y0
);

1107 i‡(
lo›
 < 9) {

1108 
glb_ds1edô
.
subtûe_Êag
[
lo›
][
ZM_11
][
i
] = 
	`gë_æe_•rôe
(
subtûe
);

1109 } i‡(
lo›
 == 9) {

1110 
glb_ds1edô
.
subtûe_nowÆk
[
ZM_11
][
i
] = 
	`gë_æe_•rôe
(
subtûe
);

1112 
glb_ds1edô
.
subtûe_nojump
[
ZM_11
][
i
] = 
	`gë_æe_•rôe
(
subtûe
);

1115 
z
=0; z<
ZM_MAX
; z++) {

1116 i‡(
z
 =
ZM_11
) {

1119 
z
) {

1120 
ZM_12
 : 
w
 = 160 / 2; 
h
 = 80 / 2; ;

1121 
ZM_14
 : 
w
 = 160 / 4; 
h
 = 80 / 4; ;

1122 
ZM_18
 : 
w
 = 160 / 8; 
h
 = 80 / 8; ;

1123 
ZM_116
 : 
w
 = 160 / 16; 
h
 = 80 / 16; ;

1125 
subtûe2
 = 
	`¸óã_bôm≠
(
w
, 
h
);

1126 
	`˛ór
(
subtûe2
);

1127 i‡(
subtûe2
 =
NULL
) {

1128 
	`FATAL_EXIT
("couldÇŸ cª©êthê(%ò- %iËbôm≠áàzoom %i", 
lo›
, 
i
, 
z
);

1130 
	`°ªtch_blô
(
subtûe
, 
subtûe2
, 0, 0, 160, 80, 0, 0, 
w
, 
h
);

1132 i‡(
lo›
 < 9){

1133 
glb_ds1edô
.
subtûe_Êag
[
lo›
][
z
][
i
] = 
	`gë_æe_•rôe
(
subtûe2
);

1134 } i‡(
lo›
 == 9) {

1135 
glb_ds1edô
.
subtûe_nowÆk
[
z
][
i
] = 
	`gë_æe_•rôe
(
subtûe2
);

1137 
glb_ds1edô
.
subtûe_nojump
[
z
][
i
] = 
	`gë_æe_•rôe
(
subtûe2
);

1140 
	`de°roy_bôm≠
(
subtûe2
);

1142 
	`de°roy_bôm≠
(
subtûe
);

1144 
	`de°roy_bôm≠
(
tmpbmp
);

1148 
	`DEBUG_MESSAGE
("walkableÅile infos combinations\n");

1149 
i
=0; i<25; i++) {

1150 
z
=0; z<
ZM_MAX
; z++) {

1151 
w
 = 
glb_ds1edô
.
subtûe_Êag
[0][
z
][
i
]->w;

1152 
h
 = 
glb_ds1edô
.
subtûe_Êag
[0][
z
][
i
]->h;

1154 
lo›
=0;Üoop<256;Üoop++) {

1155 
subtûe2
 = 
	`¸óã_bôm≠
(
w
, 
h
);

1156 
	`˛ór
(
subtûe2
);

1157 i‡(
subtûe2
 =
NULL
) {

1158 
	`FATAL_EXIT
("couldÇŸ cª©êthê(%ò- %iËbôm≠áàzoom %i", 
lo›
, 
i
, 
z
);

1161 
	`døw_æe_•rôe
(
subtûe2
, 
glb_ds1edô
.
subtûe_Êag
[0][
z
][
i
], 0, 0);

1162 
b
=0; b < 8; b++) {

1163 i‡(
lo›
 & (1 << 
b
)) {

1164 
	`døw_æe_•rôe
–
subtûe2
, 
glb_ds1edô
.
subtûe_Êag
[
b
+1][
z
][
i
], 0, 0);

1168 
glb_ds1edô
.
subtûe_Êag_combö©i⁄
[
lo›
][
z
][
i
] = 
	`gë_æe_•rôe
(
subtûe2
);

1170 
	`de°roy_bôm≠
(
subtûe2
);

1176 
b
=0; b<9; b++) {

1177 
z
=0; z<
ZM_MAX
; z++) {

1178 
i
=0; i<25; i++) {

1179 i‡(
glb_ds1edô
.
subtûe_Êag
[
b
][
z
][
i
] !
NULL
) {

1180 
	`de°roy_æe_•rôe
(
glb_ds1edô
.
subtûe_Êag
[
b
][
z
][
i
]);

1181 
glb_ds1edô
.
subtûe_Êag
[
b
][
z
][
i
] = 
NULL
;

1187 
	`DEBUG_MESSAGE
("misc_walkable_tile_info_pcx():out\n");

1188 
	}
}

1194 
	$misc_£ach_block_‹4
(
ds1_idx
, 
BLOCK_TABLE_S
 * 
bt_±r
, 
b
,

1195 
m
, 
s
)

1199 i‡(
b
 >
glb_ds1
[
ds1_idx
].
bt_num
)

1203 i‡–(
bt_±r
[
b
].
‹õ¡©i⁄
 == 4) &&

1204 (
bt_±r
[
b
].
maö_ödex
 =
m
) &&

1205 (
bt_±r
[
b
].
sub_ödex
 =
s
)

1208  
b
;

1211 
b
++;

1213 
	}
}

1218 
	$misc_£¨ch_wÆk_öfos
(
ds1_idx
, 
x
, 
y
, 
UBYTE
 * 
d°èbÀ
)

1220 
BLOCK_TABLE_S
 * 
bt_±r
;

1221 
CELL_F_S
 * 
f_±r
;

1222 
CELL_W_S
 * 
w_±r
;

1223 
tf
, 
tw
, 
b
, 
f
, 
w
, 
di
, 
bi
, 
i
;

1224 
BLOCK_S
 * 
bh_±r
;

1225 
UBYTE
 * 
u_±r
, 
Æl_Êo‹_¥›s
 = 0;

1228 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1229 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1230 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

1231 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

1234 
i
=0; i<25; i++)

1235 
d°èbÀ
[
i
] = 0;

1236 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

1239 
f
=0; f < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; f++)

1241 
Æl_Êo‹_¥›s
 |
f_±r
[
f
].
¥›1
 | f_±r[f].
¥›2
 |

1242 
f_±r
[
f
].
¥›3
 | f_±r[f].
¥›4
;

1243 i‡(
f_±r
[
f
].
¥›3
 & 0x02)

1246 
i
=0; i<25; i++)

1247 
d°èbÀ
[
i
] |= 1;

1249 
b
 = 
f_±r
[
f
].
bt_idx
;

1250 i‡(
b
 > 0)

1252 
di
 = 
bt_±r
[
b
].
dt1_idx
;

1253 
bi
 = 
bt_±r
[
b
].
block_idx
;

1254 
bh_±r
 = 
glb_dt1
[
di
].
bh_buf„r
;

1255 
u_±r
 = 
bh_±r
[
bi
].
sub_tûes_Êags
;

1258 
i
=0; i<25; i++)

1259 
d°èbÀ
[
i
] |
u_±r
[i];

1264 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_num
 == 1)

1266 i‡(
f_±r
[0].
¥›1
 == 0)

1268 
i
=0; i<25; i++)

1269 
d°èbÀ
[
i
] |= 1;

1272 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_num
 == 2)

1274 i‡((
f_±r
[0].
¥›1
 == 0) && (f_ptr[1].prop1 == 0))

1276 
i
=0; i<25; i++)

1277 
d°èbÀ
[
i
] |= 1;

1282 
w
=0; w < 
glb_ds1
[
ds1_idx
].
wÆl_num
; w++)

1284 i‡(
w_±r
[
w
].
¥›3
 & 0x02)

1287 
i
=0; i<25; i++)

1288 
d°èbÀ
[
i
] |= 1;

1290 
b
 = 
w_±r
[
w
].
bt_idx
;

1291 i‡(
b
 > 0)

1293 
di
 = 
bt_±r
[
b
].
dt1_idx
;

1294 
bi
 = 
bt_±r
[
b
].
block_idx
;

1295 
bh_±r
 = 
glb_dt1
[
di
].
bh_buf„r
;

1296 
u_±r
 = 
bh_±r
[
bi
].
sub_tûes_Êags
;

1299 
i
=0; i<25; i++)

1300 
d°èbÀ
[
i
] |
u_±r
[i];

1303 i‡(
w_±r
[
w
].
‹õ¡©i⁄
 == 3)

1305 
i
 = 
	`misc_£ach_block_‹4
(
ds1_idx
,

1306 
bt_±r
,

1307 
b
,

1308 
bt_±r
[
b
].
maö_ödex
,

1309 
bt_±r
[
b
].
sub_ödex


1311 i‡(
i
 != -1)

1313 
b
 = 
i
;

1314 
di
 = 
bt_±r
[
b
].
dt1_idx
;

1315 
bi
 = 
bt_±r
[
b
].
block_idx
;

1316 
bh_±r
 = 
glb_dt1
[
di
].
bh_buf„r
;

1317 
u_±r
 = 
bh_±r
[
bi
].
sub_tûes_Êags
;

1320 
i
=0; i<25; i++)

1321 
d°èbÀ
[
i
] |
u_±r
[i];

1326 
	}
}

1332 
	$misc_lﬂd_mpq_fûe
(* 
fûíame
, ** 
buf„r
, * 
buf_Àn
, 
ouçut
)

1334 
i
, 
íåy
, 
max
;

1339 
	`°r˝y
(
glb_ds1edô
.
°πmp
, 
fûíame
);

1340 
max
 = 
	`°æí
(
glb_ds1edô
.
°πmp
);

1341 
i
=0; i < 
max
; i++) {

1342 i‡(
glb_ds1edô
.
°πmp
[
i
] == '/')

1343 
glb_ds1edô
.
°πmp
[
i
] = '\\';

1349 
i
=0; i<
MAX_MOD_DIR
; i++) {

1350 
íåy
 = 
	`mod_lﬂd_ö_mem
–
glb_c⁄fig
.
mod_dú
[
i
], 
glb_ds1edô
.
°πmp
, 
buf„r
, 
buf_Àn
 );

1351 i‡(
íåy
 != -1) {

1352 i‡(
ouçut
) {

1353 
	`DEBUG_MESSAGE
("found i¿%s\n", 
glb_c⁄fig
.
mod_dú
[
i
]);

1355  
íåy
;

1360 
i
=0; i<
MAX_MPQ_FILE
; i++) {

1361 i‡(
glb_mpq_°ru˘
[
i
].
is_›í
 !
FALSE
) {

1362 
glb_mpq
 = & 
glb_mpq_°ru˘
[
i
];

1363 
íåy
 = 
	`mpq_b©ch_lﬂd_ö_mem
–
glb_ds1edô
.
°πmp
, 
buf„r
, 
buf_Àn
, 
ouçut
);

1364 i‡(
íåy
 != -1) {

1365 i‡(
ouçut
) {

1366 
	`DEBUG_MESSAGE
("found i¿%s\n", 
glb_c⁄fig
.
mpq_fûe
[
i
]);

1368  
íåy
;

1375 
	}
}

1380 
	$misc_gë_txt_cﬁumn_num
(
RQ_ENUM
 
txt_idx
, * 
cﬁ_«me
)

1382 
i
 = 0;

1383 *
desc
;

1384 
tmp_°r
[256];

1386 
txt_li°
[
RQ_MAX
][80] = {

1393 i‡(
txt_idx
 >
RQ_MAX
){

1399 
desc
 = 
glb_txt_ªq_±r
[
txt_idx
][
i
];

1400 i‡(
desc
 =
NULL
){

1401 
	`FATAL_EXIT
("misc_gë_txt_cﬁumn_num(Ë:\¿ c™'àföd <%s> i¿txàfûê<%i> <%s>\n", 
cﬁ_«me
, 
txt_idx
, 
txt_li°
[txt_idx] );

1403 i‡(
	`°ricmp
(
cﬁ_«me
, 
desc
) == 0){

1404  
i
;

1406 
i
++;

1410 
	}
}

1414 
	$misc_is_numîiˇl
(* 
°r
)

1416 
i
, 
max
 = 
	`°æí
(
°r
);

1418 
i
=0; i < 
max
; i++)

1420 i‡–(
°r
[
i
] == '-') ||

1421 (
°r
[
i
] == '+') ||

1422 (
°r
[
i
] == '.') ||

1423 ((
°r
[
i
] >= '0') && (str[i] <= '9'))

1429  
FALSE
;

1431  
TRUE
;

1432 
	}
}

1437 
	$misc_∂2_c‹ª˘
(
i
)

1440 
UBYTE
 * 
b±r
;

1441 
c
;

1442 
COLOR_MAP
 * 
cm≠
;

1444 
b±r
 = 
glb_ds1edô
.
d2_∑l
[
i
];

1445 
c
=0; c < 256; c++) {

1447 
cm≠
 = (
COLOR_MAP
 *Ë& 
b±r
[
COF_75TRANS
 * 256];

1448 
cm≠
->
d©a
[0][
c
] = c;

1450 
cm≠
 = (
COLOR_MAP
 *Ë& 
b±r
[
COF_50TRANS
 * 256];

1451 
cm≠
->
d©a
[0][
c
] = c;

1453 
cm≠
 = (
COLOR_MAP
 *Ë& 
b±r
[
COF_25TRANS
 * 256];

1454 
cm≠
->
d©a
[0][
c
] = c;

1456 
cm≠
 = (
COLOR_MAP
 *Ë& 
b±r
[
COF_ALPHA
 * 256];

1457 
cm≠
->
d©a
[0][
c
] = c;

1459 
cm≠
 = (
COLOR_MAP
 *Ë& 
b±r
[
COF_LUMINANCE
 * 256];

1460 
cm≠
->
d©a
[0][
c
] = c;

1462 
cm≠
 = (
COLOR_MAP
 *Ë& 
b±r
[
COF_ALPHABRIGHT
 * 256];

1463 
cm≠
->
d©a
[0][
c
] = c;

1465 
	}
}

1471 
	$misc_cmd_löe_∑r£
(
¨gc
, ** 
¨gv
)

1473 
i
 = 0;

1474 
f‹˚_dt1_¥e£¡
 = 
FALSE
;

1475 * 
ext
 = 
NULL
;

1476 
n
 = 0;

1477 
lv…y≥_id_found
 = 0;

1478 
lvÕª°_def_found
 = 0;

1482 
i
=1; i < 
¨gc
; i++) {

1483 i‡(
	`°ricmp
(
¨gv
[
i
], "-force_dt1") == 0) {

1484 
f‹˚_dt1_¥e£¡
 = 
TRUE
;

1490 
i
=1; i < 
¨gc
; i++) {

1491 i‡(
i
 == 1) {

1493 
ext
 = 
	`gë_exãnsi⁄
(
¨gv
[
i
]);

1494 i‡(
	`°ricmp
(
ext
, "ini") == 0) {

1495 
glb_ds1edô
.
cmd_löe
.
öi_fûíame
 = 
¨gv
[
i
];

1496 } i‡(
	`°ricmp
(
ext
, "ds1") == 0) {

1497 
glb_ds1edô
.
cmd_löe
.
ds1_fûíame
 = 
¨gv
[
i
];

1499 
	`WARNING_MESSAGE
("the firstárgument must beá .ini orá .ds1 file\n");

1500 
	`WARNING_MESSAGE
("cuºíàexãnsi⁄ = \"%s\")\n", 
ext
);

1503 } i‡(
	`°ricmp
(
¨gv
[
i
], "-debug") == 0) {

1505 
glb_ds1edô
.
cmd_löe
.
debug_mode
 = 
TRUE
;

1506 } i‡(
	`°ricmp
(
¨gv
[
i
], "-no_vis_debug") == 0) {

1508 
glb_ds1edô
.
cmd_löe
.
no_vis_debug
 = 
TRUE
;

1509 } i‡(
	`°ricmp
(
¨gv
[
i
], "-force_dt1") == 0) {

1511 
i
++;

1512 
n
=0; ((
i
 +ÇË< 
¨gc
Ë&& (
	`°ricmp
(
	`gë_exãnsi⁄
(
¨gv
[i +Ç]), "dt1") == 0);Ç++) {

1514 i‡((
n
 < 1Ë|| (¿> 
DT1_IN_DS1_MAX
)) {

1515 
	`¥ötf
("misc_cmd_löe_∑r£(),Éº‹ :Åhîêmu° bêbëwì¿1ánd %ò.DT1 fûe†fﬁowögÅhê-f‹˚_dt1Ö¨amëî\n", 
DT1_IN_DS1_MAX
);

1518 
glb_ds1edô
.
cmd_löe
.
dt1_li°_num
 = 
n
;

1519 
n
=0;Ç < 
glb_ds1edô
.
cmd_löe
.
dt1_li°_num
;Ç++)

1520 
glb_ds1edô
.
cmd_löe
.
dt1_li°_fûíame
[
n
] = 
¨gv
[
i
 +Ç];

1521 
i
 +(
n
 - 1);

1522 } i‡(
	`°ricmp
(
¨gv
[
i
], "-resize") == 0) {

1524 
i
++;

1525 i‡(
i
 >
¨gc
)

1527 
	`¥ötf
("misc_cmd_line_parse(),Érror :Åhe -resizeÖarameter should be folowed by widthánd height values\n");

1530 i‡(
	`misc_is_numîiˇl
(
¨gv
[
i
]))

1531 
glb_ds1edô
.
cmd_löe
.
ªsize_width
 = 
	`©oi
(
¨gv
[
i
]);

1534 
	`¥ötf
("misc_cmd_line_parse(),Érror :Åhe width value folowingÅhe -resizeÖarameter isÇotáÇumerical value\n");

1538 
i
++;

1539 i‡(
i
 >
¨gc
)

1541 
	`¥ötf
("misc_cmd_line_parse(),Érror :Åhe -resizeÖarameter is folowed by justá width value,Åhe height value is missing\n");

1544 i‡(
	`misc_is_numîiˇl
(
¨gv
[
i
]))

1545 
glb_ds1edô
.
cmd_löe
.
ªsize_height
 = 
	`©oi
(
¨gv
[
i
]);

1548 
	`¥ötf
("misc_cmd_line_parse(),Érror :Åhe height value folowingÅhe -resizeÖarameter isÇotáÇumerical value\n");

1552 i‡(
	`°ricmp
(
¨gv
[
i
], "-force_pal") == 0)

1555 
i
++;

1556 i‡(
i
 >
¨gc
)

1558 
	`¥ötf
("misc_cmd_line_parse(),Érror :ÅheÖarameter -force_pal should be folowed byánáct value\n");

1561 i‡(
	`misc_is_numîiˇl
(
¨gv
[
i
]))

1563 
n
 = 
	`©oi
(
¨gv
[
i
]);

1564 i‡((
n
 < 1) || (n > 5))

1566 
	`¥ötf
("misc_cmd_line_parse(),Érror :Åheáct value folowingÅhe -force_palÖarameter must be between 1ánd 5\n");

1569 
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 = 
n
;

1573 
	`¥ötf
("misc_cmd_line_parse(),Érror :Åheáct value folowingÅhe -force_palÖarameter isÇotáÇumerical value\n");

1577 i‡(
	`°ricmp
(
¨gv
[
i
], "-no_check_act") == 0)

1580 
glb_ds1edô
.
cmd_löe
.
no_check_a˘
 = 
TRUE
;

1582 i‡((
f‹˚_dt1_¥e£¡
 =
FALSE
Ë&& (
glb_ds1edô
.
cmd_löe
.
ds1_fûíame
 !
NULL
))

1584 i‡–! 
lv…y≥_id_found
)

1587 
lv…y≥_id_found
 = 1;

1588 i‡(
	`misc_is_numîiˇl
(
¨gv
[
i
]))

1589 
glb_ds1edô
.
cmd_löe
.
lv…y≥_id
 = 
	`©oi
(
¨gv
[
i
]);

1592 
	`¥ötf
("misc_cmd_line_parse(),Érror :Åhe LvlType.txt ID value isÇotáÇumerical value\n");

1596 i‡–! 
lvÕª°_def_found
)

1599 
lvÕª°_def_found
 = 1;

1600 i‡(
	`misc_is_numîiˇl
(
¨gv
[
i
]))

1601 
glb_ds1edô
.
cmd_löe
.
lvÕª°_def
 = 
	`©oi
(
¨gv
[
i
]);

1604 
	`¥ötf
("misc_cmd_line_parse(),Érror :Åhe LvlPrest.txt DEF value isÇotáÇumerical value\n");

1610 
	`¥ötf
("misc_cmd_löe_∑r£(),Éº‹ : u√x≥˘ed \"%s\"Ö¨amëî\n", 
¨gv
[
i
]);

1617 
	}
}

1621 
	$misc_døw_s¸ìn
(
mx
, 
my
)

1623 
BITMAP
 * 
video_bmp
 = 
glb_ds1edô
.
video_∑ge
[glb_ds1edô.
video_∑ge_num
];

1624 
BITMAP
 * 
mou£_•rôe
 = 
glb_ds1edô
.
mou£_curs‹
[glb_ds1edô.
mode
];

1627 
	`blô
–
glb_ds1edô
.
s¸ìn_buff
, 
video_bmp
, 0, 0, 0, 0, 
glb_c⁄fig
.
s¸ìn
.
width
, glb_c⁄fig.s¸ìn.
height
);

1628 
	`døw_•rôe
(
video_bmp
, 
mou£_•rôe
, 
mx
, 
my
);

1629 
	`show_video_bôm≠
(
video_bmp
);

1630 
glb_ds1edô
.
video_∑ge_num
 = (glb_ds1edit.video_page_num + 1) % 2;

1631 
	}
}

1637 
	$misc_ö¸ó£_ds1_obje˘s_max
(
ds1_idx
, 
nb_obje˘s
)

1639 
ﬁd_max
;

1640 
√w_max
;

1641 * 
√w_buf„r
;

1642 
ﬁd_size
;

1643 
√w_size
;

1644 
nb_gøn
;

1647 i‡(
nb_obje˘s
 < 0)

1650 
nb_gøn
 = 1 + (
nb_obje˘s
 / 
OBJ_MAX_GRANULARITY
);

1651 
ﬁd_max
 = 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
;

1652 
√w_max
 = 
ﬁd_max
 + (
nb_gøn
 * 
OBJ_MAX_GRANULARITY
);

1655 
ﬁd_size
 = 
ﬁd_max
 * ();

1656 
√w_size
 = 
√w_max
 * ();

1657 
√w_buf„r
 = (*Ë
	`mÆloc
(
√w_size
);

1658 i‡(
√w_buf„r
 =
NULL
)

1660 
	`mem£t
(
√w_buf„r
, 0x00, 
√w_size
);

1661 
	`mem˝y
(
√w_buf„r
, 
glb_ds1
[
ds1_idx
].
døwög_‹dî
, 
ﬁd_size
);

1662 
	`‰ì
(
glb_ds1
[
ds1_idx
].
døwög_‹dî
);

1663 
glb_ds1
[
ds1_idx
].
døwög_‹dî
 = (*Ë
√w_buf„r
;

1666 
ﬁd_size
 = 
ﬁd_max
 * (
OBJ_S
);

1667 
√w_size
 = 
√w_max
 * (
OBJ_S
);

1668 
√w_buf„r
 = (
OBJ_S
 *Ë
	`mÆloc
(
√w_size
);

1669 i‡(
√w_buf„r
 =
NULL
)

1672 
	`mem£t
(
√w_buf„r
, 0x00, 
√w_size
);

1673 
	`mem˝y
(
√w_buf„r
, 
glb_ds1
[
ds1_idx
].
obj
, 
ﬁd_size
);

1674 
	`‰ì
(
glb_ds1
[
ds1_idx
].
obj
);

1675 
glb_ds1
[
ds1_idx
].
obj
 = (
OBJ_S
 *Ë
√w_buf„r
;

1678 
ﬁd_size
 = 
ﬁd_max
 * (
OBJ_S
);

1679 
√w_size
 = 
√w_max
 * (
OBJ_S
);

1680 
√w_buf„r
 = (
OBJ_S
 *Ë
	`mÆloc
(
√w_size
);

1681 i‡(
√w_buf„r
 =
NULL
)

1683 
	`mem£t
(
√w_buf„r
, 0x00, 
√w_size
);

1684 
	`mem˝y
(
√w_buf„r
, 
glb_ds1
[
ds1_idx
].
obj_undo
, 
ﬁd_size
);

1685 
	`‰ì
(
glb_ds1
[
ds1_idx
].
obj_undo
);

1686 
glb_ds1
[
ds1_idx
].
obj_undo
 = (
OBJ_S
 *Ë
√w_buf„r
;

1688 
glb_ds1
[
ds1_idx
].
cuºít_obj_max
 = 
√w_max
;

1690 
	}
}

	@misc.h

1 #i‚de‡
_MISC_H_


3 
	#_MISC_H_


	)

5 
misc_∑l_d2_2_vga
 (
∑l_idx
);

6 
misc_qs‹t_hñ≥r_block_èbÀ_1
 (c⁄° * 
e1
, c⁄° * 
e2
);

7 
misc_qs‹t_hñ≥r_block_èbÀ_2
 (c⁄° * 
e1
, c⁄° * 
e2
);

8 
misc_check_tûes_c⁄Êi˘s
 (
ds1_idx
);

9 
misc_make_block_èbÀ
 (
ds1_idx
);

10 
misc_ªad_gamma
 ();

11 
misc_upd©e_∑l_wôh_gamma
 ();

12 
misc_pcx_put_d2_∑Àâe
 (* 
«me
, 
∑l_idx
);

13 
misc_make_cm≠s_hñ≥r
 (c⁄° 
PALETTE
 
∑l
, 
x
, 
y
, 
RGB
 * 
rgb
);

14 
misc_make_cm≠s
 ();

15 
misc_lﬂd_∑l_‰om_disk
 (
∑l_idx
);

16 
misc_ßve_∑l_⁄_disk
 (
∑l_idx
, 
UBYTE
 * 
d2_∑l_±r
);

17 
misc_my_fgës
 (* 
d°
, 
max
, 
FILE
 * 
ö
);

18 * 
misc_£¨ch_«me
 (* 
tmp
);

19 
misc_›í_1_ds1
 (
ds1_idx
, * 
«me
, 
ty≥
, 
def
, 
√w_width
, 
√w_height
);

20 
misc_›í_£vîÆ_ds1
 (* 
fûíame
);

21 
misc_wÆkabÀ_tûe_öfo_pcx
 ();

22 
misc_£ach_block_‹4
 (
ds1_idx
, 
BLOCK_TABLE_S
 * 
bt_±r
, 
b
, 
m
, 
s
);

23 
misc_£¨ch_wÆk_öfos
 (
ds1_idx
, 
x
, 
y
, 
UBYTE
 * 
d°èbÀ
);

24 
misc_lﬂd_mpq_fûe
 (* 
fûíame
, ** 
buf„r
, * 
buf_Àn
, 
ouçut
);

25 
misc_gë_txt_cﬁumn_num
 (
RQ_ENUM
 
txt_idx
, * 
cﬁ_«me
);

26 
misc_›í_1_ds1_f‹˚_dt1
 (
ds1_idx
);

27 
misc_∂2_c‹ª˘
 (
i
);

28 
misc_cmd_löe_∑r£
 (
¨gc
, ** 
¨gv
);

35 
misc_døw_s¸ìn
 (
mx
, 
my
);

36 
misc_ö¸ó£_ds1_obje˘s_max
 (
ds1_idx
, 
nb_obje˘s
);

	@mpq/dcl_tbl.c

3 
	~"d˛ib.h
"

5 c⁄° 
UI¡8
 
	gd˛_èbÀ
[] =

	@mpq/dclib.h

3 
	~"mpqty≥s.h
"

5 
	#CMP_BUFFER_SIZE
 36312L

	)

6 
	#EXP_BUFFER_SIZE
 12596L

	)

7 
	#CMP_BINARY
 0

	)

8 
	#CMP_ASCII
 1

	)

9 
	#DICT_SIZE_1
 1024

	)

10 
	#DICT_SIZE_2
 2048

	)

11 
	#DICT_SIZE_4
 4096

	)

13 
	#DCL_NO_ERROR
 0L

	)

14 
	#DCL_ERROR_1
 1L

	)

15 
	#DCL_ERROR_2
 2L

	)

16 
	#DCL_ERROR_3
 3L

	)

17 
	#DCL_ERROR_4
 4L

	)

19 
UI¡16
 
	tªad_d©a_¥oc
 (
	tUI¡8
 * 
	tbuf„r
, 
	tUI¡16
 
	tsize
, * 
	t∑øm
);

20 
	twrôe_d©a_¥oc
 (
	tUI¡8
 * 
	tbuf„r
, 
	tUI¡16
 
	tsize
, * 
	t∑øm
);

22 c⁄° 
UI¡8
 
d˛_èbÀ
[];

24 
UI¡32
 
im∂ode
 (
ªad_d©a_¥oc
 
ªad_d©a
,

25 
wrôe_d©a_¥oc
 
wrôe_d©a
,

26 
UI¡8
 * 
w‹k_buff
,

27 * 
∑øm
,

28 
UI¡16
 
ty≥
,

29 
UI¡16
 
size
);

31 
UI¡32
 
ex∂ode
 (
ªad_d©a_¥oc
 
ªad_d©a
,

32 
wrôe_d©a_¥oc
 
wrôe_d©a
,

33 * 
∑øm
);

35 
UI¡32
 
¸c32
 (
UI¡8
 * 
buf„r
,

36 
UI¡32
 
size
,

37 
UI¡32
 
ﬁd_¸c
);

	@mpq/explode.c

1 #ifde‡
WIN32


2 #¥agm®
w¨nög
 (
push
)

3 #¥agm®
w¨nög
 (
dißbÀ
 : 4244 4306 4311 4312 )

8 
	~<°dio.h
>

9 
	~"d˛ib.h
"

11 
UI¡16
 
__ex∂ode_1
 (
UI¡8
 *
buf
);

12 
UI¡16
 
__ex∂ode_2
 (
UI¡8
 *
buf
);

13 
UI¡16
 
__ex∂ode_3
 (
UI¡8
 *
buf
, UI¡16 
ªsu…
);

14 
UI¡16
 
__ex∂ode_4
 (
UI¡8
 *
buf
, 
UI¡32
 
Êag
);

15 
__ex∂ode_5
 (
UI¡16
 
cou¡
, 
UI¡8
 *
buf_1
, c⁄° UI¡8 *
èbÀ
, UI¡8 *
buf_2
);

16 
__ex∂ode_6
 (
UI¡8
 *
buf
, c⁄° UI¡8 *
èbÀ
);

17 
__ex∂ode_7
 (
UI¡8
 *
buf
, c⁄° UI¡8 *
èbÀ
, 
UI¡32
 
cou¡
);

23 
UI¡32
 
	$ex∂ode
(
ªad_d©a_¥oc
 
ªad_d©a
, 
wrôe_d©a_¥oc
 
wrôe_d©a
, * 
∑øm
)

25 
UI¡32
 
ªsu…
;

26 
UI¡16
 
ªad_ªsu…
;

27 c⁄° 
UI¡8
 * 
èbÀ
 = 
d˛_èbÀ
;

28 
UI¡8
 * 
w‹k_buff
;

32 
w‹k_buff
 = (
UI¡8
 *Ë
glb_mpq
->
ex∂ode_buf„r
;

34 *((
UI¡32
 *Ë(
w‹k_buff
 + 0x16)Ë(UI¡32Ë
ªad_d©a
;

35 *((
UI¡32
 *Ë(
w‹k_buff
 + 0x1A)Ë(UI¡32Ë
wrôe_d©a
;

36 *((**Ë(
w‹k_buff
 + 0x12)Ë
∑øm
;

37 *((
UI¡16
 *Ë(
w‹k_buff
 + 0x0E)) = 0x0800;

38 
ªad_ªsu…
 = 
	`ªad_d©a
(
w‹k_buff
 + 0x2222, 0x0800, 
∑øm
);

39 i‡(
ªad_ªsu…
 =
DCL_ERROR_4
)

41 
ªsu…
 = 
DCL_ERROR_3
;

45 
UI¡16
 
Êag_0
 = *(
w‹k_buff
 + 0x2222),

46 
Êag_1
 = *(
w‹k_buff
 + 0x2223),

47 
Êag_2
 = *(
w‹k_buff
 + 0x2224);

49 *((
UI¡16
 *Ë(
w‹k_buff
 + 0x02)Ë
Êag_0
;

50 *((
UI¡16
 *Ë(
w‹k_buff
 + 0x06)Ë
Êag_1
;

51 *((
UI¡16
 *Ë(
w‹k_buff
 + 0x0A)Ë
Êag_2
;

52 *((
UI¡16
 *Ë(
w‹k_buff
 + 0x0C)) = 0x00;

53 *((
UI¡16
 *Ë(
w‹k_buff
 + 0x0E)) = 0x03;

54 *((
UI¡16
 *Ë(
w‹k_buff
 + 0x10)Ë
ªad_ªsu…
;

55 i‡((
Êag_1
 < 0x04) || (flag_1 > 0x06))

57 
ªsu…
 = 
DCL_ERROR_1
;

61 *((
UI¡16
 *Ë(
w‹k_buff
 + 0x08)Ë(UI¡16Ë(0x0000FFFFL >> (0x0010 - 
Êag_1
));

62 i‡(
Êag_0
 > 0x01)

64 
ªsu…
 = 
DCL_ERROR_2
;

68 i‡(
Êag_0
)

70 
	`__ex∂ode_7
(
w‹k_buff
 + 0x2FA2, 
èbÀ
 + 0x00D0, 0x0100);

71 
	`__ex∂ode_6
(
w‹k_buff
, 
èbÀ
 + 0x01D0);

73 
	`__ex∂ode_7
(
w‹k_buff
 + 0x30E2, 
èbÀ
 + 0x00B0, 0x0010);

74 
	`__ex∂ode_5
(0x0010, 
w‹k_buff
 + 0x30E2, 
èbÀ
 + 0x00C0, work_buff + 0x2B22);

75 
	`__ex∂ode_7
(
w‹k_buff
 + 0x30F2, 
èbÀ
 + 0x0080, 0x0010);

76 
	`__ex∂ode_7
(
w‹k_buff
 + 0x3102, 
èbÀ
 + 0x0090, 0x0020);

77 
	`__ex∂ode_7
(
w‹k_buff
 + 0x30A2, 
èbÀ
, 0x0040);

78 
	`__ex∂ode_5
(0x0040, 
w‹k_buff
 + 0x30A2, 
èbÀ
 + 0x0040, work_buff + 0x2A22);

79 i‡(
	`__ex∂ode_1
(
w‹k_buff
) != 0x0306)

81 
ªsu…
 = 
DCL_NO_ERROR
;

85 
ªsu…
 = 
DCL_ERROR_4
;

91  
ªsu…
;

92 
	}
}

96 
UI¡16
 
	$__ex∂ode_1
(
UI¡8
 *
buf
)

98 
UI¡32
 
ªsu…
, 
ãmp
;

99 
UI¡8
 *
s
, *
d
;

100 
wrôe_d©a_¥oc
 *
wrôe_d©a
;

101 *
∑øm
;

103 *((
UI¡16
 *Ë(
buf
 + 0x04)) = 0x1000;

104 
ªsu…
 = 
	`__ex∂ode_2
(
buf
), (
UI¡16
)Ñesult < 0x0305)

106 i‡((
UI¡16
Ë
ªsu…
 < 0x0100)

108 
ãmp
 = *((
UI¡16
 *Ë(
buf
 + 0x04));

109 *((
UI¡16
 *Ë(
buf
 + 0x04)Ë(UI¡16Ë(
ãmp
 + 0x01);

110 *(
buf
 + 
ãmp
 + 0x1EË=(
UI¡8
Ë
ªsu…
;

114 
ªsu…
 -= 0x00FE;

115 
s
 = (
UI¡8
 *Ë
	`__ex∂ode_3
(
buf
, (
UI¡16
)
ªsu…
);

116 i‡(!
s
)

118 
ªsu…
 = 0x0306;

123 
ãmp
 = *((
UI¡16
 *Ë(
buf
 + 0x04));

124 
d
 = 
ãmp
 + 0x1E + 
buf
;

125 *((
UI¡16
 *Ë(
buf
 + 0x04)Ë=(UI¡16Ë(
ãmp
 + 
ªsu…
);

126 
s
 = (
UI¡8
 *)((
UI¡32
)
d
 - (UInt32)s);

129 
ªsu…
--;

130 *(
d
++Ë*(
s
++);

131 } 
ªsu…
);

134 i‡(*((
UI¡16
 *Ë(
buf
 + 4)) >= 0x2000)

136 
ªsu…
 = 0x1000;

137 
wrôe_d©a
 = (
wrôe_d©a_¥oc
 *Ë*((
UI¡32
 *Ë(
buf
 + 0x1A));

138 
∑øm
 = (*Ë*((
UI¡32
 *Ë(
buf
 + 0x12));

139 
	`wrôe_d©a
(
buf
 + 0x101E, 0x1000, 
∑øm
);

140 
	`__ex∂ode_7
(
buf
 + 0x001E, bu‡+ 0x101E, *((
UI¡16
 *) (buf + 0x04)) - 0x1000);

141 *((
UI¡16
 *Ë(
buf
 + 0x04)) -= 0x1000;

144 
wrôe_d©a
 = (
wrôe_d©a_¥oc
 *Ë*((
UI¡32
 *Ë(
buf
 + 0x1A));

145 
∑øm
 = (*Ë*((
UI¡32
 *Ë(
buf
 + 0x12));

146 
	`wrôe_d©a
(
buf
 + 0x101E, (
UI¡16
)(*((UI¡16 *Ë(bu‡+ 0x04)Ë- 0x1000), 
∑øm
);

147  (
UI¡16
Ë
ªsu…
;

148 
	}
}

152 
UI¡16
 
	$__ex∂ode_2
(
UI¡8
 *
buf
)

154 
UI¡32
 
ªsu…
, 
Êag
, 
Êag_1
;

156 i‡(*((
UI¡16
 *Ë(
buf
 + 0x0A)) & 0x01)

158 i‡(
	`__ex∂ode_4
(
buf
, 0x01))  0x0306;

159 
ªsu…
 = *(
buf
 + ((
UI¡8
Ë*((
UI¡16
 *) (buf + 0x0A))) + 0x2B22);

160 i‡(
	`__ex∂ode_4
(
buf
, *(bu‡+ ((
UI¡16
Ë
ªsu…
) + 0x30E2)))  0x0306;

161 
Êag
 = *(
buf
 + ((
UI¡16
Ë
ªsu…
) + 0x30F2);

162 i‡(
Êag
)

164 
Êag_1
 = (*((
UI¡16
 *Ë(
buf
 + 0x0A))Ë& ((0x01 << 
Êag
) - 0x01);

165 i‡(
	`__ex∂ode_4
(
buf
, 
Êag
))

167 i‡((((
UI¡16
Ë
ªsu…
Ë+ ((UI¡16Ë
Êag_1
)) != 0x010E)  0x0306;

169 
ªsu…
 = *((
UI¡16
 *Ë(
buf
 + (((UI¡16Ëªsu…Ë<< 0x01Ë+ 0x3102)Ë+ 
Êag_1
;

171 
ªsu…
 += 0x0100;

175 i‡(
	`__ex∂ode_4
(
buf
, 0x01))  0x0306;

176 i‡(!*((
UI¡16
 *Ë(
buf
 + 0x02)))

178 
ªsu…
 = (
UI¡8
Ë*((
UI¡16
 *Ë(
buf
 + 0x0A));

179 i‡(
	`__ex∂ode_4
(
buf
, 0x08))  0x0306;

183 
Êag
 = *((
UI¡16
 *Ë(
buf
 + 0x0A));

184 i‡((
UI¡8
Ë
Êag
)

186 
ªsu…
 = *(
buf
 + ((
UI¡8
Ë
Êag
) + 0x2C22);

187 i‡(((
UI¡16
Ë
ªsu…
) == 0x00FF)

189 i‡(
Êag
 & 0x003F)

191 i‡(
	`__ex∂ode_4
(
buf
, 0x04))  0x0306;

192 
ªsu…
 = *(
buf
 + ((
UI¡8
Ë*((
UI¡16
 *) (buf + 0x0A))) + 0x2D22);

196 i‡(
	`__ex∂ode_4
(
buf
, 0x06))  0x0306;

197 
ªsu…
 = *(
buf
 + ((*((
UI¡16
 *) (buf + 0x0A))) & 0x007F) + 0x2E22);

203 i‡(
	`__ex∂ode_4
(
buf
, 0x08))  0x0306;

204 
ªsu…
 = *(
buf
 + ((
UI¡8
Ë*((
UI¡16
 *) (buf + 0x0A))) + 0x2EA2);

206 
Êag
 = *(
buf
 + ((
UI¡16
Ë
ªsu…
) + 0x2FA2);

207 i‡(
	`__ex∂ode_4
(
buf
, 
Êag
))  0x0306;

210  (
UI¡16
)
ªsu…
;

211 
	}
}

215 
UI¡16
 
	$__ex∂ode_3
(
UI¡8
 *
buf
, 
UI¡16
 
Êag
)

217 
UI¡32
 
ªsu…
, 
Êag_1
;

219 
ªsu…
 = *(
buf
 + ((
UI¡8
Ë*((
UI¡16
 *) (buf + 0x0A))) + 0x2A22);

220 i‡(
	`__ex∂ode_4
(
buf
, *(bu‡+ ((
UI¡16
Ë
ªsu…
) + 0x30A2)))  0x00;

221 i‡(((
UI¡16
Ë
Êag
) == 0x02)

223 
ªsu…
 <<= 0x02;

224 
ªsu…
 |*((
UI¡16
 *Ë(
buf
 + 0x0A)) & 0x03;

225 i‡(
	`__ex∂ode_4
(
buf
, 0x02))  0x00;

229 
Êag_1
 = *((
UI¡16
 *Ë(
buf
 + 0x06));

230 
ªsu…
 <<
Êag_1
;

231 
ªsu…
 |*((
UI¡16
 *Ë(
buf
 + 0x08)) & *((UInt16 *) (buf + 0x0A));

232 i‡(
	`__ex∂ode_4
(
buf
, 
Êag_1
))  0x00;

234  (
UI¡16
Ë(
ªsu…
 + 0x01);

235 
	}
}

239 
UI¡16
 
	$__ex∂ode_4
(
UI¡8
 *
buf
, 
UI¡32
 
Êag
)

241 
UI¡32
 
ªsu…
;

242 
UI¡16
 
ªad_ªsu…
;

243 
ªad_d©a_¥oc
 *
ªad_d©a
 = (ªad_d©a_¥o¯*Ë*((
UI¡32
 *Ë(
buf
 + 0x16));

244 *
∑øm
 = (*Ë*((
UI¡32
 *Ë(
buf
 + 0x12));

246 
ªsu…
 = *((
UI¡16
 *Ë(
buf
 + 0x0C));

247 i‡((
UI¡16
Ë
Êag
 <
ªsu…
)

249 *((
UI¡16
 *Ë(
buf
 + 0x0A)Ë>>
Êag
;

250 *((
UI¡16
 *Ë(
buf
 + 0x0C)Ë-(UI¡16)
Êag
;

251 
ªsu…
 = 0x00;

255 *((
UI¡16
 *Ë(
buf
 + 0x0A)Ë>>
ªsu…
;

256 
ªsu…
 = *((
UI¡16
 *Ë(
buf
 + 0x0E));

257 i‡(
ªsu…
 =*((
UI¡16
 *Ë(
buf
 + 0x10)))

259 *((
UI¡16
 *Ë(
buf
 + 0x0E)) = 0x0800;

260 
ªad_ªsu…
 = 
	`ªad_d©a
(
buf
 + 0x2222, 0x0800, 
∑øm
);

261 *((
UI¡16
 *Ë(
buf
 + 0x10)Ë
ªad_ªsu…
;

262 i‡(!
ªad_ªsu…
)  0x01;

263 *((
UI¡16
 *Ë(
buf
 + 0x0E)) = 0x00;

265 
ªsu…
 = *((
UI¡16
 *Ë(
buf
 + 0x0E)) + 0x2222;

266 *((
UI¡16
 *Ë(
buf
 + 0x0A)Ë|*(bu‡+ 
ªsu…
) << 0x08;

267 *((
UI¡16
 *Ë(
buf
 + 0x0E)) += 0x01;

268 *((
UI¡16
 *Ë(
buf
 + 0x0A)Ë>>
Êag
 - *((UInt16 *) (buf + 0x0C));

269 *((
UI¡16
 *Ë(
buf
 + 0x0C)Ë(UI¡16)(0x08 - (
Êag
 - *((UInt16 *) (buf + 0x0C))));

270 
ªsu…
 = 0x00;

272  (
UI¡16
Ë
ªsu…
;

273 
	}
}

277 
	$__ex∂ode_5
(
UI¡16
 
cou¡
, 
UI¡8
 *
buf_1
, c⁄° UI¡8 *
èbÀ
, UI¡8 *
buf_2
)

279 
SI¡16
 
i
 = (SI¡16)(
cou¡
 - 1);

280 
UI¡32
 
idx_1
, 
idx_2
;

282 ; 
i
 >= 0; i--)

284 
idx_1
 = *(
èbÀ
 + 
i
);

285 
idx_2
 = 0x01 << *(
buf_1
 + 
i
);

288 *(
buf_2
 + (
UI¡16
Ë
idx_1
Ë(
UI¡8
Ë
i
;

289 
idx_1
 +
idx_2
;

290 i‡((
UI¡16
Ë
idx_1
 >= 0x0100) ;

293 
	}
}

297 
	$__ex∂ode_6
(
UI¡8
 *
buf
, c⁄° UI¡8 *
èbÀ
)

299 
SI¡16
 
i
;

300 
UI¡32
 
idx_1
, 
idx_2
;

302 
i
 = 0x00FF; i >= 0; i--)

304 
idx_1
 = *(
buf
 + 
i
 + 0x2FA2);

305 i‡(
idx_1
 <= 0x08 )

307 
idx_2
 = *((
UI¡16
 *Ë(
èbÀ
 + (
i
 << 0x01)));

308 
idx_1
 = 0x01 << idx_1;

311 *(
buf
 + 
idx_2
 + 0x2C22Ë=(
UI¡8
Ë
i
;

312 
idx_2
 +
idx_1
;

313 } (
UI¡16
Ë
idx_2
 < 0x0100);

317 
idx_2
 = *((
UI¡16
 *Ë(
èbÀ
 + (
i
 << 0x01)));

318 i‡((
UI¡8
Ë
idx_2
)

321 *(
buf
 + (
UI¡8
Ë
idx_2
 + 0x2C22) = 0xFF;

322 i‡(*((
UI¡16
 *Ë(
èbÀ
 + (
i
 << 0x01))) & 0x003F)

324 *(
buf
 + 
i
 + 0x2FA2) -= 0x04;

325 
idx_1
 = 0x01 << *(
buf
 + 
i
 + 0x2FA2);

326 
idx_2
 = *((
UI¡16
 *Ë(
èbÀ
 + (
i
 << 0x01))) >> 0x04;

329 *(
buf
 + 
idx_2
 + 0x2D22Ë=(
UI¡8
Ë
i
;

330 
idx_2
 +
idx_1
;

331 } (
UI¡16
Ë
idx_2
 < 0x0100);

335 *(
buf
 + 
i
 + 0x2FA2) -= 0x06;

336 
idx_1
 = 0x01 << *(
buf
 + 
i
 + 0x2FA2);

337 
idx_2
 = *((
UI¡16
 *Ë(
èbÀ
 + (
i
 << 0x01))) >> 0x06;

340 *(
buf
 + 
idx_2
 + 0x2E22Ë(
UI¡8
)
i
;

341 
idx_2
 +
idx_1
;

342 } (
UI¡16
Ë
idx_2
 < 0x0080);

347 *(
buf
 + 
i
 + 0x2FA2) -= 0x08;

348 
idx_1
 = 0x01 << *(
buf
 + 
i
 + 0x2FA2);

349 
idx_2
 = *((
UI¡16
 *Ë(
èbÀ
 + (
i
 << 0x01))) >> 0x08;

352 *(
buf
 + 
idx_2
 + 0x2EA2Ë(
UI¡8
)
i
;

353 
idx_2
 +
idx_1
;

354 } (
UI¡16
Ë
idx_2
 < 0x0100);

358 
	}
}

362 
	$__ex∂ode_7
(
UI¡8
 *
buf
, c⁄° UI¡8 *
èbÀ
, 
UI¡32
 
cou¡
)

364 
UI¡32
 
hÆf_cou¡
 = 
cou¡
 >> 0x02;

365 
UI¡8
 *
buf_íd
;

367 i‡(
hÆf_cou¡
)

369 
buf_íd
 = 
buf
 + (
hÆf_cou¡
 << 0x02);

372 *((
UI¡32
 *Ë
buf
Ë*((UI¡32 *Ë
èbÀ
);

373 
buf
 += 4;

374 
èbÀ
 += 4;

375 } 
buf
 < 
buf_íd
);

377 
cou¡
 - (
hÆf_cou¡
 << 0x02))

380 *(
buf
++Ë*(
èbÀ
++);

383 *(
buf
++Ë*(
èbÀ
++);

386 *
buf
 = *
èbÀ
;

391 
	}
}

393 #ifde‡
WIN32


394 #¥agm®
w¨nög
 (
p›
)

	@mpq/mpqtypes.h

1 #i‚de‡
_MPQTYPES_H_


3 
	#_MPQTYPES_H_


	)

5 
	~<°dio.h
>

7 
	#UI¡8
 

	)

8 
	#UI¡16
 

	)

9 
	#SI¡16
 

	)

10 
	#UI¡32
 

	)

11 
	#SI¡32
 

	)

13 
	#DWORD
 

	)

15 
	#MPQTYPES_MAX_PATH
 256

	)

19 
	sGLB_MPQ_S


21 
	mis_›í
;

23 
DWORD
 
	moff£t_mpq
;

24 
DWORD
 
	moff£t_htbl
;

25 
DWORD
 
	moff£t_btbl
;

26 
DWORD
 
	mÀnght_mpq_∑π
;

27 
DWORD
 
	mÀnght_htbl
;

28 
DWORD
 
	mÀnght_btbl
;

29 
DWORD
 *
	mhash_èbÀ
;

30 
DWORD
 *
	mblock_èbÀ
;

31 
DWORD
 
	mcou¡_fûes
;

32 
DWORD
 
	mmassive_ba£
[0x500];

35 *
	mfûíame_èbÀ
;

36 *
	midítify_èbÀ
;

38 
	mfûe_«me
[257];

39 
	mw‹k_dú
[
MPQTYPES_MAX_PATH
];

40 
	m¥nbuf
[
MPQTYPES_MAX_PATH
+100];

41 
	mdeÁu…_li°
[
MPQTYPES_MAX_PATH
];

42 
FILE
 *
	mÂMpq
;

45 
DWORD
 
	mavaû_mëods
[4];

46 
DWORD
 
	mÀnght_wrôe
;

47 
UI¡8
 * 
	mglobÆ_buf„r
, * 
	mªad_buf„r_°¨t
, * 
	mwrôe_buf„r_°¨t
, * 
	mex∂ode_buf„r
;

48 
UI¡32
 * 
	mfûe_hódî
;

49 } 
	tGLB_MPQ_S
;

51 
GLB_MPQ_S
 * 
glb_mpq
;

	@mpq/mpqview.c

1 #ifde‡
WIN32


2 #¥agm®
w¨nög
 (
push
)

3 #¥agm®
w¨nög
 (
dißbÀ
 : 4057 )

6 
	~<°dio.h
>

7 
	~<°dlib.h
>

8 
	~<°rög.h
>

9 
	~"mpqty≥s.h
"

10 
	~"d˛ib.h
"

12 
	~"../°ru˘s.h
"

13 
	~"../îr‹.h
"

16 
UI¡32
 
ExtWavU≈1
 (UInt32,UInt32,UInt32,UInt32);

17 
UI¡32
 
ExtWavU≈2
 (UInt32,UInt32,UInt32,UInt32);

18 
UI¡32
 
ExtWavU≈3
 (UInt32,UInt32,UInt32,UInt32);

21 
ã°_¥ï¨e_¨chive
 ();

22 
DWORD
 
ã°_ãŒ_íåy
 (* 
fûíame
);

24 
BuûdBa£Massive
 ();

25 
InôülizeLoˇls
 ();

26 
FªeLoˇls
 ();

27 
DWORD
 
Crc
 (* 
°rög
, DWORD * 
massive_ba£
, DWORD 
massive_ba£_off£t
);

28 
Decode
 (
DWORD
 * 
d©a_ö
, DWORD * 
massive_ba£
, DWORD 
¸c
, DWORD 
Ànght
);

29 
UI¡16
 
ªad_d©a
 (
UI¡8
 * 
buf„r
, UI¡16 
size
, * 
¸≠
);

30 
wrôe_d©a
 (
UI¡8
 * 
buf„r
, 
UI¡16
 
size
, * 
¸≠
);

31 
Exåa˘To
 (
FILE
 * 
Â_√w
, 
DWORD
 
íåy
);

32 
Exåa˘ToMem
 (* 
mp_√w
, 
DWORD
 
íåy
);

35 
	s∑øms


37 * 
	mbuf_ö
;

38 * 
	mbuf_out
;

39 } 
	t∑øms
;

41 
GLB_MPQ_S
 * 
	gglb_mpq
 = 
NULL
;

46 
	$mod_lﬂd_ö_mem
–*
moddú
, *
fûíame
, **
buf„r
, *
buf_Àn
, 
ouçut
 )

48 
FILE
 *
ö
 = 
NULL
;

49 
size
 = 0;

50 
°πmp
[256];

51 
Àngth
;

54 *
buf„r
 = (*)
NULL
;

55 *
buf_Àn
 = 0;

57 
	`DEBUG_MESSAGE
("mod_lﬂd_ö_mem(\"%s\",\"%s\"):ö\n", 
moddú
, 
fûíame
);

59 
	`•rötf
(
°πmp
, "%s/%s", 
moddú
, 
fûíame
);

60 
Àngth
 = 
	`°æí
–
°πmp
 );

61 
Àngth
--;

62  
Àngth
 >= 0 ){

63 if–
°πmp
[
Àngth
] == '\\' ){

64 
°πmp
[
Àngth
] = '/';

66 
Àngth
--;

70 
ö
 = 
	`f›í
(
°πmp
, "rb");

71 i‡(
ö
 =
NULL
){

76 
	`f£ek
(
ö
, 0, 
SEEK_END
);

77 
size
 = 
	`·ñl
(
ö
) + 1;

78 
	`f£ek
(
ö
, 0, 
SEEK_SET
);

79 *
buf„r
 = (*Ë
	`mÆloc
(
size
);

80 i‡(*
buf„r
 =
NULL
) {

81 
	`f˛o£
(
ö
);

82 
	`FATAL_EXIT
("nŸÉnough mem (%lòbyãsËf‹ %†(‰om Mod Dúe˘‹y)", 
size
, 
fûíame
);

84 
size
--;

85 *
buf_Àn
 = 
size
;

88 
	`‰ód
(* 
buf„r
, 
size
, 1, 
ö
);

89 * ( ((*Ë(* 
buf„r
)Ë+ 
size
) = 0;

92 if–
ouçut
 ){

93 
	`DEBUG_MESSAGE
("ok (%lòbyãs)\n", 
size
);

95 
	`f˛o£
(
ö
);

96 
	`DEBUG_MESSAGE
("mod_lﬂd_ö_mem(\"%s\",\"%s\"):out\n", 
moddú
, 
fûíame
);

98 
	}
}

102 
	$mpq_b©ch_›í
(* 
mpq«me
)

104 
°πmp
[256];

107 if(
glb_mpq
 =
NULL
){

108 
	`FATAL_EXIT
("pointer glb_mpq == NULL\n");

110 if(
glb_mpq
->
is_›í
 !
FALSE
){

111 
	`FATAL_EXIT
("glb_mpq->is_open != FALSE\n");

113 if(
mpq«me
 =
NULL
){

114 
	`FATAL_EXIT
("mpqname == NULL\n");

118 
glb_mpq
->
avaû_mëods
[0] = 0x08;

119 
glb_mpq
->
avaû_mëods
[1] = 0x01;

120 
glb_mpq
->
avaû_mëods
[2] = 0x40;

121 
glb_mpq
->
avaû_mëods
[3] = 0x80;

124 
	`°r˝y
(
glb_mpq
->
fûe_«me
, 
mpq«me
);

125 
glb_mpq
->
ÂMpq
 = 
	`f›í
(glb_mpq->
fûe_«me
, "rb");

126 if–! 
glb_mpq
->
ÂMpq
){

127 
	`FATAL_EXIT
("couldÇŸ o≥¿%s\n", 
glb_mpq
->
fûe_«me
);

131 i‡(
	`ã°_¥ï¨e_¨chive
()){

132 
	`exô
(
DS1ERR_INITMPQ
);

136 
glb_mpq
->
is_›í
 = 
TRUE
;

137 
	}
}

141 
	$mpq_b©ch_lﬂd_ö_mem
(* 
fûíame
, ** 
buf„r
, * 
buf_Àn
, 
ouçut
)

143 
num_íåy
, 
size_u≈ack
;

144 * 
mp_√w
;

145 
°πmp
[256];

148 i‡(
glb_mpq
 =
NULL
) {

149 
	`FATAL_EXIT
("mpq_batch_load_in_mem_mpq() :Öointer glb_mpq == NULL");

151 i‡(
glb_mpq
->
is_›í
 =
FALSE
) {

152 
	`FATAL_EXIT
("mpq_batch_load_in_mem_mpq() : glb_mpq->is_open == FALSE");

154 i‡(
fûíame
 =
NULL
) {

155 
	`FATAL_EXIT
("mpq_batch_load_in_mem_mpq() : filename == NULL");

157 i‡(
	`°æí
(
fûíame
) == 0) {

158 
	`FATAL_EXIT
("mpq_batch_load_in_mem_mpq() : strlen(filename) == 0");

162 
num_íåy
 = 
	`ã°_ãŒ_íåy
(
fûíame
);

163 i‡(
num_íåy
 != -1) {

166 
size_u≈ack
 = * (
glb_mpq
->
block_èbÀ
 + (
num_íåy
 * 4) + 2);

167 if(
num_íåy
 < 0 ||Çum_íåy > (Ë
glb_mpq
->
cou¡_fûes
 - 1) {

169 
	`FATAL_EXIT
("Eº‹! InvÆidÉ¡ryÇumbî %ò(VÆidÉ¡ryÇumbî†¨ê1-%i)\n", 
num_íåy
 + 1, 
glb_mpq
->
cou¡_fûes
);

172 
mp_√w
 = (*Ë
	`mÆloc
(
size_u≈ack
);

173 i‡(
mp_√w
 =
NULL
) {

174 
	`FATAL_EXIT
("mpq_b©ch_lﬂd_ö_mem(Ë:ÇŸÉnough mem‹y f‹ %òbyãs\n", 
size_u≈ack
);

180 
	`Exåa˘ToMem
(
mp_√w
, 
num_íåy
);

181 * 
buf„r
 = 
mp_√w
;

182 * 
buf_Àn
 = 
size_u≈ack
;

183 i‡(
ouçut
)

184 
	`¥ötf
("ok (%òbyãs)", 
size_u≈ack
);

187  
num_íåy
;

188 
	}
}

192 
	$mpq_b©ch_˛o£
()

194 
	`f˛o£
(
glb_mpq
->
ÂMpq
);

195 
	`FªeLoˇls
();

196 
	}
}

201 
	$ã°_¥ï¨e_¨chive
()

203 
DWORD
 
mpq_hódî
[2] = {0x1a51504d, 0x00000020};

204 
DWORD
 
dëe˘ed
 = 0;

205 
DWORD
 
tmp
;

206 
«me_hèbÀ
[] = "(hashÅable)";

207 
«me_bèbÀ
[] = "(blockÅable)";

211 
	`‰ód
(&
tmp
,(
DWORD
),1,
glb_mpq
->
ÂMpq
)) {

212 if(
mpq_hódî
[0]==
tmp
) {

213 
	`‰ód
(&
tmp
,(
DWORD
),1,
glb_mpq
->
ÂMpq
);

214 if(
mpq_hódî
[1]==
tmp
) {

215 
dëe˘ed
=1;

220 if(!
dëe˘ed
) {

221 
	`¥ötf
("\nEº‹: Fûê\'%s\' i†nŸá vÆid MPQárchive", 
glb_mpq
->
fûe_«me
);

222 
	`f˛o£
(
glb_mpq
->
ÂMpq
);

228 
glb_mpq
->
off£t_mpq
 = 
	`·ñl
(glb_mpq->
ÂMpq
) - 8;

231 
	`‰ód
(&
glb_mpq
->
Ànght_mpq_∑π
,(
DWORD
),1,glb_mpq->
ÂMpq
);

234 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
 + 16,
SEEK_SET
);

237 
	`‰ód
(&
glb_mpq
->
off£t_htbl
,(
DWORD
),1,glb_mpq->
ÂMpq
);

240 
	`‰ód
(&
glb_mpq
->
off£t_btbl
,(
DWORD
),1,glb_mpq->
ÂMpq
);

243 
	`‰ód
(&
glb_mpq
->
Ànght_htbl
,(
DWORD
),1,glb_mpq->
ÂMpq
);

244 
glb_mpq
->
Ànght_htbl
 *= 4;

247 
	`‰ód
(&
glb_mpq
->
Ànght_btbl
,(
DWORD
),1,glb_mpq->
ÂMpq
);

250 
glb_mpq
->
cou¡_fûes
 = glb_mpq->
Ànght_btbl
;

251 
glb_mpq
->
Ànght_btbl
 *= 4;

256 
	`BuûdBa£Massive
();

259 if(
	`InôülizeLoˇls
()) {

260 
	`f˛o£
(
glb_mpq
->
ÂMpq
);

265 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+glb_mpq->
off£t_htbl
,
SEEK_SET
);

266 
	`‰ód
(
glb_mpq
->
hash_èbÀ
,(
DWORD
),glb_mpq->
Ànght_htbl
,glb_mpq->
ÂMpq
);

269 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+glb_mpq->
off£t_btbl
,
SEEK_SET
);

270 
	`‰ód
(
glb_mpq
->
block_èbÀ
,(
DWORD
),glb_mpq->
Ànght_btbl
,glb_mpq->
ÂMpq
);

280 
tmp
=
	`Crc
(
«me_hèbÀ
,
glb_mpq
->
massive_ba£
,0x300);

281 
	`Decode
(
glb_mpq
->
hash_èbÀ
,glb_mpq->
massive_ba£
,
tmp
,glb_mpq->
Ànght_htbl
);

282 
tmp
=
	`Crc
(
«me_bèbÀ
,
glb_mpq
->
massive_ba£
,0x300);

283 
	`Decode
(
glb_mpq
->
block_èbÀ
,glb_mpq->
massive_ba£
,
tmp
,glb_mpq->
Ànght_btbl
);

287 
	}
}

293 
DWORD
 
	$ã°_ãŒ_íåy
(* 
fûíame
)

295 
DWORD
 
s¸c1
, 
s¸c2
, 
s¸c3
, 
poöãr_ht
;

297 
s¸c1
 = 
	`Crc
(
fûíame
, 
glb_mpq
->
massive_ba£
, 0);

298 
s¸c2
 = 
	`Crc
(
fûíame
, 
glb_mpq
->
massive_ba£
, 0x100);

299 
s¸c3
 = 
	`Crc
(
fûíame
, 
glb_mpq
->
massive_ba£
, 0x200);

302 
poöãr_ht
 = (
s¸c1
 & (
glb_mpq
->
Ànght_htbl
/4-1) ) * 4;

304 ; 
poöãr_ht
<
glb_mpq
->
Ànght_htbl
;Öointer_ht += 4)

307 if–(* (
glb_mpq
->
hash_èbÀ
+
poöãr_ht
Ë=
s¸c2
Ë&& (* (glb_mpq->hash_èbÀ+poöãr_ht+1Ë=
s¸c3
)){

311  * (
glb_mpq
->
hash_èbÀ
 + 
poöãr_ht
 + 3);

314  (
DWORD
) -1;

315 
	}
}

325 
	$InôülizeLoˇls
()

331 
glb_mpq
->
globÆ_buf„r
 = (
UI¡8
 *Ë
	`mÆloc
(0x60000);

332 if(!
glb_mpq
->
globÆ_buf„r
) {

333 
	`¥ötf
("\nError! Insufficient memory");

336 
glb_mpq
->
ªad_buf„r_°¨t
=glb_mpq->
globÆ_buf„r
;

337 
glb_mpq
->
wrôe_buf„r_°¨t
=glb_mpq->
globÆ_buf„r
+0x1000;

338 
glb_mpq
->
ex∂ode_buf„r
=glb_mpq->
globÆ_buf„r
+0x2000;

339 
glb_mpq
->
fûe_hódî
=(
DWORD
 *)(glb_mpq->
globÆ_buf„r
+0x6000);

342 
glb_mpq
->
hash_èbÀ
=(
DWORD
 *)
	`mÆloc
(glb_mpq->
Ànght_htbl
*4);

343 
glb_mpq
->
block_èbÀ
=(
DWORD
 *)
	`mÆloc
(glb_mpq->
Ànght_btbl
*4);

344 
glb_mpq
->
fûíame_èbÀ
=(*)
	`ˇŒoc
(glb_mpq->
Ànght_btbl
/4,
MPQTYPES_MAX_PATH
);

346 
glb_mpq
->
idítify_èbÀ
=(*)
	`ˇŒoc
(glb_mpq->
Ànght_btbl
/4, ());

347 if(
glb_mpq
->
hash_èbÀ
 && glb_mpq->
block_èbÀ
 && glb_mpq->
fûíame_èbÀ
 && glb_mpq->
idítify_èbÀ
)

350 
	`¥ötf
("\nError! Insufficient memory");

353 
	}
}

360 
	$FªeLoˇls
()

362 if(
glb_mpq
->
globÆ_buf„r
)

363 
	`‰ì
(
glb_mpq
->
globÆ_buf„r
);

364 if(
glb_mpq
->
hash_èbÀ
)

365 
	`‰ì
(
glb_mpq
->
hash_èbÀ
);

366 if(
glb_mpq
->
block_èbÀ
)

367 
	`‰ì
(
glb_mpq
->
block_èbÀ
);

368 if(
glb_mpq
->
fûíame_èbÀ
)

369 
	`‰ì
(
glb_mpq
->
fûíame_èbÀ
);

370 if(
glb_mpq
->
idítify_èbÀ
)

371 
	`‰ì
(
glb_mpq
->
idítify_èbÀ
);

373 
	}
}

380 
	$BuûdBa£Massive
()

452 
DWORD
 
s1
;

453 
i
,
j
;

454 
ldiv_t
 
divªs
;

456 
divªs
.
ªm
=0x100001;

457 
i
=0;i<0x100;i++) {

458 
j
=0;j<5;j++) {

459 
divªs
=
	`ldiv
(divªs.
ªm
*125+3,0x002AAAAB);

460 
s1
=(
divªs
.
ªm
&0xFFFFL)<<0x10;

461 
divªs
=
	`ldiv
(divªs.
ªm
*125+3,0x002AAAAB);

462 
s1
=s1|(
divªs
.
ªm
&0xFFFFL);

463 
glb_mpq
->
massive_ba£
[
i
+0x100*
j
]=
s1
;

467 
	}
}

475 
DWORD
 
	$Crc
(*
°rög
,
DWORD
 *
massive_ba£
,DWORD 
massive_ba£_off£t
)

477 
byã
;

478 
DWORD
 
¸c
=0x7fed7fed;

479 
DWORD
 
s1
=0xEEEEEEEE;

481 
byã
=*
°rög
;

482 
byã
) {

483 if(
byã
>0x60 && byte<0x7B)

484 
byã
-=0x20;

486 
¸c
=*(
massive_ba£
+
massive_ba£_off£t
+
byã
)^(¸c+
s1
);

487 
s1
+=
¸c
+(s1<<5)+
byã
+3;

488 
°rög
++;

489 
byã
=*
°rög
;

491  
¸c
;

492 
	}
}

499 
UI¡16
 
	$ªad_d©a
(
UI¡8
 *
buf„r
,
UI¡16
 
size
,*
¸≠
)

501 
∑øms
 *
∑øm
=’¨am†*)
¸≠
;

502 
	`mem˝y
(
buf„r
,
∑øm
->
buf_ö
,
size
);

503 
∑øm
->
buf_ö
+=
size
;

504  
size
;

505 
	}
}

511 
	$wrôe_d©a
(
UI¡8
 *
buf„r
,
UI¡16
 
size
,*
¸≠
)

513 
∑øms
 *
∑øm
=’¨am†*)
¸≠
;

514 
	`mem˝y
(
∑øm
->
buf_out
,
buf„r
,
size
);

515 
∑øm
->
buf_out
+=
size
;

516 
glb_mpq
->
Ànght_wrôe
+=
size
;

517 
	}
}

525 
	$Decode
(
DWORD
 *
d©a_ö
, DWORD *
massive_ba£
, DWORD 
¸c
, DWORD 
Ànght
)

532 
DWORD
 
i
,
dec
;

533 
DWORD
 
s1
=0xEEEEEEEE;

535 
i
=0;i<
Ànght
;i++) {

536 
s1
+=*(
massive_ba£
+0x400+(
¸c
&0xFFL));

537 
dec
=*(
d©a_ö
+
i
)^(
s1
+
¸c
);

538 
s1
+=
dec
+(s1<<5)+3;

539 *(
d©a_ö
+
i
)=
dec
;

540 
¸c
=(crc>>0x0b)|(0x11111111+((crc^0x7FFL)<<0x15));

543 
	}
}

550 
DWORD
 
	$GëUnknowCrc
(
DWORD
 
íåy
)

552 
DWORD
 
tmp
,
i
,
j
,
coded_dw‹d
,
¸c_fûe
=0;

553 
DWORD
 
Êag
,
size_∑ck
,
size_u≈ack
,
num_block
,
off£t_body
;

554 
DWORD
 
sign_riff1
=0x46464952;

555 
DWORD
 
sign_riff3
=0x45564157;

556 
DWORD
 
sign_mpq1
=0x1a51504d;

557 
DWORD
 
sign_mpq2
=0x00000020;

558 
ldiv_t
 
divªs
;

560 
off£t_body
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4);

561 
Êag
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+3);

562 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+
off£t_body
,
SEEK_SET
);

563 
	`‰ód
(&
coded_dw‹d
,(
DWORD
),1,
glb_mpq
->
ÂMpq
);

565 if(
Êag
&0x200 || flag&0x100) {

566 
size_u≈ack
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+2);

567 
size_∑ck
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+1);

568 
divªs
=
	`ldiv
(
size_u≈ack
-1,0x1000);

569 
num_block
=
divªs
.
quŸ
+2;

570 
j
=0;j<=0xff;j++) {

571 
¸c_fûe
=((
num_block
*4)^
coded_dw‹d
)-0xìììì - *(
glb_mpq
->
massive_ba£
+0x400+
j
);

572 if((
¸c_fûe
&0xffLË=
j
) {

573 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+
off£t_body
,
SEEK_SET
);

574 
	`‰ód
(
glb_mpq
->
fûe_hódî
,(
DWORD
),
num_block
,glb_mpq->
ÂMpq
);

575 
	`Decode
(
glb_mpq
->
fûe_hódî
,glb_mpq->
massive_ba£
,
¸c_fûe
,
num_block
);

576 
tmp
=
num_block
*4;

577 if(
tmp
 =*
glb_mpq
->
fûe_hódî
) {

578 
i
=0;i<
num_block
-1;i++) {

579 
tmp
+=*(
glb_mpq
->
fûe_hódî
+
i
+1)-*(glb_mpq->file_header+i);

580 if(*(
glb_mpq
->
fûe_hódî
+
i
+1)-*(glb_mpq->file_header+i)>0x1000) {

581 
tmp
=0xffffffff;

585 if(
tmp
!=0xffffffff) {

586 
¸c_fûe
++;

591 
¸c_fûe
=0;

595 
j
=0;j<=0xff;j++) {

596 
¸c_fûe
=(
sign_riff1
^
coded_dw‹d
)-0xìììì - *(
glb_mpq
->
massive_ba£
+0x400+
j
);

597 if((
¸c_fûe
&0xff)==
j
) {

598 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+
off£t_body
,
SEEK_SET
);

599 
	`‰ód
(
glb_mpq
->
fûe_hódî
,(
DWORD
),3,glb_mpq->
ÂMpq
);

600 
	`Decode
(
glb_mpq
->
fûe_hódî
,glb_mpq->
massive_ba£
,
¸c_fûe
,3);

601 if(
sign_riff1
==*
glb_mpq
->
fûe_hódî
) {

602 if(
sign_riff3
==*(
glb_mpq
->
fûe_hódî
+2))

606 
¸c_fûe
=0;

608 if(!
¸c_fûe
) {

609 
j
=0;j<=0xff;j++) {

610 
¸c_fûe
=(
sign_mpq1
^
coded_dw‹d
)-0xìììì - *(
glb_mpq
->
massive_ba£
+0x400+
j
);

611 if((
¸c_fûe
&0xffLË=
j
) {

612 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+
off£t_body
,
SEEK_SET
);

613 
	`‰ód
(
glb_mpq
->
fûe_hódî
,(
DWORD
),2,glb_mpq->
ÂMpq
);

614 
	`Decode
(
glb_mpq
->
fûe_hódî
,glb_mpq->
massive_ba£
,
¸c_fûe
,2);

615 if(
sign_mpq1
 =*
glb_mpq
->
fûe_hódî
) {

616 if(
sign_mpq2
 =*(
glb_mpq
->
fûe_hódî
+1))

620 
¸c_fûe
=0;

624  
¸c_fûe
;

625 
	}
}

632 
	$Exåa˘To
(
FILE
 *
Â_√w
,
DWORD
 
íåy
)

634 
DWORD
 
size_∑ck
,
size_u≈ack
;

635 
UI¡8
 *
ªad_buf„r
,*
wrôe_buf„r
;

636 
UI¡32
 
i
,
j
,
off£t_body
,
Êag
,
¸c_fûe
=0;

637 
UI¡32
 
num_block
,
Ànght_ªad
,
ôî©i⁄
;

638 
UI¡8
 *
szNameFûe
;

639 
UI¡8
 
mëod
;

640 
ldiv_t
 
divªs
;

641 
∑øms
 
∑øm
;

643 
off£t_body
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4);

644 
size_u≈ack
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+2);

645 
Êag
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+3);

650 if(
Êag
&0x30000) {

651 if(*(
glb_mpq
->
idítify_èbÀ
+
íåy
)&0x1) {

652 
szNameFûe
=
glb_mpq
->
fûíame_èbÀ
+
MPQTYPES_MAX_PATH
*
íåy
;

653 if(
	`°ºchr
(
szNameFûe
,'\\'))

654 
szNameFûe
=
	`°ºchr
(szNameFile,'\\')+1;

655 
¸c_fûe
=
	`Crc
(
szNameFûe
,
glb_mpq
->
massive_ba£
,0x300);

656 if((
Êag
&0x20200) == 0x20200)

657 
¸c_fûe
=(¸c_fûe+
off£t_body
)^
size_u≈ack
;

660 
¸c_fûe
=
	`GëUnknowCrc
(
íåy
);

663 if(
Êag
&0x200 || flag&0x100) {

664 
divªs
=
	`ldiv
(
size_u≈ack
-1,0x1000);

665 
num_block
=
divªs
.
quŸ
+2;

666 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+
off£t_body
,
SEEK_SET
);

667 
	`‰ód
(
glb_mpq
->
fûe_hódî
,(
DWORD
),
num_block
,glb_mpq->
ÂMpq
);

668 if(
Êag
&0x30000)

669 
	`Decode
(
glb_mpq
->
fûe_hódî
,glb_mpq->
massive_ba£
,(
¸c_fûe
-1),
num_block
);

670 
ªad_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

671 
j
=0;j<(
num_block
-1);j++) {

672 
Ànght_ªad
=*(
glb_mpq
->
fûe_hódî
+
j
+1)-*(glb_mpq->file_header+j);

673 
	`‰ód
(
ªad_buf„r
,(),
Ànght_ªad
,
glb_mpq
->
ÂMpq
);

674 if(
Êag
&0x30000)

675 
	`Decode
((
DWORD
 *)
ªad_buf„r
,
glb_mpq
->
massive_ba£
,
¸c_fûe
,
Ànght_ªad
/4);

676 if(
Ànght_ªad
==0x1000 || (
j
==
num_block
-2 &&Üíght_ªad==(
size_u≈ack
&0xFFF)))

678 
	`fwrôe
(
ªad_buf„r
,(),
Ànght_ªad
,
Â_√w
);

680 if(
Êag
&0x200) {

681 
mëod
=*
ªad_buf„r
;

682 
ôî©i⁄
=0;

683 
i
=0;i<4;i++) {

684 if(
mëod
&
glb_mpq
->
avaû_mëods
[
i
])

685 
ôî©i⁄
++;

687 
ªad_buf„r
+=1;

688 
Ànght_ªad
-=1;

690 
ôî©i⁄
=1;

691 
mëod
=8;

693 
wrôe_buf„r
=
glb_mpq
->
wrôe_buf„r_°¨t
;

694 if(
mëod
&0x08) {

695 
∑øm
.
buf_ö
 =
ªad_buf„r
;

696 
∑øm
.
buf_out
=
wrôe_buf„r
;

697 
glb_mpq
->
Ànght_wrôe
=0;

698 
	`ex∂ode
(&
ªad_d©a
,&
wrôe_d©a
,&
∑øm
);

699 
Ànght_ªad
=
glb_mpq
->
Ànght_wrôe
;

700 
ôî©i⁄
--;

701 if(
ôî©i⁄
) {

702 
ªad_buf„r
=
wrôe_buf„r
;

703 
wrôe_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

706 if(
mëod
&0x01) {

707 
Ànght_ªad
=
	`ExtWavU≈1
((
UI¡32
)
ªad_buf„r
,(UI¡32Óíght_ªad,(UI¡32)
wrôe_buf„r
,0x1000);

708 
ôî©i⁄
--;

709 if(
ôî©i⁄
) {

710 
ªad_buf„r
=
wrôe_buf„r
;

711 
wrôe_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

714 if(
mëod
&0x40)

715 
Ànght_ªad
=
	`ExtWavU≈2
((
UI¡32
)
ªad_buf„r
,(UI¡32Óíght_ªad,(UI¡32)
wrôe_buf„r
,0x1000);

716 if(
mëod
&0x80)

717 
Ànght_ªad
=
	`ExtWavU≈3
((
UI¡32
)
ªad_buf„r
,(UI¡32Óíght_ªad,(UI¡32)
wrôe_buf„r
,0x1000);

719 
	`fwrôe
(
wrôe_buf„r
,1,
Ànght_ªad
,
Â_√w
);

720 
ªad_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

722 
¸c_fûe
++;

727 
size_∑ck
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+1);

728 if(
Êag
&0x30000)

729 
Ànght_ªad
=0x1000;

731 
Ànght_ªad
=0x60000;

732 if(
size_∑ck
<
Ànght_ªad
)

733 
Ànght_ªad
=
size_∑ck
;

734 
ªad_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

735 if(
Ànght_ªad
) {

736 
divªs
=
	`ldiv
(
size_∑ck
,
Ànght_ªad
);

737 
num_block
=
divªs
.
quŸ
;

739 
num_block
=0;

740 
divªs
.
ªm
=0;

742 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+
off£t_body
,
SEEK_SET
);

743 
j
=0;j<
num_block
;j++) {

744 
	`‰ód
(
ªad_buf„r
,1,
Ànght_ªad
,
glb_mpq
->
ÂMpq
);

745 if(
Êag
&0x30000) {

746 
	`Decode
((
DWORD
 *)
ªad_buf„r
,
glb_mpq
->
massive_ba£
,
¸c_fûe
,
Ànght_ªad
/4);

747 
¸c_fûe
++;

750 
	`fwrôe
(
ªad_buf„r
,1,
Ànght_ªad
,
Â_√w
);

752 if(
divªs
.
ªm
) {

753 
	`‰ód
(
ªad_buf„r
,1,
divªs
.
ªm
,
glb_mpq
->
ÂMpq
);

754 if(
Êag
&0x30000)

755 
	`Decode
((
DWORD
 *)
ªad_buf„r
,
glb_mpq
->
massive_ba£
,
¸c_fûe
,
divªs
.
ªm
/4);

757 
	`fwrôe
(
ªad_buf„r
,1,
divªs
.
ªm
,
Â_√w
);

761 
	}
}

772 
	$Exåa˘ToMem
(* 
mp_√w
, 
DWORD
 
íåy
)

775 
DWORD
 
size_∑ck
,
size_u≈ack
;

776 
UI¡8
 * 
ªad_buf„r
,*
wrôe_buf„r
;

777 
UI¡32
 
i
,
j
,
off£t_body
,
Êag
,
¸c_fûe
=0;

778 
UI¡32
 
num_block
,
Ànght_ªad
,
ôî©i⁄
;

779 
UI¡8
 * 
szNameFûe
;

780 
UI¡8
 
mëod
;

781 
ldiv_t
 
divªs
;

782 
∑øms
 
∑øm
;

783 
UBYTE
 * 
buff_±r
 = 
mp_√w
;

785 
off£t_body
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4);

786 
size_u≈ack
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+2);

787 
Êag
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+3);

792 if(
Êag
&0x30000) {

793 if(*(
glb_mpq
->
idítify_èbÀ
+
íåy
)&0x1) {

794 
szNameFûe
=
glb_mpq
->
fûíame_èbÀ
+
MPQTYPES_MAX_PATH
*
íåy
;

795 if(
	`°ºchr
(
szNameFûe
,'\\'))

796 
szNameFûe
=
	`°ºchr
(szNameFile,'\\')+1;

797 
¸c_fûe
=
	`Crc
(
szNameFûe
,
glb_mpq
->
massive_ba£
,0x300);

804 i‡((
Êag
 & 0x20200) == 0x20200)

806 
¸c_fûe
=(¸c_fûe+
off£t_body
)^
size_u≈ack
;

809 
¸c_fûe
=
	`GëUnknowCrc
(
íåy
);

812 if(
Êag
&0x200 || flag&0x100) {

813 
divªs
=
	`ldiv
(
size_u≈ack
-1,0x1000);

814 
num_block
=
divªs
.
quŸ
+2;

815 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+
off£t_body
,
SEEK_SET
);

816 
	`‰ód
(
glb_mpq
->
fûe_hódî
,(
DWORD
),
num_block
,glb_mpq->
ÂMpq
);

817 if(
Êag
&0x30000){

819 
	`Decode
(
glb_mpq
->
fûe_hódî
,glb_mpq->
massive_ba£
,(
¸c_fûe
-1),
num_block
);

821 
ªad_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

822 
j
=0;j<(
num_block
-1);j++) {

823 
Ànght_ªad
=*(
glb_mpq
->
fûe_hódî
+
j
+1)-*(glb_mpq->file_header+j);

824 
	`‰ód
(
ªad_buf„r
,(),
Ànght_ªad
,
glb_mpq
->
ÂMpq
);

825 if(
Êag
&0x30000)

826 
	`Decode
((
DWORD
 *)
ªad_buf„r
,
glb_mpq
->
massive_ba£
,
¸c_fûe
,
Ànght_ªad
/4);

827 if(
Ànght_ªad
==0x1000 || (
j
==
num_block
-2 &&Üíght_ªad==(
size_u≈ack
&0xFFF)))

831 
	`mem˝y
(
buff_±r
, 
ªad_buf„r
, 
Ànght_ªad
);

832 
buff_±r
 +
Ànght_ªad
;

835 if(
Êag
&0x200) {

836 
mëod
=*
ªad_buf„r
;

837 
ôî©i⁄
=0;

838 
i
=0;i<4;i++) {

839 if(
mëod
&
glb_mpq
->
avaû_mëods
[
i
])

840 
ôî©i⁄
++;

842 
ªad_buf„r
+=1;

843 
Ànght_ªad
-=1;

845 
ôî©i⁄
=1;

846 
mëod
=8;

848 
wrôe_buf„r
=
glb_mpq
->
wrôe_buf„r_°¨t
;

849 if(
mëod
&0x08) {

850 
∑øm
.
buf_ö
 =
ªad_buf„r
;

851 
∑øm
.
buf_out
=
wrôe_buf„r
;

852 
glb_mpq
->
Ànght_wrôe
=0;

853 
	`ex∂ode
(&
ªad_d©a
,&
wrôe_d©a
,&
∑øm
);

854 
Ànght_ªad
=
glb_mpq
->
Ànght_wrôe
;

855 
ôî©i⁄
--;

856 if(
ôî©i⁄
) {

857 
ªad_buf„r
=
wrôe_buf„r
;

858 
wrôe_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

861 if(
mëod
&0x01) {

862 
Ànght_ªad
=
	`ExtWavU≈1
((
UI¡32
)
ªad_buf„r
,(UI¡32Óíght_ªad,(UI¡32)
wrôe_buf„r
,0x1000);

863 
ôî©i⁄
--;

864 if(
ôî©i⁄
) {

865 
ªad_buf„r
=
wrôe_buf„r
;

866 
wrôe_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

869 if(
mëod
&0x40)

870 
Ànght_ªad
=
	`ExtWavU≈2
((
UI¡32
)
ªad_buf„r
,(UI¡32Óíght_ªad,(UI¡32)
wrôe_buf„r
,0x1000);

871 if(
mëod
&0x80)

872 
Ànght_ªad
=
	`ExtWavU≈3
((
UI¡32
)
ªad_buf„r
,(UI¡32Óíght_ªad,(UI¡32)
wrôe_buf„r
,0x1000);

875 
	`mem˝y
(
buff_±r
, 
wrôe_buf„r
, 
Ànght_ªad
);

876 
buff_±r
 +
Ànght_ªad
;

878 
ªad_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

880 
¸c_fûe
++;

885 
size_∑ck
=*(
glb_mpq
->
block_èbÀ
+
íåy
*4+1);

886 if(
Êag
&0x30000)

887 
Ànght_ªad
=0x1000;

889 
Ànght_ªad
=0x60000;

890 if(
size_∑ck
<
Ànght_ªad
)

891 
Ànght_ªad
=
size_∑ck
;

892 
ªad_buf„r
=
glb_mpq
->
ªad_buf„r_°¨t
;

893 if(
Ànght_ªad
) {

894 
divªs
=
	`ldiv
(
size_∑ck
,
Ànght_ªad
);

895 
num_block
=
divªs
.
quŸ
;

897 
num_block
=0;

898 
divªs
.
ªm
=0;

900 
	`f£ek
(
glb_mpq
->
ÂMpq
,glb_mpq->
off£t_mpq
+
off£t_body
,
SEEK_SET
);

901 
j
=0;j<
num_block
;j++) {

902 
	`‰ód
(
ªad_buf„r
,1,
Ànght_ªad
,
glb_mpq
->
ÂMpq
);

903 if(
Êag
&0x30000) {

904 
	`Decode
((
DWORD
 *)
ªad_buf„r
,
glb_mpq
->
massive_ba£
,
¸c_fûe
,
Ànght_ªad
/4);

905 
¸c_fûe
++;

909 
	`mem˝y
(
buff_±r
, 
ªad_buf„r
, 
Ànght_ªad
);

910 
buff_±r
 +
Ànght_ªad
;

912 if(
divªs
.
ªm
) {

913 
	`‰ód
(
ªad_buf„r
,1,
divªs
.
ªm
,
glb_mpq
->
ÂMpq
);

914 if(
Êag
&0x30000)

915 
	`Decode
((
DWORD
 *)
ªad_buf„r
,
glb_mpq
->
massive_ba£
,
¸c_fûe
,
divªs
.
ªm
/4);

918 
	`mem˝y
(
buff_±r
, 
ªad_buf„r
, 
divªs
.
ªm
);

919 
buff_±r
 +
divªs
.
ªm
;

923 
	}
}

925 #ifde‡
WIN32


926 #¥agm®
w¨nög
 (
p›
)

	@mpq/mpqview.h

1 #i‚de‡
_MPQVIEW_H_


3 
	#_MPQVIEW_H_


	)

5 
mod_lﬂd_ö_mem
 (* 
moddú
, * 
fûíame
, ** 
buf„r
, * 
buf_Àn
);

6 
mpq_lﬂd_ö_mem
 (* 
mpq«me
, * 
fûíame
, ** 
buf„r
, * 
buf_Àn
, 
ouçut
);

7 
mpq_b©ch_›í
 (* 
mpq«me
);

8 
mpq_b©ch_lﬂd_ö_mem
 (* 
fûíame
, ** 
buf„r
, * 
buf_Àn
, 
ouçut
);

9 
mpq_b©ch_˛o£
 ();

	@mpq/wav_unp.c

1 #ifde‡
WIN32


2 #¥agm®
w¨nög
 (
push
)

3 #¥agm®
w¨nög
 (
dißbÀ
 : 4100 4127 4311 4312 4127)

8 
	~"mpqty≥s.h
"

9 
	~"wav_u≈.h
"

10 
	~<°dlib.h
>

12 
UI¡32
 
ExtWavU≈1
 (UInt32,UInt32,UInt32,UInt32);

13 
UI¡32
 
ExtWavU≈2
 (UInt32,UInt32,UInt32,UInt32);

14 
UI¡32
 
ExtWavU≈3
 (UInt32,UInt32,UInt32,UInt32);

15 
Sub_WavU≈1
 (
UI¡32
,UInt32);

16 
UI¡32
 
Sub_WavU≈2
 (UInt32,UInt32,UInt32);

17 
Sub_WavU≈3
 (
UI¡32
);

18 
Sub_WavU≈4
 (
UI¡32
,UInt32,UInt32,UInt32);

19 
UI¡32
 
Sub_WavU≈5
 (UInt32);

20 
Sub_WavU≈6
 (
UI¡32
);

21 
UI¡32
 
Sub_WavU≈7
 (UInt32);

22 
UI¡32
 
Sub_WavU≈8
 (UInt32);

23 
Sub_WavU≈9
 (
UI¡32
,UInt32);

24 
Sub_WavU≈10
 (
UI¡32
,UInt32);

25 
UI¡32
 
Sub_WavU≈11
 (UInt32,UInt32,UInt32,UInt32);

26 
Sub_WavU≈12
 (
UI¡32
);

27 
UI¡32
 
Sub_WavU≈13
 (UInt32,UInt32,UInt32,UInt32,UInt32);

31 
UI¡32
 
	$ExtWavU≈3
(
UI¡32
 
buf_ö
,UI¡32 
size_ö
,UI¡32 
buf_out
,UI¡32 
size_out
)

33  
	`Sub_WavU≈13
(
buf_ö
,
size_ö
,2,
buf_out
,
size_out
);

34 
	}
}

38 
UI¡32
 
	$ExtWavU≈2
(
UI¡32
 
buf_ö
,UI¡32 
size_ö
,UI¡32 
buf_out
,UI¡32 
size_out
)

40  
	`Sub_WavU≈13
(
buf_ö
,
size_ö
,1,
buf_out
,
size_out
);

41 
	}
}

45 
UI¡32
 
	$Sub_WavU≈13
(
UI¡32
 
buf_ö
,UI¡32 
size_ö
,UI¡32 
Êag
,UI¡32 
buf_out
,UI¡32 
size_out
)

47 
UI¡32
 
v¨14
=0,
v¨18
=0,
v¨1c
=0;

48 
UI¡32
 
tmp0
=0,
tmp1
=0,
tmp2
=0,
tmp3
=0,
tmp4
=0;

49 
UI¡32
 
v¨8
[2]={0, 0};

50 
UI¡32
 
v¨10
[2]={0, 0};

53 
v¨14
=
buf_ö
;

54 
size_ö
+=
buf_ö
;

55 
tmp0
=
v¨14
+2;

56 
v¨1c
=
size_out
;

57 
tmp3
=
buf_out
;

58 
v¨18
=
buf_out
;

59 
v¨10
[0]=0x2C;

60 
v¨10
[1]=0x2C;

61 if((
SI¡32
)
Êag
>0) {

62 
tmp2
=0;tmp2<
Êag
;tmp2++) {

63 
v¨8
[
tmp2
]=(
SI¡32
)*((
SI¡16
 *)
tmp0
);

64 
tmp0
+=2;

65 if(
size_out
<2)

66  
tmp3
-
v¨18
;

67 *((
UI¡16
 *)
tmp3
)=(UI¡16Ë
v¨8
[
tmp2
];

68 
tmp3
+=2;

69 
v¨1c
-=2;

72 
tmp2
=
Êag
-1;

73 
tmp0
<
size_ö
) {

74 if(
Êag
==2) {

75 if(
tmp2
==0)

76 
tmp2
=1;

78 
tmp2
=0;

80 
tmp1
=(
UI¡32
)*((
UI¡8
 *)
tmp0
);

81 
tmp0
++;

82 
buf_ö
=
tmp0
;

83 if(
tmp1
&0x80) {

84 
tmp1
&=0x7F;

85 
tmp4
=1;

86 if(
tmp1
==0) {

87 if(
v¨10
[
tmp2
])

88 
v¨10
[
tmp2
]--;

89 if(
v¨1c
<2)

90  
tmp3
-
v¨18
;

91 *((
UI¡16
 *)
tmp3
)=(UI¡16)
v¨8
[
tmp2
];

92 
tmp3
+=2;

93 
v¨1c
-=2;

94 if((
tmp4
==0)&&(
Êag
==2)) {

95 if(
tmp2
==0)

96 
tmp2
=1;

98 
tmp2
=0;

101 
tmp1
--;

102 if(
tmp1
==0) {

103 
v¨10
[
tmp2
]+=8;

104 
tmp4
=
v¨10
[
tmp2
];

105 if(
tmp4
>0x58)

106 
v¨10
[
tmp2
]=0x58;

107 
tmp4
=0;

108 if(
tmp4
==0 && 
Êag
==2) {

109 if(
tmp2
==0)

110 
tmp2
=1;

112 
tmp2
=0;

115 
tmp1
--;

116 if(
tmp1
==0) {

117 
v¨10
[
tmp2
]+=0xFFFFFFF8;

118 if((
SI¡32
)
v¨10
[
tmp2
]<0)

119 
v¨10
[
tmp2
]=0;

120 
tmp4
=0;

122 if((
tmp4
==0)&&(
Êag
==2)) {

123 if(
tmp2
==0)

124 
tmp2
=1;

126 
tmp2
=0;

131 
tmp0
=
smÆl_tbl1
[
v¨10
[
tmp2
]];

132 
tmp4
=
tmp0
>>(*((
UI¡8
 *)(
v¨14
+1)));

133 if(
tmp1
&1)

134 
tmp4
+=
tmp0
;

135 if(
tmp1
&2)

136 
tmp4
+=
tmp0
>>1;

137 if(
tmp1
&4)

138 
tmp4
+=
tmp0
>>2;

139 if(
tmp1
&8)

140 
tmp4
+=
tmp0
>>3;

141 if(
tmp1
&0x10)

142 
tmp4
+=
tmp0
>>4;

143 if(
tmp1
&0x20)

144 
tmp4
+=
tmp0
>>5;

145 
tmp0
=
v¨8
[
tmp2
];

146 if((
tmp1
&0xFF)&0x40) {

147 
tmp0
-=
tmp4
;

148 if((
SI¡32
)
tmp0
<=(SInt32)0xFFFF8000)

149 
tmp0
=0xFFFF8000;

151 
tmp0
+=
tmp4
;

152 if((
SI¡32
)
tmp0
>=0x7FFF)

153 
tmp0
=0x7FFF;

155 
v¨8
[
tmp2
]=
tmp0
;

156 
tmp0
=
v¨1c
;

157 if(
tmp0
<2)

158  
tmp3
-
v¨18
;

159 *((
UI¡16
 *)
tmp3
)=(UI¡16)
v¨8
[
tmp2
];

160 
tmp1
&=0x1F;

161 
tmp3
+=2;

162 
v¨1c
-=2;

163 
tmp4
=
v¨10
[
tmp2
]+
smÆl_tbl2
[
tmp1
];

164 
v¨10
[
tmp2
]=
tmp4
;

165 if((
SI¡32
)
tmp4
<0)

166 
v¨10
[
tmp2
]=0;

168 if(
tmp4
>0x58)

169 
v¨10
[
tmp2
]=0x58;

171 
tmp0
=
buf_ö
;

174  
tmp3
-
v¨18
;

175 
	}
}

179 
UI¡32
 
	$ExtWavU≈1
(
UI¡32
 
buf_ö
, UI¡32 
size_ö
, UI¡32 
buf_out
, UI¡32 
size_out
)

181 
UI¡32
 
w‹k_buff
=0,
ba£
=0;

182 
UI¡32
 
tmp1
=0,
tmp2
=0,
tmp3
=0;

183 
SI¡32
 
i
=0;

186 
w‹k_buff
=(
UI¡32
)(
UI¡8
 *)
	`mÆloc
(0x3a80);

187 *((
UI¡32
 *)
w‹k_buff
)=
buf_ö
+4;

188 *((
UI¡32
 *)(
w‹k_buff
+4))=*((UI¡32 *)
buf_ö
);

189 *((
UI¡32
 *)(
w‹k_buff
+8))=0x20;

190 
ba£
=
w‹k_buff
+0xC;

191 
	`Sub_WavU≈12
(
ba£
);

192 
size_out
=
	`Sub_WavU≈11
(
buf_out
,size_out,
w‹k_buff
,
ba£
);

194 
tmp2
=*((
UI¡32
 *)(
w‹k_buff
+0x3070));

195 if((
SI¡32
)
tmp2
<=0)

197 
tmp3
=
	`Sub_WavU≈5
(
tmp2
);

198 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)
tmp2
);

199 
tmp3
=*((
UI¡32
 *)
tmp2
);

200 *((
UI¡32
 *)(
tmp3
+4))=*((UI¡32 *)(
tmp2
+4));

201 *((
UI¡32
 *)
tmp2
)=0;

202 *((
UI¡32
 *)(
tmp2
+4))=0;

204 if(*((
UI¡32
 *)(
w‹k_buff
+0x306C))) {

205 
tmp3
=
	`Sub_WavU≈5
(*((
UI¡32
 *)(
w‹k_buff
+0x306C)));

206 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)(
w‹k_buff
+0x306C));

207 
tmp3
=*((
UI¡32
 *)(
w‹k_buff
+0x306C));

208 *((
UI¡32
 *)(
tmp3
+4))=*((UI¡32 *)(
w‹k_buff
+0x3070));

209 *((
UI¡32
 *)(
w‹k_buff
+0x306C))=0;

210 *((
UI¡32
 *)(
w‹k_buff
+0x3070))=0;

213 
tmp2
=*((
UI¡32
 *)(
w‹k_buff
+0x3064));

214 if((
SI¡32
)
tmp2
<=0)

216 
tmp3
=
	`Sub_WavU≈5
(
tmp2
);

217 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)
tmp2
);

218 
tmp3
=*((
UI¡32
 *)
tmp2
);

219 *((
UI¡32
 *)(
tmp3
+4))=*((UI¡32 *)(
tmp2
+4));

220 *((
UI¡32
 *)
tmp2
)=0;

221 *((
UI¡32
 *)(
tmp2
+4))=0;

223 if(*((
UI¡32
 *)(
w‹k_buff
+0x3060))) {

224 
tmp3
=
	`Sub_WavU≈5
(*((
UI¡32
 *)(
w‹k_buff
+0x3060)));

225 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)(
w‹k_buff
+0x3060));

226 
tmp3
=*((
UI¡32
 *)(
w‹k_buff
+0x3060));

227 *((
UI¡32
 *)(
tmp3
+4))=*((UI¡32 *)(
w‹k_buff
+0x3064));

228 *((
UI¡32
 *)(
w‹k_buff
+0x3060))=0;

229 *((
UI¡32
 *)(
w‹k_buff
+0x3064))=0;

231 
tmp2
=
w‹k_buff
+0x305C;

232 
i
=0x203;i!=0;i--) {

233 
tmp3
=*((
UI¡32
 *)(
tmp2
-0x18));

234 
tmp2
-=0x18;

235 if(
tmp3
) {

236 
tmp3
=
	`Sub_WavU≈5
(
tmp2
);

237 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)
tmp2
);

238 
tmp3
=*((
UI¡32
 *)
tmp2
);

239 *((
UI¡32
 *)(
tmp3
+4))=*((UI¡32 *)(
tmp2
+4));

240 *((
UI¡32
 *)
tmp2
)=0;

241 *((
UI¡32
 *)(
tmp2
+4))=0;

243 
tmp1
=*((
UI¡32
 *)
tmp2
);

244 if(
tmp1
) {

245 
tmp3
=*((
UI¡32
 *)(
tmp2
+4));

246 if((
SI¡32
)
tmp3
<0)

247 
tmp3
=~tmp3;

249 
tmp3
=
tmp2
+tmp3-*((
UI¡32
 *)(
tmp1
+4));

250 *((
UI¡32
 *)
tmp3
)=
tmp1
;

251 
tmp3
=*((
UI¡32
 *)
tmp2
);

252 *((
UI¡32
 *)(
tmp3
+4))=*((UI¡32 *)(
tmp2
+4));

253 *((
UI¡32
 *)
tmp2
)=0;

254 *((
UI¡32
 *)(
tmp2
+4))=0;

257 
	`‰ì
((
UI¡8
 *)
w‹k_buff
);

258  
size_out
;

259 
	}
}

263 
	$Sub_WavU≈12
(
UI¡32
 
ba£
)

265 
UI¡32
 
tmp
=0;

266 
SI¡32
 
i
=0;

269 
	`Sub_WavU≈6
(
ba£
);

270 
tmp
=
ba£
+0x3474;

271 
i
=0x80;i!=0;i--) {

272 *((
UI¡32
 *Ë
tmp
)=0;

273 
tmp
+=0xC;

276 
	}
}

280 
UI¡32
 
	$Sub_WavU≈11
(
UI¡32
 
buf_out
,UI¡32 
size_out
,UI¡32 
w‹k_buff
,UI¡32 
ba£
)

282 
UI¡32
 
v¨4
=0,
v¨8
=0,
v¨c
=0,
v¨10
=0,
v¨14
=0;

283 
UI¡32
 
Êag
=0,
tmp0
=0,
tmp1
=0,
tmp2
=0,
tmp3
=0,
tmp4
=0,
tmp5
=0;

286 if(
size_out
==0)

288 
tmp0
=
w‹k_buff
;

289 if(*((
UI¡32
 *)(
tmp0
+8))<=8) {

290 
tmp3
=*((
UI¡32
 *)
tmp0
);

291 *((
UI¡32
 *)(
tmp0
+4))|=((UI¡32)*((
UI¡16
 *)
tmp3
)&0xFFFF)<<(*((UInt32 *)(tmp0+8))&0xFF);

292 *((
UI¡32
 *)(
tmp0
+8))+=0x10;

293 *((
UI¡32
 *)
tmp0
)+=2;

295 *((
UI¡32
 *)(
tmp0
+8))+=0xFFFFFFF8;

296 
v¨c
=*((
UI¡32
 *)(
tmp0
+4))&0xFF;

297 *((
UI¡32
 *)(
tmp0
+4))=*((UInt32 *)(tmp0+4))>>8;

298 
	`Sub_WavU≈1
(
v¨c
,
ba£
);

299 if((
v¨c
&0xFF)==0)

300 *((
UI¡32
 *)
ba£
)=1;

302 *((
UI¡32
 *)
ba£
)=0;

303 
v¨c
=
buf_out
;

306 if(*((
UI¡32
 *)(
tmp0
+8))<=7) {

307 
tmp3
=*((
UI¡32
 *)
tmp0
);

308 *((
UI¡32
 *)(
tmp0
+4))|=((UI¡32)*((
UI¡16
 *)
tmp3
)&0xFFFF)<<(*((UInt32 *)(tmp0+8))&0xFF);

309 *((
UI¡32
 *)(
tmp0
+8))+=0x10;

310 *((
UI¡32
 *)
tmp0
)+=2;

312 
tmp3
=*((
UI¡32
 *)(
tmp0
+4));

313 
tmp4
=
tmp3
&0x7F;

314 
tmp2
=
ba£
+(
tmp4
+0x45F)*12;

315 
tmp1
=*((
UI¡32
 *)
tmp2
);

316 
v¨8
=0;

317 
Êag
=1;

318 if(
tmp1
==*((
UI¡32
 *)(
ba£
+4))) {

319 
v¨8
=1;

320 
tmp5
=*((
UI¡32
 *)(
tmp2
+4));

321 if(
tmp5
>7) {

322 *((
UI¡32
 *)(
tmp0
+4))=*((UInt32 *)(tmp0+4))>>7;

323 *((
UI¡32
 *)(
tmp0
+8))+=0xFFFFFFF9;

324 
v¨14
=*((
UI¡32
 *)(
tmp2
+8));

326 *((
UI¡32
 *)(
tmp0
+4))=*((UI¡32 *)—mp0+4))>>(*((UI¡32 *)(
tmp2
+4))&0xFF);

327 *((
UI¡32
 *)(
tmp0
+8))-=*((UI¡32 *)(
tmp2
+4));

328 
tmp5
=*((
UI¡32
 *)(
tmp2
+8));

329 
Êag
=0;

332 
tmp5
=*((
UI¡32
 *)(
ba£
+0x3060));

333 
tmp3
=*((
UI¡32
 *)
tmp5
);

334 
v¨14
=*((
UI¡32
 *)(
tmp3
+4));

335 
tmp3
=
v¨14
;

336 if((
SI¡32
)
v¨14
<=0)

337 
v¨14
=0;

339 if(
Êag
) {

340 
v¨10
=0;

342 
v¨14
=*((
UI¡32
 *)(var14+0x14));

343 if(
	`Sub_WavU≈8
(
tmp0
)) {

344 
tmp3
=*((
UI¡32
 *)(
v¨14
+4));

345 
v¨14
=
tmp3
;

347 
tmp3
=
v¨14
;

348 
v¨10
++;

349 if(
v¨10
==7)

350 
v¨4
=
tmp3
;

351 } *((
UI¡32
 *)(
tmp3
+0x14)));

352 if(
v¨8
==0) {

353 if(
v¨10
>7) {

354 *((
UI¡32
 *)
tmp2
)=*((UI¡32 *)(
ba£
+4));

355 *((
UI¡32
 *)(
tmp2
+4))=
v¨10
;

356 *((
UI¡32
 *)(
tmp2
+8))=
v¨4
;

358 
tmp3
=(((
v¨10
|0xFFFFFFFF)>>((0x20-v¨10)&0xFF)))&
tmp4
;

359 
tmp1
=1<<(
v¨10
&0xFF);

360 
tmp5
=
ba£
+0x347C+
tmp3
*12;

361 
tmp2
=(
tmp1
*3)<<2;

363 
tmp3
+=
tmp1
;

364 *((
UI¡32
 *)(
tmp5
-8))=*((UI¡32 *)(
ba£
+4));

365 *((
UI¡32
 *)(
tmp5
-4))=
v¨10
;

366 *((
UI¡32
 *)
tmp5
)=*((UI¡32 *)(
v¨14
+8));

367 
tmp5
+=
tmp2
;

368 } 
tmp3
<=0x7F);

371 
v¨10
=*((
UI¡32
 *)(
v¨14
+8));

372 
tmp5
=
v¨10
;

374 if(
tmp5
==0x101) {

375 
tmp5
=*((
UI¡32
 *)(
tmp0
+8));

376 if(
tmp5
<=8) {

377 
tmp3
=*((
UI¡32
 *)
tmp0
);

378 *((
UI¡32
 *)(
tmp0
+4))|=((UI¡32)*((
UI¡16
 *)
tmp3
)&0xFFFF)<<(*((UInt32 *)(tmp0+8))&0xFF);

379 *((
UI¡32
 *)(
tmp0
+8))+=0x10;

380 *((
UI¡32
 *)
tmp0
)+=2;

382 
tmp2
=*((
UI¡32
 *)(
tmp0
+4))&0xFF;

383 *((
UI¡32
 *)(
tmp0
+4))=*((UInt32 *)(tmp0+4))>>8;

384 *((
UI¡32
 *)(
tmp0
+8))+=0xFFFFFFF8;

385 
v¨10
=
tmp2
;

386 
	`Sub_WavU≈9
(
tmp2
,
ba£
);

387 if(*((
UI¡32
 *)
ba£
)==0) {

388 
tmp2
=*((
UI¡32
 *)(
ba£
+tmp2*4+0x306C));

389 if(
tmp2
) {

390 
tmp2
) {

391 
tmp3
=*((
UI¡32
 *)(
tmp2
+0xC));

392 
tmp3
++;

393 *((
UI¡32
 *)(
tmp2
+0xC))=
tmp3
;

394 
tmp0
=
tmp2
;

395 
tmp5
=
tmp3
;

397 
tmp4
=*((
UI¡32
 *)(
tmp0
+4));

398 if((
SI¡32
)
tmp4
<0)

399 
tmp4
=0;

400 if(
tmp4
) {

401 if(*((
UI¡32
 *)(
tmp4
+0xC))<
tmp5
)

402 
tmp0
=
tmp4
;

408 if(
tmp0
!=
tmp2
) {

409 
	`Sub_WavU≈4
(
tmp0
,2,
tmp2
,
ba£
+0x305C);

410 
	`Sub_WavU≈4
(
tmp2
,2,
tmp4
,
ba£
+0x305C);

411 
tmp3
=*((
UI¡32
 *)(
tmp0
+0x10));

412 
tmp5
=*((
UI¡32
 *)(
tmp3
+0x14));

413 
tmp3
=*((
UI¡32
 *)(
tmp2
+0x10));

414 if(*((
UI¡32
 *)(
tmp3
+0x14))==
tmp2
)

415 *((
UI¡32
 *)(
tmp3
+0x14))=
tmp0
;

416 if(
tmp5
==
tmp0
) {

417 
tmp5
=*((
UI¡32
 *)(
tmp0
+0x10));

418 *((
UI¡32
 *)(
tmp5
+0x14))=
tmp2
;

420 
tmp3
=*((
UI¡32
 *)(
tmp2
+0x10));

421 *((
UI¡32
 *)(
tmp2
+0x10))=*((UI¡32 *)(
tmp0
+0x10));

422 *((
UI¡32
 *)(
tmp0
+0x10))=
tmp3
;

423 *((
UI¡32
 *)(
ba£
+4))+=1;

425 
tmp2
=*((
UI¡32
 *)(tmp2+0x10));

427 
tmp5
=
v¨10
;

428 
tmp0
=
w‹k_buff
;

431 
tmp5
=
v¨10
;

434 
tmp5
=
v¨10
;

436 
tmp3
=
v¨c
;

437 if(
tmp5
!=0x100)

439 
size_out
--;

440 *((
UI¡8
 *)
v¨c
)=(UI¡8)
tmp5
&0xFF;

441 
tmp3
++;

442 
v¨c
=
tmp3
;

443 if(
size_out
) {

444 if(*((
UI¡32
 *)
ba£
)) {

445 
tmp3
=*((
UI¡32
 *)(
ba£
+
tmp5
*4+0x306C));

446 
	`Sub_WavU≈10
(
tmp3
,
ba£
);

449  
tmp3
-
buf_out
;

452  
tmp3
-
buf_out
;

454 
	}
}

458 
	$Sub_WavU≈1
(
UI¡32
 
¨g1
,UI¡32 
ba£
)

460 
UI¡32
 
v¨_4
=0,
v¨_8
=0,
v¨_c
=0;

461 
UI¡32
 
tmp0
=0,
tmp1
=0,
tmp2
=0,
tmp3
=0,
tmp4
=0;

462 
SI¡32
 
i
=0;

465 (
SI¡32
)*((
UI¡32
 *)(
ba£
+0x3064))>0) {

466 
tmp0
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)(
ba£
+0x3050)),*((UInt32 *)(base+0x3064)));

467 if(*((
UI¡32
 *Ë
tmp0
))

468 
	`Sub_WavU≈3
(
tmp0
);

469 
tmp2
=
ba£
+0x3054;

470 *((
UI¡32
 *)(
tmp0
))=
tmp2
;

471 *((
UI¡32
 *)(
tmp0
+4))=*((UI¡32 *)(
tmp2
+4));

472 
tmp3
=*((
UI¡32
 *)(
tmp2
+4));

473 if((
SI¡32
)
tmp3
<=0)

474 
tmp3
=~tmp3;

475 
tmp3
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)(
ba£
+0x3050)),tmp3);

476 *((
UI¡32
 *)
tmp3
)=(UI¡32)
tmp0
;

477 *((
UI¡32
 *)(
tmp2
+4))=
ba£
;

479 
tmp0
=
ba£
+0x306c;

480 
i
=0x102;i!=0;i--) {

481 *((
UI¡32
 *)
tmp0
)=0;

482 
tmp0
+=4;

484 
v¨_c
=0;

485 
v¨_8
=
ba£
+0x306C;

486 
tmp1
=(
UI¡32
)
wav_èbÀ
+(((
¨g1
&0xff)<<7)+(arg1&0xff))*2;

487 
v¨_4
=
tmp1
;

488 
tmp0
=0;

489 
tmp0
<0x100) {

490 if(*((
UI¡8
 *)(
tmp0
+
tmp1
))) {

491 
tmp2
=*((
UI¡32
 *)(
ba£
+0x3058));

492 if((
SI¡32
)
tmp2
<=0) {

493 
tmp2
=*((
UI¡32
 *)(
ba£
+0x3068))*24+base+8;

494 *((
UI¡32
 *)(
ba£
+0x3068))=*((UInt32 *)(base+0x3068))+1;

496 
	`Sub_WavU≈4
(
tmp2
,2,0,
ba£
+0x305C);

497 *((
UI¡32
 *)(
tmp2
+0x10))=0;

498 *((
UI¡32
 *)(
tmp2
+0x14))=0;

499 *((
UI¡32
 *)
v¨_8
)=
tmp2
;

500 *((
UI¡32
 *)(
tmp2
+8))=
tmp0
;

501 
tmp3
=*((
UI¡32
 *)(
tmp0
+
tmp1
))&0xFF;

502 *((
UI¡32
 *)(
tmp2
+0xC))=
tmp3
;

503 if(
tmp3
>=
v¨_c
)

504 
v¨_c
=
tmp3
;

506 
tmp1
=*((
UI¡32
 *)(
ba£
+0x3064));

507 if((
SI¡32
)
tmp1
>0) {

508 
tmp1
) {

509 if(*((
UI¡32
 *)(
tmp1
+0xC))<
tmp3
)

510 
tmp1
=*((
UI¡32
 *)(tmp1+4));

515 
tmp1
=0;

516 
¨g1
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)(
ba£
+0x305C)),
tmp2
);

517 if(*((
UI¡32
 *)
¨g1
))

518 
	`Sub_WavU≈3
(
¨g1
);

519 if(
tmp1
)

520 
tmp3
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)(
ba£
+0x305C)),
tmp1
);

522 
tmp3
=
ba£
+0x3060;

523 
tmp4
=*((
UI¡32
 *)
tmp3
);

524 *((
UI¡32
 *)
¨g1
)=
tmp4
;

525 *((
UI¡32
 *)(
¨g1
+4))=*((UI¡32 *)(
tmp4
+4));

526 
tmp1
=
v¨_4
;

527 *((
UI¡32
 *)(
tmp4
+4))=
tmp2
;

528 *((
UI¡32
 *)
tmp3
)=
¨g1
;

531 
v¨_8
+=4;

532 
tmp0
++;

534 if(
tmp0
<0x102) {

535 
tmp1
=
ba£
+
tmp0
*4+0x306C;

536 
tmp0
<0x102) {

537 
tmp2
=*((
UI¡32
 *)(
ba£
+0x3058));

538 if((
SI¡32
)
tmp2
<=0) {

539 
tmp2
=
ba£
+*((
UI¡32
 *)(base+0x3068))*24+8;

540 *((
UI¡32
 *)(
ba£
+0x3068))=*((UInt32 *)(base+0x3068))+1;

543 
	`Sub_WavU≈4
(
tmp2
,1,0,
ba£
+0x305C);

544 
tmp1
+=4;

545 *((
UI¡32
 *)(
tmp2
+0x10))=0;

546 *((
UI¡32
 *)(
tmp2
+0x14))=0;

547 *((
UI¡32
 *)(
tmp1
-4))=
tmp2
;

548 *((
UI¡32
 *)(
tmp2
+8))=
tmp0
;

549 
tmp0
++;

550 *((
UI¡32
 *)(
tmp2
+0xC))=1;

553 
tmp0
=*((
UI¡32
 *)(
ba£
+0x3064));

554 if((
SI¡32
)
tmp0
<=0)

555 
tmp0
=0;

556 
tmp0
) {

557 
tmp1
=*((
UI¡32
 *)(
tmp0
+4));

558 if((
SI¡32
)
tmp1
<=0)

559 
tmp1
=0;

560 
¨g1
=
tmp1
;

561 if(
tmp1
) {

562 
tmp2
=*((
UI¡32
 *)(
ba£
+0x3058));

563 if((
SI¡32
)
tmp2
<=0) {

564 
tmp2
=
ba£
+*((
UI¡32
 *)(base+0x3068))*24+8;

565 *((
UI¡32
 *)(
ba£
+0x3068))=*((UInt32 *)(base+0x3068))+1;

567 
	`Sub_WavU≈4
(
tmp2
,2,0,
ba£
+0x305C);

568 *((
UI¡32
 *)(
tmp2
+0x10))=0;

569 *((
UI¡32
 *)(
tmp2
+0x14))=0;

570 *((
UI¡32
 *)(
tmp2
+0x14))=
tmp0
;

571 *((
UI¡32
 *)(
tmp2
+0xC))=*((UI¡32 *)(
tmp1
+0xC))+*((UI¡32 *)(
tmp0
+0xC));

572 *((
UI¡32
 *)(
tmp0
+0x10))=
tmp2
;

573 *((
UI¡32
 *)(
tmp1
+0x10))=
tmp2
;

574 
tmp3
=*((
UI¡32
 *)(
tmp2
+0xC));

575 if(
tmp3
>=
v¨_c
)

576 
v¨_c
=
tmp3
;

578 
tmp1
=*((
UI¡32
 *)(tmp1+4));

579 
tmp0
=
tmp1
;

580 if((
SI¡32
)
tmp0
<=0)

581 
tmp0
=0;

582 
tmp0
) {

583 if(*((
UI¡32
 *)(
tmp0
+0xC))<
tmp3
) {

584 
tmp0
=*((
UI¡32
 *)(tmp0+4));

585 if((
SI¡32
)
tmp0
<=0)

586 
tmp0
=0;

591 
tmp1
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)(
ba£
+0x305C)),
tmp2
);

592 if(*((
UI¡32
 *)(
tmp1
))) {

593 
tmp3
=
	`Sub_WavU≈5
(
tmp1
);

594 *((
UI¡32
 *)(
tmp3
))=*((UI¡32 *)(
tmp1
));

595 
tmp4
=*((
UI¡32
 *)
tmp1
);

596 *((
UI¡32
 *)(
tmp4
+4))=*((UI¡32 *)(
tmp1
+4));

597 *((
UI¡32
 *)
tmp1
)=0;

598 *((
UI¡32
 *)(
tmp1
+4))=0;

600 if(
tmp0
)

601 
tmp3
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)(
ba£
+0x305C)),
tmp0
);

603 
tmp3
=
ba£
+0x3060;

604 
tmp4
=*((
UI¡32
 *)(
tmp3
));

605 *((
UI¡32
 *)(
tmp1
))=
tmp4
;

606 *((
UI¡32
 *)(
tmp1
+4))=*((UI¡32 *)(
tmp4
+4));

607 *((
UI¡32
 *)(
tmp4
+4))=
tmp2
;

608 *((
UI¡32
 *)(
tmp3
))=
tmp1
;

609 
tmp1
=
¨g1
;

611 
tmp0
=*((
UI¡32
 *)(
tmp1
+4));

612 if((
SI¡32
)
tmp0
<=0)

613 
tmp0
=0;

617 *((
UI¡32
 *)(
ba£
+4))=1;

619 
	}
}

623 
	$Sub_WavU≈9
(
UI¡32
 
¨g1
,UI¡32 
¨g2
)

625 
UI¡32
 
v¨4
=0,
v¨8
=0,
tmp0
=0,
tmp1
=0,
tmp2
=0,
tmp3
=0,
tmp4
=0;

628 
tmp0
=*((
UI¡32
 *)(
¨g2
+0x3064));

629 if((
SI¡32
)
tmp0
<0)

630 
tmp0
=0;

631 
tmp2
=*((
UI¡32
 *)(
¨g2
+0x3058));

632 if((
SI¡32
)
tmp2
<0)

633 
tmp2
=0;

634 
v¨4
=
¨g2
;

635 if(
tmp2
==0) {

636 
tmp2
=
v¨4
+*((
UI¡32
 *)(var4+0x3068))*24+8;

637 *((
UI¡32
 *)(
v¨4
+0x3068))+=1;

639 
v¨8
=
¨g2
+0x305C;

640 
tmp1
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)
v¨8
),
tmp2
);

641 if(*((
UI¡32
 *)
tmp1
)) {

642 
tmp3
=
	`Sub_WavU≈5
(
tmp1
);

643 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)
tmp1
);

644 
tmp3
=*((
UI¡32
 *)
tmp1
);

645 *((
UI¡32
 *)(
tmp3
+4))=*((UI¡32 *)(
tmp1
+4));

646 *((
UI¡32
 *)
tmp1
)=0;

647 *((
UI¡32
 *)(
tmp1
+4))=0;

649 *((
UI¡32
 *)
tmp1
)=
v¨8
+4;

650 *((
UI¡32
 *)(
tmp1
+4))=*((UI¡32 *)(
v¨8
+8));

651 
tmp3
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)
v¨8
),
	`Sub_WavU≈7
(var8+4));

652 *((
UI¡32
 *)
tmp3
)=
tmp1
;

653 *((
UI¡32
 *)(
v¨8
+8))=
tmp2
;

654 *((
UI¡32
 *)(
tmp2
+0x10))=0;

655 *((
UI¡32
 *)(
tmp2
+0x14))=0;

656 *((
UI¡32
 *)(
tmp2
+8))=*((UI¡32 *)(
tmp0
+8));

657 *((
UI¡32
 *)(
tmp2
+0xC))=*((UI¡32 *)(
tmp0
+0xC));

658 *((
UI¡32
 *)(
tmp2
+0x10))=
tmp0
;

659 *((
UI¡32
 *)(
v¨4
+*((UI¡32 *)(
tmp0
+8))*4+0x306C))=
tmp2
;

660 
tmp2
=*((
UI¡32
 *)(
v¨4
+0x3058));

661 if((
SI¡32
)
tmp2
<0)

662 
tmp2
=0;

663 if(
tmp2
==0) {

664 
tmp2
=
v¨4
+*((
UI¡32
 *)(var4+0x3068))*24+8;

665 *((
UI¡32
 *)(
v¨4
+0x3068))+=1;

667 
tmp1
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)
v¨8
),
tmp2
);

668 if(*((
UI¡32
 *)
tmp1
)) {

669 
tmp3
=
	`Sub_WavU≈5
(
tmp1
);

670 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)
tmp1
);

671 
tmp3
=*((
UI¡32
 *)
tmp1
);

672 *((
UI¡32
 *)(
tmp3
+4))=*((UI¡32 *)(
tmp1
+4));

673 *((
UI¡32
 *)
tmp1
)=0;

674 *((
UI¡32
 *)(
tmp1
+4))=0;

676 *((
UI¡32
 *)
tmp1
)=
v¨8
+4;

677 *((
UI¡32
 *)(
tmp1
+4))=*((UI¡32 *)(
v¨8
+8));

678 
tmp3
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)
v¨8
),
	`Sub_WavU≈7
(var8+4));

679 *((
UI¡32
 *)
tmp3
)=
tmp1
;

680 
tmp3
=
¨g1
;

681 *((
UI¡32
 *)(
v¨8
+8))=
tmp2
;

682 *((
UI¡32
 *)(
tmp2
+0x14))=0;

683 *((
UI¡32
 *)(
tmp2
+8))=
tmp3
;

684 *((
UI¡32
 *)(
tmp2
+0xC))=0;

685 *((
UI¡32
 *)(
tmp2
+0x10))=
tmp0
;

686 *((
UI¡32
 *)(
v¨4
+
tmp3
*4+0x306C))=
tmp2
;

687 *((
UI¡32
 *)(
tmp0
+0x14))=
tmp2
;

688 
tmp2
) {

689 
tmp4
=
tmp2
;

690 *((
UI¡32
 *)(
tmp2
+0xC))+=1;

691 
tmp3
=*((
UI¡32
 *)(
tmp2
+0xC));

693 
tmp1
=*((
UI¡32
 *)(
tmp4
+4));

694 if((
SI¡32
)
tmp1
<=0) {

695 
tmp1
=0;

698 if(*((
UI¡32
 *)(
tmp1
+0xC))>=
tmp3
)

700 
tmp4
=
tmp1
;

702 if(
tmp4
!=
tmp2
) {

703 
	`Sub_WavU≈4
(
tmp4
,2,
tmp2
,
v¨8
);

704 
	`Sub_WavU≈4
(
tmp2
,2,
tmp1
,
v¨8
);

705 
tmp3
=*((
UI¡32
 *)(
tmp4
+0x10));

706 
tmp1
=*((
UI¡32
 *)(
tmp2
+0x10));

707 
tmp0
=*((
UI¡32
 *)(
tmp3
+0x14));

708 
tmp3
=*((
UI¡32
 *)(
tmp1
+0x14));

709 if(
tmp3
==
tmp2
)

710 *((
UI¡32
 *)(
tmp1
+0x14))=
tmp4
;

711 if(
tmp0
==
tmp4
) {

712 
tmp1
=*((
UI¡32
 *)(
tmp4
+0x10));

713 *((
UI¡32
 *)(
tmp1
+0x14))=
tmp2
;

715 
tmp3
=*((
UI¡32
 *)(
tmp2
+0x10));

716 *((
UI¡32
 *)(
tmp2
+0x10))=*((UI¡32 *)(
tmp4
+0x10));

717 *((
UI¡32
 *)(
tmp4
+0x10))=
tmp3
;

718 *((
UI¡32
 *)(
v¨4
+4))+=1;

720 
tmp2
=*((
UI¡32
 *)(tmp2+0x10));

723 
	}
}

727 
	$Sub_WavU≈6
(
UI¡32
 
±r_ba£
)

729 
UI¡32
 
±r1
=0;

730 
SI¡32
 
i
=0;

733 
±r1
=
±r_ba£
+8;

734 
i
=0x203;i!=0;i--) {

735 *((
UI¡32
 *)
±r1
)=0;

736 *((
UI¡32
 *)(
±r1
+4))=0;

737 
±r1
+=0x18;

739 
±r1
=
±r_ba£
+0x3054;

740 *((
UI¡32
 *)
±r1
)=0;

741 *((
UI¡32
 *)(
±r1
+4))=0;

742 *((
UI¡32
 *)
±r1
)=ptr1;

743 *((
UI¡32
 *)(
±r_ba£
+0x3050))=0;

744 *((
UI¡32
 *)(
±r_ba£
+0x3058))=~
±r1
;

745 
±r1
=
±r_ba£
+0x3060;

746 *((
UI¡32
 *)
±r1
)=0;

747 *((
UI¡32
 *)(
±r1
+4))=0;

748 *((
UI¡32
 *)
±r1
)=(UInt32)Ötr1;

749 *((
UI¡32
 *)(
±r_ba£
+0x305C))=0;

750 *((
UI¡32
 *)(
±r_ba£
+0x3064))=~
±r1
;

751 *((
UI¡32
 *)(
±r_ba£
+0x3068))=0;

752 *((
UI¡32
 *)(
±r_ba£
+4))=1;

754 
	}
}

758 
UI¡32
 
	$Sub_WavU≈2
(
UI¡32
 
¨g1
,UI¡32 
¨g2
,UI¡32 
¨g3
)

760 if(
¨g1
)

761  
¨g3
+
¨g2
;

762  
¨g3
;

763 
	}
}

767 
	$Sub_WavU≈3
(
UI¡32
 
±r
)

769 
UI¡32
 
±r0
=0,
±r1
=0;

772 
±r0
=*((
UI¡32
 *)
±r
);

773 if(
±r0
) {

774 
±r1
=*((
UI¡32
 *)(
±r
+4));

775 if((
SI¡32
)
±r1
<0)

776 
±r1
=~ptr1;

778 
±r1
ıå1+
±r
-*((
UI¡32
 *)(
±r0
+4));

779 *((
UI¡32
 *)
±r1
)=
±r0
;

780 *((
UI¡32
 *)(
±r0
+4))=*((UI¡32 *)(
±r
+4));

781 *((
UI¡32
 *)
±r
)=0;

782 *((
UI¡32
 *)(
±r
+4))=0;

785 
	}
}

789 
	$Sub_WavU≈4
(
UI¡32
 
¨g1
,UI¡32 
¨g2
,UI¡32 
¨g3
,UI¡32 
¨g4
)

791 
UI¡32
 
tmp0
=0,
tmp1
=0;

794 
tmp0
=*((
UI¡32
 *)
¨g1
);

795 if(
tmp0
) {

796 
tmp1
=*((
UI¡32
 *)(
¨g1
+4));

797 if((
SI¡32
)
tmp1
<0)

798 
tmp1
=~tmp1;

800 
tmp1
+=
¨g1
-*((
UI¡32
 *)(
tmp0
+4));

801 *((
UI¡32
 *)
tmp1
)=(UI¡32)
tmp0
;

802 *((
UI¡32
 *)(
tmp0
+4))=*((UI¡32 *)(
¨g1
+4));

803 *((
UI¡32
 *)
¨g1
)=0;

804 *((
UI¡32
 *)(
¨g1
+4))=0;

806 if(
¨g3
==0)

807 
¨g3
=
¨g4
+4;

808 if(
¨g2
-1) {

809 if((
¨g2
-2)==0) {

810 
tmp1
=*((
UI¡32
 *)
¨g3
);

811 *((
UI¡32
 *)
¨g1
)=
tmp1
;

812 *((
UI¡32
 *)(
¨g1
+4))=*((UI¡32 *)(
tmp1
+4));

813 *((
UI¡32
 *)(
tmp1
+4))=
¨g1
;

814 *((
UI¡32
 *)
¨g3
)=
¨g1
;

818 *((
UI¡32
 *)
¨g1
)=
¨g3
;

819 *((
UI¡32
 *)(
¨g1
+4))=*((UI¡32 *)(
¨g3
+4));

820 
tmp1
=*((
UI¡32
 *)(
¨g3
+4));

821 if((
SI¡32
)
tmp1
<=0)

822 
tmp1
=~tmp1;

823 *((
UI¡32
 *)
tmp1
)=
¨g1
;

824 *((
UI¡32
 *)(
¨g3
+4))=
¨g1
;

826 
	}
}

830 
UI¡32
 
	$Sub_WavU≈5
(
UI¡32
 
¨g1
)

832 
UI¡32
 
tmp0
=0,
tmp1
=0;

835 
tmp0
=*((
UI¡32
 *)(
¨g1
+4));

836 if((
SI¡32
)
tmp0
<0)

837  ~
tmp0
;

838 
tmp1
=*((
UI¡32
 *)
¨g1
);

839 
tmp0
+=
¨g1
-*((
UI¡32
 *)(
tmp1
+4));

840  
tmp0
;

841 
	}
}

845 
UI¡32
 
	$Sub_WavU≈7
(
UI¡32
 
¨g1
)

847 
UI¡32
 
tmp
=0;

850 
tmp
=*((
UI¡32
 *)(
¨g1
+4));

851 if((
SI¡32
)
tmp
<=0)

852  ~
tmp
;

853  
tmp
;

854 
	}
}

858 
UI¡32
 
	$Sub_WavU≈8
(
UI¡32
 
¨g1
)

860 
UI¡32
 
tmp0
=0,
tmp1
=0;

863 
tmp0
=*((
UI¡32
 *)(
¨g1
+4));

864 *((
UI¡32
 *)(
¨g1
+4))=
tmp0
>>1;

865 
tmp0
&=1;

866 *((
UI¡32
 *)(
¨g1
+8))-=1;

867 if(*((
UI¡32
 *)(
¨g1
+8))==0) {

868 
tmp1
=*((
UI¡32
 *)
¨g1
);

869 *((
UI¡32
 *)
¨g1
)+=4;

870 *((
UI¡32
 *)(
¨g1
+4))=*((UI¡32 *)
tmp1
);

871 *((
UI¡32
 *)(
¨g1
+8))=0x20;

873  
tmp0
;

874 
	}
}

878 
	$Sub_WavU≈10
(
UI¡32
 
¨g1
,UI¡32 
¨g2
)

880 
UI¡32
 
tmp0
=0,
tmp1
=0,
tmp2
=0,
tmp3
=0,
¨g2_ﬁd
=0;

883 
¨g2_ﬁd
=
¨g2
;

884 
¨g1
) {

885 
tmp2
=
¨g1
;

886 *((
UI¡32
 *)(
¨g1
+0xC))+=1;

887 
tmp3
=*((
UI¡32
 *)(
¨g1
+0xC));

889 
tmp0
=*((
UI¡32
 *)(
tmp2
+4));

890 if((
SI¡32
)
tmp0
<=0) {

891 
tmp0
=0;

894 if(*((
UI¡32
 *)(
tmp0
+0xC))>=
tmp3
)

896 
tmp2
=
tmp0
;

898 if(
tmp2
!=
¨g1
) {

899 if(*((
UI¡32
 *)
tmp2
)) {

900 
tmp3
=
	`Sub_WavU≈5
(
tmp2
);

901 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)
tmp2
);

902 
tmp1
=*((
UI¡32
 *)
tmp2
);

903 *((
UI¡32
 *)(
tmp1
+4))=*((UI¡32 *)(
tmp2
+4));

904 *((
UI¡32
 *)
tmp2
)=0;

905 *((
UI¡32
 *)(
tmp2
+4))=0;

907 
tmp1
=
¨g1
;

908 if(
tmp1
==0)

909 
tmp1
=
¨g2
+0x3060;

910 
tmp3
=*((
UI¡32
 *)
tmp1
);

911 *((
UI¡32
 *)
tmp2
)=
tmp3
;

912 *((
UI¡32
 *)(
tmp2
+4))=*((UI¡32 *)(
tmp3
+4));

913 *((
UI¡32
 *)
tmp1
)=
tmp2
;

914 
¨g2
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)◊rg2+0x205C)),
¨g1
);

915 if(*((
UI¡32
 *)
¨g2
)) {

916 
tmp3
=
	`Sub_WavU≈5
(
¨g2
);

917 *((
UI¡32
 *)
tmp3
)=*((UI¡32 *)
¨g2
);

918 
tmp1
=*((
UI¡32
 *)
¨g2
);

919 *((
UI¡32
 *)(
tmp1
+4))=*((UI¡32 *)(
¨g2
+4));

920 *((
UI¡32
 *)
¨g2
)=0;

921 *((
UI¡32
 *)(
¨g2
+4))=0;

923 if(
tmp0
)

924 
tmp3
=
	`Sub_WavU≈2
(0,*((
UI¡32
 *)(
¨g2_ﬁd
+0x305C)),
tmp0
);

926 
tmp3
=
¨g2_ﬁd
+0x3060;

927 
tmp1
=*((
UI¡32
 *)
tmp3
);

928 *((
UI¡32
 *)
¨g2
)=
tmp1
;

929 
tmp0
=*((
UI¡32
 *)(
tmp1
+4));

930 *((
UI¡32
 *)(
¨g2
+4))=
tmp0
;

931 *((
UI¡32
 *)(
tmp1
+4))=
¨g1
;

932 *((
UI¡32
 *)
tmp3
)=
¨g2
;

933 
tmp3
=*((
UI¡32
 *)(
tmp2
+0x10));

934 
tmp1
=*((
UI¡32
 *)(
tmp3
+0x14));

935 
tmp3
=*((
UI¡32
 *)(
¨g1
+0x10));

936 if(*((
UI¡32
 *)(
tmp3
+0x14))==
¨g1
)

937 *((
UI¡32
 *)(
tmp3
+0x14))=
tmp2
;

938 if(
tmp1
==
tmp2
) {

939 
tmp1
=*((
UI¡32
 *)(
tmp2
+0x10));

940 *((
UI¡32
 *)(
tmp1
+0x14))=
¨g1
;

942 
tmp3
=*((
UI¡32
 *)(
¨g1
+0x10));

943 *((
UI¡32
 *)(
¨g1
+0x10))=*((UI¡32 *)(
tmp2
+0x10));

944 *((
UI¡32
 *)(
tmp2
+0x10))=
tmp3
;

945 
¨g2
=
¨g2_ﬁd
;

946 *((
UI¡32
 *)(
¨g2_ﬁd
+4))+=1;

948 
¨g1
=*((
UI¡32
 *)(arg1+0x10));

951 
	}
}

953 #ifde‡
WIN32


954 #¥agm®
w¨nög
 (
p›
)

	@mpq/wav_unp.h

3 
	~"mpqty≥s.h
"

5 
UI¡8
 
	gwav_èbÀ
[2512] =

322 
UI¡32
 
	gsmÆl_tbl1
[90] =

335 
UI¡32
 
	gsmÆl_tbl2
[32] =

	@msg_quit.c

1 
	~"°ru˘s.h
"

2 
	~"wmsg.h
"

3 
	~"msg_quô.h
"

13 
	$msg_quô_maö
()

15 
WMSG_BUT_S
 
buâ⁄s
[4];

16 
WMSG_S
 
wmsg_quô
;

17 
cﬁ_bœck
 = 
	`makecﬁ
(0, 0, 0),

18 
cﬁ_midgªí
 = 
	`makecﬁ
(0, 128, 0),

19 
cﬁ_whôe
 = 
	`makecﬁ
(255, 255, 255),

20 
cﬁ_gªí
 = 
	`makecﬁ
(0, 255, 0);

24 
	`mem£t
(
buâ⁄s
, 0, (buttons));

27 
buâ⁄s
[0].
ãxt
 = "(S) SAVE ALL & QUIT";

28 
buâ⁄s
[0].
right_•a˚s
 = 3;

29 
buâ⁄s
[0].
⁄
.
fg
 = 
cﬁ_bœck
;

30 
buâ⁄s
[0].
⁄
.
bg
 = 
cﬁ_midgªí
;

31 
buâ⁄s
[0].
⁄
.
b‹dî
 = 
cﬁ_whôe
;

32 
buâ⁄s
[0].
off
.
fg
 = 
cﬁ_gªí
;

33 
buâ⁄s
[0].
off
.
bg
 = 
cﬁ_bœck
;

34 
buâ⁄s
[0].
off
.
b‹dî
 = 
cﬁ_gªí
;

35 
buâ⁄s
[0].
sh‹tcut
[0].
key
[0] = 
KEY_S
;

38 
buâ⁄s
[1].
ãxt
 = " (Q) QUIT ";

39 
buâ⁄s
[1].
right_•a˚s
 = 3;

40 
buâ⁄s
[1].
⁄
.
fg
 = 
cﬁ_bœck
;

41 
buâ⁄s
[1].
⁄
.
bg
 = 
cﬁ_midgªí
;

42 
buâ⁄s
[1].
⁄
.
b‹dî
 = 
cﬁ_whôe
;

43 
buâ⁄s
[1].
off
.
fg
 = 
cﬁ_gªí
;

44 
buâ⁄s
[1].
off
.
bg
 = 
cﬁ_bœck
;

45 
buâ⁄s
[1].
off
.
b‹dî
 = 
cﬁ_gªí
;

46 
buâ⁄s
[1].
sh‹tcut
[0].
key
[0] = 
KEY_A
;

47 
buâ⁄s
[1].
sh‹tcut
[1].
key
[0] = 
KEY_Q
;

50 
buâ⁄s
[2].
ãxt
 = " (Esc) CANCEL ";

51 
buâ⁄s
[2].
right_•a˚s
 = 0;

52 
buâ⁄s
[2].
⁄
.
fg
 = 
cﬁ_bœck
;

53 
buâ⁄s
[2].
⁄
.
bg
 = 
cﬁ_midgªí
;

54 
buâ⁄s
[2].
⁄
.
b‹dî
 = 
cﬁ_whôe
;

55 
buâ⁄s
[2].
off
.
fg
 = 
cﬁ_gªí
;

56 
buâ⁄s
[2].
off
.
bg
 = 
cﬁ_bœck
;

57 
buâ⁄s
[2].
off
.
b‹dî
 = 
cﬁ_gªí
;

58 
buâ⁄s
[2].
sh‹tcut
[0].
key
[0] = 
KEY_ESC
;

61 
wmsg_quô
.
tôÀ
 = "WARNING";

62 
wmsg_quô
.
ãxt
 = "\nYouáreáboutÅo quitÅhe DS1 Editor. What do you wantÅo do ?";

63 
wmsg_quô
.
f⁄t_width
 = 8;

64 
wmsg_quô
.
f⁄t_height
 = 8;

65 
wmsg_quô
.
cﬁ_wö
.
bg
 = 
cﬁ_bœck
;

66 
wmsg_quô
.
cﬁ_wö
.
fg
 = 
cﬁ_whôe
;

67 
wmsg_quô
.
cﬁ_tôÀ
.
bg
 = 
cﬁ_gªí
;

68 
wmsg_quô
.
cﬁ_tôÀ
.
fg
 = 
cﬁ_bœck
;

69 
wmsg_quô
.
cﬁ_ãxt
.
bg
 = -1;

70 
wmsg_quô
.
cﬁ_ãxt
.
fg
 = 
cﬁ_gªí
;

71 
wmsg_quô
.
buâ⁄
 = & 
buâ⁄s
[0];

73  
	`wmsg_maö
–& 
wmsg_quô
);

74 
	}
}

	@msg_quit.h

1 #i‚de‡
_MSG_QUIT_H_


3 
	#_MSG_QUIT_H_


	)

5 
msg_quô_maö
();

	@msg_save.c

1 
	~"°ru˘s.h
"

2 
	~"wmsg.h
"

3 
	~"msg_ßve.h
"

12 
	$msg_ßve_maö
()

14 
WMSG_BUT_S
 
buâ⁄s
[2];

15 
WMSG_S
 
wmsg_ßve
;

16 
cﬁ_bœck
 = 
	`makecﬁ
(0, 0, 0),

17 
cﬁ_midgªí
 = 
	`makecﬁ
(0, 128, 0),

18 
cﬁ_whôe
 = 
	`makecﬁ
(255, 255, 255),

19 
cﬁ_gªí
 = 
	`makecﬁ
(0, 255, 0);

23 
	`mem£t
(
buâ⁄s
, 0, (buttons));

26 
buâ⁄s
[0].
ãxt
 = " OK ";

27 
buâ⁄s
[0].
right_•a˚s
 = 0;

28 
buâ⁄s
[0].
⁄
.
fg
 = 
cﬁ_bœck
;

29 
buâ⁄s
[0].
⁄
.
bg
 = 
cﬁ_midgªí
;

30 
buâ⁄s
[0].
⁄
.
b‹dî
 = 
cﬁ_whôe
;

31 
buâ⁄s
[0].
off
.
fg
 = 
cﬁ_gªí
;

32 
buâ⁄s
[0].
off
.
bg
 = 
cﬁ_bœck
;

33 
buâ⁄s
[0].
off
.
b‹dî
 = 
cﬁ_gªí
;

34 
buâ⁄s
[0].
sh‹tcut
[0].
key
[0] = 
KEY_ENTER
;

35 
buâ⁄s
[0].
sh‹tcut
[1].
key
[0] = 
KEY_ENTER_PAD
;

36 
buâ⁄s
[0].
sh‹tcut
[2].
key
[0] = 
KEY_ESC
;

39 
wmsg_ßve
.
tôÀ
 = "Information";

40 
wmsg_ßve
.
ãxt
 = "\nYour DS1 has been saved";

41 
wmsg_ßve
.
f⁄t_width
 = 8;

42 
wmsg_ßve
.
f⁄t_height
 = 8;

43 
wmsg_ßve
.
cﬁ_wö
.
bg
 = 
cﬁ_bœck
;

44 
wmsg_ßve
.
cﬁ_wö
.
fg
 = 
cﬁ_whôe
;

45 
wmsg_ßve
.
cﬁ_tôÀ
.
bg
 = 
cﬁ_gªí
;

46 
wmsg_ßve
.
cﬁ_tôÀ
.
fg
 = 
cﬁ_bœck
;

47 
wmsg_ßve
.
cﬁ_ãxt
.
bg
 = -1;

48 
wmsg_ßve
.
cﬁ_ãxt
.
fg
 = 
cﬁ_gªí
;

49 
wmsg_ßve
.
buâ⁄
 = & 
buâ⁄s
[0];

51  
	`wmsg_maö
–& 
wmsg_ßve
);

52 
	}
}

	@msg_save.h

1 #i‚de‡
_MSG_SAVE_H_


3 
	#_MSG_SAVE_H_


	)

5 
msg_ßve_maö
();

	@structs.h

1 #i‚de‡
_WINDS1EDIT_STRUCTS_H_


3 
	#_WINDS1EDIT_STRUCTS_H_


	)

6 
	#USE_CONSOLE


	)

8 
	~"ty≥s.h
"

9 
	~<°dio.h
>

10 
	~<°rög.h
>

11 
	~<ÆÀgro.h
>

12 
	~"mpqty≥s.h
"

14 
	#MAX_MPQ_FILE
 4

	)

15 
	#MAX_MOD_DIR
 1

	)

16 
	#DT1_IN_DS1_MAX
 33

	)

17 
	#DS1_MAX
 100

	)

18 
	#DT1_MAX
 300

	)

19 
	#ACT_MAX
 5

	)

20 
	#FLOOR_MAX_LAYER
 2

	)

21 
	#SHADOW_MAX_LAYER
 1

	)

22 
	#TAG_MAX_LAYER
 1

	)

23 
	#WALL_MAX_LAYER
 4

	)

24 
	#OBJ_MAX_START
 100

	)

25 
	#OBJ_MAX_GRANULARITY
 50

	)

26 
	#WINDS1EDIT_PATH_MAX
 100

	)

28 
	#TXT_COL_NAME_LENGTH
 30

	)

30 
	#FLG_SELECTED
 1

	)

31 
	#FLG_HIDE
 2

	)

32 
	#FLG_TMP_SELECT
 4

	)

33 
	#FLG_COPY_INFO
 8

	)

34 
	#FLG_COPY_STATE
 16

	)

37 
	#FLG_MOUSE_OVER
 32

	)

38 
	#FLG_MOVING
 64

	)

39 
	#FLG_ACTIVATED
 128

	)

41 
	#IS_SELECTED
(
x
Ë((xË& 
FLG_SELECTED
)

	)

42 
	#IS_HIDE
(
x
Ë((xË& 
FLG_HIDE
)

	)

43 
	#IS_TMP_SELECT
(
x
Ë((xË& 
FLG_TMP_SELECT
)

	)

44 
	#IS_COPY_INFO
(
x
Ë((xË& 
FLG_COPY_INFO
)

	)

45 
	#IS_COPY_STATE
(
x
Ë((xË& 
FLG_COPY_STATE
)

	)

46 
	#IS_MOUSE_OVER
(
x
Ë((xË& 
FLG_MOUSE_OVER
)

	)

47 
	#IS_MOVING
(
x
Ë((xË& 
FLG_MOVING
)

	)

48 
	#IS_ACTIVATED
(
x
Ë((xË& 
FLG_ACTIVATED
)

	)

50 
	#SET_SELECTED
(
x
Ë((xË|
FLG_SELECTED
)

	)

51 
	#SET_HIDE
(
x
Ë((xË|
FLG_HIDE
)

	)

52 
	#SET_TMP_SELECT
(
x
Ë((xË|
FLG_TMP_SELECT
)

	)

53 
	#SET_COPY_INFO
(
x
Ë((xË|
FLG_COPY_INFO
)

	)

54 
	#SET_COPY_STATE
(
x
Ë((xË|
FLG_COPY_STATE
)

	)

55 
	#SET_MOUSE_OVER
(
x
Ë((xË|
FLG_MOUSE_OVER
)

	)

56 
	#SET_MOVING
(
x
Ë((xË|
FLG_MOVING
)

	)

57 
	#SET_ACTIVATED
(
x
Ë((xË|
FLG_ACTIVATED
)

	)

59 
	#DEL_SELECTED
(
x
Ë((xË&~
FLG_SELECTED
)

	)

60 
	#DEL_HIDE
(
x
Ë((xË&~
FLG_HIDE
)

	)

61 
	#DEL_TMP_SELECT
(
x
Ë((xË&~
FLG_TMP_SELECT
)

	)

62 
	#DEL_COPY_INFO
(
x
Ë((xË&~
FLG_COPY_INFO
)

	)

63 
	#DEL_COPY_STATE
(
x
Ë((xË&~
FLG_COPY_STATE
)

	)

64 
	#DEL_MOUSE_OVER
(
x
Ë((xË&~
FLG_MOUSE_OVER
)

	)

65 
	#DEL_MOVING
(
x
Ë((xË&~
FLG_MOVING
)

	)

66 
	#DEL_ACTIVATED
(
x
Ë((xË&~
FLG_ACTIVATED
)

	)

69 
	#DF_P1
 1

	)

70 
	#DF_P2
 2

	)

71 
	#DF_P3
 4

	)

72 
	#DF_P4
 8

	)

73 
	#DF_OR
 16

	)

74 
	#DF_BT
 32

	)

75 
	#DF_FL
 64

	)

78 
	#MW_SHORTCUT_NUM
 5

	)

79 
	#MW_COMBINATION_KEY_NUM
 5

	)

82 
	#COF_25TRANS
 53

	)

83 
	#COF_50TRANS
 309

	)

84 
	#COF_75TRANS
 565

	)

85 
	#COF_ALPHA
 821

	)

86 
	#COF_LUMINANCE
 1077

	)

87 
	#COF_ALPHABRIGHT
 1461

	)

89 
glb_tûes_∑th
 [30];

90 
glb_ds1edô_d©a_dú
 [80];

91 
glb_ds1edô_tmp_dú
 [80];

92 
GLB_MPQ_S
 
glb_mpq_°ru˘
 [
MAX_MPQ_FILE
];

94 
	sSCREEN_S


96 
	mwidth
;

97 
	mheight
;

98 
	mdïth
;

99 
	mª‰esh
;

100 } 
	tSCREEN_S
;

102 
	sXY_S


104 
	mx
;

105 
	my
;

106 } 
	tXY_S
;

108 
	sSCROLL_S


110 
XY_S
 
	mkeyb
;

111 
XY_S
 
	mmou£
;

112 
XY_S
 
	medô
;

113 
	mobj_edô
;

114 } 
	tSCROLL_S
;

116 
	eGC_ENUM


118 
	mGC_060
, 
	mGC_062
, 
	mGC_064
, 
	mGC_066
, 
	mGC_068
,

119 
	mGC_070
, 
	mGC_072
, 
	mGC_074
, 
	mGC_076
, 
	mGC_078
,

120 
	mGC_080
, 
	mGC_082
, 
	mGC_084
, 
	mGC_086
, 
	mGC_088
,

121 
	mGC_090
, 
	mGC_092
, 
	mGC_094
, 
	mGC_096
, 
	mGC_098
,

122 
	mGC_100
,

123 
	mGC_110
, 
	mGC_120
, 
	mGC_130
, 
	mGC_140
, 
	mGC_150
,

124 
	mGC_160
, 
	mGC_170
, 
	mGC_180
, 
	mGC_190
, 
	mGC_200
,

125 
	mGC_210
, 
	mGC_220
, 
	mGC_230
, 
	mGC_240
, 
	mGC_250
,

126 
	mGC_260
, 
	mGC_270
, 
	mGC_280
, 
	mGC_290
, 
	mGC_300
,

127 
	mGC_MAX


128 } 
	tGC_ENUM
;

130 
	sGAMMA_S


132 
	m°r
[5];

133 
GC_ENUM
 
	mvÆ
;

134 } 
	tGAMMA_S
;

136 
GAMMA_S
 
glb_gamma_°r
[
GC_MAX
];

138 
	sCONFIG_S


140 
	mfuŒs¸ìn
;

141 * 
	mmpq_fûe
[
MAX_MPQ_FILE
];

142 * 
	mmod_dú
[
MAX_MOD_DIR
];

143 
SCREEN_S
 
	ms¸ìn
;

144 
SCROLL_S
 
	ms¸ﬁl
;

145 
GC_ENUM
 
	mgamma
;

146 
XY_S
 
	mmou£_•ìd
;

147 
	mn‹mÆ_ty≥2
;

148 
	mÆways_max_œyîs
;

149 
	m°ªtch_•rôes
;

150 
	mwöobj_s¸ﬁl_keyb
;

151 
	mwöobj_s¸ﬁl_mou£
;

152 
	m˚¡î_zoom
;

153 
	mnb_ty≥1_≥r_a˘
;

154 
	mnb_ty≥2_≥r_a˘
;

155 
	mmöimize_ds1
;

156 
	mlowî_•ìd_zoom_out
;

157 
	mw‹k•a˚_íabÀ
;

158 } 
	tCONFIG_S
;

160 
CONFIG_S
 
glb_c⁄fig
;

162 
	sWIN_PREVIEW_S


164 
	mx0
;

165 
	my0
;

166 
	mw
;

167 
	mh
;

168 } 
	tWIN_PREVIEW_S
;

170 
	eBUT_STATE_E


172 
	mBS_OFF
,

173 
	mBS_ON


174 } 
	tBUT_STATE_E
;

176 
	sBUTTON_S


178 
	mx0
, 
	my0
;

179 
	mw
, 
	mh
;

180 
	ma˘ive
;

181 
	mèb_have_tûes
;

182 
BUT_STATE_E
 
	m°©e
;

183 
	mmou£_ovî
;

184 
BITMAP
 * 
	mbmp
[2];

185 } 
	tBUTTON_S
;

187 
	eBLK_TYP_E


189  
	mBT_NULL
,

190  
	mBT_STATIC
, 
	mBT_ANIMATED
,

191  
	mBT_WALL_UP
, 
	mBT_WALL_DOWN
, 
	mBT_ROOF
, 
	mBT_SPECIAL
, 
	mBT_WALL_ANIMATED
,

192  
	mBT_SHADOW
,

193 
	mBT_MAX


194 } 
	tBLK_TYP_E
;

196 
	eBUT_TYP_E


198  
	mBU_NULL
,

199  
	mBU_FLOOR1
, 
	mBU_FLOOR2
,

200  
	mBU_SHADOW
,

201  
	mBU_WALL1
, 
	mBU_WALL2
, 
	mBU_WALL3
, 
	mBU_WALL4
,

202  
	mBU_OK
, 
	mBU_CANCEL
,

203  
	mBU_VIEW_RAND
,

204 
	mBU_MAX


205 } 
	tBUT_TYP_E
;

207 
	sWIN_ELEMENT_S


210 
	mb_x0
, 
	mb_y0
;

211 
RLE_SPRITE
 * 
	mb‹dî
;

214 
	mi_x0
, 
	mi_y0
;

215 
BITMAP
 * 
	möside
;

216 } 
	tWIN_ELEMENT_S
;

219 
	sSUB_ELM_S


221 
	mbt_idx_èb
;

222 
	mx1
;

223 
	my1
;

224 
	mx2
;

225 
	my2
;

226 
	mis_døw
;

227 } 
	tSUB_ELM_S
;

229 
	sMAIN_LINE_S


231 
SUB_ELM_S
 * 
	msub_ñm
;

232 
	mbt_idx_num
;

233 
	mmax_height
;

234 } 
	tMAIN_LINE_S
;

236 
	sWIN_EDIT_S


238 
BUTTON_S
 
	mbuâ⁄
 [
BU_MAX
];

239 
BUTTON_S
 
	mèb
 [
BT_MAX
];

240 
WIN_ELEMENT_S
 
	mw_¥evõw
;

241 
WIN_ELEMENT_S
 
	mw_tûes
;

242 
MAIN_LINE_S
 * 
	mmaö_löe_èb
[
BT_MAX
];

243 
	mmaö_löe_num
[
BT_MAX
];

244 
BITMAP
 * 
	mtmp_edô
;

245 } 
	tWIN_EDIT_S
;

247 
	eZOOM_E


249 
	mZM_11
,

250 
	mZM_12
,

251 
	mZM_14
,

252 
	mZM_18
,

253 
	mZM_116
,

254 
	mZM_MAX


255 } 
	tZOOM_E
;

258 
	eCMAP_E


260 
	mCM_SELECT
,

261 
	mCM_TRANS
,

262 
	mCM_SHADOW
,

263 
	mCM_MAX


264 } 
	tCMAP_E
;

266 
	eCOL_E


268 
	mCOL_FLOOR
 = 29,

269 
	mCOL_FLOOR_M
 = 32,

270 
	mCOL_WALL
 = 151,

271 
	mCOL_WALL_M
 = 162,

272 
	mCOL_MOUSE
 = 255,

273 
	mCOL_TMPSEL
 = 92,

274 
	mCOL_TMPSEL_M
 = 108,

275 
	mCOL_PASTE_OK
 = 132,

276 
	mCOL_PASTE_KO
 = 98,

277 
	mCOL_SHADOW
 = 168

278 } 
	tCOL_E
;

280 
	eMODE_E


282 
	mMOD_T
,

283 
	mMOD_O
,

284 
	mMOD_P
,

285 
	mMOD_L
,

286 
	mMOD_MAX


287 } 
	tMODE_E
;

290 
	#COMPOSIT_NB
 16

	)

292 
	sLAY_INF_S


294 
UBYTE
 
	mshad_a
;

295 
UBYTE
 
	mshad_b
;

296 
UBYTE
 
	må™s_a
;

297 
UBYTE
 
	må™s_b
;

298 
	mw˛ass
[4];

301 
	mbmp_num
;

302 
BITMAP
 ** 
	mbmp
;

303 
	moff_x
;

304 
	moff_y
;

305 
	mœ°_good_‰ame
;

306 } 
	tLAY_INF_S
;

308 
	sCOF_S


310 
UBYTE
 
	mœy
;

311 
UBYTE
 
	mÂd
;

312 
UBYTE
 
	mdú
;

313 
	mxoff£t
;

314 
	myoff£t
;

315 
LAY_INF_S
 
	mœy_öf
[
COMPOSIT_NB
];

316 
UBYTE
 * 
	m¥i‹ôy
;

317 
	mcur_‰ame
;

318 
	mcur_dú
;

319 
	m•d_mul
;

320 
	m•d_div
;

321 
	m•d_mod
;

322 
	m‹dîÊag
;

323 } 
	tCOF_S
;

325 
	sOBJ_DESC_S


327 
	ma˘
;

328 
	mty≥
;

329 
	mid
;

330 * 
	mdesc
;

331 
COF_S
 * 
	mcof
;

332 
	mobje˘s_löe
;

333 
	mm⁄°©s_löe
;

334 
	mußge_cou¡
;

335 } 
	tOBJ_DESC_S
;

339 
	sUNDO_DAT_FLG_S


341 
UBYTE
 
	mf
 [
FLOOR_MAX_LAYER
];

342 
UBYTE
 
	ms
 [
SHADOW_MAX_LAYER
];

343 
UBYTE
 
	mw
 [
WALL_MAX_LAYER
];

344 } 
	tUNDO_DAT_FLG_S
;

346 
	sUNDO_S


348 
FILE
 * 
	mÂå
;

349 
	mbuf_num
;

350 
	mcur_buf_num
;

351 
	m«me
[150];

352 
	mèg
[4];

353 
	mö_£g
;

354 
	m£g_off£t
;

355 
UBYTE
 
	m£g_num
;

356 
	m˚Œ_off£t
;

357 
UBYTE
 
	m˚Œ_num
;

358 
UBYTE
 
	mﬁd_x
, 
	mﬁd_y
;

359 
UNDO_DAT_FLG_S
 
	md©_Êg
;

360 } 
	tUNDO_S
;

362 
	eCOL_TYPE_NM


364 
	mCT_NULL
,

365 
	mCT_STR
,

366 
	mCT_NUM


367 } 
	tCOL_TYPE_NM
;

369 
	sTXT_COL_S


372 
	m«me
[
TXT_COL_NAME_LENGTH
];

375 
	mpos
;

376 
COL_TYPE_NM
 
	mty≥
;

377 
	msize
;

378 
	moff£t
;

379 } 
	tTXT_COL_S
;

381 
	sTXT_S


383 * 
	md©a
;

384 
	mlöe_num
;

385 
	mlöe_size
;

386 
	mnb_ªquúed_cﬁs
;

387 
	mcﬁ_num
;

388 
TXT_COL_S
 * 
	mcﬁ
;

389 } 
	tTXT_S
;

391 #¥agm®
∑ck
(1)

393 
	sANIM_DATA_RECORD_S


395 
	mcof_«me
[8];

396 
	m‰ames_≥r_dú
;

397 
	m•ìd
;

398 
UBYTE
 
	mÊags
[144];

399 } 
	tANIM_DATA_RECORD_S
;

401 #¥agm®
∑ck
()

403 
	sANIM_DATA_S


405 * 
	mbuf„r
;

406 
	mbuf„r_size
;

407 
ANIM_DATA_RECORD_S
 * 
	mblock_poöãr
 [256];

408 
	mnb_ªc‹ds
 [256];

409 } 
	tANIM_DATA_S
;

412 
	sCMD_LINE_S


415 * 
	mds1_fûíame
;

418 * 
	möi_fûíame
;

421 
	mlv…y≥_id
;

424 
	mlvÕª°_def
;

427 
	mªsize_width
;

430 
	mªsize_height
;

433 
	mf‹˚_∑l_num
;

436 
	mno_check_a˘
;

439 
	mdt1_li°_num
;

442 * 
	mdt1_li°_fûíame
[
DT1_IN_DS1_MAX
];

445 
	mdebug_mode
;

448 
	mno_vis_debug
;

449 } 
	tCMD_LINE_S
;

452 
	eTILEGRID_ENUM


454 
	mTG_OFF
 = 0,

455 
	mTG_OVERFLOOR
,

456 
	mTG_OVERWALL
,

457 
	mTG_MAX


458 } 
	tTILEGRID_ENUM
;

460 
	sGLB_DS1EDIT_S


462 
UBYTE
 * 
	md2_∑l
 [
ACT_MAX
];

463 
	m∑l_size
 [
ACT_MAX
];

464 
PALETTE
 
	mvga_∑l
 [
ACT_MAX
];

465 
PALETTE
 
	mdummy_∑l
;

466 
	m∑l_lﬂded
[
ACT_MAX
];

467 
BITMAP
 * 
	mmou£_curs‹
[
MOD_MAX
];

468 
WIN_PREVIEW_S
 
	mwö_¥evõw
;

469 
WIN_EDIT_S
 
	mwö_edô
;

470 
BITMAP
 * 
	mbig_s¸ìn_buff
;

471 
BITMAP
 * 
	ms¸ìn_buff
;

472 
BITMAP
 * 
	mvideo_∑ge
[2];

473 
	mvideo_∑ge_num
;

474 
UBYTE
 
	mgamma_èbÀ
[
GC_MAX
][256];

475 
GC_ENUM
 
	mcur_gamma
;

476 vﬁ©ûê
	mﬁd_Âs
;

477 vﬁ©ûê
	mÂs
;

478 vﬁ©ûê
	mticks_ñ≠£d
;

479 
	ms¸ìnshŸ_num
;

480 
COLOR_MAP
 
	mcm≠
[
CM_MAX
][
ACT_MAX
];

481 
OBJ_DESC_S
 * 
	mobj_desc
;

482 
	mobj_desc_num
;

483 
MODE_E
 
	mmode
;

484 
RLE_SPRITE
 * 
	msubtûe_Êag
[9][
ZM_MAX
][25];

485 
RLE_SPRITE
 * 
	msubtûe_Êag_combö©i⁄
[256][
ZM_MAX
][25];

486 
RLE_SPRITE
 * 
	msubtûe_nowÆk
[
ZM_MAX
][25];

487 
RLE_SPRITE
 * 
	msubtûe_nojump
[
ZM_MAX
][25];

488 
BITMAP
 * 
	msubtûe_hñp
;

489 
	mnight_mode
;

490 
TXT_S
 * 
	mlv…y≥s_buff
;

491 
TXT_S
 * 
	mlvÕª°_buff
;

492 
TXT_S
 * 
	mobj_buff
;

493 
TXT_S
 * 
	mobje˘s_buff
;

494 
	m√w_dú1
[1],

495 
	m√w_dú4
[4],

496 
	m√w_dú8
[8],

497 
	m√w_dú16
[16],

498 
	m√w_dú32
[32];

499 
	mobj_‹dî_ds1_idx
;

500 
	mobj_sub_tûe_‹dî
[5][5];

502 
	mcuºít_ª‰esh_øã
;

503 
	mcﬁ_obj_id
;

504 
	mcﬁ_obje˘s_id
;

505 
	mcﬁ_‰ame_dñè
[8];

506 
	mcﬁ_‹dîÊag
[8];

507 
ANIM_DATA_S
 
	m™im_d©a
;

508 
CMD_LINE_S
 
	mcmd_löe
;

509 
	mds1_group_idx
;

510 
	mshow_2nd_row
;

511 
	m°πmp
[512];

512 
TILEGRID_ENUM
 
	mdi•œy_tûe_grid
;

515 } 
	tGLB_DS1EDIT_S
;

517 
GLB_DS1EDIT_S
 
glb_ds1edô
;

519 
	sBLOCK_TABLE_S


522 
	mdt1_idx_f‹_ds1
;

523 
	mmaö_ödex
;

524 
	m‹õ¡©i⁄
;

525 
	msub_ödex
;

528 
	mdt1_idx
;

529 
	mørôy
;

530 
	mblock_idx
;

531 
BLK_TYP_E
 
	mty≥
;

532 
	mzîo_löe
;

533 
	mroof_y
;

536 
	mc⁄Êi˘
;

537 
	mu£d_by_game
;

538 
	mu£d_by_edô‹
;

541 
	mcuº_‰ame
;

542 
	mupd©ed
;

543 } 
	tBLOCK_TABLE_S
;

545 
	sPATH_S


547 
	mx
;

548 
	my
;

549 
	ma˘i⁄
;

550 
	mÊags
;

551 } 
	tPATH_S
;

553 
	sOBJ_LABEL_S


555 
	mrx
, 
	mry
;

557 
	mw
, 
	mh
;

558 
	mx0
, 
	my0
;

559 
	mÊags
;

562 
	mﬁd_rx
;

563 
	mﬁd_ry
;

565 } 
	tOBJ_LABEL_S
;

567 
	sOBJ_S


569 
	mty≥
;

570 
	mid
;

571 
	mx
;

572 
	my
;

573 
	mds1_Êags
;

575 
PATH_S
 
	m∑th
[
WINDS1EDIT_PATH_MAX
];

576 
	m∑th_num
;

577 
	mdesc_idx
;

578 
	mÊags
;

579 
OBJ_LABEL_S
 
	mœbñ
;

582 
	mﬁd_x
;

583 
	mﬁd_y
;

586 
	mtx
;

587 
	mty
;

588 
	msx
;

589 
	msy
;

592 
UBYTE
 
	m‰ame_dñè
;

593 } 
	tOBJ_S
;

595 
	sBOX_S


597 
	mx1
, 
	my1
, 
	mx2
, 
	my2
;

598 } 
	tBOX_S
;

600 
	sEDT_BUT_S


602 
BOX_S
 
	mbox
;

603 
XY_S
 
	mtxt
;

604 
	m«me
[10];

605 
	mÊags
;

606 } 
	tEDT_BUT_S
;

608 
	eEDT_BUT_E


610 
	mEB_OK
, 
	mEB_CANCEL
, 
	mEB_TYPE1
, 
	mEB_TYPE2
,

611 
	mEB_ACT1
, 
	mEB_ACT2
, 
	mEB_ACT3
, 
	mEB_ACT4
, 
	mEB_ACT5
,

612 
	mEB_MAX


613 } 
	tEDT_BUT_E
;

615 
	sWIN_EDT_OBJ_S


618 
	mx0
, 
	my0
;

619 
	mw
, 
	mh
;

620 
	mobj_idx
;

621 
	mcur_ty≥
;

622 
	m°¨t_a˘
;

623 
	mcur_a˘
;

626 
EDT_BUT_S
 
	mbuâ⁄
[
EB_MAX
];

629 
	mnum
;

630 
	m°¨t
;

631 
	mcur
;

633 
	mdesc_ch¨
;

634 
	mdesc_°¨t
;

635 
	mdesc_num
;

636 
	mdesc_íd
;

637 
	mdesc_cur
;

638 } 
	tWIN_EDT_OBJ_S
;

640 
	sCELL_W_S


642 
UBYTE
 
	m¥›1
;

643 
UBYTE
 
	m¥›2
;

644 
UBYTE
 
	m¥›3
;

645 
UBYTE
 
	m¥›4
;

646 
UBYTE
 
	m‹õ¡©i⁄
;

647 
	mbt_idx
;

648 
UBYTE
 
	mÊags
;

649 } 
	tCELL_W_S
;

651 
	sCELL_F_S


653 
UBYTE
 
	m¥›1
;

654 
UBYTE
 
	m¥›2
;

655 
UBYTE
 
	m¥›3
;

656 
UBYTE
 
	m¥›4
;

657 
	mbt_idx
;

658 
UBYTE
 
	mÊags
;

659 } 
	tCELL_F_S
;

661 
	sCELL_S_S


663 
UBYTE
 
	m¥›1
;

664 
UBYTE
 
	m¥›2
;

665 
UBYTE
 
	m¥›3
;

666 
UBYTE
 
	m¥›4
;

667 
	mbt_idx
;

668 
UBYTE
 
	mÊags
;

669 } 
	tCELL_S_S
;

671 
	sCELL_T_S


674 
UDWORD
 
	mnum
;

675 
UBYTE
 
	mÊags
;

676 } 
	tCELL_T_S
;

678 
	sGROUP_S


680 
UDWORD
 
	mtûe_x
;

681 
UDWORD
 
	mtûe_y
;

682 
UDWORD
 
	mwidth
;

683 
UDWORD
 
	mheight
;

684 
UDWORD
 
	munk
;

685 } 
	tGROUP_S
;

688 
	eOL_ENUM


690 
	mOL_NONE
,

691 
	mOL_TYPEID
,

692 
	mOL_SPEED
,

693 
	mOL_DESC
,

694 
	mOL_MAX


695 } 
	tOL_ENUM
;

698 
	sPATH_EDIT_BUT_COL_S


700 
	mbg
;

701 
	mfg
;

702 
	mb‹dî
;

703 } 
	tPATH_EDIT_BUT_COL_S
;

706 
	sPATH_EDIT_BUT_S


708 
	mshow
;

709 
	mx0
, 
	my0
, 
	mw
, 
	mh
;

710 * 
	mãxt
;

711 
	mãxt_x0
;

712 
PATH_EDIT_BUT_COL_S
 
	mcﬁ_⁄
;

713 
PATH_EDIT_BUT_COL_S
 
	mcﬁ_off
;

714 } 
	tPATH_EDIT_BUT_S
;

717 
	ePEB_E


719 
	mPEB_OK
,

720 
	mPEB_CANCEL
,

721 
	mPEB_ALLNEW
,

722 
	mPEB_STOP
,

723 
	mPEB_SETACTION
,

724 
	mPEB_MAX


725 } 
	tPEB_E
;

728 
	ePEM_E


730 
	mPEM_NONE
,

731 
	mPEM_ALLNEW
,

732 
	mPEM_MAX


733 } 
	tPEM_E
;

736 
	sPATH_EDIT_WIN_S


738 
	mx0
, 
	my0
;

739 
	mw
, 
	mh
;

740 
	mobj_idx
;

741 
	mobj_dúty
;

743 
	m∑th_°¨t_idx
;

746 
	mbut_x0
, 
	mbut_y0
;

747 
	mbut_w
, 
	mbut_h
;

748 
PATH_EDIT_BUT_S
 
	mbuâ⁄
[
PEB_MAX
];

751 
	mc_bœck
;

752 
	mc_whôe
;

753 
	mc_gªí
;

754 
	mc_d¨kgªí
;

755 
	mc_yñlow
;

756 
	mc_gøy
;

757 
	mc_d¨kgøy
;

760 
PATH_S
 
	m∑th_c›y
[
WINDS1EDIT_PATH_MAX
];

761 
	m∑th_c›y_num
;

764 
PEM_E
 
	mmode
;

767 
	mcuº_a˘i⁄
;

769 } 
	tPATH_EDIT_WIN_S
;

771 
	sDS1_S


773 
	mdt1_idx
[
DT1_IN_DS1_MAX
];

774 
	mdt1_mask
[
DT1_IN_DS1_MAX
];

775 
	mtxt_a˘
;

776 
BLOCK_TABLE_S
 * 
	mblock_èbÀ
;

777 
	mbt_num
;

778 
UBYTE
 
	mwÆl_œyî_mask
[
WALL_MAX_LAYER
];

779 
UBYTE
 
	mÊo‹_œyî_mask
[
FLOOR_MAX_LAYER
];

780 
	mshadow_œyî_mask
[
SHADOW_MAX_LAYER
];

781 
OL_ENUM
 
	mobje˘s_œyî_mask
;

782 
UBYTE
 
	m∑ths_œyî_mask
;

783 
UBYTE
 
	mwÆkabÀ_œyî_mask
;

784 
UBYTE
 
	m™im©i⁄s_œyî_mask
;

785 
UBYTE
 
	m•ecül_œyî_mask
;

786 
	msubtûe_hñp_di•œy
;

787 
	m«me
[256];

788 
	mfûíame
[50];

789 
UNDO_S
 
	mundo
;

792 
	mvîsi⁄
;

793 
	mèg_ty≥
;

794 
	mwidth
;

795 
	mheight
;

796 
	ma˘
;

799 
	mfûe_num
;

800 * 
	mfûe_buff
;

801 
	mfûe_Àn
;

804 
CELL_F_S
 * 
	mÊo‹_buff
,

805 * 
	mÊo‹_buff2
;

806 
	mÊo‹_buff_Àn
;

807 
	mÊo‹_num
;

808 
	mÊo‹_löe
;

809 
	mÊo‹_Àn
;

812 
CELL_S_S
 * 
	mshadow_buff
,

813 * 
	mshadow_buff2
;

814 
	mshadow_buff_Àn
;

815 
	mshadow_num
;

816 
	mshadow_löe
;

817 
	mshadow_Àn
;

820 
CELL_W_S
 * 
	mwÆl_buff
,

821 * 
	mwÆl_buff2
;

822 
	mwÆl_buff_Àn
;

823 
	mwÆl_num
;

824 
	mwÆl_löe
;

825 
	mwÆl_Àn
;

828 
CELL_T_S
 * 
	mèg_buff
,

829 * 
	mèg_buff2
;

830 
	mèg_buff_Àn
;

831 
	mèg_num
;

832 
	mèg_löe
;

833 
	mèg_Àn
;

836 
	mgroup_num
;

837 
	mgroup_size
;

838 
GROUP_S
 * 
	mgroup
;

841 
ZOOM_E
 
	mcur_zoom
;

842 
	mtûe_w
;

843 
	mtûe_h
;

844 
	mheight_mul
;

845 
	mheight_div
;

846 
SCROLL_S
 
	mcur_s¸ﬁl
;

849 
WIN_PREVIEW_S
 
	mown_w¥evõw
;

852 * 
	mdøwög_‹dî
;

853 
OBJ_S
 * 
	mobj
;

854 
OBJ_S
 * 
	mobj_undo
;

855 
	mobj_num
;

856 
	mobj_num_undo
;

857 
	mˇn_undo_obj
;

858 
	mdøw_edô_obj
;

859 
WIN_EDT_OBJ_S
 
	mwö_edt_obj
;

862 
	mcur_™im_Êo‹_‰ame
;

865 
PATH_EDIT_WIN_S
 
	m∑th_edô_wö
;

868 
UDWORD
 
	mßve_cou¡
;

871 
	mcuºít_obj_max
;

872 } 
	tDS1_S
;

874 
DS1_S
 * 
glb_ds1
;

876 
	sBLOCK_S


878 
	mdúe˘i⁄
;

879 
WORD
 
	mroof_y
;

880 
UBYTE
 
	msound
;

881 
UBYTE
 
	m™im©ed
;

882 
	msize_y
;

883 
	msize_x
;

885 
	m‹õ¡©i⁄
;

886 
	mmaö_ödex
;

887 
	msub_ödex
;

888 
	mørôy
;

895 
UBYTE
 
	msub_tûes_Êags
[25];

897 
	mtûes_±r
;

898 
	mtûes_Àngth
;

899 
	mtûes_numbî
;

901 } 
	tBLOCK_S
;

903 
	sDT1_S


905 
	mds1_ußge
;

906 
	m«me
[80];

907 * 
	mbuf„r
;

908 
	mbuff_Àn
;

909 
	mx1
;

910 
	mx2
;

911 
	mblock_num
;

912 
	mbh_°¨t
;

915 * 
	mbh_buf„r
;

916 
	mbh_buff_Àn
;

919 
BITMAP
 ** 
	mblock_zoom
[
ZM_MAX
];

921 
	mbz_size
[
ZM_MAX
];

922 } 
	tDT1_S
;

924 
DT1_S
 * 
glb_dt1
;

926 
	sSUB_TILE_S


928 
WORD
 
	mx_pos
;

929 
WORD
 
	my_pos
;

931 
	mx_grid
;

932 
	my_grid
;

933 
WORD
 
	mf‹m©
;

934 
	mÀngth
;

936 
	md©a_off£t
;

937 } 
	tSUB_TILE_S
;

939 
	sORDER_DATA_S


941 
	midx
;

942 
	mheight
;

943 } 
	tORDER_DATA_S
;

945 
	sTMP_SEL_S


947 
	ety≥
 {
	mTMP_NULL
, 
	mTMP_NEW
, 
	mTMP_ADD
, 
	mTMP_DEL
, 
	mTMP_HIDE
} 
	mty≥
;

948 
	m°¨t
;

949 
	mx1
, 
	my1
, 
	mx2
, 
	my2
, 
	mﬁd_x2
, 
	mﬁd_y2
;

950 } 
	tTMP_SEL_S
;

952 
	sPASTE_POS_S


954 
	m§c_ds1_idx
;

955 
	m°¨t
;

956 
	m°¨t_x
, 
	m°¨t_y
, 
	mﬁd_x
, 
	mﬁd_y
, 
	mﬁd_ds1_idx
;

957 
	mis_cut
;

958 
	mcut_ßved
;

959 } 
	tPASTE_POS_S
;

961 
	eIT_ENUM


963 
	mIT_NULL
,

964 
	mIT_NEW
,

965 
	mIT_ADD
,

966 
	mIT_DEL


967 } 
	tIT_ENUM
;

970 
	eRQ_ENUM


972 
	mRQ_LVLTYPE
,

973 
	mRQ_LVLPREST
,

974 
	mRQ_OBJ
,

975 
	mRQ_OBJECTS
,

976 
	mRQ_MAX


977 } 
	tRQ_ENUM
;

979 ** 
glb_txt_ªq_±r
 [
RQ_MAX
];

981 
	sWMSG_FGBG_S


983 
	mfg
;

984 
	mbg
;

985 } 
	tWMSG_FGBG_S
;

987 
	sWMSG_BUTCOL_S


989 
	mfg
;

990 
	mbg
;

991 
	mb‹dî
;

992 } 
	tWMSG_BUTCOL_S
;

994 
	sWMSG_BUTKEY_S


996 
	mkey
 [
MW_COMBINATION_KEY_NUM
];

997 
	mmb
;

998 } 
	tWMSG_BUTKEY_S
;

1000 
	sWMSG_BUT_S


1002 * 
	mãxt
;

1003 
	mright_•a˚s
;

1004 
WMSG_BUTCOL_S
 
	m⁄
;

1005 
WMSG_BUTCOL_S
 
	moff
;

1006 
WMSG_BUTKEY_S
 
	msh‹tcut
[
MW_SHORTCUT_NUM
];

1007 } 
	tWMSG_BUT_S
;

1009 
	sWMSG_S


1011 
	mf⁄t_width
;

1012 
	mf⁄t_height
;

1013 * 
	mtôÀ
;

1014 * 
	mãxt
;

1015 
WMSG_FGBG_S
 
	mcﬁ_wö
;

1016 
WMSG_FGBG_S
 
	mcﬁ_tôÀ
;

1017 
WMSG_FGBG_S
 
	mcﬁ_ãxt
;

1018 
WMSG_BUT_S
 * 
	mbuâ⁄
;

1019 } 
	tWMSG_S
;

1021 
	eDS1ERR_ENUM


1023 
	mDS1ERR_OK
 = 0,

1024 
	mDS1ERR_INICREATE
 = 1,

1025 
	mDS1ERR_CMDLINE
 = 2,

1026 
	mDS1ERR_NOHEIGHT
 = 3,

1027 
	mDS1ERR_INITMPQ
 = 4,

1028 
	mDS1ERR_OTHER
 = 255

1029 } 
	tDS1ERR_ENUM
;

1031 
	eWBITSTYPE_ENUM


1033 
	mWBITSTYPE_UNKNOWN
 = 0,

1034 
	mWBITSTYPE_SAME
,

1035 
	mWBITSTYPE_DIFFERENT


1036 } 
	tWBITSTYPE_ENUM
;

1038 
	sWBITSDATA_S


1041 
CELL_F_S
 
	mmix_f
[
FLOOR_MAX_LAYER
];

1042 
CELL_S_S
 
	mmix_s
[
SHADOW_MAX_LAYER
];

1043 
CELL_W_S
 
	mmix_w
[
WALL_MAX_LAYER
];

1044 
CELL_T_S
 
	mmix_t
[
TAG_MAX_LAYER
];

1047 
WBITSTYPE_ENUM
 
	mbô_ty≥_f
[
FLOOR_MAX_LAYER
 ][ 4][8];

1048 
WBITSTYPE_ENUM
 
	mbô_ty≥_s
[
SHADOW_MAX_LAYER
][ 4][8];

1049 
WBITSTYPE_ENUM
 
	mbô_ty≥_w
[
WALL_MAX_LAYER
 ][ 5][8];

1050 
WBITSTYPE_ENUM
 
	mbô_ty≥_t
[
TAG_MAX_LAYER
 ][32];

1051 } 
	tWBITSDATA_S
;

1054 
	eWRKSPC_ENUM


1056 
	mWRKSPC_TILE_X
 = 0,

1057 
	mWRKSPC_TILE_Y
,

1058 
	mWRKSPC_ZOOM
,

1059 
	mWRKSPC_VERSION
,

1060 
	mWRKSPC_SAVE_COUNT
,

1061 
	mWRKSPC_MAX


1062 } 
	tWRKSPC_ENUM
;

1064 
	sWRKSPC_DATAS_S
{

1065 * 
	mid
;

1066 } 
	tWRKSPC_DATAS_S
;

1068 
WRKSPC_DATAS_S
 
glb_wrk•c_d©as
[
WRKSPC_MAX
];

1071 * 
glb_∑th_lv…y≥s_mem
;

1072 * 
glb_∑th_lv…y≥s_def
;

1073 * 
glb_∑th_lvÕª°_mem
;

1074 * 
glb_∑th_lvÕª°_def
;

1075 * 
glb_∑th_obj_mem
;

1076 * 
glb_∑th_obj_def
;

1077 * 
glb_∑th_obje˘s_mem
;

1078 * 
glb_∑th_obje˘s_def
;

	@txtread.c

1 
	~<°rög.h
>

2 
	~"°ru˘s.h
"

3 
	~"îr‹.h
"

4 
	~"misc.h
"

5 
	~"dt1misc.h
"

6 
	~"mpqvõw.h
"

7 
	~"txåód.h
"

18 * 
	$txt_gës
(* 
b±r
, * 
nb_ch¨
, * 
is_√w_löe
, 
dñ_ch¨
)

20 * 
is_√w_löe
 = 
FALSE
;

21 * 
nb_ch¨
 = 0;

44 i‡(
b±r
[* 
nb_ch¨
] == 0)

47  
NULL
;

49 i‡(
b±r
[* 
nb_ch¨
] == '\t')

52 i‡(
dñ_ch¨
 =
TRUE
)

53 
b±r
[* 
nb_ch¨
] = 0;

54  
b±r
 + (* 
nb_ch¨
) + 1;

56 i‡(
b±r
[* 
nb_ch¨
] == 0x0A)

59 * 
is_√w_löe
 = 
TRUE
;

60 i‡(
dñ_ch¨
 =
TRUE
)

61 
b±r
[* 
nb_ch¨
] = 0;

62  
b±r
 + (* 
nb_ch¨
) + 1;

64 i‡(
b±r
[* 
nb_ch¨
] == 0x0D)

67 * 
is_√w_löe
 = 
TRUE
;

68 i‡(
dñ_ch¨
 =
TRUE
)

69 
b±r
[* 
nb_ch¨
] = 0;

71  
b±r
 + (* 
nb_ch¨
) + 2;

74 (* 
nb_ch¨
)++;

76 
	}
}

80 
	$txt_cou¡_hódî_cﬁs
(* 
cur_cﬁ
, * 
cﬁ_cou¡
)

82 
nb_ch¨
, 
is_√w_löe
;

83 * 
√xt_cﬁ
 = 
NULL
;

86 i‡((
cur_cﬁ
 =
NULL
Ë|| (
cﬁ_cou¡
 == NULL))

89 (* 
cﬁ_cou¡
) = 0;

90 
cur_cﬁ
 !
NULL
)

92 
√xt_cﬁ
 = 
	`txt_gës
(
cur_cﬁ
, & 
nb_ch¨
, & 
is_√w_löe
, 
FALSE
);

95 i‡(
nb_ch¨
)

97 i‡(
	`°∫ˇ£cmp
(
cur_cﬁ
, "*eol", 4) != 0)

98 (* 
cﬁ_cou¡
)++;

102 i‡((
is_√w_löe
Ë|| (
√xt_cﬁ
 =
NULL
))

105 
cur_cﬁ
 = 
√xt_cﬁ
;

107 
	}
}

111 * 
	$txt_ªad_hódî
(* 
cur_cﬁ
, 
TXT_S
 * 
txt
)

113 
nb_ch¨
, 
i
, 
cﬁ_pos
 = 0, 
is_√w_löe
;

114 * 
√xt_cﬁ
 = 
NULL
;

117 
cur_cﬁ
 !
NULL
)

119 
√xt_cﬁ
 = 
	`txt_gës
(
cur_cﬁ
, & 
nb_ch¨
, & 
is_√w_löe
, 
TRUE
);

120 i‡(
nb_ch¨
)

123 
i
=0; i < 
txt
->
cﬁ_num
; i++)

125 i‡(
	`°ricmp
(
cur_cﬁ
, 
txt
->
cﬁ
[
i
].
«me
) == 0)

128 
txt
->
cﬁ
[
i
].
pos
 = 
cﬁ_pos
;

133 
cﬁ_pos
++;

136 i‡(
is_√w_löe
)

137  
√xt_cﬁ
;

139 
cur_cﬁ
 = 
√xt_cﬁ
;

141  
NULL
;

142 
	}
}

146 
	$txt_check_ty≥_™d_size
(* 
cur_cﬁ
, 
TXT_S
 * 
txt
)

153 
nb_ch¨
, 
i
, 
cﬁ_pos
 = 0, 
is_√w_löe
 = 
FALSE
, 
x
;

154 * 
√xt_cﬁ
;

156 i‡(
cur_cﬁ
 =
NULL
)

160 
txt
->
löe_num
 = 0;

161 
cﬁ_pos
 = 0;

162 
cur_cﬁ
 !
NULL
)

175 
√xt_cﬁ
 = 
	`txt_gës
(
cur_cﬁ
, & 
nb_ch¨
, & 
is_√w_löe
, 
FALSE
);

177 i‡(
nb_ch¨
)

180 
i
=0; i < 
txt
->
cﬁ_num
; i++)

182 i‡(
cﬁ_pos
 =
txt
->
cﬁ
[
i
].
pos
)

186 i‡(
nb_ch¨
 > 
txt
->
cﬁ
[
i
].
size
)

187 
txt
->
cﬁ
[
i
].
size
 = 
nb_ch¨
;

190 i‡(
i
 >
txt
->
nb_ªquúed_cﬁs
)

193 i‡(
txt
->
cﬁ
[
i
].
ty≥
 =
CT_NULL
)

194 
txt
->
cﬁ
[
i
].
ty≥
 = 
CT_STR
;

198 i‡(
txt
->
cﬁ
[
i
].
ty≥
 =
CT_NULL
)

199 
txt
->
cﬁ
[
i
].
ty≥
 = 
CT_NUM
;

201 i‡(
txt
->
cﬁ
[
i
].
ty≥
 !
CT_STR
)

203 
x
=0; x < 
nb_ch¨
; x++)

205 i‡–((
cur_cﬁ
[
x
] < '0') || (cur_col[x] > '9'))

207 
cur_cﬁ
[
x
] != '-')

209 
txt
->
cﬁ
[
i
].
ty≥
 = 
CT_STR
;

210 
x
 = 
nb_ch¨
;

220 
cﬁ_pos
++;

223 i‡(
is_√w_löe
)

225 
txt
->
löe_num
++;

226 
cﬁ_pos
 = 0;

228 
cur_cﬁ
 = 
√xt_cﬁ
;

231 
	}
}

235 
	$txt_fûl_d©a
(* 
cur_cﬁ
, 
TXT_S
 * 
txt
)

239 
nb_ch¨
, 
i
, 
cﬁ_pos
 = 0, 
is_√w_löe
, 
cur_löe
 = 0;

240 * 
√xt_cﬁ
, * 
d©a_±r
, * 
•å
;

241 * 
Õå
;

243 i‡((
cur_cﬁ
 =
NULL
Ë|| (
txt
->
d©a
 == NULL))

247 
cﬁ_pos
 = 0;

248 
d©a_±r
 = 
txt
->
d©a
;

249 
cur_cﬁ
 !
NULL
)

252 
√xt_cﬁ
 = 
	`txt_gës
(
cur_cﬁ
, & 
nb_ch¨
, & 
is_√w_löe
, 
TRUE
);

254 i‡(
nb_ch¨
)

257 
i
=0; i < 
txt
->
cﬁ_num
; i++)

259 i‡(
cﬁ_pos
 =
txt
->
cﬁ
[
i
].
pos
)

262 
•å
 = 
d©a_±r
 + 
txt
->
cﬁ
[
i
].
off£t
;

263 i‡(
txt
->
cﬁ
[
i
].
ty≥
 =
CT_STR
)

264 
	`°r˝y
(
•å
, 
cur_cﬁ
);

265 i‡(
txt
->
cﬁ
[
i
].
ty≥
 =
CT_NUM
)

267 
Õå
 = (*Ë
•å
;

268 * 
Õå
 = 
	`©ﬁ
(
cur_cﬁ
);

275 
cﬁ_pos
++;

278 i‡(
is_√w_löe
)

280 
cur_löe
++;

281 i‡(
cur_löe
 > 
txt
->
löe_num
)

285 
d©a_±r
 +
txt
->
löe_size
;

286 
cﬁ_pos
 = 0;

289 
cur_cﬁ
 = 
√xt_cﬁ
;

292 
	}
}

296 
TXT_S
 * 
	$txt_de°roy
(
TXT_S
 * 
txt
)

298 i‡(
txt
 =
NULL
)

299  
NULL
;

300 i‡(
txt
->
d©a
 !
NULL
)

301 
	`‰ì
(
txt
->
d©a
);

302 i‡(
txt
->
cﬁ
 !
NULL
)

303 
	`‰ì
(
txt
->
cﬁ
);

304 
	`‰ì
(
txt
);

305  
NULL
;

306 
	}
}

310 
	$txt_gë_u£r_fûãr_cﬁs
(* 
cur_cﬁ
, 
TXT_S
 * 
txt
)

312 
nb_ch¨
, 
is_√w_löe
;

313 * 
√xt_cﬁ
 = 
NULL
;

314 
i
 = 0;

315 
tmp
[500] = "";

316 
size
 = 0;

319 i‡((
cur_cﬁ
 =
NULL
Ë|| (
txt
 == NULL))

322 
cur_cﬁ
 !
NULL
)

324 
√xt_cﬁ
 = 
	`txt_gës
(
cur_cﬁ
, & 
nb_ch¨
, & 
is_√w_löe
, 
FALSE
);

327 i‡(
nb_ch¨
)

329 i‡(
	`°∫ˇ£cmp
(
cur_cﬁ
, "*eol", 4) != 0)

332 
i
=0; i < 
txt
->
nb_ªquúed_cﬁs
; i++)

334 
size
 = 0;

335  (
cur_cﬁ
[
size
] != 0x00) && (cur_col[size] != '\t') &&

336 (
cur_cﬁ
[
size
] != 0x0D) && (cur_col[size] != 0x0A) )

338 
size
++;

341 i‡(
	`°∫ˇ£cmp
(
txt
->
cﬁ
[
i
].
«me
, 
cur_cﬁ
, 
size
) == 0)

345 i‡(
i
 >
txt
->
nb_ªquúed_cﬁs
)

350 (
i
 < 
txt
->
cﬁ_num
Ë&& (
	`°æí
—xt->
cﬁ
[i].
«me
) > 0)) {

351 
i
++;

354 i‡(
i
 < 
txt
->
cﬁ_num
) {

355 i‡(
size
 >
TXT_COL_NAME_LENGTH
) {

356 
	`FATAL_EXIT
("txt_gë_u£r_fûãr_cﬁs(Ë: foundá u£∏deföed fûã∏hódîÇamêth© i†m‹êth™ %òch¨a˘î†: \"%.*s...\" (%òch¨a˘îs)" , 
TXT_COL_NAME_LENGTH
 - 1, TXT_COL_NAME_LENGTH - 1, 
cur_cﬁ
, 
size
);

358 
	`°∫˝y
(
txt
->
cﬁ
[
i
].
«me
, 
cur_cﬁ
, 
size
);

365 i‡((
is_√w_löe
Ë|| (
√xt_cﬁ
 =
NULL
))

368 
cur_cﬁ
 = 
√xt_cﬁ
;

370 
	}
}

375 
TXT_S
 * 
	$txt_lﬂd
(* 
mem
, 
RQ_ENUM
 
íum_txt
, * 
fûíame
)

381 
TXT_S
 *
txt
 = 
NULL
;

382 
i
=0;

383 
size
=0;

384 
Æl_cﬁ_ok
 = 
TRUE
;

385 *
fú°_löe
 = 
NULL
;

386 
tmp
[150] = "";

387 **
ªquúed_cﬁ
 = 
NULL
;

390 
	`DEBUG_MESSAGE
("txt_lﬂd(\"%s\"):ö\n",
fûíame
 );

391 i‡(((
íum_txt
 < 0)Ë|| (íum_txà>
RQ_MAX
)) {

392 
	`FATAL_EXIT
("∑ømëî 'íum_txt' = %i, should bêbëwì¿0ánd %i", 
íum_txt
, 
RQ_MAX
 - 1);

423 
ªquúed_cﬁ
 = 
glb_txt_ªq_±r
[
íum_txt
];

425 
	`DEBUG_MESSAGE
("lﬂdög %s\n", 
fûíame
);

428 
size
 = (
TXT_S
);

429 
txt
 = (
TXT_S
 *Ë
	`mÆloc
(
size
);

430 i‡(
txt
 =
NULL
) {

431 
	`FATAL_EXIT
("couldÇŸáŒoˇã %òbyãs", 
size
);

433 
	`mem£t
(
txt
, 0, 
size
);

438 
txt
->
nb_ªquúed_cﬁs
 = 0;

439 
ªquúed_cﬁ
[
txt
->
nb_ªquúed_cﬁs
] !
NULL
) {

440 
txt
->
nb_ªquúed_cﬁs
++;

444 
txt
->
cﬁ_num
 = 0;

445 i‡(
íum_txt
 =
RQ_OBJ
) {

447 
	`txt_cou¡_hódî_cﬁs
(
mem
, & 
txt
->
cﬁ_num
);

449 
txt
->
cﬁ_num
 =Åxt->
nb_ªquúed_cﬁs
;

452 
txt
->
cﬁ
 = (
TXT_COL_S
 *Ë
	`ˇŒoc
—xt->
cﬁ_num
 + 1, (TXT_COL_S));

453 i‡(
txt
->
cﬁ
 =
NULL
) {

454 
txt
 = 
	`txt_de°roy
(txt);

455 
	`FATAL_EXIT
("ˇŒoc(Ëîr‹ f‹ %òñemíà* %òbyã†óch", 
txt
->
cﬁ_num
 + 1, (
TXT_COL_S
));

459 
i
=0; i < 
txt
->
cﬁ_num
; i++) {

460 
txt
->
cﬁ
[
i
].
pos
 = -1;

464 i‡(
i
 < 
txt
->
nb_ªquúed_cﬁs
) {

465 
	`°∫˝y
(
txt
->
cﬁ
[
i
].
«me
, 
ªquúed_cﬁ
[i], 
TXT_COL_NAME_LENGTH
);

470 i‡(
txt
->
nb_ªquúed_cﬁs
 !txt->
cﬁ_num
) {

471 
	`txt_gë_u£r_fûãr_cﬁs
(
mem
, 
txt
);

475 
fú°_löe
 = 
	`txt_ªad_hódî
(
mem
, 
txt
);

476 
i
=0; i < 
txt
->
cﬁ_num
; i++) {

477 i‡(
txt
->
cﬁ
[
i
].
pos
 == -1) {

478 
	`WARNING_MESSAGE
("couldÇŸ födÑequúed cﬁum¿%ò(%s)\n", 
i
, 
txt
->
cﬁ
[i].
«me
);

479 
Æl_cﬁ_ok
 = 
FALSE
;

483 i‡(
Æl_cﬁ_ok
 !
TRUE
) {

484 
txt
 = 
	`txt_de°roy
(txt);

485 
	`FATAL_EXIT
("notáll columns have been found\n");

489 i‡(
	`txt_check_ty≥_™d_size
(
fú°_löe
, 
txt
)) {

490 
txt
 = 
	`txt_de°roy
(txt);

491 
	`FATAL_EXIT
("stage 2,Érror shouldn't have happen\n");

495 
size
 = 0;

496 
i
=0; i < 
txt
->
cﬁ_num
; i++) {

497 
txt
->
cﬁ
[
i
].
off£t
 = 
size
;

498 i‡(
txt
->
cﬁ
[
i
].
ty≥
 =
CT_NUM
) {

499 
size
 += ();

500 } i‡(
txt
->
cﬁ
[
i
].
ty≥
 =
CT_STR
) {

501 
size
 +(
txt
->
cﬁ
[
i
].size + 1);

505 
txt
->
löe_size
 = 
size
;

508 
txt
->
d©a
 = (*Ë
	`ˇŒoc
—xt->
löe_num
 + 1,Åxt->
löe_size
);

509 i‡(
txt
->
d©a
 =
NULL
) {

510 
txt
 = 
	`txt_de°roy
(txt);

511 
	`FATAL_EXIT
("ˇŒoc(Ëîr‹ f‹ %òñemít†* %òbyã†óch\n", 
txt
->
löe_num
 + 1,Åxt->
löe_size
);

515 i‡(
	`txt_fûl_d©a
(
fú°_löe
, 
txt
)) {

516 
txt
 = 
	`txt_de°roy
(txt);

517 
	`FATAL_EXIT
("stage 4,Érror shouldn't have happen\n");

520 
	`DEBUG_MESSAGE
("txt_lﬂd(\"%s\"):out\n",
fûíame
 );

522  
txt
;

523 
	}
}

528 * 
	$txt_ªad_ö_mem
(* 
txäame
)

530 * 
buff
 = 
NULL
, * 
√w_buff
;

531 
íåy
;

532 
Àn
;

533 
tmp
[150];

535 
	`DEBUG_MESSAGE
("w™àtÿªadáÅxà‰om mpq : %s\n", 
txäame
);

537 
íåy
 = 
	`misc_lﬂd_mpq_fûe
(
txäame
, (**Ë& 
buff
, & 
Àn
, 
TRUE
);

538 i‡((
íåy
 =-1Ë|| (
buff
 =
NULL
)) {

539 
	`FATAL_EXIT
("fûê%†nŸ found\n", 
txäame
);

542 
Àn
++;

544 
√w_buff
 = 
	`ªÆloc
(
buff
, 
Àn
);

545 i‡(
√w_buff
 =
NULL
) {

546 i‡(
buff
 !
NULL
) {

547 
	`‰ì
(
buff
);

549 
	`FATAL_EXIT
("couldÇŸÑóŒoˇã %òbyã†f‹ %s\n", 
Àn
, 
txäame
);

552 i‡(
√w_buff
 !
buff
) {

553 
	`mem˝y
(
√w_buff
, 
buff
, 
Àn
 - 1);

556 * (((*Ë
√w_buff
Ë+ 
Àn
 - 1) = 0;

558  
buff
;

559 
	}
}

563 
	$txt_c⁄vît_¶ash
(* 
°r
)

565 
i
, 
s
 = 
	`°æí
(
°r
);

568 
i
=0; i < 
s
; i++)

569 i‡(
°r
[
i
] == '/')

570 
°r
[
i
] = '\\';

571 
	}
}

576 
	$txt_debug
(* 
fûe_∑th_mem
, * 
fûe_∑th_def
, 
TXT_S
 * 
txt
)

578 
FILE
 * 
out
 = 
NULL
;

579 
i
 = 0;

582 i‡(
glb_ds1edô
.
cmd_löe
.
debug_mode
 !
TRUE
)

585 i‡((
fûe_∑th_mem
 =
NULL
Ë|| (
fûe_∑th_def
 =NULLË|| (
txt
 == NULL))

588 
out
 = 
	`f›í
(
fûe_∑th_mem
, "wb");

589 i‡(
out
 !
NULL
)

591 
	`fwrôe
(
txt
->
d©a
,Åxt->
löe_size
,Åxt->
löe_num
, 
out
);

592 
	`f˛o£
(
out
);

595 
out
 = 
	`f›í
(
fûe_∑th_def
, "wt");

596 i‡(
out
 !
NULL
)

598 
	`Ârötf
(
out
, "mem‹y_cﬁ cﬁ_ty≥ %-*†txt_cﬁ_num d©a_ty≥Åxt_d©a_sizêmem‹y_off£t\n", 
TXT_COL_NAME_LENGTH
, "header_name");

599 
	`Ârötf
(
out
, "---------- -------- %-.*†----------- --------- ------------- -------------\n", 
TXT_COL_NAME_LENGTH
, "------------------------------");

601 
i
=0; i < 
txt
->
cﬁ_num
; i++)

603 
	`Ârötf
(

604 
out
,

606 
i
,

607 (
i
 >
txt
->
nb_ªquúed_cﬁs
) ? "Filter" : "Required",

608 
TXT_COL_NAME_LENGTH
,

609 
txt
->
cﬁ
[
i
].
«me
,

610 
txt
->
cﬁ
[
i
].
pos
,

611 
txt
->
cﬁ
[
i
].
ty≥
 =
CT_NUM
 ? "NUM" : "STR",

612 
txt
->
cﬁ
[
i
].
size
,

613 
txt
->
cﬁ
[
i
].
off£t


616 
	`f˛o£
(
out
);

618 
	}
}

623 
	$ªad_lv…y≥s_txt
(
ds1_idx
, 
ty≥
)

625 
TXT_S
 *
txt
 = 
NULL
;

626 *
Õå
 = 
NULL
;

627 *
tmp_l⁄g
 = 
NULL
;

628 *
buff
;

629 *
•å
;

631 
lv…y≥s
[] = "data/global/excel/lvltypes.txt";

632 
tmp
[150] = "";

633 
«me
[256] = "";

634 
ds1edt_fûe
[] = "ds1edit.dt1";

636 
i
;

637 
f
;

638 
a˘
;

640 
cﬁ_idx
 = 0;

641 
fûe_1_idx
 = 0;

644 if(
glb_ds1edô
.
lv…y≥s_buff
 =
NULL
){

646 
buff
 = 
	`txt_ªad_ö_mem
(
lv…y≥s
);

647 i‡(
buff
 =
NULL
){

653 
txt
 = 
	`txt_lﬂd
(
buff
, 
RQ_LVLTYPE
, 
lv…y≥s
);

654 
glb_ds1edô
.
lv…y≥s_buff
 = 
txt
;

655 
	`‰ì
(
buff
);

656 i‡(
txt
 =
NULL
){

661 i‡(
glb_ds1edô
.
cmd_löe
.
debug_mode
 =
TRUE
){

662 
	`txt_debug
(
glb_∑th_lv…y≥s_mem
, 
glb_∑th_lv…y≥s_def
, 
txt
);

665 
txt
 = 
glb_ds1edô
.
lv…y≥s_buff
;

669 
i
=0; i < 
txt
->
löe_num
; i++){

670 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLTYPE
, "ID")].
off£t
;

671 
Õå
 = (*Ë
•å
;

672 if((* 
Õå
Ë=
ty≥
){

674 
	`DEBUG_MESSAGE
–"Found ID %òö LvlTy≥s.txà©Ñow %i, cﬁ %i\n", 
ty≥
, 
i
 + 1, 
txt
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLTYPE
, "ID")].
pos
 );

677 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLTYPE
, "A˘")].
off£t
;

678 
Õå
 = (*Ë
•å
;

679 
a˘
 = * 
Õå
;

680 if((
a˘
 !
glb_ds1
[
ds1_idx
].a˘Ë&& (
glb_ds1edô
.
cmd_löe
.
no_check_a˘
 =
FALSE
)){

681 
	`FATAL_EXIT
("ªad_lv…y≥s_txt(Ë: A˘†‰om LvlTy≥s.txà(%liË™dÅhêDs1 (%liË" "¨êdif„ª¡", 
a˘
, 
glb_ds1
[
ds1_idx
].act );

685 
	`DEBUG_MESSAGE
( "Found dt1files :\n" );

686 
fûe_1_idx
 = 
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLTYPE
, "File 1");

691 
f
=0; f<33; f++){

692 
glb_ds1
[
ds1_idx
].
dt1_idx
[
f
] = -1;

693 i‡(
f
==0){

694 
	`•rötf
(
tmp
, "%s%s", 
glb_ds1edô_d©a_dú
, 
ds1edt_fûe
);

695 
	`DEBUG_MESSAGE
("w™àtÿªadá dt1 : %s\n", 
tmp
);

697 
glb_ds1
[
ds1_idx
].
dt1_idx
[
f
] = 
	`dt1_add_•ecül
(
tmp
);

700 
cﬁ_idx
 = 
fûe_1_idx
 + (
f
 - 1);

701 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
cﬁ_idx
].
off£t
;

702 if(
txt
->
cﬁ
[
cﬁ_idx
].
ty≥
 =
CT_STR
){

703 
	`°r˝y
(
tmp
, 
•å
);

704 }i‡(
txt
->
cﬁ
[
cﬁ_idx
].
ty≥
 =
CT_NUM
){

705 
tmp_l⁄g
 = (*Ë
•å
;

706 
	`•rötf
(
tmp
, "%li", * 
tmp_l⁄g
);

708 
	`txt_c⁄vît_¶ash
(
tmp
);

709 
	`°r˝y
(
«me
, 
glb_tûes_∑th
);

710 
	`°rˇt
(
«me
, 
tmp
);

711 if(
glb_ds1
[
ds1_idx
].
dt1_mask
[
f
]){

713 
	`DEBUG_MESSAGE
("w™àtÿªadá dt1 from mpq : %s\n", 
«me
);

714 
glb_ds1
[
ds1_idx
].
dt1_idx
[
f
] = 
	`dt1_add
(
«me
);

716 if((
tmp
[0] != '0') &&Åmp[1] != 0){

717 
	`DEBUG_MESSAGE
("\n(skù %s)\n", 
tmp
);

723  
a˘
;

726 
	`FATAL_EXIT
("couldÇŸ födÅhêID %òö LvlTy≥s.txt\n", 
ty≥
);

728 
	}
}

733 
	$ªad_lvÕª°_txt
(
ds1_idx
, 
def
)

735 
TXT_S
 *
txt
;

736 *
buff
;

737 *
Õå
;

738 *
•å
;

739 *
found_±r
 = 
NULL
;

740 *
lvÕª°
 = "data/global/excel/lvlprest.txt";

742 
tmp
[150];

743 
i
, 
b
, 
mask
, 
fûíame_cﬁidx
[6], 
fûíame_idx
, 
Àngth
, 
c
, 
found_nb
, 
œ°_found
=0, 
œ°_¶ash
, 
found_cﬁ
=0;

747 if(
glb_ds1edô
.
lvÕª°_buff
 =
NULL
){

751 
buff
 = 
	`txt_ªad_ö_mem
–
lvÕª°
 );

752 if(
buff
 =
NULL
){

758 
txt
 = 
	`txt_lﬂd
(
buff
, 
RQ_LVLPREST
, 
lvÕª°
);

759 
glb_ds1edô
.
lvÕª°_buff
 = 
txt
;

760 
	`‰ì
(
buff
);

761 i‡(
txt
 =
NULL
){

766 i‡(
glb_ds1edô
.
cmd_löe
.
debug_mode
 =
TRUE
)

767 
	`txt_debug
(
glb_∑th_lvÕª°_mem
, 
glb_∑th_lvÕª°_def
, 
txt
);

769 
txt
 = 
glb_ds1edô
.
lvÕª°_buff
;

773 if(
def
 == -1){

775 
	`¥ötf
("AUTOMATIC LVLPREST.DEF DETECTION\n");

776 
	`fÊush
(
°dout
);

779 
fûíame_cﬁidx
[0] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "File1");

780 
fûíame_cﬁidx
[1] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "File2");

781 
fûíame_cﬁidx
[2] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "File3");

782 
fûíame_cﬁidx
[3] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "File4");

783 
fûíame_cﬁidx
[4] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "File5");

784 
fûíame_cﬁidx
[5] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "File6");

786 
found_nb
 = 0;

787 
i
=0; i < 
txt
->
löe_num
; i++){

788 
fûíame_idx
 = 0; filename_idx < 6; filename_idx++){

789 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[ 
fûíame_cﬁidx
[
fûíame_idx
] ].
off£t
;

790 if(
•å
 !
NULL
){

791 
Àngth
 = 
	`°æí
(
•å
);

792 if(
Àngth
 > 0)

795 
œ°_¶ash
 = 0;

796 
c
=0; c < 
Àngth
; c++)

798 i‡((
•å
[
c
] == '/') || (sptr[c] == '\\'))

799 
œ°_¶ash
 = 
c
;

803 i‡(
œ°_¶ash
)

804 
œ°_¶ash
++;

805 i‡(
œ°_¶ash
 >
Àngth
)

806 
œ°_¶ash
 = 
Àngth
 - 1;

807 i‡(
	`°ricmp
(
•å
 + 
œ°_¶ash
, 
glb_ds1
[
ds1_idx
].
fûíame
) == 0)

810 
found_nb
++;

811 
œ°_found
 = 
i
;

812 
found_±r
 = 
•å
;

813 
found_cﬁ
 = 
fûíame_idx
;

820 i‡(
found_nb
 == 1)

826 
i
 = 
œ°_found
;

828 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "Def")].
off£t
;

829 
Õå
 = (*Ë
•å
;

831 
	`¥ötf
("Found \"%s\" in LvlPrest.txtátÑow %i (DEF = %li, 'File%i' = \"%s\")\n",

832 
glb_ds1
[
ds1_idx
].
fûíame
,

833 
i
 + 1,

834 * 
Õå
,

835 
found_cﬁ
 + 1,

836 
found_±r


838 
	`fÊush
(
°dout
);

841 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "Dt1Mask")].
off£t
;

842 
Õå
 = (*Ë
•å
;

843 
mask
 = * 
Õå
;

845 
	`¥ötf
("DT1MASK = %li in LvlPrest.txtátÑow %i, col %i\n",

846 
mask
, 
i
 + 1, 
txt
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "Dt1Mask")].
pos
);

847 
	`fÊush
(
°dout
);

849 
b
=0; b < 
DT1_IN_DS1_MAX
; b++)

851 i‡(
b
 == 0)

852 
glb_ds1
[
ds1_idx
].
dt1_mask
[
b
] = 
TRUE
;

854 
glb_ds1
[
ds1_idx
].
dt1_mask
[
b
] = 
mask
 & (1 << (b-1)Ë? 
TRUE
 : 
FALSE
;

860 i‡(
found_nb
 >= 2) {

861 
	`FATAL_EXIT
("couldn'àfound ds1 fûíamê\"%s\" i¿LvlPª°.txàf‹ suª :Öª£¡ %òtimes\n", 
glb_ds1
[
ds1_idx
].
fûíame
, 
found_nb
);

863 
	`FATAL_EXIT
("couldn'àfound ds1 fûíamê\"%s\" i¿LvlPª°.txt\n", 
glb_ds1
[
ds1_idx
].
fûíame
);

868 
i
=0; i < 
txt
->
löe_num
; i++){

869 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "Def")].
off£t
;

870 
Õå
 = (*Ë
•å
;

871 if((* 
Õå
Ë=
def
){

873 
	`DEBUG_MESSAGE
("Found DEF %òö LvlPª°.txà©Ñow %i, cﬁ %i\n", 
def
, 
i
 + 1, 
txt
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "Def")].
pos
);

876 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "Dt1Mask")].
off£t
;

877 
Õå
 = (*Ë
•å
;

878 
mask
 = * 
Õå
;

880 
	`DEBUG_MESSAGE
("DT1MASK = %lòö LvlPª°.txà©Ñow %i, cﬁ %i\n", 
mask
, 
i
 + 1, 
txt
->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_LVLPREST
, "Dt1Mask")].
pos
);

882 
b
=0; b < 
DT1_IN_DS1_MAX
; b++){

883 i‡(
b
 == 0){

884 
glb_ds1
[
ds1_idx
].
dt1_mask
[
b
] = 
TRUE
;

886 
glb_ds1
[
ds1_idx
].
dt1_mask
[
b
] = 
mask
 & (1 << (b-1)Ë? 
TRUE
 : 
FALSE
;

897 
	`FATAL_EXIT
("couldÇŸ foundÅhêDEF %òö LvlPª°.txt\n", 
def
);

899 
	}
}

904 
	$ªad_obj_txt
()

906 
TXT_S
 *
txt
;

907 *
buff
;

908 *
•å
;

909 *
Õå
;

911 
i
;

912 
size
;

913 
Àn
;

914 
tmp
[150];

915 
obj
[] = "obj.txt";

918 
	`DEBUG_MESSAGE
("read_obj_txt():in\n");

920 i‡(
glb_ds1edô
.
obj_buff
 =
NULL
){

921 
	`DEBUG_MESSAGE
("w™àtÿªad %†‰om %s\n", 
obj
, 
glb_ds1edô_d©a_dú
 );

923 if–
	`mod_lﬂd_ö_mem
(
glb_ds1edô_d©a_dú
, 
obj
, &
buff
, &
Àn
) == -1 ){

924 
	`FATAL_EXIT
("ªad_obj_txt(Ë: fûê%†nŸ found", 
obj
);

929 
txt
 = 
	`txt_lﬂd
(
buff
, 
RQ_OBJ
, 
obj
);

930 
glb_ds1edô
.
obj_buff
 = 
txt
;

931 
	`‰ì
(
buff
);

932 i‡(
txt
 =
NULL
){

937 i‡(
glb_ds1edô
.
cmd_löe
.
debug_mode
 =
TRUE
){

938 
	`txt_debug
(
glb_∑th_obj_mem
, 
glb_∑th_obj_def
, 
txt
);

941 
txt
 = 
glb_ds1edô
.
obj_buff
;

945 
glb_ds1edô
.
obj_desc_num
 = 
txt
->
löe_num
;

946 
size
 = 
glb_ds1edô
.
obj_desc_num
 * (
OBJ_DESC_S
);

947 
glb_ds1edô
.
obj_desc
 = (
OBJ_DESC_S
 *Ë
	`mÆloc
(
size
);

948 i‡(
glb_ds1edô
.
obj_desc
 =
NULL
){

949 
	`FATAL_EXIT
("nŸÉnough mem f‹ %òbyãs\n", 
size
);

951 
	`mem£t
(
glb_ds1edô
.
obj_desc
, 0, 
size
);

957 
i
=0; i < 
txt
->
löe_num
; i++){

960 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "A˘")].
off£t
;

961 
Õå
 = (*Ë
•å
;

962 
glb_ds1edô
.
obj_desc
[
i
].
a˘
 = * 
Õå
;

965 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Ty≥")].
off£t
;

966 
Õå
 = (*Ë
•å
;

967 
glb_ds1edô
.
obj_desc
[
i
].
ty≥
 = * 
Õå
;

970 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "ID")].
off£t
;

971 
Õå
 = (*Ë
•å
;

972 
glb_ds1edô
.
obj_desc
[
i
].
id
 = * 
Õå
;

975 
•å
 = 
txt
->
d©a
 + (
i
 *Åxt->
löe_size
Ë+Åxt->
cﬁ
[
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Des¸ùti⁄")].
off£t
;

976 
glb_ds1edô
.
obj_desc
[
i
].
desc
 = 
•å
;

980 
glb_ds1edô
.
cﬁ_obj_id
 = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJ
, "Objects.txt_ID");

982 
	`DEBUG_MESSAGE
("read_obj_txt():out\n");

984 
	}
}

990 
	$ªad_obje˘s_txt
()

992 
TXT_S
 *
txt
;

993 *
buff
;

994 *
obje˘s
 = "data/global/excel/objects.txt";

997 
	`DEBUG_MESSAGE
("read_objects_txt():in\n");

999 if(
glb_ds1edô
.
obje˘s_buff
 =
NULL
){

1004 
buff
 = 
	`txt_ªad_ö_mem
(
obje˘s
);

1005 i‡(
buff
 =
NULL
) {

1039 
txt
 = 
	`txt_lﬂd
(
buff
, 
RQ_OBJECTS
, 
obje˘s
);

1040 
glb_ds1edô
.
obje˘s_buff
 = 
txt
;

1041 
	`‰ì
(
buff
);

1042 i‡(
txt
 =
NULL
){

1047 i‡(
glb_ds1edô
.
cmd_löe
.
debug_mode
 =
TRUE
){

1048 
	`txt_debug
(
glb_∑th_obje˘s_mem
, 
glb_∑th_obje˘s_def
, 
txt
);

1051 
txt
 = 
glb_ds1edô
.
obje˘s_buff
;

1057 
glb_ds1edô
.
cﬁ_obje˘s_id
 = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "Id");

1059 
glb_ds1edô
.
cﬁ_‰ame_dñè
[0] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "FrameDelta0");

1060 
glb_ds1edô
.
cﬁ_‰ame_dñè
[1] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "FrameDelta1");

1061 
glb_ds1edô
.
cﬁ_‰ame_dñè
[2] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "FrameDelta2");

1062 
glb_ds1edô
.
cﬁ_‰ame_dñè
[3] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "FrameDelta3");

1063 
glb_ds1edô
.
cﬁ_‰ame_dñè
[4] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "FrameDelta4");

1064 
glb_ds1edô
.
cﬁ_‰ame_dñè
[5] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "FrameDelta5");

1065 
glb_ds1edô
.
cﬁ_‰ame_dñè
[6] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "FrameDelta6");

1066 
glb_ds1edô
.
cﬁ_‰ame_dñè
[7] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "FrameDelta7");

1069 
glb_ds1edô
.
cﬁ_‹dîÊag
[0] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "OrderFlag0");

1070 
glb_ds1edô
.
cﬁ_‹dîÊag
[1] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "OrderFlag1");

1071 
glb_ds1edô
.
cﬁ_‹dîÊag
[2] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "OrderFlag2");

1072 
glb_ds1edô
.
cﬁ_‹dîÊag
[3] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "OrderFlag3");

1073 
glb_ds1edô
.
cﬁ_‹dîÊag
[4] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "OrderFlag4");

1074 
glb_ds1edô
.
cﬁ_‹dîÊag
[5] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "OrderFlag5");

1075 
glb_ds1edô
.
cﬁ_‹dîÊag
[6] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "OrderFlag6");

1076 
glb_ds1edô
.
cﬁ_‹dîÊag
[7] = 
	`misc_gë_txt_cﬁumn_num
(
RQ_OBJECTS
, "OrderFlag7");

1077 
	`DEBUG_MESSAGE
("read_objects_txt():out\n");

1080 
	}
}

	@txtread.h

1 #i‚de‡
_TXTREAD_H_


3 
	#_TXTREAD_H_


	)

5 * 
txt_gës
 (* 
b±r
, * 
nb_ch¨
, * 
is_√w_löe
, 
dñ_ch¨
);

6 
txt_cou¡_hódî_cﬁs
 (* 
cur_cﬁ
, * 
cﬁ_cou¡
);

7 * 
txt_ªad_hódî
 (* 
cur_cﬁ
, 
TXT_S
 * 
txt
);

8 
txt_check_ty≥_™d_size
 (* 
cur_cﬁ
, 
TXT_S
 * 
txt
);

9 
txt_fûl_d©a
 (* 
cur_cﬁ
, 
TXT_S
 * 
txt
);

10 
TXT_S
 * 
txt_de°roy
 (TXT_S * 
txt
);

11 
txt_gë_u£r_fûãr_cﬁs
 (* 
cur_cﬁ
, 
TXT_S
 * 
txt
);

12 
TXT_S
 * 
txt_lﬂd
 (* 
mem
, 
RQ_ENUM
 
íum_txt
, * 
fûíame
);

13 * 
txt_ªad_ö_mem
 (* 
txäame
);

14 
txt_c⁄vît_¶ash
 (* 
°r
);

15 
txt_debug
 (* 
fûe_∑th_mem
, * 
fûe_∑th_def
, 
TXT_S
 * 
txt
);

16 
ªad_lv…y≥s_txt
 (
ds1_idx
, 
ty≥
);

17 
ªad_lvÕª°_txt
 (
ds1_idx
, 
def
);

18 
ªad_obj_txt
 ();

19 
ªad_obje˘s_txt
 ();

	@types.h

1 #i‚de‡
_WINDS1EDIT_TYPES_H_


3 
	#_WINDS1EDIT_TYPES_H_


	)

5 
	tUBYTE
;

6 
	tWORD
;

7 
	tUWORD
;

8 
	tUDWORD
;

11 #¥agm®
w¨nög
(
dißbÀ
 : 4996)

	@undo.c

1 
	~"°ru˘s.h
"

2 
	~"îr‹.h
"

3 
	~"ds1misc.h
"

4 
	~"undo.h
"

9 
	$undo_ª£t_Êags
(
ds1_idx
)

11 
UNDO_DAT_FLG_S
 * 
df
 = & 
glb_ds1
[
ds1_idx
].
undo
.
d©_Êg
;

12 
i
;

14 
i
=0; i < 
FLOOR_MAX_LAYER
; i++)

15 
df
->
f
[
i
] = 0;

17 
i
=0; i < 
SHADOW_MAX_LAYER
; i++)

18 
df
->
s
[
i
] = 0;

20 
i
=0; i < 
WALL_MAX_LAYER
; i++)

21 
df
->
w
[
i
] = 0;

22 
	}
}

27 
	$undo_exô
()

29 
UNDO_S
 * 
u
;

30 
Æ_ffblk
 
f
;

31 
d⁄e
, 
i
;

32 
tmp
[150];

34 
i
=0; i<
DS1_MAX
; i++)

36 i‡(
	`°æí
(
glb_ds1
[
i
].
«me
))

38 
u
 = & 
glb_ds1
[
i
].
undo
;

39 i‡(
u
->
Âå
 !
NULL
)

41 
	`f˛o£
(
u
->
Âå
);

42 
u
->
Âå
 = 
NULL
;

43 
	`°r˝y
(
u
->
«me
, "");

48 
	`•rötf
(
tmp
, "%s%sundo*.bö", 
glb_ds1edô_d©a_dú
, 
glb_ds1edô_tmp_dú
);

49 
	`¥ötf
("\ƒemovögÅm∞undÿbuf„r†(%s)...", 
tmp
);

50 
	`Ârötf
(
°dîr
, " .ÑemovögÅm∞undÿbuf„r†(%s)...", 
tmp
);

51 
	`fÊush
(
°dîr
);

52 
	`fÊush
(
°dout
);

53 
d⁄e
 = 
	`Æ_födfú°
(
tmp
, &
f
, -1);

54  ! 
d⁄e
)

56 
	`•rötf
(
tmp
, "%s%s%s", 
glb_ds1edô_d©a_dú
, 
glb_ds1edô_tmp_dú
, 
f
.
«me
);

57 
	`ªmove
(
tmp
);

58 
d⁄e
 = 
	`Æ_föd√xt
(&
f
);

60 
	`Æ_föd˛o£
(&
f
);

61 
	`¥ötf
("done\n");

62 
	`Ârötf
(
°dîr
, "done\n");

63 
	`fÊush
(
°dîr
);

64 
	`fÊush
(
°dout
);

65 
	}
}

70 
	$undo_√w_tûe_buf„r
(
ds1_idx
)

72 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

73 
Áke
 = 0, 
i
;

74 
tmp
[150];

77 i‡(
u
->
Âå
 !
NULL
) {

78 
	`f˛o£
(
u
->
Âå
);

79 
	`FATAL_EXIT
("undo_√w_buf„r(Ë: undÿfûêpoöã∏wa†nŸ NULL,Åûêbuf„∏%s", 
u
->
«me
);

83 i‡(
u
->
cur_buf_num
 < u->
buf_num
 - 1)

86 
i
 = 
u
->
cur_buf_num
 + 1; i < u->
buf_num
; i++)

88 
	`•rötf
(
tmp
, "%s%sundo%ôûe%li.bö", 
glb_ds1edô_d©a_dú
,

89 
glb_ds1edô_tmp_dú
, 
ds1_idx
, 
i
);

90 
	`ªmove
(
tmp
);

94 
u
->
buf_num
 = u->
cur_buf_num
 + 1;

98 
	`•rötf
(
u
->
«me
, "%s%sundo%ôûe%li.bö", 
glb_ds1edô_d©a_dú
, 
glb_ds1edô_tmp_dú
, 
ds1_idx
, u->
buf_num
);

99 
u
->
Âå
 = 
	`f›í
(u->
«me
, "wb");

100 i‡(
u
->
Âå
 =
NULL
) {

101 
	`FATAL_EXIT
("undo_√w_tûe_buf„r(Ë: c™'à¸óã %s", 
u
->
«me
);

105 
	`fwrôe
(
u
->
èg
, (u->èg), 1, u->
Âå
);

108 
u
->
£g_off£t
 = 
	`·ñl
(u->
Âå
);

109 
	`fwrôe
(&
Áke
, (
u
->
£g_num
), 1, u->
Âå
);

112 
u
->
ö_£g
 = 
FALSE
;

113 
u
->
£g_num
 = 0;

114 
u
->
˚Œ_off£t
 = -1;

115 
u
->
˚Œ_num
 = 0;

116 
u
->
ﬁd_x
 = (
UBYTE
) -1;

117 
u
->
ﬁd_y
 = (
UBYTE
) -1;

118 
	`undo_ª£t_Êags
(
ds1_idx
);

119 
	}
}

124 
	$undo_°¨t_£g_ö_tûe_buf„r
(
ds1_idx
, 
UBYTE
 
x
, UBYTE 
y
)

126 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

127 
Áke
 = 0;

128 
tmp
[150];

131 i‡(
u
->
Âå
 =
NULL
) {

132 
	`f˛o£
(
u
->
Âå
);

133 
	`FATAL_EXIT
("undo_°¨t_£g_ö_tûe_buf„r(Ë: undÿfûêpoöãri†NULL,Åûêbuf„∏%li", 
u
->
buf_num
);

137 i‡(
u
->
ö_£g
 !
FALSE
)

139 
	`f˛o£
(
u
->
Âå
);

140 
	`FATAL_EXIT
("undo_start_seg_in_tile_buffer() :ÅryÅo startá segment of cells while current oneÇot closed");

144 
u
->
ö_£g
 = 
TRUE
;

145 
u
->
£g_num
++;

148 
	`fwrôe
(&
x
, (x), 1, 
u
->
Âå
);

149 
	`fwrôe
(&
y
, (y), 1, 
u
->
Âå
);

152 
u
->
˚Œ_off£t
 = 
	`·ñl
(u->
Âå
);

153 
	`fwrôe
(&
Áke
, (
u
->
˚Œ_num
), 1, u->
Âå
);

156 
u
->
˚Œ_num
 = 0;

157 
u
->
ﬁd_x
 = 
x
 - 1;

158 
u
->
ﬁd_y
 = 
y
;

159 
	}
}

164 
	$undo_˛o£_£g_ö_tûe_buf„r
(
ds1_idx
)

166 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

167 
ﬁd_±r
;

168 
tmp
[150];

171 i‡(
u
->
Âå
 =
NULL
) {

172 
	`f˛o£
(
u
->
Âå
);

173 
	`FATAL_EXIT
("undo_˛o£_£g_ö_tûe_buf„r(Ë: undÿfûêpoöãri†NULL,Åûêbuf„∏%li", 
u
->
buf_num
);

176 i‡(
u
->
£g_num
 != 0) {

178 i‡(
u
->
ö_£g
 =
FALSE
) {

179 
	`f˛o£
(
u
->
Âå
);

180 
	`FATAL_EXIT
("undo_close_seg_in_tile_buffer() :ÅryÅo closeá segment of cells whileÇone was started");

184 
ﬁd_±r
 = 
	`·ñl
(
u
->
Âå
);

185 
	`f£ek
(
u
->
Âå
, u->
˚Œ_off£t
, 
SEEK_SET
);

186 
	`fwrôe
(&
u
->
˚Œ_num
, (u->˚Œ_num), 1, u->
Âå
);

187 
	`f£ek
(
u
->
Âå
, 
ﬁd_±r
, 
SEEK_SET
);

191 
u
->
ö_£g
 = 
FALSE
;

192 
	}
}

197 
	$undo_add_to_tûe_buf„r
(
ds1_idx
, 
ix
, 
iy
)

199 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

200 
UNDO_DAT_FLG_S
 * 
df
 = & 
u
->
d©_Êg
;

201 
tf
 = (
iy
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
) +

202 (
ix
 * 
glb_ds1
[
ds1_idx
].
Êo‹_num
),

203 
ts
 = (
iy
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
) +

204 (
ix
 * 
glb_ds1
[
ds1_idx
].
shadow_num
),

205 
tw
 = (
iy
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
) +

206 (
ix
 * 
glb_ds1
[
ds1_idx
].
wÆl_num
),

207 
i
;

208 
CELL_F_S
 * 
f
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

209 
CELL_S_S
 * 
s
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

210 
CELL_W_S
 * 
w
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

211 
UWORD
 
œyî_Êag
 = 0;

212 
UBYTE
 
x
 = 
ix
 & 0xFF, 
y
 = 
iy
 & 0xFF;

213 
tmp
[150];

216 i‡(
u
->
Âå
 =
NULL
) {

217 
	`FATAL_EXIT
("undo_add_to_tûe_buf„r(Ë: c™'àwrôêö undÿtûêbuf„∏%li", 
u
->
buf_num
);

221 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

222 i‡(
df
->
f
[
i
])

223 
œyî_Êag
 |1 << 
i
;

224 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

225 i‡(
df
->
s
[
i
])

226 
œyî_Êag
 |1 << (
i
 + 
FLOOR_MAX_LAYER
);

227 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

228 i‡(
df
->
w
[
i
])

229 
œyî_Êag
 |1 << (
i
 + 
FLOOR_MAX_LAYER
 + 
SHADOW_MAX_LAYER
);

232 i‡(
œyî_Êag
)

235 i‡–(
u
->
£g_num
 =0Ë|| ((
x
 !(u->
ﬁd_x
 + 1)Ë|| (
y
 !u->
ﬁd_y
)) )

238 i‡(
u
->
ö_£g
 !
FALSE
)

241 
	`undo_˛o£_£g_ö_tûe_buf„r
(
ds1_idx
);

245 
	`undo_°¨t_£g_ö_tûe_buf„r
(
ds1_idx
, 
x
, 
y
);

249 
	`fwrôe
(&
œyî_Êag
, ÷ayî_Êag), 1, 
u
->
Âå
);

250 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

252 i‡(
œyî_Êag
 & (1 << 
i
))

254 
	`fwrôe
(&
df
->
f
[
i
], (df->f[i]), 1, 
u
->
Âå
);

256 i‡(
df
->
f
[
i
] & 
DF_P1
)

257 
	`fwrôe
(&
f
[
i
].
¥›1
, (f[i].¥›1), 1, 
u
->
Âå
);

259 i‡(
df
->
f
[
i
] & 
DF_P2
)

260 
	`fwrôe
(&
f
[
i
].
¥›2
, (f[i].¥›2), 1, 
u
->
Âå
);

262 i‡(
df
->
f
[
i
] & 
DF_P3
)

263 
	`fwrôe
(&
f
[
i
].
¥›3
, (f[i].¥›3), 1, 
u
->
Âå
);

265 i‡(
df
->
f
[
i
] & 
DF_P4
)

266 
	`fwrôe
(&
f
[
i
].
¥›4
, (f[i].¥›4), 1, 
u
->
Âå
);

268 i‡(
df
->
f
[
i
] & 
DF_BT
)

269 
	`fwrôe
(&
f
[
i
].
bt_idx
, (f[i].bt_idx), 1, 
u
->
Âå
);

271 i‡(
df
->
f
[
i
] & 
DF_FL
)

272 
	`fwrôe
(&
f
[
i
].
Êags
, (f[i].Êags), 1, 
u
->
Âå
);

275 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

277 i‡(
œyî_Êag
 & (1 << (
i
 + 
FLOOR_MAX_LAYER
)))

279 
	`fwrôe
(&
df
->
s
[
i
], (df->s[i]), 1, 
u
->
Âå
);

281 i‡(
df
->
s
[
i
] & 
DF_P1
)

282 
	`fwrôe
(&
s
[
i
].
¥›1
, (s[i].¥›1), 1, 
u
->
Âå
);

284 i‡(
df
->
s
[
i
] & 
DF_P2
)

285 
	`fwrôe
(&
s
[
i
].
¥›2
, (s[i].¥›2), 1, 
u
->
Âå
);

287 i‡(
df
->
s
[
i
] & 
DF_P3
)

288 
	`fwrôe
(&
s
[
i
].
¥›3
, (s[i].¥›3), 1, 
u
->
Âå
);

290 i‡(
df
->
s
[
i
] & 
DF_P4
)

291 
	`fwrôe
(&
s
[
i
].
¥›4
, (s[i].¥›4), 1, 
u
->
Âå
);

293 i‡(
df
->
s
[
i
] & 
DF_BT
)

294 
	`fwrôe
(&
s
[
i
].
bt_idx
, (s[i].bt_idx), 1, 
u
->
Âå
);

296 i‡(
df
->
s
[
i
] & 
DF_FL
)

297 
	`fwrôe
(&
s
[
i
].
Êags
, (s[i].Êags), 1, 
u
->
Âå
);

300 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

302 i‡(
œyî_Êag
 & (1 << (
i
 + 
FLOOR_MAX_LAYER
 + 
SHADOW_MAX_LAYER
)))

304 
	`fwrôe
(&
df
->
w
[
i
], (df->w[i]), 1, 
u
->
Âå
);

306 i‡(
df
->
w
[
i
] & 
DF_P1
)

307 
	`fwrôe
(&
w
[
i
].
¥›1
, (w[i].¥›1), 1, 
u
->
Âå
);

309 i‡(
df
->
w
[
i
] & 
DF_P2
)

310 
	`fwrôe
(&
w
[
i
].
¥›2
, (w[i].¥›2), 1, 
u
->
Âå
);

312 i‡(
df
->
w
[
i
] & 
DF_P3
)

313 
	`fwrôe
(&
w
[
i
].
¥›3
, (w[i].¥›3), 1, 
u
->
Âå
);

315 i‡(
df
->
w
[
i
] & 
DF_P4
)

316 
	`fwrôe
(&
w
[
i
].
¥›4
, (w[i].¥›4), 1, 
u
->
Âå
);

318 i‡(
df
->
w
[
i
] & 
DF_OR
)

319 
	`fwrôe
(&
w
[
i
].
‹õ¡©i⁄
, (w[i].‹õ¡©i⁄), 1, 
u
->
Âå
);

321 i‡(
df
->
w
[
i
] & 
DF_BT
)

322 
	`fwrôe
(&
w
[
i
].
bt_idx
, (w[i].bt_idx), 1, 
u
->
Âå
);

324 i‡(
df
->
w
[
i
] & 
DF_FL
)

325 
	`fwrôe
(&
w
[
i
].
Êags
, (w[i].Êags), 1, 
u
->
Âå
);

330 
	`undo_ª£t_Êags
(
ds1_idx
);

331 
u
->
ﬁd_x
++;

332 
u
->
˚Œ_num
++;

334 
	}
}

339 
	$undo_˛o£_tûe_buf„r
(
ds1_idx
)

341 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

342 
ﬁd_±r
;

343 
tmp
[150];

346 i‡(
u
->
Âå
 =
NULL
) {

347 
	`FATAL_EXIT
("undo_˛o£_tûe_buf„r(Ë:Çÿundÿtûêbuf„∏poöã∏tÿ˛o£ (%li)", 
u
->
buf_num
);

350 i‡(
u
->
ö_£g
 !
FALSE
)

351 
	`undo_˛o£_£g_ö_tûe_buf„r
(
ds1_idx
);

354 
ﬁd_±r
 = 
	`·ñl
(
u
->
Âå
);

355 
	`f£ek
(
u
->
Âå
, u->
£g_off£t
, 
SEEK_SET
);

356 
	`fwrôe
(&
u
->
£g_num
, (u->£g_num), 1, u->
Âå
);

357 
	`f£ek
(
u
->
Âå
, 
ﬁd_±r
, 
SEEK_SET
);

360 i‡(
	`f˛o£
(
u
->
Âå
) != 0) {

361 
	`FATAL_EXIT
("undo_˛o£_tûe_buf„r(Ë: c™'à˛o£ undÿtûêbuf„∏%li", 
u
->
buf_num
);

365 
u
->
cur_buf_num
 = u->
buf_num
;

366 
u
->
buf_num
++;

367 
u
->
Âå
 = 
NULL
;

368 
	`°r˝y
(
u
->
«me
, "");

369 
	}
}

374 
	$undo_≠∂y_tûe_buf„r
(
ds1_idx
)

376 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

377 
FILE
 * 
ö
;

378 
tf
, 
ts
, 
tw
, 
i
, 
c
, 
s
, 
£g_num
, 
˚Œ_num
, 
x
, 
y
, 
œyî_Êag
, 
d©a_Êag
;

379 
CELL_F_S
 * 
f
;

380 
CELL_S_S
 * 
sh
;

381 
CELL_W_S
 * 
w
;

382 
undo_fûe
[100], 
tmp
[100];

384 i‡((
u
->
buf_num
 <0Ë|| (u->
cur_buf_num
 < 0))

387 
	`•rötf
(
undo_fûe
, "%s%sundo%ôûe%li.bö", 
glb_ds1edô_d©a_dú
,

388 
glb_ds1edô_tmp_dú
, 
ds1_idx
, 
u
->
cur_buf_num
);

389 
ö
 = 
	`f›í
(
undo_fûe
, "rb");

390 i‡(
ö
 =
NULL
) {

391 
	`FATAL_EXIT
("undo_≠∂y_tûe_buf„r(Ë: c™'à›í %s", 
undo_fûe
);

394 
i
=0; i < (
u
->
èg
); i++) {

395 
c
 = 
	`fgëc
(
ö
);

396 i‡(
c
 !
u
->
èg
[
i
]) {

397 
	`f˛o£
(
ö
);

398 
	`FATAL_EXIT
("undo_≠∂y_tûe_buf„r(Ë: wr⁄gÅag i¿%s", 
u
->
«me
);

402 
£g_num
 = 
	`fgëc
(
ö
);

403 
s
=0; s < 
£g_num
; s++)

405 
x
 = 
	`fgëc
(
ö
);

406 
y
 = 
	`fgëc
(
ö
);

407 
˚Œ_num
 = 
	`fgëc
(
ö
);

408 
c
=0; c < 
˚Œ_num
; c++)

410 i‡–(
x
 < 0Ë|| (
y
 < 0Ë|| (x >
glb_ds1
[
ds1_idx
].
width
Ë|| (y >glb_ds1[ds1_idx].
height
)) {

411 
	`f˛o£
(
ö
);

412 
	`FATAL_EXIT
("undo_≠∂y_tûe_buf„r(Ë: wr⁄g cñ»(%i, %i)", 
x
, 
y
);

414 
tf
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

415 
ts
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

416 
tw
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

417 
f
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
tf
;

418 
sh
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
ts
;

419 
w
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
tw
;

420 
	`‰ód
(&
œyî_Êag
, (
UWORD
), 1, 
ö
);

421 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

423 i‡(
œyî_Êag
 & (1 << 
i
))

425 
d©a_Êag
 = 
	`fgëc
(
ö
);

427 i‡(
d©a_Êag
 & 
DF_P1
)

428 
f
[
i
].
¥›1
 = 
	`fgëc
(
ö
);

430 i‡(
d©a_Êag
 & 
DF_P2
)

431 
f
[
i
].
¥›2
 = 
	`fgëc
(
ö
);

433 i‡(
d©a_Êag
 & 
DF_P3
)

434 
f
[
i
].
¥›3
 = 
	`fgëc
(
ö
);

436 i‡(
d©a_Êag
 & 
DF_P4
)

437 
f
[
i
].
¥›4
 = 
	`fgëc
(
ö
);

439 i‡(
d©a_Êag
 & 
DF_BT
)

440 
	`‰ód
(&
f
[
i
].
bt_idx
, (f[i].bt_idx), 1, 
ö
);

442 
	`Âr›_2_block
(
ds1_idx
, &
f
[
i
]);

444 i‡(
d©a_Êag
 & 
DF_FL
)

445 
f
[
i
].
Êags
 = 
	`fgëc
(
ö
);

448 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

450 i‡(
œyî_Êag
 & (1 << (
i
 + 
FLOOR_MAX_LAYER
)))

452 
d©a_Êag
 = 
	`fgëc
(
ö
);

454 i‡(
d©a_Êag
 & 
DF_P1
)

455 
sh
[
i
].
¥›1
 = 
	`fgëc
(
ö
);

457 i‡(
d©a_Êag
 & 
DF_P2
)

458 
sh
[
i
].
¥›2
 = 
	`fgëc
(
ö
);

460 i‡(
d©a_Êag
 & 
DF_P3
)

461 
sh
[
i
].
¥›3
 = 
	`fgëc
(
ö
);

463 i‡(
d©a_Êag
 & 
DF_P4
)

464 
sh
[
i
].
¥›4
 = 
	`fgëc
(
ö
);

466 i‡(
d©a_Êag
 & 
DF_BT
)

467 
	`‰ód
(&
sh
[
i
].
bt_idx
, (sh[i].bt_idx), 1, 
ö
);

469 
	`•r›_2_block
(
ds1_idx
, &
sh
[
i
]);

471 i‡(
d©a_Êag
 & 
DF_FL
)

472 
sh
[
i
].
Êags
 = 
	`fgëc
(
ö
);

475 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

477 i‡(
œyî_Êag
 & (1 << (
i
 + 
FLOOR_MAX_LAYER
 + 
SHADOW_MAX_LAYER
)))

479 
d©a_Êag
 = 
	`fgëc
(
ö
);

481 i‡(
d©a_Êag
 & 
DF_P1
)

482 
w
[
i
].
¥›1
 = 
	`fgëc
(
ö
);

484 i‡(
d©a_Êag
 & 
DF_P2
)

485 
w
[
i
].
¥›2
 = 
	`fgëc
(
ö
);

487 i‡(
d©a_Êag
 & 
DF_P3
)

488 
w
[
i
].
¥›3
 = 
	`fgëc
(
ö
);

490 i‡(
d©a_Êag
 & 
DF_P4
)

491 
w
[
i
].
¥›4
 = 
	`fgëc
(
ö
);

493 i‡(
d©a_Êag
 & 
DF_OR
)

494 
w
[
i
].
‹õ¡©i⁄
 = 
	`fgëc
(
ö
);

496 i‡(
d©a_Êag
 & 
DF_BT
)

497 
	`‰ód
(&
w
[
i
].
bt_idx
, (w[i].bt_idx), 1, 
ö
);

499 
	`w¥›_2_block
(
ds1_idx
, &
w
[
i
]);

501 i‡(
d©a_Êag
 & 
DF_FL
)

502 
w
[
i
].
Êags
 = 
	`fgëc
(
ö
);

505 
x
++;

508 
	`f˛o£
(
ö
);

509 
u
->
cur_buf_num
--;

510 
	}
}

516 
	$undo_add_this_tûe_to_buf„r
(
ds1_idx
, 
ix
, 
iy
,

517 
CELL_F_S
 * 
f
, 
CELL_W_S
 * 
w
, 
CELL_S_S
 * 
s
)

519 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

520 
UNDO_DAT_FLG_S
 * 
df
 = & 
u
->
d©_Êg
;

521 
i
;

522 
UWORD
 
œyî_Êag
 = 0;

523 
UBYTE
 
x
 = 
ix
 & 0xFF, 
y
 = 
iy
 & 0xFF;

524 
tmp
[150];

528 i‡(
u
->
Âå
 =
NULL
) {

529 
	`FATAL_EXIT
("undo_add_to_tûe_buf„r(Ë: c™'àwrôêö undÿtûêbuf„∏%li", 
u
->
buf_num
);

533 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

534 i‡(
df
->
f
[
i
])

535 
œyî_Êag
 |1 << 
i
;

537 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

538 i‡(
df
->
s
[
i
])

539 
œyî_Êag
 |1 << (
i
 + 
FLOOR_MAX_LAYER
);

541 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

542 i‡(
df
->
w
[
i
])

543 
œyî_Êag
 |1 << (
i
 + 
FLOOR_MAX_LAYER
 + 
SHADOW_MAX_LAYER
);

547 i‡(
œyî_Êag
)

550 i‡–(
u
->
£g_num
 =0Ë|| ((
x
 !(u->
ﬁd_x
 + 1)Ë|| (
y
 !u->
ﬁd_y
)) )

553 i‡(
u
->
ö_£g
 !
FALSE
)

556 
	`undo_˛o£_£g_ö_tûe_buf„r
(
ds1_idx
);

560 
	`undo_°¨t_£g_ö_tûe_buf„r
(
ds1_idx
, 
x
, 
y
);

564 
	`fwrôe
(&
œyî_Êag
, ÷ayî_Êag), 1, 
u
->
Âå
);

565 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

567 i‡(
œyî_Êag
 & (1 << 
i
))

569 
	`fwrôe
(&
df
->
f
[
i
], (df->f[i]), 1, 
u
->
Âå
);

571 i‡(
df
->
f
[
i
] & 
DF_P1
)

572 
	`fwrôe
(&
f
[
i
].
¥›1
, (f[i].¥›1), 1, 
u
->
Âå
);

574 i‡(
df
->
f
[
i
] & 
DF_P2
)

575 
	`fwrôe
(&
f
[
i
].
¥›2
, (f[i].¥›2), 1, 
u
->
Âå
);

577 i‡(
df
->
f
[
i
] & 
DF_P3
)

578 
	`fwrôe
(&
f
[
i
].
¥›3
, (f[i].¥›3), 1, 
u
->
Âå
);

580 i‡(
df
->
f
[
i
] & 
DF_P4
)

581 
	`fwrôe
(&
f
[
i
].
¥›4
, (f[i].¥›4), 1, 
u
->
Âå
);

583 i‡(
df
->
f
[
i
] & 
DF_BT
)

584 
	`fwrôe
(&
f
[
i
].
bt_idx
, (f[i].bt_idx), 1, 
u
->
Âå
);

586 i‡(
df
->
f
[
i
] & 
DF_FL
)

587 
	`fwrôe
(&
f
[
i
].
Êags
, (f[i].Êags), 1, 
u
->
Âå
);

590 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

592 i‡(
œyî_Êag
 & (1 << (
i
 + 
FLOOR_MAX_LAYER
) ))

594 
	`fwrôe
(&
df
->
s
[
i
], (df->s[i]), 1, 
u
->
Âå
);

596 i‡(
df
->
s
[
i
] & 
DF_P1
)

597 
	`fwrôe
(&
s
[
i
].
¥›1
, (s[i].¥›1), 1, 
u
->
Âå
);

599 i‡(
df
->
s
[
i
] & 
DF_P2
)

600 
	`fwrôe
(&
s
[
i
].
¥›2
, (s[i].¥›2), 1, 
u
->
Âå
);

602 i‡(
df
->
s
[
i
] & 
DF_P3
)

603 
	`fwrôe
(&
s
[
i
].
¥›3
, (s[i].¥›3), 1, 
u
->
Âå
);

605 i‡(
df
->
s
[
i
] & 
DF_P4
)

606 
	`fwrôe
(&
s
[
i
].
¥›4
, (s[i].¥›4), 1, 
u
->
Âå
);

608 i‡(
df
->
s
[
i
] & 
DF_BT
)

609 
	`fwrôe
(&
s
[
i
].
bt_idx
, (s[i].bt_idx), 1, 
u
->
Âå
);

611 i‡(
df
->
s
[
i
] & 
DF_FL
)

612 
	`fwrôe
(&
s
[
i
].
Êags
, (s[i].Êags), 1, 
u
->
Âå
);

615 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

617 i‡(
œyî_Êag
 & (1 << (
i
 + 
FLOOR_MAX_LAYER
 + 
SHADOW_MAX_LAYER
)))

619 
	`fwrôe
(&
df
->
w
[
i
], (df->w[i]), 1, 
u
->
Âå
);

621 i‡(
df
->
w
[
i
] & 
DF_P1
)

622 
	`fwrôe
(&
w
[
i
].
¥›1
, (w[i].¥›1), 1, 
u
->
Âå
);

624 i‡(
df
->
w
[
i
] & 
DF_P2
)

625 
	`fwrôe
(&
w
[
i
].
¥›2
, (w[i].¥›2), 1, 
u
->
Âå
);

627 i‡(
df
->
w
[
i
] & 
DF_P3
)

628 
	`fwrôe
(&
w
[
i
].
¥›3
, (w[i].¥›3), 1, 
u
->
Âå
);

630 i‡(
df
->
w
[
i
] & 
DF_P4
)

631 
	`fwrôe
(&
w
[
i
].
¥›4
, (w[i].¥›4), 1, 
u
->
Âå
);

633 i‡(
df
->
w
[
i
] & 
DF_OR
)

634 
	`fwrôe
(&
w
[
i
].
‹õ¡©i⁄
, (w[i].‹õ¡©i⁄), 1, 
u
->
Âå
);

636 i‡(
df
->
w
[
i
] & 
DF_BT
)

637 
	`fwrôe
(&
w
[
i
].
bt_idx
, (w[i].bt_idx), 1, 
u
->
Âå
);

639 i‡(
df
->
w
[
i
] & 
DF_FL
)

640 
	`fwrôe
(&
w
[
i
].
Êags
, (w[i].Êags), 1, 
u
->
Âå
);

645 
	`undo_ª£t_Êags
(
ds1_idx
);

646 
u
->
ﬁd_x
++;

647 
u
->
˚Œ_num
++;

649 
	}
}

	@undo.h

1 #i‚de‡
_UNDO_H_


3 
	#_UNDO_H_


	)

5 
undo_ª£t_Êags
 (
ds1_idx
);

6 
undo_exô
 ();

7 
undo_√w_tûe_buf„r
 (
ds1_idx
);

8 
undo_°¨t_£g_ö_tûe_buf„r
 (
ds1_idx
, 
UBYTE
 
x
, UBYTE 
y
);

9 
undo_˛o£_£g_ö_tûe_buf„r
 (
ds1_idx
);

10 
undo_add_to_tûe_buf„r
 (
ds1_idx
, 
ix
, 
iy
);

11 
undo_˛o£_tûe_buf„r
 (
ds1_idx
);

12 
undo_≠∂y_tûe_buf„r
 (
ds1_idx
);

13 
undo_add_this_tûe_to_buf„r
 (
ds1_idx
, 
ix
, 
iy
, 
CELL_F_S
 * 
f
, 
CELL_W_S
 * 
w
, 
CELL_S_S
 * 
s
);

	@wbits.c

1 
	~"°ru˘s.h
"

2 
	~"îr‹.h
"

3 
	~"ds1misc.h
"

4 
	~"wbôs.h
"

5 
	~"misc.h
"

9 
	$wbôs_maö_sögÀ_tûe
(
ds1_idx
, 
tx
, 
ty
)

11 
CELL_F_S
 * 
f_±r
;

12 
CELL_W_S
 * 
w_±r
;

13 
CELL_S_S
 * 
s_±r
;

14 
CELL_T_S
 * 
t_±r
;

15 
t
, 
n
;

16 
w_x0
, 
w_y0
, 
w_x1
, 
w_y1
;

17 
ok_x0
, 
ok_y0
, 
ˇn˚l_x0
;

18 
c_bœck
 = 
	`makecﬁ
(0, 0, 0),

19 
c_whôe
 = 
	`makecﬁ
(255, 255, 255),

20 
c_yñlow
 = 
	`makecﬁ
(255, 255, 0),

21 
c_d¨kgªí
 = 
	`makecﬁ
(0, 64, 0),

22 
c_lightgªí
 = 
	`makecﬁ
(0, 255, 0),

23 
c_ªd
 = 
	`makecﬁ
(255, 0, 0),

24 
c
, 
c1
, 
c2
, 
c3
, 
mx
, 
my
, 
mb
;

25 
b
, 
i
, 
vÆ
[4], 
x
, 
y
, 
ßve
 = 
FALSE
, 
d⁄e
 = FALSE;

26 
UBYTE
 
¥›s
[6][4], 
dú
[4], 
shad
[4];

27 
UDWORD
 
èg_dw
;

29 
w_width
 = 545, 
w_height
= 270;

32 
	`ãxt_mode
(-1);

34 
w_x0
 = (
glb_c⁄fig
.
s¸ìn
.
width
 - 
w_width
) / 2;

35 
w_y0
 = (
glb_c⁄fig
.
s¸ìn
.
height
 - 
w_height
) / 2;

36 
w_x1
 = 
w_x0
 + 
w_width
;

37 
w_y1
 = 
w_y0
 + 
w_height
;

39 
ok_x0
 = 
w_x0
 + (
w_width
 / 2) - 64;

40 
ok_y0
 = 
w_y0
 + 
w_height
 - 24;

41 
ˇn˚l_x0
 = 
ok_x0
 + 70;

43 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
, 
w_y0
, 
w_x1
, 
w_y1
, 
c_bœck
);

44 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
, 
w_y0
, 
w_x1
, 
w_y1
, 
c_whôe
);

46 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_num
 >= 1)

47 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "F1", 
w_x0
 + 2, 
w_y0
 + 2, 
c_yñlow
);

48 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_num
 >= 2)

49 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "F2", 
w_x0
 + 2, 
w_y0
 + 12, 
c_yñlow
);

51 i‡(
glb_ds1
[
ds1_idx
].
shadow_num
 >= 1)

52 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "SH", 
w_x0
 + 2, 
w_y0
 + 32, 
c_yñlow
);

54 i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 1)

55 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "W1", 
w_x0
 + 2, 
w_y0
 + 52, 
c_yñlow
);

56 i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 2)

57 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "W2", 
w_x0
 + 2, 
w_y0
 + 62, 
c_yñlow
);

58 i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 3)

59 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "W3", 
w_x0
 + 2, 
w_y0
 + 72, 
c_yñlow
);

60 i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 4)

61 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "W4", 
w_x0
 + 2, 
w_y0
 + 82, 
c_yñlow
);

63 i‡(
glb_ds1
[
ds1_idx
].
èg_num
 >= 1)

64 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "SUB", 
w_x0
 + 2, 
w_y0
 + 200, 
c_yñlow
);

66 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 237, 
w_y0
 + 92, w_y0 + 105, 
c_yñlow
);

67 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "UnwÆkabÀ", 
w_x0
 + 200, 
w_y0
 + 110, 
c_yñlow
);

69 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 27, 
w_y0
 + 92, w_y0 + 105, 
c_yñlow
);

70 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Hiddí", 
w_x0
 + 10, 
w_y0
 + 110, 
c_yñlow
);

72 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 87, 
w_y0
 + 92, w_y0 + 105, 
c_yñlow
);

73 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "?", 
w_x0
 + 82, 
w_y0
 + 110, 
c_yñlow
);

75 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 97, 
w_y0
 + 92, w_y0 + 125, 
c_yñlow
);

76 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "IsShadow", 
w_x0
 + 60, 
w_y0
 + 130, 
c_yñlow
);

78 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 162, 
w_y0
 + 92, w_y0 + 140, 
c_yñlow
);

79 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Maö-ödex", 
w_x0
 + 130, 
w_y0
 + 145, 
c_yñlow
);

81 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 333, 
w_y0
 + 92, w_y0 + 140, 
c_yñlow
);

82 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Sub-ödex", 
w_x0
 + 300, 
w_y0
 + 145, 
c_yñlow
);

84 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 413, 
w_y0
 + 92, w_y0 + 100, 
c_yñlow
);

85 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Layî†¥i‹ôy,", 
w_x0
 + 360, 
w_y0
 + 105, 
c_yñlow
);

86 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Ty≥ o‡œyîs,", 
w_x0
 + 360, 
w_y0
 + 115, 
c_yñlow
);

87 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "ánd unknown", 
w_x0
 + 360, 
w_y0
 + 125, 
c_yñlow
);

89 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 503, 
w_y0
 + 92, w_y0 + 140, 
c_yñlow
);

90 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Orõ¡©i⁄", 
w_x0
 + 455, 
w_y0
 + 145, 
c_yñlow
);

93 
t
 = (
ty
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
tx
 * glb_ds1[ds1_idx].
Êo‹_num
);

94 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
;

96 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

98 
¥›s
[
i
][0] = 
f_±r
[i].
¥›1
;

99 
¥›s
[
i
][1] = 
f_±r
[i].
¥›2
;

100 
¥›s
[
i
][2] = 
f_±r
[i].
¥›3
;

101 
¥›s
[
i
][3] = 
f_±r
[i].
¥›4
;

104 
t
 = (
ty
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
tx
 * glb_ds1[ds1_idx].
wÆl_num
);

105 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

106 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

108 
¥›s
[
i
+2][0] = 
w_±r
[i].
¥›1
;

109 
¥›s
[
i
+2][1] = 
w_±r
[i].
¥›2
;

110 
¥›s
[
i
+2][2] = 
w_±r
[i].
¥›3
;

111 
¥›s
[
i
+2][3] = 
w_±r
[i].
¥›4
;

112 
dú
[
i
] = 
w_±r
[i].
‹õ¡©i⁄
;

115 
t
 = (
ty
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
tx
 * glb_ds1[ds1_idx].
shadow_num
);

116 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
;

117 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

119 
shad
[0] = 
s_±r
[
i
].
¥›1
;

120 
shad
[1] = 
s_±r
[
i
].
¥›2
;

121 
shad
[2] = 
s_±r
[
i
].
¥›3
;

122 
shad
[3] = 
s_±r
[
i
].
¥›4
;

125 
t
 = (
ty
 * 
glb_ds1
[
ds1_idx
].
èg_löe
Ë+ (
tx
 * glb_ds1[ds1_idx].
èg_num
);

126 
t_±r
 = 
glb_ds1
[
ds1_idx
].
èg_buff
 + 
t
;

127 
èg_dw
 = 
t_±r
->
num
;

131 
mx
 = 
mou£_x
;

132 
my
 = 
mou£_y
;

133 
mb
 = 
mou£_b
;

136  ! 
d⁄e
)

138 
	`ãxt_mode
(-1);

141 
c1
 = 
c_d¨kgªí
;

142 
c2
 = 
c_lightgªí
;

143 
c3
 = 
c_yñlow
;

144 i‡((
mx
 >
ok_x0
Ë&& (mx <ok_x0 + 64Ë&& (
my
 >
ok_y0
) && (my <= ok_y0 + 20))

146 
c1
 = 
c_lightgªí
;

147 
c2
 = 
c_whôe
;

148 
c3
 = 
c_bœck
;

149 i‡(
mb
 & 1)

152 
ßve
 = 
TRUE
;

153 
d⁄e
 = 
TRUE
;

154 
mou£_b
 & 1)

160 i‡(
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

162 
ßve
 = 
TRUE
;

163 
d⁄e
 = 
TRUE
;

165 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
ok_x0
, 
ok_y0
-3, ok_x0 + 64, ok_y0 + 20, 
c1
);

166 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
ok_x0
, 
ok_y0
-3, ok_x0 + 64, ok_y0 + 20, 
c2
);

167 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "OK", 
ok_x0
+25, 
ok_y0
+5, 
c3
);

170 
c1
 = 
c_d¨kgªí
;

171 
c2
 = 
c_lightgªí
;

172 
c3
 = 
c_yñlow
;

173 i‡((
mx
 >
ˇn˚l_x0
Ë&& (mx <ˇn˚l_x0 + 64Ë&& (
my
 >
ok_y0
) && (my <= ok_y0 + 20))

175 
c1
 = 
c_lightgªí
;

176 
c2
 = 
c_whôe
;

177 
c3
 = 
c_bœck
;

178 i‡(
mb
 & 1)

181 
ßve
 = 
FALSE
;

182 
d⁄e
 = 
TRUE
;

183 
mou£_b
 & 1)

189 i‡(
key
[
KEY_ESC
])

191 
ßve
 = 
FALSE
;

192 
d⁄e
 = 
TRUE
;

194 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
ˇn˚l_x0
, 
ok_y0
-3, c™˚l_x0 + 64, ok_y0 + 20, 
c1
);

195 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
ˇn˚l_x0
, 
ok_y0
-3, c™˚l_x0 + 64, ok_y0 + 20, 
c2
);

196 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "CANCEL", 
ˇn˚l_x0
+10, 
ok_y0
+5, 
c3
);

198 
	`ãxt_mode
(0);

201 
y
 = 
w_y0
 + 2;

202 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

204 
vÆ
[0] = 
f_±r
[
n
].
¥›1
;

205 
vÆ
[1] = 
f_±r
[
n
].
¥›2
;

206 
vÆ
[2] = 
f_±r
[
n
].
¥›3
;

207 
vÆ
[3] = 
f_±r
[
n
].
¥›4
;

208 
x
 = 
w_x0
 + 24;

209 
b
=3; b >= 0 ; b--)

211 
i
=7; i >= 0; i--)

213 
c
 = 
c_whôe
;

214 i‡–(
mx
 >
x
) && (mx <= x+9) &&

215 (
my
 >
y
) && (my <= y+9) )

217 
c
 = 
c_ªd
;

218 i‡(
mb
 & 1)

220 i‡(
vÆ
[
b
] & (1 << 
i
))

223 
vÆ
[
b
] = vÆ[b] - (1 << 
i
);

228 
vÆ
[
b
] = vÆ[b] + (1 << 
i
);

230 
mb
 & 1)

233 
mb
 = 
mou£_b
;

235 
b
)

237 0 : 
f_±r
[
n
].
¥›1
 = 
vÆ
[
b
]; ;

238 1 : 
f_±r
[
n
].
¥›2
 = 
vÆ
[
b
]; ;

239 2 : 
f_±r
[
n
].
¥›3
 = 
vÆ
[
b
]; ;

240 3 : 
f_±r
[
n
].
¥›4
 = 
vÆ
[
b
]; ;

244 i‡(
vÆ
[
b
] & (1 << 
i
))

245 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

247 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

248 
x
 += 10;

250 i‡((
b
==3Ë&& ((
i
==7) || (i==6) || (i==5) || (i==3) || (i==2)))

251 
x
+=10;

252 i‡((
b
==2Ë&& ((
i
==4) || (i==2) || (i==1) || (i==0)))

253 
x
+=10;

254 i‡((
b
==1Ë&& ((
i
==6) || (i==0)))

255 
x
+=10;

258 
y
 += 10;

262 
y
 +10 * (2 - 
glb_ds1
[
ds1_idx
].
Êo‹_num
);

263 
y
 += 10;

264 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

266 
shad
[0] = 
s_±r
[
n
].
¥›1
;

267 
shad
[1] = 
s_±r
[
n
].
¥›2
;

268 
shad
[2] = 
s_±r
[
n
].
¥›3
;

269 
shad
[3] = 
s_±r
[
n
].
¥›4
;

270 
x
 = 
w_x0
 + 24;

271 
b
=3; b >= 0 ; b--)

273 
i
=7; i >= 0; i--)

275 
c
 = 
c_whôe
;

276 i‡–(
mx
 >
x
) && (mx <= x+9) &&

277 (
my
 >
y
) && (my <= y+9) )

279 
c
 = 
c_ªd
;

280 i‡(
mb
 & 1)

282 i‡(
shad
[
b
] & (1 << 
i
))

285 
shad
[
b
] = shad[b] - (1 << 
i
);

290 
shad
[
b
] = shad[b] + (1 << 
i
);

292 
mb
 & 1)

295 
mb
 = 
mou£_b
;

297 
b
)

299 0 : 
s_±r
[
n
].
¥›1
 = 
shad
[
b
]; ;

300 1 : 
s_±r
[
n
].
¥›2
 = 
shad
[
b
]; ;

301 2 : 
s_±r
[
n
].
¥›3
 = 
shad
[
b
]; ;

302 3 : 
s_±r
[
n
].
¥›4
 = 
shad
[
b
]; ;

306 i‡(
shad
[
b
] & (1 << 
i
))

307 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

309 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

310 
x
 += 10;

312 i‡((
b
==3Ë&& ((
i
==7) || (i==6) || (i==5) || (i==3) || (i==2)))

313 
x
+=10;

314 i‡((
b
==2Ë&& ((
i
==4) || (i==2) || (i==1) || (i==0)))

315 
x
+=10;

316 i‡((
b
==1Ë&& ((
i
==6) || (i==0)))

317 
x
+=10;

320 
y
 += 10;

324 
y
 += 10;

325 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

327 
vÆ
[0] = 
w_±r
[
n
].
¥›1
;

328 
vÆ
[1] = 
w_±r
[
n
].
¥›2
;

329 
vÆ
[2] = 
w_±r
[
n
].
¥›3
;

330 
vÆ
[3] = 
w_±r
[
n
].
¥›4
;

331 
x
 = 
w_x0
 + 24;

334 
b
=3; b >= 0 ; b--)

336 
i
=7; i >= 0; i--)

338 
c
 = 
c_whôe
;

339 i‡–(
mx
 >
x
) && (mx <= x+9) &&

340 (
my
 >
y
) && (my <= y+9) )

342 
c
 = 
c_ªd
;

343 i‡(
mb
 & 1)

345 i‡(
vÆ
[
b
] & (1 << 
i
))

348 
vÆ
[
b
] = vÆ[b] - (1 << 
i
);

353 
vÆ
[
b
] = vÆ[b] + (1 << 
i
);

355 
mb
 & 1)

358 
mb
 = 
mou£_b
;

360 
b
)

362 0 : 
w_±r
[
n
].
¥›1
 = 
vÆ
[
b
]; ;

363 1 : 
w_±r
[
n
].
¥›2
 = 
vÆ
[
b
]; ;

364 2 : 
w_±r
[
n
].
¥›3
 = 
vÆ
[
b
]; ;

365 3 : 
w_±r
[
n
].
¥›4
 = 
vÆ
[
b
]; ;

369 i‡(
vÆ
[
b
] & (1 << 
i
))

370 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

372 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

373 
x
 += 10;

375 i‡((
b
==3Ë&& ((
i
==7) || (i==6) || (i==5) || (i==3) || (i==2)))

376 
x
+=10;

377 i‡((
b
==2Ë&& ((
i
==4) || (i==2) || (i==1) || (i==0)))

378 
x
+=10;

379 i‡((
b
==1Ë&& ((
i
==6) || (i==0)))

380 
x
+=10;

381 i‡((
b
==0Ë&& (
i
==0))

382 
x
+=10;

387 
i
=7; i >= 0; i--)

389 
c
 = 
c_whôe
;

390 i‡–(
mx
 >
x
) && (mx <= x+9) &&

391 (
my
 >
y
) && (my <= y+9) )

393 
c
 = 
c_ªd
;

394 i‡(
mb
 & 1)

396 i‡(
w_±r
[
n
].
‹õ¡©i⁄
 & (1 << 
i
))

399 
w_±r
[
n
].
‹õ¡©i⁄
 = w_±r[n].‹õ¡©i⁄ - (1 << 
i
);

404 
w_±r
[
n
].
‹õ¡©i⁄
 = w_±r[n].‹õ¡©i⁄ + (1 << 
i
);

406 
mb
 & 1)

409 
mb
 = 
mou£_b
;

413 i‡(
w_±r
[
n
].
‹õ¡©i⁄
 & (1 << 
i
))

414 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

416 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

417 
x
 += 10;

420 
y
 += 10;

424 
y
 +10 * (4 - 
glb_ds1
[
ds1_idx
].
wÆl_num
);

425 
y
 += 108;

426 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
èg_num
;Ç++)

428 
èg_dw
 = 
t_±r
->
num
;

429 
x
 = 
w_x0
 + 34;

430 
i
=31; i >= 0; i--)

432 
c
 = 
c_whôe
;

433 i‡–(
mx
 >
x
) && (mx <= x+9) &&

434 (
my
 >
y
) && (my <= y+9) )

436 
c
 = 
c_ªd
;

437 i‡(
mb
 & 1)

439 i‡(
èg_dw
 & (1 << 
i
))

442 
èg_dw
 =Åag_dw - (1 << 
i
);

447 
èg_dw
 =Åag_dw + (1 << 
i
);

449 
mb
 & 1)

452 
mb
 = 
mou£_b
;

454 
t_±r
->
num
 = 
èg_dw
;

457 i‡(
èg_dw
 & (1 << 
i
))

458 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

460 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

461 
x
 += 10;

463 i‡((
i
==8) || (i==16) || (i==24))

464 
x
+=10;

466 
y
 += 10;

467 
x
 = 
w_x0
 + 48;

468 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
, 
y
, 
c_lightgªí
, "%8lu", (
èg_dw
 & 0xFF000000LU) >> 24);

469 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
 + 90, 
y
, 
c_lightgªí
, "%8lu", (
èg_dw
 & 0x00FF0000LU) >> 16);

470 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
 + 180, 
y
, 
c_lightgªí
, "%8lu", (
èg_dw
 & 0x0000FF00LU) >> 8);

471 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
 + 270, 
y
, 
c_lightgªí
, "%8lu", 
èg_dw
 & 0x000000FFLU);

474 
	`misc_døw_s¸ìn
(
mx
, 
my
);

477 
mx
 = 
mou£_x
;

478 
my
 = 
mou£_y
;

479 
mb
 = 
mou£_b
;

482 i‡(
ßve
 =
FALSE
)

485 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

487 
f_±r
[
i
].
¥›1
 = 
¥›s
[i][0];

488 
f_±r
[
i
].
¥›2
 = 
¥›s
[i][1];

489 
f_±r
[
i
].
¥›3
 = 
¥›s
[i][2];

490 
f_±r
[
i
].
¥›4
 = 
¥›s
[i][3];

492 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

494 
w_±r
[
i
].
¥›1
 = 
¥›s
[i+2][0];

495 
w_±r
[
i
].
¥›2
 = 
¥›s
[i+2][1];

496 
w_±r
[
i
].
¥›3
 = 
¥›s
[i+2][2];

497 
w_±r
[
i
].
¥›4
 = 
¥›s
[i+2][3];

498 
w_±r
[
i
].
‹õ¡©i⁄
 = 
dú
[i];

500 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

502 
s_±r
[
i
].
¥›1
 = 
shad
[0];

503 
s_±r
[
i
].
¥›2
 = 
shad
[1];

504 
s_±r
[
i
].
¥›3
 = 
shad
[2];

505 
s_±r
[
i
].
¥›4
 = 
shad
[3];

507 
t_±r
->
num
 = 
èg_dw
;

512 
	`ds1_make_¥›_2_block
(
ds1_idx
);

515 i‡(
key
[
KEY_ESC
])

517 
key
[
KEY_ESC
])

522 i‡(
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

524 
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

531 
	`ãxt_mode
(-1);

532 
	}
}

536 
	$wbôs_≠∂y_modifiˇti⁄
(
ds1_idx
, 
WBITSDATA_S
 * 
±r_wbôsd©a
)

538 
CELL_F_S
 * 
f_±r
;

539 
CELL_W_S
 * 
w_±r
;

540 
CELL_S_S
 * 
s_±r
;

541 
CELL_T_S
 * 
t_±r
;

542 
x
, 
y
, 
t
, 
i
, 
b
;

543 
UDWORD
 
bt
, 
b1
, 
b2
;

546 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

548 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

551 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

552 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

554 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

555 i‡(
	`IS_SELECTED
(
f_±r
->
Êags
))

560 
b
=0; b < 8; b++)

562 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][0][
b
];

563 i‡(
bt
 =
WBITSTYPE_SAME
)

565 
b1
 = 
±r_wbôsd©a
->
mix_f
[
i
].
¥›1
 & (1 << 
b
);

566 
b2
 = 
f_±r
->
¥›1
 & (1 << 
b
);

567 i‡(
b1
 !
b2
)

569 i‡(
b1
)

570 
f_±r
->
¥›1
 |(1 << 
b
);

572 
f_±r
->
¥›1
 &~(1 << 
b
);

578 
b
=0; b < 8; b++)

580 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][1][
b
];

581 i‡(
bt
 =
WBITSTYPE_SAME
)

583 
b1
 = 
±r_wbôsd©a
->
mix_f
[
i
].
¥›2
 & (1 << 
b
);

584 
b2
 = 
f_±r
->
¥›2
 & (1 << 
b
);

585 i‡(
b1
 !
b2
)

587 i‡(
b1
)

588 
f_±r
->
¥›2
 |(1 << 
b
);

590 
f_±r
->
¥›2
 &~(1 << 
b
);

596 
b
=0; b < 8; b++)

598 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][2][
b
];

599 i‡(
bt
 =
WBITSTYPE_SAME
)

601 
b1
 = 
±r_wbôsd©a
->
mix_f
[
i
].
¥›3
 & (1 << 
b
);

602 
b2
 = 
f_±r
->
¥›3
 & (1 << 
b
);

603 i‡(
b1
 !
b2
)

605 i‡(
b1
)

606 
f_±r
->
¥›3
 |(1 << 
b
);

608 
f_±r
->
¥›3
 &~(1 << 
b
);

614 
b
=0; b < 8; b++)

616 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][3][
b
];

617 i‡((
bt
 =
WBITSTYPE_SAME
))

619 
b1
 = 
±r_wbôsd©a
->
mix_f
[
i
].
¥›4
 & (1 << 
b
);

620 
b2
 = 
f_±r
->
¥›4
 & (1 << 
b
);

621 i‡(
b1
 !
b2
)

623 i‡(
b1
)

624 
f_±r
->
¥›4
 |(1 << 
b
);

626 
f_±r
->
¥›4
 &~(1 << 
b
);

634 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

635 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

637 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
i
;

638 i‡(
	`IS_SELECTED
(
s_±r
->
Êags
))

643 
b
=0; b < 8; b++)

645 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][0][
b
];

646 i‡(
bt
 =
WBITSTYPE_SAME
)

648 
b1
 = 
±r_wbôsd©a
->
mix_s
[
i
].
¥›1
 & (1 << 
b
);

649 
b2
 = 
s_±r
->
¥›1
 & (1 << 
b
);

650 i‡(
b1
 !
b2
)

652 i‡(
b1
)

653 
s_±r
->
¥›1
 |(1 << 
b
);

655 
s_±r
->
¥›1
 &~(1 << 
b
);

661 
b
=0; b < 8; b++)

663 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][1][
b
];

664 i‡(
bt
 =
WBITSTYPE_SAME
)

666 
b1
 = 
±r_wbôsd©a
->
mix_s
[
i
].
¥›2
 & (1 << 
b
);

667 
b2
 = 
s_±r
->
¥›2
 & (1 << 
b
);

668 i‡(
b1
 !
b2
)

670 i‡(
b1
)

671 
s_±r
->
¥›2
 |(1 << 
b
);

673 
s_±r
->
¥›2
 &~(1 << 
b
);

679 
b
=0; b < 8; b++)

681 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][2][
b
];

682 i‡(
bt
 =
WBITSTYPE_SAME
)

684 
b1
 = 
±r_wbôsd©a
->
mix_s
[
i
].
¥›3
 & (1 << 
b
);

685 
b2
 = 
s_±r
->
¥›3
 & (1 << 
b
);

686 i‡(
b1
 !
b2
)

688 i‡(
b1
)

689 
s_±r
->
¥›3
 |(1 << 
b
);

691 
s_±r
->
¥›3
 &~(1 << 
b
);

697 
b
=0; b < 8; b++)

699 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][3][
b
];

700 i‡(
bt
 =
WBITSTYPE_SAME
)

702 
b1
 = 
±r_wbôsd©a
->
mix_s
[
i
].
¥›4
 & (1 << 
b
);

703 
b2
 = 
s_±r
->
¥›4
 & (1 << 
b
);

704 i‡(
b1
 !
b2
)

706 i‡(
b1
)

707 
s_±r
->
¥›4
 |(1 << 
b
);

709 
s_±r
->
¥›4
 &~(1 << 
b
);

717 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

718 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

720 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

721 i‡(
	`IS_SELECTED
(
w_±r
->
Êags
))

726 
b
=0; b < 8; b++)

728 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][0][
b
];

729 i‡(
bt
 =
WBITSTYPE_SAME
)

731 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
¥›1
 & (1 << 
b
);

732 
b2
 = 
w_±r
->
¥›1
 & (1 << 
b
);

733 i‡(
b1
 !
b2
)

735 i‡(
b1
)

736 
w_±r
->
¥›1
 |(1 << 
b
);

738 
w_±r
->
¥›1
 &~(1 << 
b
);

744 
b
=0; b < 8; b++)

746 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][1][
b
];

747 i‡(
bt
 =
WBITSTYPE_SAME
)

749 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
¥›2
 & (1 << 
b
);

750 
b2
 = 
w_±r
->
¥›2
 & (1 << 
b
);

751 i‡(
b1
 !
b2
)

753 i‡(
b1
)

754 
w_±r
->
¥›2
 |(1 << 
b
);

756 
w_±r
->
¥›2
 &~(1 << 
b
);

762 
b
=0; b < 8; b++)

764 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][2][
b
];

765 i‡(
bt
 =
WBITSTYPE_SAME
)

767 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
¥›3
 & (1 << 
b
);

768 
b2
 = 
w_±r
->
¥›3
 & (1 << 
b
);

769 i‡(
b1
 !
b2
)

771 i‡(
b1
)

772 
w_±r
->
¥›3
 |(1 << 
b
);

774 
w_±r
->
¥›3
 &~(1 << 
b
);

780 
b
=0; b < 8; b++)

782 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][3][
b
];

783 i‡(
bt
 =
WBITSTYPE_SAME
)

785 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
¥›4
 & (1 << 
b
);

786 
b2
 = 
w_±r
->
¥›4
 & (1 << 
b
);

787 i‡(
b1
 !
b2
)

789 i‡(
b1
)

790 
w_±r
->
¥›4
 |(1 << 
b
);

792 
w_±r
->
¥›4
 &~(1 << 
b
);

798 
b
=0; b < 8; b++)

800 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][4][
b
];

801 i‡(
bt
 =
WBITSTYPE_SAME
)

803 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
‹õ¡©i⁄
 & (1 << 
b
);

804 
b2
 = 
w_±r
->
‹õ¡©i⁄
 & (1 << 
b
);

805 i‡(
b1
 !
b2
)

807 i‡(
b1
)

808 
w_±r
->
‹õ¡©i⁄
 |(1 << 
b
);

810 
w_±r
->
‹õ¡©i⁄
 &~(1 << 
b
);

818 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
èg_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
èg_num
);

819 
i
=0; i < 
glb_ds1
[
ds1_idx
].
èg_num
; i++)

821 
t_±r
 = 
glb_ds1
[
ds1_idx
].
èg_buff
 + 
t
 + 
i
;

822 i‡(
	`IS_SELECTED
(
t_±r
->
Êags
))

827 
b
=0; b < 32; b++)

829 
bt
 = 
±r_wbôsd©a
->
bô_ty≥_t
[
i
][
b
];

830 i‡(
bt
 =
WBITSTYPE_SAME
)

832 
b1
 = 
±r_wbôsd©a
->
mix_t
[
i
].
num
 & (1 << 
b
);

833 
b2
 = 
t_±r
->
num
 & (1 << 
b
);

834 i‡(
b1
 !
b2
)

836 i‡(
b1
)

837 
t_±r
->
num
 |(1 << 
b
);

839 
t_±r
->
num
 &~(1 << 
b
);

848 
	}
}

852 
	$wbôs_maö_mu…ùÀ_tûes
(
ds1_idx
, 
WBITSDATA_S
 * 
±r_wbôsd©a
)

854 
w_x0
, 
w_y0
, 
w_x1
, 
w_y1
;

855 
ok_x0
, 
ok_y0
, 
ˇn˚l_x0
;

856 
c_bœck
 = 
	`makecﬁ
(0, 0, 0),

857 
c_whôe
 = 
	`makecﬁ
(255, 255, 255),

858 
c_yñlow
 = 
	`makecﬁ
(255, 255, 0),

859 
c_d¨kgªí
 = 
	`makecﬁ
(0, 64, 0),

860 
c_lightgªí
 = 
	`makecﬁ
(0, 255, 0),

861 
c_ªd
 = 
	`makecﬁ
(255, 0, 0),

862 
c_unkn
 = 
	`makecﬁ
(52, 156, 28),

863 
c_blue
 = 
	`makecﬁ
(36, 96, 216),

864 
c1
, 
c2
, 
c3
, 
mx
, 
my
, 
mb
;

865 
UDWORD
 
èg_dw
;

867 
w_width
 = 545, 
w_height
= 270;

868 
ßve
 = 
FALSE
, 
d⁄e
 = FALSE;

869 
x
, 
y
, 
i
, 
b
, 
c
, 
n
, 
vÆ
[4];

870 
UBYTE
 
shad
[4];

873 
	`ãxt_mode
(-1);

875 
w_x0
 = (
glb_c⁄fig
.
s¸ìn
.
width
 - 
w_width
) / 2;

876 
w_y0
 = (
glb_c⁄fig
.
s¸ìn
.
height
 - 
w_height
) / 2;

877 
w_x1
 = 
w_x0
 + 
w_width
;

878 
w_y1
 = 
w_y0
 + 
w_height
;

880 
ok_x0
 = 
w_x0
 + (
w_width
 / 2) - 64;

881 
ok_y0
 = 
w_y0
 + 
w_height
 - 24;

882 
ˇn˚l_x0
 = 
ok_x0
 + 70;

884 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
, 
w_y0
, 
w_x1
, 
w_y1
, 
c_bœck
);

885 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
, 
w_y0
, 
w_x1
, 
w_y1
, 
c_whôe
);

887 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_num
 >= 1)

888 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "F1", 
w_x0
 + 2, 
w_y0
 + 2, 
c_yñlow
);

889 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_num
 >= 2)

890 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "F2", 
w_x0
 + 2, 
w_y0
 + 12, 
c_yñlow
);

892 i‡(
glb_ds1
[
ds1_idx
].
shadow_num
 >= 1)

893 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "SH", 
w_x0
 + 2, 
w_y0
 + 32, 
c_yñlow
);

895 i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 1)

896 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "W1", 
w_x0
 + 2, 
w_y0
 + 52, 
c_yñlow
);

897 i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 2)

898 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "W2", 
w_x0
 + 2, 
w_y0
 + 62, 
c_yñlow
);

899 i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 3)

900 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "W3", 
w_x0
 + 2, 
w_y0
 + 72, 
c_yñlow
);

901 i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 4)

902 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "W4", 
w_x0
 + 2, 
w_y0
 + 82, 
c_yñlow
);

904 i‡(
glb_ds1
[
ds1_idx
].
èg_num
 >= 1)

905 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "SUB", 
w_x0
 + 2, 
w_y0
 + 200, 
c_yñlow
);

907 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 237, 
w_y0
 + 92, w_y0 + 105, 
c_yñlow
);

908 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "UnwÆkabÀ", 
w_x0
 + 200, 
w_y0
 + 110, 
c_yñlow
);

910 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 27, 
w_y0
 + 92, w_y0 + 105, 
c_yñlow
);

911 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Hiddí", 
w_x0
 + 10, 
w_y0
 + 110, 
c_yñlow
);

913 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 87, 
w_y0
 + 92, w_y0 + 105, 
c_yñlow
);

914 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "?", 
w_x0
 + 82, 
w_y0
 + 110, 
c_yñlow
);

916 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 97, 
w_y0
 + 92, w_y0 + 125, 
c_yñlow
);

917 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "IsShadow", 
w_x0
 + 60, 
w_y0
 + 130, 
c_yñlow
);

919 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 162, 
w_y0
 + 92, w_y0 + 140, 
c_yñlow
);

920 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Maö-ödex", 
w_x0
 + 130, 
w_y0
 + 145, 
c_yñlow
);

922 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 333, 
w_y0
 + 92, w_y0 + 140, 
c_yñlow
);

923 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Sub-ödex", 
w_x0
 + 300, 
w_y0
 + 145, 
c_yñlow
);

925 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 413, 
w_y0
 + 92, w_y0 + 100, 
c_yñlow
);

926 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Layî†¥i‹ôy,", 
w_x0
 + 360, 
w_y0
 + 105, 
c_yñlow
);

927 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Ty≥ o‡œyîs,", 
w_x0
 + 360, 
w_y0
 + 115, 
c_yñlow
);

928 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "ánd unknown", 
w_x0
 + 360, 
w_y0
 + 125, 
c_yñlow
);

930 
	`vlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_x0
 + 503, 
w_y0
 + 92, w_y0 + 140, 
c_yñlow
);

931 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "Orõ¡©i⁄", 
w_x0
 + 455, 
w_y0
 + 145, 
c_yñlow
);

935 
mx
 = 
mou£_x
;

936 
my
 = 
mou£_y
;

937 
mb
 = 
mou£_b
;

940  ! 
d⁄e
)

942 
	`ãxt_mode
(-1);

945 
c1
 = 
c_d¨kgªí
;

946 
c2
 = 
c_lightgªí
;

947 
c3
 = 
c_yñlow
;

948 i‡((
mx
 >
ok_x0
Ë&& (mx <ok_x0 + 64Ë&& (
my
 >
ok_y0
) && (my <= ok_y0 + 20))

950 
c1
 = 
c_lightgªí
;

951 
c2
 = 
c_whôe
;

952 
c3
 = 
c_bœck
;

953 i‡(
mb
 & 1)

956 
ßve
 = 
TRUE
;

957 
d⁄e
 = 
TRUE
;

958 
mou£_b
 & 1)

964 i‡(
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

966 
ßve
 = 
TRUE
;

967 
d⁄e
 = 
TRUE
;

969 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
ok_x0
, 
ok_y0
-3, ok_x0 + 64, ok_y0 + 20, 
c1
);

970 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
ok_x0
, 
ok_y0
-3, ok_x0 + 64, ok_y0 + 20, 
c2
);

971 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "OK", 
ok_x0
+25, 
ok_y0
+5, 
c3
);

974 
c1
 = 
c_d¨kgªí
;

975 
c2
 = 
c_lightgªí
;

976 
c3
 = 
c_yñlow
;

977 i‡((
mx
 >
ˇn˚l_x0
Ë&& (mx <ˇn˚l_x0 + 64Ë&& (
my
 >
ok_y0
) && (my <= ok_y0 + 20))

979 
c1
 = 
c_lightgªí
;

980 
c2
 = 
c_whôe
;

981 
c3
 = 
c_bœck
;

982 i‡(
mb
 & 1)

985 
ßve
 = 
FALSE
;

986 
d⁄e
 = 
TRUE
;

987 
mou£_b
 & 1)

993 i‡(
key
[
KEY_ESC
])

995 
ßve
 = 
FALSE
;

996 
d⁄e
 = 
TRUE
;

998 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
ˇn˚l_x0
, 
ok_y0
-3, c™˚l_x0 + 64, ok_y0 + 20, 
c1
);

999 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
ˇn˚l_x0
, 
ok_y0
-3, c™˚l_x0 + 64, ok_y0 + 20, 
c2
);

1000 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "CANCEL", 
ˇn˚l_x0
+10, 
ok_y0
+5, 
c3
);

1002 
	`ãxt_mode
(0);

1005 
y
 = 
w_y0
 + 2;

1006 
n
=0;Ç < 
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

1008 
vÆ
[0] = 
±r_wbôsd©a
->
mix_f
[
n
].
¥›1
;

1009 
vÆ
[1] = 
±r_wbôsd©a
->
mix_f
[
n
].
¥›2
;

1010 
vÆ
[2] = 
±r_wbôsd©a
->
mix_f
[
n
].
¥›3
;

1011 
vÆ
[3] = 
±r_wbôsd©a
->
mix_f
[
n
].
¥›4
;

1012 
x
 = 
w_x0
 + 24;

1013 
b
=3; b >= 0 ; b--)

1015 
i
=7; i >= 0; i--)

1017 i‡(
±r_wbôsd©a
->
bô_ty≥_f
[
n
][
b
][
i
] =
WBITSTYPE_DIFFERENT
)

1018 
c
 = 
c_blue
;

1019 i‡(
±r_wbôsd©a
->
bô_ty≥_f
[
n
][
b
][
i
] =
WBITSTYPE_UNKNOWN
)

1020 
c
 = 
c_unkn
;

1022 
c
 = 
c_whôe
;

1024 i‡((
mx
 >
x
Ë&& (mx <x+9Ë&& (
my
 >
y
) && (my <= y+9) &&

1025 (
±r_wbôsd©a
->
bô_ty≥_f
[
n
][
b
][
i
] !
WBITSTYPE_UNKNOWN
))

1027 
c
 = 
c_ªd
;

1028 i‡(
mb
 & 1)

1030 i‡(
vÆ
[
b
] & (1 << 
i
))

1033 
vÆ
[
b
] = vÆ[b] - (1 << 
i
);

1038 
vÆ
[
b
] = vÆ[b] + (1 << 
i
);

1040 
mb
 & 1)

1043 
mb
 = 
mou£_b
;

1045 
b
)

1047 0 : 
±r_wbôsd©a
->
mix_f
[
n
].
¥›1
 = 
vÆ
[0]; ;

1048 1 : 
±r_wbôsd©a
->
mix_f
[
n
].
¥›2
 = 
vÆ
[1]; ;

1049 2 : 
±r_wbôsd©a
->
mix_f
[
n
].
¥›3
 = 
vÆ
[2]; ;

1050 3 : 
±r_wbôsd©a
->
mix_f
[
n
].
¥›4
 = 
vÆ
[3]; ;

1052 i‡(
±r_wbôsd©a
->
bô_ty≥_f
[
n
][
b
][
i
] =
WBITSTYPE_DIFFERENT
)

1053 
±r_wbôsd©a
->
bô_ty≥_f
[
n
][
b
][
i
] = 
WBITSTYPE_SAME
;

1056 i‡(
±r_wbôsd©a
->
bô_ty≥_f
[
n
][
b
][
i
] =
WBITSTYPE_UNKNOWN
)

1058 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "-", 
x
, 
y
, 
c
);

1062 i‡(
vÆ
[
b
] & (1 << 
i
))

1063 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

1065 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

1068 
x
 += 10;

1069 i‡((
b
==3Ë&& ((
i
==7) || (i==6) || (i==5) || (i==3) || (i==2)))

1070 
x
+=10;

1071 i‡((
b
==2Ë&& ((
i
==4) || (i==2) || (i==1) || (i==0)))

1072 
x
+=10;

1073 i‡((
b
==1Ë&& ((
i
==6) || (i==0)))

1074 
x
+=10;

1077 
y
 += 10;

1081 
y
 +10 * (2 - 
glb_ds1
[
ds1_idx
].
Êo‹_num
);

1082 
y
 += 10;

1083 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

1085 
shad
[0] = 
±r_wbôsd©a
->
mix_s
[
n
].
¥›1
;

1086 
shad
[1] = 
±r_wbôsd©a
->
mix_s
[
n
].
¥›2
;

1087 
shad
[2] = 
±r_wbôsd©a
->
mix_s
[
n
].
¥›3
;

1088 
shad
[3] = 
±r_wbôsd©a
->
mix_s
[
n
].
¥›4
;

1089 
x
 = 
w_x0
 + 24;

1090 
b
=3; b >= 0 ; b--)

1092 
i
=7; i >= 0; i--)

1094 i‡(
±r_wbôsd©a
->
bô_ty≥_s
[
n
][
b
][
i
] =
WBITSTYPE_DIFFERENT
)

1095 
c
 = 
c_blue
;

1096 i‡(
±r_wbôsd©a
->
bô_ty≥_s
[
n
][
b
][
i
] =
WBITSTYPE_UNKNOWN
)

1097 
c
 = 
c_unkn
;

1099 
c
 = 
c_whôe
;

1101 i‡((
mx
 >
x
Ë&& (mx <x+9Ë&& (
my
 >
y
) && (my <= y+9) &&

1102 (
±r_wbôsd©a
->
bô_ty≥_s
[
n
][
b
][
i
] !
WBITSTYPE_UNKNOWN
))

1104 
c
 = 
c_ªd
;

1105 i‡(
mb
 & 1)

1107 i‡(
shad
[
b
] & (1 << 
i
))

1110 
shad
[
b
] = shad[b] - (1 << 
i
);

1115 
shad
[
b
] = shad[b] + (1 << 
i
);

1117 
mb
 & 1)

1120 
mb
 = 
mou£_b
;

1122 
b
)

1124 0 : 
±r_wbôsd©a
->
mix_s
[
n
].
¥›1
 = 
shad
[0]; ;

1125 1 : 
±r_wbôsd©a
->
mix_s
[
n
].
¥›2
 = 
shad
[1]; ;

1126 2 : 
±r_wbôsd©a
->
mix_s
[
n
].
¥›3
 = 
shad
[2]; ;

1127 3 : 
±r_wbôsd©a
->
mix_s
[
n
].
¥›4
 = 
shad
[3]; ;

1129 i‡(
±r_wbôsd©a
->
bô_ty≥_s
[
n
][
b
][
i
] =
WBITSTYPE_DIFFERENT
)

1130 
±r_wbôsd©a
->
bô_ty≥_s
[
n
][
b
][
i
] = 
WBITSTYPE_SAME
;

1133 i‡(
±r_wbôsd©a
->
bô_ty≥_s
[
n
][
b
][
i
] =
WBITSTYPE_UNKNOWN
)

1135 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "-", 
x
, 
y
, 
c
);

1139 i‡(
shad
[
b
] & (1 << 
i
))

1140 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

1142 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

1145 
x
 += 10;

1146 i‡((
b
==3Ë&& ((
i
==7) || (i==6) || (i==5) || (i==3) || (i==2)))

1147 
x
+=10;

1148 i‡((
b
==2Ë&& ((
i
==4) || (i==2) || (i==1) || (i==0)))

1149 
x
+=10;

1150 i‡((
b
==1Ë&& ((
i
==6) || (i==0)))

1151 
x
+=10;

1154 
y
 += 10;

1158 
y
 += 10;

1159 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

1161 
vÆ
[0] = 
±r_wbôsd©a
->
mix_w
[
n
].
¥›1
;

1162 
vÆ
[1] = 
±r_wbôsd©a
->
mix_w
[
n
].
¥›2
;

1163 
vÆ
[2] = 
±r_wbôsd©a
->
mix_w
[
n
].
¥›3
;

1164 
vÆ
[3] = 
±r_wbôsd©a
->
mix_w
[
n
].
¥›4
;

1165 
x
 = 
w_x0
 + 24;

1168 
b
=3; b >= 0 ; b--)

1170 
i
=7; i >= 0; i--)

1172 i‡(
±r_wbôsd©a
->
bô_ty≥_w
[
n
][
b
][
i
] =
WBITSTYPE_DIFFERENT
)

1173 
c
 = 
c_blue
;

1174 i‡(
±r_wbôsd©a
->
bô_ty≥_w
[
n
][
b
][
i
] =
WBITSTYPE_UNKNOWN
)

1175 
c
 = 
c_unkn
;

1177 
c
 = 
c_whôe
;

1179 i‡((
mx
 >
x
Ë&& (mx <x+9Ë&& (
my
 >
y
) && (my <= y+9) &&

1180 (
±r_wbôsd©a
->
bô_ty≥_w
[
n
][
b
][
i
] !
WBITSTYPE_UNKNOWN
))

1182 
c
 = 
c_ªd
;

1183 i‡(
mb
 & 1)

1185 i‡(
vÆ
[
b
] & (1 << 
i
))

1188 
vÆ
[
b
] = vÆ[b] - (1 << 
i
);

1193 
vÆ
[
b
] = vÆ[b] + (1 << 
i
);

1195 
mb
 & 1)

1198 
mb
 = 
mou£_b
;

1200 
b
)

1202 0 : 
±r_wbôsd©a
->
mix_w
[
n
].
¥›1
 = 
vÆ
[0]; ;

1203 1 : 
±r_wbôsd©a
->
mix_w
[
n
].
¥›2
 = 
vÆ
[1]; ;

1204 2 : 
±r_wbôsd©a
->
mix_w
[
n
].
¥›3
 = 
vÆ
[2]; ;

1205 3 : 
±r_wbôsd©a
->
mix_w
[
n
].
¥›4
 = 
vÆ
[3]; ;

1207 i‡(
±r_wbôsd©a
->
bô_ty≥_w
[
n
][
b
][
i
] =
WBITSTYPE_DIFFERENT
)

1208 
±r_wbôsd©a
->
bô_ty≥_w
[
n
][
b
][
i
] = 
WBITSTYPE_SAME
;

1211 i‡(
±r_wbôsd©a
->
bô_ty≥_w
[
n
][
b
][
i
] =
WBITSTYPE_UNKNOWN
)

1213 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "-", 
x
, 
y
, 
c
);

1217 i‡(
vÆ
[
b
] & (1 << 
i
))

1218 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

1220 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

1223 
x
 += 10;

1224 i‡((
b
==3Ë&& ((
i
==7) || (i==6) || (i==5) || (i==3) || (i==2)))

1225 
x
+=10;

1226 i‡((
b
==2Ë&& ((
i
==4) || (i==2) || (i==1) || (i==0)))

1227 
x
+=10;

1228 i‡((
b
==1Ë&& ((
i
==6) || (i==0)))

1229 
x
+=10;

1230 i‡((
b
==0Ë&& (
i
==0))

1231 
x
+=10;

1236 
i
=7; i >= 0; i--)

1238 i‡(
±r_wbôsd©a
->
bô_ty≥_w
[
n
][4][
i
] =
WBITSTYPE_DIFFERENT
)

1239 
c
 = 
c_blue
;

1240 i‡(
±r_wbôsd©a
->
bô_ty≥_w
[
n
][4][
i
] =
WBITSTYPE_UNKNOWN
)

1241 
c
 = 
c_unkn
;

1243 
c
 = 
c_whôe
;

1245 i‡((
mx
 >
x
Ë&& (mx <x+9Ë&& (
my
 >
y
) && (my <= y+9) &&

1246 (
±r_wbôsd©a
->
bô_ty≥_w
[
n
][4][
i
] !
WBITSTYPE_UNKNOWN
))

1248 
c
 = 
c_ªd
;

1249 i‡(
mb
 & 1)

1251 i‡(
±r_wbôsd©a
->
mix_w
[
n
].
‹õ¡©i⁄
 & (1 << 
i
))

1254 
±r_wbôsd©a
->
mix_w
[
n
].
‹õ¡©i⁄
 =

1255 
±r_wbôsd©a
->
mix_w
[
n
].
‹õ¡©i⁄
 - (1 << 
i
);

1260 
±r_wbôsd©a
->
mix_w
[
n
].
‹õ¡©i⁄
 =

1261 
±r_wbôsd©a
->
mix_w
[
n
].
‹õ¡©i⁄
 + (1 << 
i
);

1263 
mb
 & 1)

1266 
mb
 = 
mou£_b
;

1269 i‡(
±r_wbôsd©a
->
bô_ty≥_w
[
n
][4][
i
] =
WBITSTYPE_DIFFERENT
)

1270 
±r_wbôsd©a
->
bô_ty≥_w
[
n
][4][
i
] = 
WBITSTYPE_SAME
;

1273 i‡(
±r_wbôsd©a
->
bô_ty≥_w
[
n
][4][
i
] =
WBITSTYPE_UNKNOWN
)

1275 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "-", 
x
, 
y
, 
c
);

1279 i‡(
±r_wbôsd©a
->
mix_w
[
n
].
‹õ¡©i⁄
 & (1 << 
i
))

1280 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

1282 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

1284 
x
 += 10;

1287 
y
 += 10;

1291 
y
 +10 * (4 - 
glb_ds1
[
ds1_idx
].
wÆl_num
);

1292 
y
 += 108;

1293 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
èg_num
;Ç++)

1295 
èg_dw
 = 
±r_wbôsd©a
->
mix_t
[
n
].
num
;

1296 
x
 = 
w_x0
 + 34;

1297 
i
=31; i >= 0; i--)

1299 i‡(
±r_wbôsd©a
->
bô_ty≥_t
[
n
][
i
] =
WBITSTYPE_DIFFERENT
)

1300 
c
 = 
c_blue
;

1301 i‡(
±r_wbôsd©a
->
bô_ty≥_t
[
n
][
i
] =
WBITSTYPE_UNKNOWN
)

1302 
c
 = 
c_unkn
;

1304 
c
 = 
c_whôe
;

1306 i‡((
mx
 >
x
Ë&& (mx <x+9Ë&& (
my
 >
y
) && (my <= y+9) &&

1307 (
±r_wbôsd©a
->
bô_ty≥_t
[
n
][
i
] !
WBITSTYPE_UNKNOWN
))

1309 
c
 = 
c_ªd
;

1310 i‡(
mb
 & 1)

1312 i‡(
èg_dw
 & (1 << 
i
))

1315 
èg_dw
 =Åag_dw - (1 << 
i
);

1320 
èg_dw
 =Åag_dw + (1 << 
i
);

1322 
mb
 & 1)

1325 
mb
 = 
mou£_b
;

1328 
±r_wbôsd©a
->
mix_t
[
n
].
num
 = 
èg_dw
;

1330 i‡(
±r_wbôsd©a
->
bô_ty≥_t
[
n
][
i
] =
WBITSTYPE_DIFFERENT
)

1331 
±r_wbôsd©a
->
bô_ty≥_t
[
n
][
i
] = 
WBITSTYPE_SAME
;

1334 i‡(
±r_wbôsd©a
->
bô_ty≥_t
[
n
][
i
] =
WBITSTYPE_UNKNOWN
)

1336 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "-", 
x
, 
y
, 
c
);

1340 i‡(
èg_dw
 & (1 << 
i
))

1341 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "1", 
x
, 
y
, 
c
);

1343 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, "0", 
x
, 
y
, 
c
);

1345 
x
 += 10;

1347 i‡((
i
==8) || (i==16) || (i==24))

1348 
x
+=10;

1350 
y
 += 10;

1351 
x
 = 
w_x0
 + 48;

1352 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
, 
y
, 
c_lightgªí
, "%8lu", (
èg_dw
 & 0xFF000000LU) >> 24);

1353 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
 + 90, 
y
, 
c_lightgªí
, "%8lu", (
èg_dw
 & 0x00FF0000LU) >> 16);

1354 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
 + 180, 
y
, 
c_lightgªí
, "%8lu", (
èg_dw
 & 0x0000FF00LU) >> 8);

1355 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x
 + 270, 
y
, 
c_lightgªí
, "%8lu", 
èg_dw
 & 0x000000FFLU);

1358 
	`misc_døw_s¸ìn
(
mx
, 
my
);

1361 
mx
 = 
mou£_x
;

1362 
my
 = 
mou£_y
;

1363 
mb
 = 
mou£_b
;

1366 i‡(
ßve
 =
FALSE
)

1373 
	`wbôs_≠∂y_modifiˇti⁄
(
ds1_idx
, 
±r_wbôsd©a
);

1376 
	`ds1_make_¥›_2_block
(
ds1_idx
);

1379 i‡(
key
[
KEY_ESC
])

1381 
key
[
KEY_ESC
])

1386 i‡(
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

1388 
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
])

1395 
	`ãxt_mode
(-1);

1396 
	}
}

1400 
	$wbôs_maö
(
ds1_idx
, 
tx
, 
ty
)

1402 
WBITSDATA_S
 * 
±r_wbôsd©a
;

1403 
CELL_F_S
 * 
f_±r
;

1404 
CELL_W_S
 * 
w_±r
;

1405 
CELL_S_S
 * 
s_±r
;

1406 
CELL_T_S
 * 
t_±r
;

1407 
x
, 
y
, 
t
, 
i
, 
size
, 
b
, 
b1
, 
b2
;

1408 
has_£À˘i⁄
;

1409 
tmp
[256];

1413 
size
 = (
WBITSDATA_S
);

1414 
±r_wbôsd©a
 = (
WBITSDATA_S
 *Ë
	`mÆloc
(
size
);

1415 i‡(
±r_wbôsd©a
 =
NULL
) {

1416 
	`FATAL_EXIT
("wbôs_maö(Ë: c™'àÆoˇã %òbyã†f‹ '±r_wbôsd©a'\n", 
size
);

1418 
	`mem£t
(
±r_wbôsd©a
, 0, 
size
);

1423 
has_£À˘i⁄
 = 
FALSE
;

1424 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

1426 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

1429 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1430 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

1432 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

1433 i‡(
	`IS_SELECTED
(
f_±r
->
Êags
))

1434 
has_£À˘i⁄
 = 
TRUE
;

1438 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1439 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

1441 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
i
;

1442 i‡(
	`IS_SELECTED
(
s_±r
->
Êags
))

1443 
has_£À˘i⁄
 = 
TRUE
;

1447 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1448 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

1450 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

1451 i‡(
	`IS_SELECTED
(
w_±r
->
Êags
))

1452 
has_£À˘i⁄
 = 
TRUE
;

1456 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
èg_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
èg_num
);

1457 
i
=0; i < 
glb_ds1
[
ds1_idx
].
èg_num
; i++)

1459 
t_±r
 = 
glb_ds1
[
ds1_idx
].
èg_buff
 + 
t
 + 
i
;

1460 i‡(
	`IS_SELECTED
(
t_±r
->
Êags
))

1461 
has_£À˘i⁄
 = 
TRUE
;

1466 i‡(
has_£À˘i⁄
 =
FALSE
)

1470 
	`wbôs_maö_sögÀ_tûe
(
ds1_idx
, 
tx
, 
ty
);

1480 
y
=0; y < 
glb_ds1
[
ds1_idx
].
height
; y++)

1482 
x
=0; x < 
glb_ds1
[
ds1_idx
].
width
; x++)

1485 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1486 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

1488 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

1489 i‡(
	`IS_SELECTED
(
f_±r
->
Êags
))

1493 i‡(
	`IS_SELECTED
(
±r_wbôsd©a
->
mix_f
[
i
].
Êags
))

1498 
b
=0; b < 8; b++)

1500 
b1
 = 
±r_wbôsd©a
->
mix_f
[
i
].
¥›1
 & (1 << 
b
);

1501 
b2
 = 
f_±r
->
¥›1
 & (1 << 
b
);

1502 i‡(
b1
 !
b2
)

1503 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][0][
b
] = 
WBITSTYPE_DIFFERENT
;

1507 
b
=0; b < 8; b++)

1509 
b1
 = 
±r_wbôsd©a
->
mix_f
[
i
].
¥›2
 & (1 << 
b
);

1510 
b2
 = 
f_±r
->
¥›2
 & (1 << 
b
);

1511 i‡(
b1
 !
b2
)

1512 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][1][
b
] = 
WBITSTYPE_DIFFERENT
;

1516 
b
=0; b < 8; b++)

1518 
b1
 = 
±r_wbôsd©a
->
mix_f
[
i
].
¥›3
 & (1 << 
b
);

1519 
b2
 = 
f_±r
->
¥›3
 & (1 << 
b
);

1520 i‡(
b1
 !
b2
)

1521 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][2][
b
] = 
WBITSTYPE_DIFFERENT
;

1525 
b
=0; b < 8; b++)

1527 
b1
 = 
±r_wbôsd©a
->
mix_f
[
i
].
¥›4
 & (1 << 
b
);

1528 
b2
 = 
f_±r
->
¥›4
 & (1 << 
b
);

1529 i‡(
b1
 !
b2
)

1530 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][3][
b
] = 
WBITSTYPE_DIFFERENT
;

1535 
	`SET_SELECTED
(
±r_wbôsd©a
->
mix_f
[
i
].
Êags
);

1538 
b
=0; b < 8; b++)

1539 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][0][
b
] = 
WBITSTYPE_SAME
;

1540 
b
=0; b < 8; b++)

1541 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][1][
b
] = 
WBITSTYPE_SAME
;

1542 
b
=0; b < 8; b++)

1543 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][2][
b
] = 
WBITSTYPE_SAME
;

1544 
b
=0; b < 8; b++)

1545 
±r_wbôsd©a
->
bô_ty≥_f
[
i
][3][
b
] = 
WBITSTYPE_SAME
;

1549 
±r_wbôsd©a
->
mix_f
[
i
].
¥›1
 |
f_±r
->prop1;

1550 
±r_wbôsd©a
->
mix_f
[
i
].
¥›2
 |
f_±r
->prop2;

1551 
±r_wbôsd©a
->
mix_f
[
i
].
¥›3
 |
f_±r
->prop3;

1552 
±r_wbôsd©a
->
mix_f
[
i
].
¥›4
 |
f_±r
->prop4;

1557 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1558 
i
=0; i < 
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

1560 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
i
;

1561 i‡(
	`IS_SELECTED
(
s_±r
->
Êags
))

1565 i‡(
	`IS_SELECTED
(
±r_wbôsd©a
->
mix_s
[
i
].
Êags
))

1570 
b
=0; b < 8; b++)

1572 
b1
 = 
±r_wbôsd©a
->
mix_s
[
i
].
¥›1
 & (1 << 
b
);

1573 
b2
 = 
s_±r
->
¥›1
 & (1 << 
b
);

1574 i‡(
b1
 !
b2
)

1575 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][0][
b
] = 
WBITSTYPE_DIFFERENT
;

1579 
b
=0; b < 8; b++)

1581 
b1
 = 
±r_wbôsd©a
->
mix_s
[
i
].
¥›2
 & (1 << 
b
);

1582 
b2
 = 
s_±r
->
¥›2
 & (1 << 
b
);

1583 i‡(
b1
 !
b2
)

1584 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][1][
b
] = 
WBITSTYPE_DIFFERENT
;

1588 
b
=0; b < 8; b++)

1590 
b1
 = 
±r_wbôsd©a
->
mix_s
[
i
].
¥›3
 & (1 << 
b
);

1591 
b2
 = 
s_±r
->
¥›3
 & (1 << 
b
);

1592 i‡(
b1
 !
b2
)

1593 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][2][
b
] = 
WBITSTYPE_DIFFERENT
;

1597 
b
=0; b < 8; b++)

1599 
b1
 = 
±r_wbôsd©a
->
mix_s
[
i
].
¥›4
 & (1 << 
b
);

1600 
b2
 = 
s_±r
->
¥›4
 & (1 << 
b
);

1601 i‡(
b1
 !
b2
)

1602 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][3][
b
] = 
WBITSTYPE_DIFFERENT
;

1607 
	`SET_SELECTED
(
±r_wbôsd©a
->
mix_s
[
i
].
Êags
);

1610 
b
=0; b < 8; b++)

1611 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][0][
b
] = 
WBITSTYPE_SAME
;

1612 
b
=0; b < 8; b++)

1613 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][1][
b
] = 
WBITSTYPE_SAME
;

1614 
b
=0; b < 8; b++)

1615 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][2][
b
] = 
WBITSTYPE_SAME
;

1616 
b
=0; b < 8; b++)

1617 
±r_wbôsd©a
->
bô_ty≥_s
[
i
][3][
b
] = 
WBITSTYPE_SAME
;

1621 
±r_wbôsd©a
->
mix_s
[
i
].
¥›1
 |
s_±r
->prop1;

1622 
±r_wbôsd©a
->
mix_s
[
i
].
¥›2
 |
s_±r
->prop2;

1623 
±r_wbôsd©a
->
mix_s
[
i
].
¥›3
 |
s_±r
->prop3;

1624 
±r_wbôsd©a
->
mix_s
[
i
].
¥›4
 |
s_±r
->prop4;

1629 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1630 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

1632 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

1633 i‡(
	`IS_SELECTED
(
w_±r
->
Êags
))

1637 i‡(
	`IS_SELECTED
(
±r_wbôsd©a
->
mix_w
[
i
].
Êags
))

1642 
b
=0; b < 8; b++)

1644 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
¥›1
 & (1 << 
b
);

1645 
b2
 = 
w_±r
->
¥›1
 & (1 << 
b
);

1646 i‡(
b1
 !
b2
)

1647 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][0][
b
] = 
WBITSTYPE_DIFFERENT
;

1651 
b
=0; b < 8; b++)

1653 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
¥›2
 & (1 << 
b
);

1654 
b2
 = 
w_±r
->
¥›2
 & (1 << 
b
);

1655 i‡(
b1
 !
b2
)

1656 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][1][
b
] = 
WBITSTYPE_DIFFERENT
;

1660 
b
=0; b < 8; b++)

1662 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
¥›3
 & (1 << 
b
);

1663 
b2
 = 
w_±r
->
¥›3
 & (1 << 
b
);

1664 i‡(
b1
 !
b2
)

1665 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][2][
b
] = 
WBITSTYPE_DIFFERENT
;

1669 
b
=0; b < 8; b++)

1671 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
¥›4
 & (1 << 
b
);

1672 
b2
 = 
w_±r
->
¥›4
 & (1 << 
b
);

1673 i‡(
b1
 !
b2
)

1674 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][3][
b
] = 
WBITSTYPE_DIFFERENT
;

1678 
b
=0; b < 8; b++)

1680 
b1
 = 
±r_wbôsd©a
->
mix_w
[
i
].
‹õ¡©i⁄
 & (1 << 
b
);

1681 
b2
 = 
w_±r
->
‹õ¡©i⁄
 & (1 << 
b
);

1682 i‡(
b1
 !
b2
)

1683 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][4][
b
] = 
WBITSTYPE_DIFFERENT
;

1688 
	`SET_SELECTED
(
±r_wbôsd©a
->
mix_w
[
i
].
Êags
);

1691 
b
=0; b < 8; b++)

1692 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][0][
b
] = 
WBITSTYPE_SAME
;

1693 
b
=0; b < 8; b++)

1694 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][1][
b
] = 
WBITSTYPE_SAME
;

1695 
b
=0; b < 8; b++)

1696 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][2][
b
] = 
WBITSTYPE_SAME
;

1697 
b
=0; b < 8; b++)

1698 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][3][
b
] = 
WBITSTYPE_SAME
;

1699 
b
=0; b < 8; b++)

1700 
±r_wbôsd©a
->
bô_ty≥_w
[
i
][4][
b
] = 
WBITSTYPE_SAME
;

1704 
±r_wbôsd©a
->
mix_w
[
i
].
¥›1
 |
w_±r
->prop1;

1705 
±r_wbôsd©a
->
mix_w
[
i
].
¥›2
 |
w_±r
->prop2;

1706 
±r_wbôsd©a
->
mix_w
[
i
].
¥›3
 |
w_±r
->prop3;

1707 
±r_wbôsd©a
->
mix_w
[
i
].
¥›4
 |
w_±r
->prop4;

1708 
±r_wbôsd©a
->
mix_w
[
i
].
‹õ¡©i⁄
 |
w_±r
->orientation;

1713 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
èg_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
èg_num
);

1714 
i
=0; i < 
glb_ds1
[
ds1_idx
].
èg_num
; i++)

1716 
t_±r
 = 
glb_ds1
[
ds1_idx
].
èg_buff
 + 
t
 + 
i
;

1717 i‡(
	`IS_SELECTED
(
t_±r
->
Êags
))

1721 i‡(
	`IS_SELECTED
(
±r_wbôsd©a
->
mix_t
[
i
].
Êags
))

1726 
b
=0; b < 32; b++)

1728 
b1
 = 
±r_wbôsd©a
->
mix_t
[
i
].
num
 & (1 << 
b
);

1729 
b2
 = 
t_±r
->
num
 & (1 << 
b
);

1730 i‡(
b1
 !
b2
)

1731 
±r_wbôsd©a
->
bô_ty≥_t
[
i
][
b
] = 
WBITSTYPE_DIFFERENT
;

1736 
	`SET_SELECTED
(
±r_wbôsd©a
->
mix_t
[
i
].
Êags
);

1739 
b
=0; b < 32; b++)

1740 
±r_wbôsd©a
->
bô_ty≥_t
[
i
][
b
] = 
WBITSTYPE_SAME
;

1744 
±r_wbôsd©a
->
mix_t
[
i
].
num
 |
t_±r
->num;

1751 
	`wbôs_maö_mu…ùÀ_tûes
(
ds1_idx
, 
±r_wbôsd©a
);

1755 
	`‰ì
(
±r_wbôsd©a
);

1756 
	}
}

	@wbits.h

1 #i‚de‡
_WBITS_H_


3 
	#_WBITS_H_


	)

5 
wbôs_maö_sögÀ_tûe
 (
ds1_idx
, 
tx
, 
ty
);

6 
wbôs_≠∂y_modifiˇti⁄
 (
ds1_idx
, 
WBITSDATA_S
 * 
±r_wbôsd©a
);

7 
wbôs_maö_mu…ùÀ_tûes
 (
ds1_idx
, 
WBITSDATA_S
 * 
±r_wbôsd©a
);

8 
wbôs_maö
 (
ds1_idx
, 
tx
, 
ty
);

	@wedit.c

1 
	~"°ru˘s.h
"

2 
	~"w¥evõw.h
"

3 
	~"îr‹.h
"

4 
	~"undo.h
"

5 
	~"misc.h
"

6 
	~"wedô.h
"

8 
	#˘uif
–
ex¥
 ) do{ if–ex¥ ){ ; }}0)

	)

9 
	#brkif
–
ex¥
 ) do{ if–ex¥ ){ ; }}0)

	)

14 
	$wedô_døw_s
(
ds1_idx
, 
x
, 
y
)

16 
WIN_ELEMENT_S
 * 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_¥evõw
;

17 
BITMAP
 * 
sub
;

18 
BLOCK_TABLE_S
 * 
bt_±r
;

19 
BITMAP
 * 
tmp_bmp
;

20 
CELL_S_S
 * 
s_±r
;

21 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
y1
;

22 
ux1
, 
ux2
, 
ux3
, 
ux4
, 
uy1
, 
uy2
, 
uy3
;

25 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

26 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
;

27 
sub
 = 
	`¸óã_sub_bôm≠
(
glb_ds1edô
.
s¸ìn_buff
, 
w_ñm
->
i_x0
, w_ñm->
i_y0
, w_ñm->
öside
->
w
, w_ñm->öside->
h
);

29 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++) {

30 
bt_idx
 = 
s_±r
[
n
].bt_idx;

31 i‡(
bt_idx
 == -1) {

32 
ux1
 = 0;

33 
ux2
 = 
ux1
 + 79;

34 
ux3
 = 
ux1
 + 80;

35 
ux4
 = 
ux1
 + 159;

37 
uy1
 = 
sub
->
h
 - 160;

38 
uy2
 = 
uy1
 + 39;

39 
uy3
 = 
uy1
 + 78;

41 
	`löe
(
sub
, 
ux1
, 
uy2
, 
ux2
, 
uy1
, 168);

42 
	`löe
(
sub
, 
ux3
, 
uy1
, 
ux4
, 
uy2
, 168);

43 
	`löe
(
sub
, 
ux3
, 
uy3
, 
ux4
, 
uy2
, 168);

44 
	`löe
(
sub
, 
ux1
, 
uy2
, 
ux2
, 
uy3
, 168);

46 
	`ãxçrötf
(
sub
, 
f⁄t
, 
ux1
+8, 
uy2
-2, 0, "%u %u %u %u", 
s_±r
[
n
].
¥›1
, s_±r[n].
¥›2
, s_±r[n].
¥›3
, s_±r[n].
¥›4
);

47 
	`ãxçrötf
(
sub
, 
f⁄t
, 
ux1
+7, 
uy2
-3, 255, "%u %u %u %u", 
s_±r
[
n
].
¥›1
, s_±r[n].
¥›2
, s_±r[n].
¥›3
, s_±r[n].
¥›4
);

49 i‡(
bt_idx
 <= 0) {

53 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

54 i‡(
bt_±r
->
ty≥
 !
BT_SHADOW
) {

58 
dt1_idx
 = 
bt_±r
->dt1_idx;

59 
block_idx
 = 
bt_±r
->block_idx;

60 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
ZM_11
] + 
block_idx
);

62 i‡(
tmp_bmp
 =
NULL
) {

66 
y1
 = 
sub
->
h
 - 160 - 
bt_±r
->
zîo_löe
;

67 
y1
 += 80;

70 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0])

73 
	`døw_•rôe
(
sub
, 
tmp_bmp
, 0, 
y1
);

77 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

78 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SELECT
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

80 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SELECT
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

81 
	`døw_lô_•rôe
(
sub
, 
tmp_bmp
, 0, 
y1
, 
COL_SHADOW
);

85 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

86 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_TRANS
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

88 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_TRANS
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

89 
	`døw_å™s_•rôe
(
sub
, 
tmp_bmp
, 0, 
y1
);

93 
	`de°roy_bôm≠
(
sub
);

94 
	}
}

99 
	$wedô_døw_f
(
ds1_idx
, 
x
, 
y
)

101 
WIN_ELEMENT_S
 * 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_¥evõw
;

102 
BITMAP
 * 
sub
;

103 
BLOCK_TABLE_S
 * 
bt_±r
;

104 
BITMAP
 * 
tmp_bmp
;

105 
CELL_F_S
 * 
f_±r
;

106 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
y1
;

107 
ORDER_DATA_S
 
‹dî_d©a
[4];

108 
ux1
, 
ux2
, 
ux3
, 
ux4
, 
uy1
, 
uy2
, 
uy3
;

111 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

112 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
;

113 
sub
 = 
	`¸óã_sub_bôm≠
(
glb_ds1edô
.
s¸ìn_buff
, 
w_ñm
->
i_x0
, w_ñm->
i_y0
, w_ñm->
öside
->
w
, w_ñm->öside->
h
);

115 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++) {

116 
‹dî_d©a
[
n
].
idx
 =Ç;

117 
‹dî_d©a
[
n
].
height
 = 
f_±r
[n].
¥›1
;

119 
	`qs‹t
(
‹dî_d©a
, 
glb_ds1
[
ds1_idx
].
Êo‹_num
, (
ORDER_DATA_S
), 
qs‹t_hñ≥r_‹dî_d©a
);

121 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++) {

122 
bt_idx
 = 
f_±r
[
‹dî_d©a
[
n
].
idx
].bt_idx;

123 i‡(
bt_idx
 == -1) {

124 
ux1
 = 0;

125 
ux2
 = 
ux1
 + 79;

126 
ux3
 = 
ux1
 + 80;

127 
ux4
 = 
ux1
 + 159;

129 
uy1
 = 
sub
->
h
 - 160;

130 
uy2
 = 
uy1
 + 39;

131 
uy3
 = 
uy1
 + 78;

133 
	`löe
(
sub
, 
ux1
, 
uy2
, 
ux2
, 
uy1
, 168);

134 
	`löe
(
sub
, 
ux3
, 
uy1
, 
ux4
, 
uy2
, 168);

135 
	`löe
(
sub
, 
ux3
, 
uy3
, 
ux4
, 
uy2
, 168);

136 
	`löe
(
sub
, 
ux1
, 
uy2
, 
ux2
, 
uy3
, 168);

138 
	`ãxçrötf
(
sub
, 
f⁄t
, 
ux1
+8, 
uy2
-2, 0, "%u %u %u %u", 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›1
, f_±r[‹dî_d©a[n].idx].
¥›2
, f_±r[‹dî_d©a[n].idx].
¥›3
, f_±r[‹dî_d©a[n].idx].
¥›4
);

139 
	`ãxçrötf
(
sub
, 
f⁄t
, 
ux1
+7, 
uy2
-3, 255, "%u %u %u %u", 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›1
, f_±r[‹dî_d©a[n].idx].
¥›2
, f_±r[‹dî_d©a[n].idx].
¥›3
, f_±r[‹dî_d©a[n].idx].
¥›4
);

141 i‡(
bt_idx
 <= 0) {

145 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

146 i‡–(
bt_±r
->
ty≥
 !
BT_STATIC
Ë&& (bt_±r->ty≥ !
BT_ANIMATED
) ) {

150 
dt1_idx
 = 
bt_±r
->dt1_idx;

151 
block_idx
 = 
bt_±r
->block_idx;

152 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
ZM_11
] + 
block_idx
);

154 i‡(
tmp_bmp
 =
NULL
) {

158 
y1
 = 
sub
->
h
 - 160 - 
bt_±r
->
zîo_löe
;

159 
	`døw_•rôe
(
sub
, 
tmp_bmp
, 0, 
y1
);

161 
	`de°roy_bôm≠
(
sub
);

162 
	}
}

167 
	$wedô_døw_w
(
ds1_idx
, 
x
, 
y
, 
uµî
)

169 
WIN_ELEMENT_S
 * 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_¥evõw
;

170 
BITMAP
 * 
sub
;

171 
BLOCK_TABLE_S
 * 
bt_±r
;

172 
BITMAP
 * 
tmp_bmp
;

173 
CELL_W_S
 * 
w_±r
;

174 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
m
, 
s
, 
y1
;

175 
d⁄e
, 
found
, 
o
;

176 
ORDER_DATA_S
 
‹dî_d©a
[4];

177 
ux1
, 
ux2
, 
ux3
, 
ux4
, 
uy1
, 
uy2
, 
uy3
;

180 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

181 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

182 
sub
 = 
	`¸óã_sub_bôm≠
(
glb_ds1edô
.
s¸ìn_buff
, 
w_ñm
->
i_x0
, w_ñm->
i_y0
, w_ñm->
öside
->
w
, w_ñm->öside->
h
);

184 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++) {

185 
‹dî_d©a
[
n
].
idx
 =Ç;

186 
‹dî_d©a
[
n
].
height
 = 
w_±r
[n].
¥›1
;

187 i‡(
w_±r
[
n
].
‹õ¡©i⁄
 == 10) {

188 
‹dî_d©a
[
n
].
height
 = 255;

191 
	`qs‹t
(
‹dî_d©a
, 
glb_ds1
[
ds1_idx
].
wÆl_num
, (
ORDER_DATA_S
), 
qs‹t_hñ≥r_‹dî_d©a
);

193 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++) {

194 
o
 = 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
;

195 i‡((
uµî
 =
TRUE
Ë&& (
o
 >= 15)) {

198 i‡((
uµî
 =
FALSE
Ë&& (
o
 <= 15)) {

202 i‡(
glb_ds1
[
ds1_idx
].
•ecül_œyî_mask
 && ((
o
 == 10) || (o == 11))) {

207 
bt_idx
 = 
w_±r
[
‹dî_d©a
[
n
].
idx
].bt_idx;

209 i‡(
bt_idx
 == 0) {

213 i‡(
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4
 & 0x80) {

216 i‡((
o
 != 10) && (o != 11)) {

217 
bt_idx
 = -1;

221 i‡(
bt_idx
 == -1) {

222 
ux1
 = 0;

223 
ux2
 = 
ux1
 + 79;

224 
ux3
 = 
ux1
 + 80;

225 
ux4
 = 
ux1
 + 159;

227 
uy1
 = 
sub
->
h
 - 160;

228 
uy2
 = 
uy1
 + 39;

229 
uy3
 = 
uy1
 + 78;

231 
	`löe
(
sub
, 
ux1
, 
uy2
, 
ux2
, 
uy1
, 168);

232 
	`löe
(
sub
, 
ux3
, 
uy1
, 
ux4
, 
uy2
, 168);

233 
	`löe
(
sub
, 
ux3
, 
uy3
, 
ux4
, 
uy2
, 168);

234 
	`löe
(
sub
, 
ux1
, 
uy2
, 
ux2
, 
uy3
, 168);

236 
	`ãxçrötf
(
sub
, 
f⁄t
, 
ux1
+8, 
uy2
-2, 0, "(%uË%u %u %u %u", 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
, w_±r[‹dî_d©a[n].idx].
¥›1
, w_±r[‹dî_d©a[n].idx].
¥›2
, w_±r[‹dî_d©a[n].idx].
¥›3
, w_±r[‹dî_d©a[n].idx].
¥›4
 );

237 
	`ãxçrötf
(
sub
, 
f⁄t
, 
ux1
+7, 
uy2
-3, 255, "(%uË%u %u %u %u", 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
, w_±r[‹dî_d©a[n].idx].
¥›1
, w_±r[‹dî_d©a[n].idx].
¥›2
, w_±r[‹dî_d©a[n].idx].
¥›3
, w_±r[‹dî_d©a[n].idx].
¥›4
 );

241 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

242 i‡–(
bt_±r
->
ty≥
 !
BT_WALL_UP
Ë&& (bt_±r->ty≥ !
BT_WALL_DOWN
Ë&& (bt_±r->ty≥ !
BT_SPECIAL
)) {

247 
dt1_idx
 = 
bt_±r
->dt1_idx;

248 
block_idx
 = 
bt_±r
->block_idx;

250 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
ZM_11
] + 
block_idx
);

252 i‡(
tmp_bmp
 =
NULL
) {

256 
y1
 = 
sub
->
h
 - 160 - 
bt_±r
->
zîo_löe
;

257 
y1
 += 80;

258 
	`døw_•rôe
(
sub
, 
tmp_bmp
, 0, 
y1
);

260 i‡(
bt_±r
->
‹õ¡©i⁄
 == 3) {

263 
m
 = 
bt_±r
->
maö_ödex
;

264 
s
 = 
bt_±r
->
sub_ödex
;

265 
d⁄e
 = 
FALSE
;

266 
found
 = 
FALSE
;

267  ! 
d⁄e
) {

268 i‡(
bt_idx
 >
glb_ds1
[
ds1_idx
].
bt_num
) {

269 
d⁄e
 = 
TRUE
;

271 
bt_±r
++;

272 i‡(
bt_±r
->
‹õ¡©i⁄
 < 4) {

273 
bt_idx
++;

275 i‡(
bt_±r
->
‹õ¡©i⁄
 == 4) {

276 i‡((
bt_±r
->
maö_ödex
 =
m
Ë&& (bt_±r->
sub_ödex
 =
s
)) {

277 
d⁄e
 = 
found
 = 
TRUE
;

284 i‡(
found
 =
TRUE
) {

285 
dt1_idx
 = 
bt_±r
->dt1_idx;

286 
block_idx
 = 
bt_±r
->block_idx;

287 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
ZM_11
] + 
block_idx
);

289 i‡(
tmp_bmp
 =
NULL
) {

293 
y1
 = 
sub
->
h
 - 160 - 
bt_±r
->
zîo_löe
;

294 
y1
 += 80;

295 
	`døw_•rôe
(
sub
, 
tmp_bmp
, 0, 
y1
);

299 
	`de°roy_bôm≠
(
sub
);

300 
	}
}

304 
	$wedô_døw_r
(
ds1_idx
, 
x
, 
y
)

306 
WIN_ELEMENT_S
 * 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_¥evõw
;

307 
BITMAP
 * 
sub
;

308 
BLOCK_TABLE_S
 * 
bt_±r
;

309 
BITMAP
 * 
tmp_bmp
;

310 
CELL_W_S
 * 
r_±r
;

311 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
y1
;

312 
ORDER_DATA_S
 
‹dî_d©a
[4];

314 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

315 
r_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

316 
sub
 = 
	`¸óã_sub_bôm≠
(
glb_ds1edô
.
s¸ìn_buff
, 
w_ñm
->
i_x0
, w_ñm->
i_y0
, w_ñm->
öside
->
w
, w_ñm->öside->
h
);

318 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++) {

319 
‹dî_d©a
[
n
].
idx
 =Ç;

320 
‹dî_d©a
[
n
].
height
 = 
r_±r
[n].
¥›1
;

322 
	`qs‹t
(
‹dî_d©a
, 
glb_ds1
[
ds1_idx
].
wÆl_num
, (
ORDER_DATA_S
), 
qs‹t_hñ≥r_‹dî_d©a
);

324 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++) {

325 i‡(
r_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4
 & 0x80) {

330 
bt_idx
 = 
r_±r
[
‹dî_d©a
[
n
].
idx
].bt_idx;

331 i‡(
bt_idx
 <= 0) {

335 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

336 i‡(
bt_±r
->
ty≥
 !
BT_ROOF
) {

340 
dt1_idx
 = 
bt_±r
->dt1_idx;

341 
block_idx
 = 
bt_±r
->block_idx;

342 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
ZM_11
] + 
block_idx
);

344 i‡(
tmp_bmp
 =
NULL
) {

348 
y1
 = 
sub
->
h
 - 160 - 
bt_±r
->
zîo_löe
;

349 
y1
 -
bt_±r
->
roof_y
;

350 
	`døw_•rôe
(
sub
, 
tmp_bmp
, 0, 
y1
);

352 
	`de°roy_bôm≠
(
sub
);

353 
	}
}

358 
	$wedô_døw_•
(
ds1_idx
, 
x
, 
y
)

360 
WIN_ELEMENT_S
 * 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_¥evõw
;

361 
BITMAP
 * 
sub
;

362 
BLOCK_TABLE_S
 * 
bt_±r
;

363 
BITMAP
 * 
tmp_bmp
;

364 
CELL_W_S
 * 
w_±r
;

365 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
y1
, 
o
;

366 
ORDER_DATA_S
 
‹dî_d©a
[4];

367 
ux1
, 
ux2
, 
ux3
, 
ux4
, 
uy1
, 
uy2
, 
uy3
;

370 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

371 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

372 
sub
 = 
	`¸óã_sub_bôm≠
(
glb_ds1edô
.
s¸ìn_buff
, 
w_ñm
->
i_x0
, w_ñm->
i_y0
, w_ñm->
öside
->
w
, w_ñm->öside->
h
);

374 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++) {

375 
‹dî_d©a
[
n
].
idx
 =Ç;

376 
‹dî_d©a
[
n
].
height
 = 
w_±r
[n].
¥›1
;

377 i‡(
w_±r
[
n
].
‹õ¡©i⁄
 == 10) {

378 
‹dî_d©a
[
n
].
height
 = 255;

381 
	`qs‹t
(
‹dî_d©a
, 
glb_ds1
[
ds1_idx
].
wÆl_num
, (
ORDER_DATA_S
), 
qs‹t_hñ≥r_‹dî_d©a
);

383 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++) {

384 
bt_idx
 = 
w_±r
[
‹dî_d©a
[
n
].
idx
].bt_idx;

386 i‡(
bt_idx
 == 0) {

391 
o
 = 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
;

393 i‡((
o
 != 10) && (o != 11)) {

399 i‡(
bt_idx
 <= 0) {

401 
ux1
 = 0;

402 
ux2
 = 
ux1
 + 79;

403 
ux3
 = 
ux1
 + 80;

404 
ux4
 = 
ux1
 + 159;

406 
uy1
 = 
sub
->
h
 - 160;

407 
uy2
 = 
uy1
 + 39;

408 
uy3
 = 
uy1
 + 78;

410 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy1
, 168);

411 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy1
, 
ux4
, 
uy2
, 168);

412 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy3
, 
ux4
, 
uy2
, 168);

413 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy3
, 168);

415 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+8, 
uy2
-2, 0, "(%uË%u %u %u %u", 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
, w_±r[‹dî_d©a[n].idx].
¥›1
, w_±r[‹dî_d©a[n].idx].
¥›2
, w_±r[‹dî_d©a[n].idx].
¥›3
, w_±r[‹dî_d©a[n].idx].
¥›4
);

416 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+7, 
uy2
-3, 255, "(%uË%u %u %u %u", 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
, w_±r[‹dî_d©a[n].idx].
¥›1
, w_±r[‹dî_d©a[n].idx].
¥›2
, w_±r[‹dî_d©a[n].idx].
¥›3
, w_±r[‹dî_d©a[n].idx].
¥›4
);

422 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

423 i‡(
bt_±r
->
ty≥
 !
BT_SPECIAL
) {

427 
dt1_idx
 = 
bt_±r
->dt1_idx;

428 
block_idx
 = 
bt_±r
->block_idx;

430 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
ZM_11
] + 
block_idx
);

432 i‡(
tmp_bmp
 =
NULL
) {

436 
y1
 = 
sub
->
h
 - 160 - 
bt_±r
->
zîo_löe
;

437 
y1
 += 80;

438 
	`døw_•rôe
(
sub
, 
tmp_bmp
, 0, 
y1
);

440 
	`de°roy_bôm≠
(
sub
);

441 
	}
}

446 
	$wedô_make_2nd_buâ⁄s
()

448 
BUTTON_S
 * 
b
;

449 
BITMAP
 * 
tmp
;

450 
i
;

452 
i
 = 
BU_NULL
+1; i<
BU_MAX
; i++) {

453 
b
 = & 
glb_ds1edô
.
wö_edô
.
buâ⁄
[
i
];

454 
tmp
 = 
	`¸óã_bôm≠
(
b
->
w
, b->
h
);

455 i‡(
tmp
 =
NULL
){

456 
	`FATAL_EXIT
("notÉnough mem for 1 button");

458 
b
->
bmp
[1] = 
tmp
;

459 
	`˛ór_to_cﬁ‹
(
tmp
, 172);

461 
	`blô
(
b
->
bmp
[0], 
tmp
, 0, 0, 2, 2, b->
w
, b->
h
);

463 
	}
}

468 
	$wedô_ªad_pcx
()

470 
WIN_ELEMENT_S
 * 
w_ñm
;

471 
BITMAP
 * 
tmp_bmp
;

472 
BITMAP
 * 
pcx
[9];

473 
BUTTON_S
 * 
b
;

476 
fûe
[30];

477 
BUT_TYP_E
 
b_num
;

478 
BLK_TYP_E
 
t_num
;

479 
x0
;

480 
y0
;

481 } 
d©a
[] = {

482 {"but_ok", 
BU_OK
, 
BT_NULL
, 8, 8},

483 {"but_ˇn˚l", 
BU_CANCEL
, 
BT_NULL
, 83, 8},

484 {"but_Êo‹1", 
BU_FLOOR1
, 
BT_NULL
, 186, 38},

485 {"but_Êo‹2", 
BU_FLOOR2
, 
BT_NULL
, 257, 38},

486 {"but_shadow", 
BU_SHADOW
, 
BT_NULL
, 470, 38},

487 {"but_wÆl1", 
BU_WALL1
, 
BT_NULL
, 186, 8},

488 {"but_wÆl2", 
BU_WALL2
, 
BT_NULL
, 257, 8},

489 {"but_wÆl3", 
BU_WALL3
, 
BT_NULL
, 328, 8},

490 {"but_wÆl4", 
BU_WALL4
, 
BT_NULL
, 399, 8},

491 {"võw_ønd", 
BU_VIEW_RAND
, 
BT_NULL
, 470, 8},

492 {"èb_°©ic", 
BU_NULL
, 
BT_STATIC
, -1, -1},

493 {"èb_™im", 
BU_NULL
, 
BT_ANIMATED
, -1, -1},

494 {"èb_uµî", 
BU_NULL
, 
BT_WALL_UP
, -1, -1},

495 {"èb_lowî", 
BU_NULL
, 
BT_WALL_DOWN
, -1, -1},

496 {"èb_roofs", 
BU_NULL
, 
BT_ROOF
, -1, -1},

497 {"èb_•ecül", 
BU_NULL
, 
BT_SPECIAL
, -1, -1},

498 {"èb_shadow", 
BU_NULL
, 
BT_SHADOW
, -1, -1},

499 {"", 
BU_NULL
, 
BT_NULL
, -1, -1}

501 
fûíame
[80];

502 
pcx_«me
[9][20] = {

513 
i
=0, 
n1
, 
n2
, 
x0
, 
y0
, 
w
, 
h
, 
my_b‹dî
, 
x
, 
y
;

515 
	`DEBUG_MESSAGE
("wedit_read_pcx():in\n");

516 
	`°æí
(
d©a
[
i
].
fûe
) != 0) {

517 
n1
 = 
d©a
[
i
].
b_num
;

518 
n2
 = 
d©a
[
i
].
t_num
;

519 i‡(
n1
 !
BU_NULL
) {

521 
b
 = & 
glb_ds1edô
.
wö_edô
.
buâ⁄
[
n1
];

522 
	`•rötf
(
fûíame
, "./ªs/pcx/%s.pcx", 
d©a
[
i
].
fûe
);

523 
b
->
bmp
[0] = 
	`lﬂd_pcx
(
fûíame
, 
glb_ds1edô
.
dummy_∑l
);

524 
b
->
w
 = b->
bmp
[0]->w;

525 
b
->
h
 = b->
bmp
[0]->h;

526 
b
->
x0
 = 
d©a
[
i
].x0;

527 
b
->
y0
 = 
d©a
[
i
].y0;

529 i‡(
n2
 !
BT_NULL
) {

531 
b
 = & 
glb_ds1edô
.
wö_edô
.
èb
[
n2
];

532 
	`•rötf
(
fûíame
, "./ªs/pcx/%s_off.pcx", 
d©a
[
i
].
fûe
);

533 
b
->
bmp
[0] = 
	`lﬂd_pcx
(
fûíame
, 
glb_ds1edô
.
dummy_∑l
);

534 
b
->
w
 = b->
bmp
[0]->w;

535 
b
->
h
 = b->
bmp
[0]->h;

538 
	`•rötf
(
fûíame
, "./ªs/pcx/%s.pcx", 
d©a
[
i
].
fûe
);

539 
b
->
bmp
[1] = 
	`lﬂd_pcx
(
fûíame
, 
glb_ds1edô
.
dummy_∑l
);

541 
i
++;

545 
i
=0; i<9; i++) {

546 
	`•rötf
(
fûíame
, "./ªs/pcx/¥evõw/%s.pcx", 
pcx_«me
[
i
]);

547 
pcx
[
i
] = 
	`lﬂd_pcx
(
fûíame
, 
glb_ds1edô
.
dummy_∑l
);

549 
my_b‹dî
 = 8;

550 
x0
 = 
my_b‹dî
;

551 
y0
 = 38;

552 
w
 = 160 + 
pcx
[0]->w +Öcx[2]->w;

553 
h
 = 
glb_c⁄fig
.
s¸ìn
.
height
 - 
y0
 - 
my_b‹dî
;

555 
tmp_bmp
 = 
	`¸óã_bôm≠
(
w
, 
h
);

557 
	`˛ór
(
tmp_bmp
);

559 
x
=0; x<
w
; x +
pcx
[1]->w) {

560 
	`blô
(
pcx
[1], 
tmp_bmp
, 0, 0, 
x
, 0,Öcx[1]->
w
,Öcx[1]->
h
);

563 
x
=0; x<
w
; x +
pcx
[7]->w) {

564 
	`blô
(
pcx
[7], 
tmp_bmp
, 0, 0, 
x
, 
h
 -Öcx[7]->h,Öcx[7]->
w
,Öcx[7]->h);

567 
y
=0; y<
h
; y +
pcx
[3]->h) {

568 
	`blô
(
pcx
[3], 
tmp_bmp
, 0, 0, 0, 
y
,Öcx[3]->
w
,Öcx[3]->
h
);

571 
y
=0; y<
h
; y +
pcx
[5]->h) {

572 
	`blô
(
pcx
[5], 
tmp_bmp
, 0, 0, 
w
-pcx[5]->w, 
y
,Öcx[5]->w,Öcx[5]->
h
);

575 
	`blô
(
pcx
[0], 
tmp_bmp
, 0, 0, 0, 0,Öcx[0]->
w
,Öcx[0]->
h
);

576 
	`blô
(
pcx
[2], 
tmp_bmp
, 0, 0, 
w
-pcx[2]->w, 0,Öcx[2]->w,Öcx[2]->
h
);

577 
	`blô
(
pcx
[6], 
tmp_bmp
, 0, 0, 0, 
h
-pcx[6]->h,Öcx[6]->
w
,Öcx[6]->h);

578 
	`blô
(
pcx
[8], 
tmp_bmp
, 0, 0, 
w
-pcx[8]->w, 
h
-pcx[8]->h,Öcx[8]->w,Öcx[8]->h);

580 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_¥evõw
;

581 
w_ñm
->
b‹dî
 = 
	`gë_æe_•rôe
(
tmp_bmp
);

582 
w_ñm
->
b_x0
 = 
x0
;

583 
w_ñm
->
b_y0
 = 
y0
;

585 
y
=0; y<
h
; y +
pcx
[4]->h) {

586 
x
=0; x<
w
; x +
pcx
[4]->w) {

587 
	`blô
(
pcx
[4], 
tmp_bmp
, 0, 0, 
x
, 
y
,Öcx[4]->
w
,Öcx[4]->
h
);

590 
w_ñm
->
öside
 = 
	`¸óã_bôm≠
(
w
 - 
pcx
[3]->w * 2, 
h
 -Öcx[1]->h * 2);

591 
	`blô
(
tmp_bmp
, 
w_ñm
->
öside
, 
pcx
[3]->
w
,Öcx[1]->
h
, 0, 0, w -Öcx[3]->w * 2, h -Öcx[1]->h * 2);

592 
w_ñm
->
i_x0
 = w_ñm->
b_x0
 + 
pcx
[3]->
w
;

593 
w_ñm
->
i_y0
 = w_ñm->
b_y0
 + 
pcx
[1]->
h
;

595 
i
=0; i<9; i++) {

596 
	`de°roy_bôm≠
(
pcx
[
i
]);

598 
	`de°roy_bôm≠
(
tmp_bmp
);

602 
i
=0; i<9; i++) {

603 
	`•rötf
(
fûíame
, "./ªs/pcx/tûes/%s.pcx", 
pcx_«me
[
i
]);

604 
pcx
[
i
] = 
	`lﬂd_pcx
(
fûíame
, 
glb_ds1edô
.
dummy_∑l
);

606 
x0
 = 
w_ñm
->
b_x0
 + w_ñm->
b‹dî
->
w
 + 
my_b‹dî
;

607 
y0
 = 119;

608 
w
 = 
glb_c⁄fig
.
s¸ìn
.
width
 - 
x0
 - 
my_b‹dî
;

609 
h
 = 
glb_c⁄fig
.
s¸ìn
.
height
 - 
y0
 - 
my_b‹dî
;

610 
tmp_bmp
 = 
	`¸óã_bôm≠
(
w
, 
h
);

611 
	`˛ór
(
tmp_bmp
);

613 
x
=0; x<
w
; x +
pcx
[1]->w) {

614 
	`blô
(
pcx
[1], 
tmp_bmp
, 0, 0, 
x
, 0,Öcx[1]->
w
,Öcx[1]->
h
);

617 
x
=0; x<
w
; x +
pcx
[7]->w) {

618 
	`blô
(
pcx
[7], 
tmp_bmp
, 0, 0, 
x
, 
h
 -Öcx[7]->h,Öcx[7]->
w
,Öcx[7]->h);

621 
y
=0; y<
h
; y +
pcx
[3]->h) {

622 
	`blô
(
pcx
[3], 
tmp_bmp
, 0, 0, 0, 
y
,Öcx[3]->
w
,Öcx[3]->
h
);

625 
y
=0; y<
h
; y +
pcx
[5]->h) {

626 
	`blô
(
pcx
[5], 
tmp_bmp
, 0, 0, 
w
-pcx[5]->w, 
y
,Öcx[5]->w,Öcx[5]->
h
);

629 
	`blô
(
pcx
[0], 
tmp_bmp
, 0, 0, 0, 0,Öcx[0]->
w
,Öcx[0]->
h
);

630 
	`blô
(
pcx
[2], 
tmp_bmp
, 0, 0, 
w
-pcx[2]->w, 0,Öcx[2]->w,Öcx[2]->
h
);

631 
	`blô
(
pcx
[6], 
tmp_bmp
, 0, 0, 0, 
h
-pcx[6]->h,Öcx[6]->
w
,Öcx[6]->h);

632 
	`blô
(
pcx
[8], 
tmp_bmp
, 0, 0, 
w
-pcx[8]->w, 
h
-pcx[8]->h,Öcx[8]->w,Öcx[8]->h);

634 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_tûes
;

635 
w_ñm
->
b‹dî
 = 
	`gë_æe_•rôe
(
tmp_bmp
);

636 
w_ñm
->
b_x0
 = 
x0
;

637 
w_ñm
->
b_y0
 = 
y0
;

639 
y
=0; y<
h
; y +
pcx
[4]->h) {

640 
x
=0; x<
w
; x +
pcx
[4]->w) {

641 
	`blô
(
pcx
[4], 
tmp_bmp
, 0, 0, 
x
, 
y
,Öcx[4]->
w
,Öcx[4]->
h
);

645 
w_ñm
->
öside
 = 
	`¸óã_bôm≠
(
w
 - 
pcx
[3]->w * 2, 
h
 -Öcx[1]->h * 2);

646 
	`blô
(
tmp_bmp
, 
w_ñm
->
öside
, 
pcx
[3]->
w
,Öcx[1]->
h
, 0, 0, w -Öcx[3]->w * 2, h -Öcx[1]->h * 2);

647 
w_ñm
->
i_x0
 = w_ñm->
b_x0
 + 
pcx
[3]->
w
;

648 
w_ñm
->
i_y0
 = w_ñm->
b_y0
 + 
pcx
[1]->
h
;

650 
i
=0; i<9; i++){

651 
	`de°roy_bôm≠
(
pcx
[
i
]);

653 
	`de°roy_bôm≠
(
tmp_bmp
);

655 
	`DEBUG_MESSAGE
("wedit_read_pcx():out\n");

656 
	}
}

661 
	$wedô_‰ì
()

663 
WIN_ELEMENT_S
 * 
w_ñm
;

664 
BUTTON_S
 * 
b
, * 
t
;

665 
i
, 
n
;

668 
i
 = 
BU_NULL
+1; i<
BU_MAX
; i++)

670 
b
 = & 
glb_ds1edô
.
wö_edô
.
buâ⁄
[
i
];

671 
n
=0;Ç<2;Ç++)

673 i‡(
b
->
bmp
[
n
] !
NULL
)

675 
	`de°roy_bôm≠
(
b
->
bmp
[
n
]);

676 
b
->
bmp
[
n
] = 
NULL
;

682 
i
 = 
BT_NULL
+1; i<
BT_MAX
; i++)

684 
t
 = & 
glb_ds1edô
.
wö_edô
.
èb
[
i
];

685 
n
=0;Ç<2;Ç++)

687 i‡(
t
->
bmp
[
n
] !
NULL
)

689 
	`de°roy_bôm≠
(
t
->
bmp
[
n
]);

690 
t
->
bmp
[
n
] = 
NULL
;

696 
i
=0; i<2; i++)

699 i‡(
i
 == 0)

700 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_¥evõw
;

701 i‡(
i
 == 1)

702 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_tûes
;

704 
w_ñm
 = 
NULL
;

707 i‡(
w_ñm
->
b‹dî
 !
NULL
)

709 
	`de°roy_æe_•rôe
(
w_ñm
->
b‹dî
);

710 
w_ñm
->
b‹dî
 = 
NULL
;

712 i‡(
w_ñm
->
öside
 !
NULL
)

714 
	`de°roy_bôm≠
(
w_ñm
->
öside
);

715 
w_ñm
->
öside
 = 
NULL
;

718 
	}
}

723 
	$wedô_døw_buâ⁄
(
BUT_TYP_E
 
b_num
)

725 
BUTTON_S
 * 
b
 = & 
glb_ds1edô
.
wö_edô
.
buâ⁄
[
b_num
];

726 
x1
, 
y1
, 
x2
, 
y2
;

728 i‡–! 
b
->
a˘ive
) {

731 
x1
 = 
b
->
x0
;

732 
x2
 = 
x1
 + 
b
->
w
 - 1;

733 
y1
 = 
b
->
y0
;

734 
y2
 = 
y1
 + 
b
->
h
 - 1;

735 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 0);

737 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
b
->
bmp
[b->
°©e
], b->
x0
, b->
y0
);

738 
	}
}

743 
	$wedô_døw_èb
(
BLK_TYP_E
 
t_num
)

745 
BUTTON_S
 * 
t
 = & 
glb_ds1edô
.
wö_edô
.
èb
[
t_num
];

746 
x1
, 
y1
, 
x2
, 
y2
;

748 i‡–! 
t
->
a˘ive
)

750 
x1
 = 
t
->
x0
;

751 
x2
 = 
x1
 + 
t
->
w
 - 1;

752 
y1
 = 
t
->
y0
;

753 
y2
 = 
y1
 + 
t
->
h
 - 1;

754 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 0);

755 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
t
->
bmp
[t->
°©e
],Å->
x0
,Å->
y0
);

756 
	}
}

761 
	$wedô_èb_have
(
ds1_idx
, 
BLK_TYP_E
 
t
)

764 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

765 
i
;

767 
i
=0; i<
glb_ds1
[
ds1_idx
].
bt_num
; i++) {

768 i‡(
bt_±r
->
ty≥
 =
t
) {

769  
TRUE
;

771 
bt_±r
++;

774  
FALSE
;

775 
	}
}

780 
	$wedô_tûes_‰ì
()

782 
WIN_EDIT_S
 * 
w
 = & 
glb_ds1edô
.
wö_edô
;

783 
MAIN_LINE_S
 * 
m_±r
;

784 
t
, 
m
;

786 
t
=
BT_NULL
+1;Å<
BT_MAX
;Å++)

788 i‡(
w
->
maö_löe_èb
[
t
] !
NULL
)

790 
m
=0; m < 
w
->
maö_löe_num
[
t
]; m++)

792 
m_±r
 = 
w
->
maö_löe_èb
[
t
] + 
m
;

793 i‡(
m_±r
->
sub_ñm
 !
NULL
)

795 
	`‰ì
(
m_±r
->
sub_ñm
);

796 
m_±r
->
sub_ñm
 = 
NULL
;

799 
	`‰ì
(
w
->
maö_löe_èb
[
t
]);

800 
w
->
maö_löe_èb
[
t
] = 
NULL
;

803 
	}
}

808 
	$wedô_tûes_make
(
ds1_idx
)

810 
BITMAP
 * 
tmp_bmp
;

811 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

812 
WIN_EDIT_S
 * 
w
 = & 
glb_ds1edô
.
wö_edô
;

813 
MAIN_LINE_S
 * 
m_±r
;

814 
SUB_ELM_S
 * 
s_±r
;

816 
numb
, 
size
, 
i
, 
b
, 
löe
, 
t
, 
n
, 
d⁄e
, 
cﬁ
, 
y
, 
max_height
, 
x
;

817 
ﬁd_o
, 
ﬁd_m
, 
ﬁd_s
, 
o
, 
m
, 
s
, 
dx
, 
bx
, 
y0
;

818 
ube
;

819 * 
is_kìp
, 
tmp
[150];

821 
numb
 = 
glb_ds1
[
ds1_idx
].
bt_num
;

822 
size
 = 
numb
 * ();

823 
is_kìp
 = (*Ë
	`mÆloc
(
size
);

824 i‡(
is_kìp
 =
NULL
) {

825 
	`FATAL_EXIT
("(is_kìpË:ÇŸÉnough mem (%òbyãs)", 
size
);

829 
t
 = 
BT_NULL
 + 1;Å < 
BT_MAX
;Å++) {

830 
i
=0; i<
numb
; i++) {

831 *(
is_kìp
 + 
i
Ë
FALSE
;

834 
löe
 = 0;

835 
ﬁd_o
 = 
ﬁd_m
 = -1;

836 
b
=1; b < 
numb
; b++) {

837 i‡(
bt_±r
[
b
].
ty≥
 =
t
) {

838 
o
 = 
bt_±r
[
b
].
‹õ¡©i⁄
;

839 
m
 = 
bt_±r
[
b
].
maö_ödex
;

840 
dx
 = 
bt_±r
[
b
].
dt1_idx
;

841 
bx
 = 
bt_±r
[
b
].
block_idx
;

842 
ube
 = 
bt_±r
[
b
].
u£d_by_edô‹
;

843 
tmp_bmp
 = * (
glb_dt1
[
dx
].
block_zoom
[
ZM_11
] + 
bx
);

844 i‡((
tmp_bmp
 !
NULL
Ë&& 
ube
) {

845 i‡–(
ﬁd_o
 !
o
Ë|| (
ﬁd_m
 !
m
) ) {

846 * (
is_kìp
 + 
b
Ë
TRUE
;

847 
löe
++;

848 
ﬁd_o
 = 
o
;

849 
ﬁd_m
 = 
m
;

855 
w
->
maö_löe_èb
[
t
] = 
NULL
;

857 i‡(
löe
 == 0) {

862 
size
 = 
löe
 * (
MAIN_LINE_S
);

863 
w
->
maö_löe_èb
[
t
] = (
MAIN_LINE_S
 *Ë
	`mÆloc
(
size
);

864 i‡(
w
->
maö_löe_èb
[
t
] =
NULL
) {

865 
	`FATAL_EXIT
("(maö_löe_èbË:ÇŸÉnough mem (%òbyãs),Åy≥ %i,Üöê%i", 
size
, 
t
, 
löe
);

867 
i
=0; i<
löe
; i++) {

868 
w
->
maö_löe_èb
[
t
][
i
].
sub_ñm
 = 
NULL
;

869 
w
->
maö_löe_èb
[
t
][
i
].
bt_idx_num
 = 0;

870 
w
->
maö_löe_èb
[
t
][
i
].
max_height
 = 0;

872 
w
->
maö_löe_num
[
t
] = 
löe
;

874 
b
=1;

875 
y0
=0;

878 
n
=0;Ç<
löe
;Ç++) {

879  * (
is_kìp
 + 
b
Ë!
TRUE
) {

880 
b
++;

882 
ﬁd_o
 = 
bt_±r
[
b
].
‹õ¡©i⁄
;

883 
ﬁd_m
 = 
bt_±r
[
b
].
maö_ödex
;

884 
ﬁd_s
 = 
bt_±r
[
b
].
sub_ödex
;

885 
cﬁ
 = 1;

886 
y
 = 
b
;

887 
d⁄e
 = 
FALSE
;

891 
y
++;

892 
o
 = 
bt_±r
[
y
].
‹õ¡©i⁄
;

893 
m
 = 
bt_±r
[
y
].
maö_ödex
;

894 
s
 = 
bt_±r
[
y
].
sub_ödex
;

895 i‡((
ﬁd_o
 =
o
Ë&& (
ﬁd_m
 =
m
)) {

897 
dx
 = 
bt_±r
[
y
].
dt1_idx
;

898 
bx
 = 
bt_±r
[
y
].
block_idx
;

899 
ube
 = 
bt_±r
[
y
].
u£d_by_edô‹
;

900 
tmp_bmp
 = * (
glb_dt1
[
dx
].
block_zoom
[
ZM_11
] + 
bx
);

901 i‡((
tmp_bmp
 !
NULL
Ë&& 
ube
) {

902 i‡(
ﬁd_s
 !
s
) {

903 
cﬁ
++;

904 
ﬁd_s
 = 
s
;

910 
d⁄e
 = 
TRUE
;

912 }  ! 
d⁄e
);

917 
m_±r
 = 
w
->
maö_löe_èb
[
t
] + 
n
;

918 
size
 = 
cﬁ
 * (
SUB_ELM_S
);

919 
m_±r
->
sub_ñm
 = (
SUB_ELM_S
 *Ë
	`mÆloc
(
size
);

920 i‡(
m_±r
->
sub_ñm
 =
NULL
) {

921 
	`FATAL_EXIT
("(sub_löeË:ÇŸÉnough mem (%òbyãs),Åy≥ %i,Üöê%i, cﬁ %i", 
size
, 
t
, 
n
, 
cﬁ
);

923 
i
=0; i<
cﬁ
; i++) {

924 
m_±r
->
sub_ñm
[
i
].
bt_idx_èb
 = 0;

925 
m_±r
->
sub_ñm
[
i
].
x1
 = 0;

926 
m_±r
->
sub_ñm
[
i
].
y1
 = 0;

927 
m_±r
->
sub_ñm
[
i
].
x2
 = 0;

928 
m_±r
->
sub_ñm
[
i
].
y2
 = 0;

929 
m_±r
->
sub_ñm
[
i
].
is_døw
 = 
FALSE
;

931 
m_±r
->
bt_idx_num
 = 
cﬁ
;

933 
max_height
 = 0;

936 
ﬁd_o
 = 
bt_±r
[
b
].
‹õ¡©i⁄
;

937 
ﬁd_m
 = 
bt_±r
[
b
].
maö_ödex
;

938 
ﬁd_s
 = -1;

939 
y
 = 
b
 - 1;

940 
x
 = 0;

941 
d⁄e
 = 
FALSE
;

945 
y
++;

946 
o
 = 
bt_±r
[
y
].
‹õ¡©i⁄
;

947 
m
 = 
bt_±r
[
y
].
maö_ödex
;

948 
s
 = 
bt_±r
[
y
].
sub_ödex
;

949 i‡((
ﬁd_o
 =
o
Ë&& (
ﬁd_m
 =
m
)) {

951 
dx
 = 
bt_±r
[
y
].
dt1_idx
;

952 
bx
 = 
bt_±r
[
y
].
block_idx
;

953 
ube
 = 
bt_±r
[
y
].
u£d_by_edô‹
;

954 
tmp_bmp
 = * (
glb_dt1
[
dx
].
block_zoom
[
ZM_11
] + 
bx
);

955 i‡((
tmp_bmp
 !
NULL
Ë&& 
ube
) {

956 i‡(
ﬁd_s
 !
s
) {

958 
s_±r
 = 
m_±r
->
sub_ñm
 + 
x
;

959 
s_±r
->
bt_idx_èb
 = 
y
;

960 
x
++;

961 
ﬁd_s
 = 
s
;

964 i‡(
tmp_bmp
->
h
 > 
max_height
) {

965 
max_height
 = 
tmp_bmp
->
h
;

972 
d⁄e
 = 
TRUE
;

974 }  ! 
d⁄e
);

977 
ﬁd_o
 = 
bt_±r
[
b
].
‹õ¡©i⁄
;

978 
ﬁd_m
 = 
bt_±r
[
b
].
maö_ödex
;

979 
ﬁd_s
 = -1;

980 
y
 = 
b
 - 1;

981 
x
 = 0;

982 
d⁄e
 = 
FALSE
;

986 
y
++;

987 
o
 = 
bt_±r
[
y
].
‹õ¡©i⁄
;

988 
m
 = 
bt_±r
[
y
].
maö_ödex
;

989 
s
 = 
bt_±r
[
y
].
sub_ödex
;

990 i‡((
ﬁd_o
 =
o
Ë&& (
ﬁd_m
 =
m
)) {

992 
dx
 = 
bt_±r
[
y
].
dt1_idx
;

993 
bx
 = 
bt_±r
[
y
].
block_idx
;

994 
ube
 = 
bt_±r
[
y
].
u£d_by_edô‹
;

995 
tmp_bmp
 = * (
glb_dt1
[
dx
].
block_zoom
[
ZM_11
] + 
bx
);

996 i‡((
tmp_bmp
 !
NULL
Ë&& 
ube
) {

997 i‡(
ﬁd_s
 !
s
) {

999 
s_±r
 = 
m_±r
->
sub_ñm
 + 
x
;

1000 
s_±r
->
x1
 = 161 * 
x
;

1001 
s_±r
->
x2
 = s_±r->
x1
 + 159;

1002 
s_±r
->
y1
 = 
y0
;

1003 
s_±r
->
y2
 = s_±r->
y1
 + 
max_height
 + 12;

1004 
x
++;

1005 
ﬁd_s
 = 
s
;

1011 
d⁄e
 = 
TRUE
;

1013 }  ! 
d⁄e
);

1016 
m_±r
->
max_height
 = max_height;

1017 
y0
 +
max_height
 + 12;

1020 
b
++;

1023 
	`‰ì
(
is_kìp
);

1024 
	}
}

1029 
	$wedô_£¨ch_tûe
(
ds1_idx
, 
x
, 
y
, 
BUT_TYP_E
 
but
)

1031 
CELL_F_S
 * 
f_±r
;

1032 
CELL_S_S
 * 
s_±r
;

1033 
CELL_W_S
 * 
w_±r
;

1035 
t
;

1036 
n
;

1038 i‡((
but
 =
BU_FLOOR1
Ë|| (buà=
BU_FLOOR2
)) {

1040 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1041 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
;

1043 i‡((
but
 =
BU_FLOOR1
Ë&& (
glb_ds1
[
ds1_idx
].
Êo‹_num
 >= 1)) {

1044 
n
 = 0;

1045 } i‡((
but
 =
BU_FLOOR2
Ë&& (
glb_ds1
[
ds1_idx
].
Êo‹_num
 >= 2)) {

1046 
n
 = 1;

1051  
f_±r
[
n
].
bt_idx
;

1053 } i‡(
but
 =
BU_SHADOW
) {

1055 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1056 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
;

1059 i‡((
but
 =
BU_SHADOW
Ë&& (
glb_ds1
[
ds1_idx
].
shadow_num
 >= 1)) {

1060 
n
 = 0;

1065  
s_±r
[
n
].
bt_idx
;

1066 } i‡((
but
 =
BU_WALL1
Ë|| (buà=
BU_WALL2
Ë|| (buà=
BU_WALL3
Ë|| (buà=
BU_WALL4
)) {

1068 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1069 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

1072 i‡((
but
 =
BU_WALL1
Ë&& (
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 1)) {

1073 
n
 = 0;

1074 } i‡((
but
 =
BU_WALL2
Ë&& (
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 2)) {

1075 
n
 = 1;

1076 } i‡((
but
 =
BU_WALL3
Ë&& (
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 3)) {

1077 
n
 = 2;

1078 } i‡((
but
 =
BU_WALL4
Ë&& (
glb_ds1
[
ds1_idx
].
wÆl_num
 >= 4)) {

1079 
n
 = 3;

1086  
w_±r
[
n
].
bt_idx
;

1089 
	}
}

1146 
	$wedô_èb_tûes
(
ds1_idx
, 
BLK_TYP_E
 
t
, 
x0
, 
y0
, 
bt_£l
, 
m_idx
, 
s_idx
)

1148 
WIN_EDIT_S
 * 
w
 = & 
glb_ds1edô
.
wö_edô
;

1149 
WIN_ELEMENT_S
 * 
wt
 = & 
w
->
w_tûes
;

1150 
MAIN_LINE_S
 * 
m_±r
;

1151 
SUB_ELM_S
 * 
s_±r
;

1152 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

1153 
BITMAP
 * 
tmp_bmp
;

1154 
m
, 
i
, 
bt
, 
dx
, 
bx
, 
x1
, 
y1
, 
x2
, 
y2
, 
c
, 
Àn
, 
dt1_idx
;

1155 * 
dt1«me
;

1161 
	`blô
(
wt
->
öside
, 
w
->
tmp_edô
, 0, 0, 0, 0, wt->öside->w, wt->öside->
h
);

1164 
	`ãxt_mode
(-1);

1165 
m
=0; m < 
w
->
maö_löe_num
[
t
]; m++) {

1166 
m_±r
 = 
w
->
maö_löe_èb
[
t
] + 
m
;

1169 
s_±r
 = 
m_±r
->
sub_ñm
;

1170 
x1
 = 
s_±r
->x1 - 
x0
;

1171 
y1
 = 
s_±r
->y1 - 
y0
 + (
m_±r
->
max_height
 / 2);

1172 i‡((
y1
 >-8Ë&& (y1 < 
w
->
tmp_edô
->
h
Ë&& (
x1
 > 0)) {

1173 
dt1_idx
 = 
bt_±r
[
s_±r
->
bt_idx_èb
].dt1_idx;

1174 i‡(
dt1_idx
 != -1) {

1175 
dt1«me
 = 
glb_dt1
[
dt1_idx
].
«me
;

1176 
Àn
 = 
	`°æí
(
dt1«me
) + 2;

1177 
x1
 -8 * 
Àn
;

1178 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
+1, 
y1
+1, 0, "%s", 
dt1«me
);

1179 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
, 
y1
, 255, "%s", 
dt1«me
);

1184 
i
=0; i < 
m_±r
->
bt_idx_num
; i++) {

1185 
s_±r
 = 
m_±r
->
sub_ñm
 + 
i
;

1186 
x1
 = 
s_±r
->x1 - 
x0
;

1187 
x2
 = 
s_±r
->x2 - 
x0
;

1188 i‡((
x1
 > -160Ë&& (x1 < 
w
->
tmp_edô
->w)) {

1189 
bt
 = 
s_±r
->
bt_idx_èb
;

1190 
dx
 = 
bt_±r
[
bt
].
dt1_idx
;

1191 
bx
 = 
bt_±r
[
bt
].
block_idx
;

1192 
tmp_bmp
 = * (
glb_dt1
[
dx
].
block_zoom
[
ZM_11
] + 
bx
);

1193 i‡(
tmp_bmp
 !
NULL
) {

1194 
y1
 = 
s_±r
->y1 - 
y0
;

1195 
y2
 = 
y1
 + 
tmp_bmp
->
h
 - 1;

1196 i‡(((
y1
 + 
m_±r
->
max_height
 - 1Ë< 0Ë|| (y1 >
w
->
tmp_edô
->
h
)) {

1198 
s_±r
->
is_døw
 = 
FALSE
;

1200 
s_±r
->
is_døw
 = 
TRUE
;

1201 
	`ª˘
(
w
->
tmp_edô
, 
x1
-1, 
y1
-1, 
x2
+1, y1+
m_±r
->
max_height
+1+10, 255);

1202 
c
 = 22;

1203 i‡(
bt_£l
 =
bt
) {

1204 
c
 = 119;

1206 i‡((
m
 =
m_idx
Ë&& (
i
 =
s_idx
)) {

1207 
c
 = 255;

1209 i‡(
t
 =
BT_WALL_DOWN
) {

1210 
	`ª˘fûl
(
w
->
tmp_edô
, 
x1
, 
y1
, 
x2
, 
y2
+9, 
c
);

1212 
	`døw_•rôe
(
w
->
tmp_edô
, 
tmp_bmp
, 
x1
, 
y1
);

1214 
	`ª˘fûl
(
w
->
tmp_edô
, 
x1
, 
y1
 + 
m_±r
->
max_height
 - 
tmp_bmp
->
h
, 
x2
, y1 + m_±r->max_heighà+ 10, 
c
);

1217 
	`døw_•rôe
(
w
->
tmp_edô
, 
tmp_bmp
, 
x1
, 
y1
 + 
m_±r
->
max_height
 -Åmp_bmp->
h
);

1220 i‡(
t
 =
BT_WALL_DOWN
) {

1221 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
 + 2, 
y1
 + 2, 96, "%2i", 
bt_±r
[
bt
].
maö_ödex
);

1222 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
 + 26, 
y1
 + 2, 96, "%2i", 
bt_±r
[
bt
].
‹õ¡©i⁄
);

1223 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
 + 82, 
y1
 + 2, 158, "%2i", 
bt_±r
[
bt
].
sub_ödex
);

1224 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
 + 138, 
y1
 + 2, 134, "%2i", 
bt_±r
[
bt
].
ørôy
);

1226 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
 + 2, 
y1
 + 
m_±r
->
max_height
 + 2, 96, "%2i", 
bt_±r
[
bt
].
maö_ödex
);

1227 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
 + 26, 
y1
 + 
m_±r
->
max_height
 + 2, 96, "%2i", 
bt_±r
[
bt
].
‹õ¡©i⁄
);

1228 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
 + 82, 
y1
 + 
m_±r
->
max_height
 + 2, 158, "%2i", 
bt_±r
[
bt
].
sub_ödex
);

1229 
	`ãxçrötf
(
w
->
tmp_edô
, 
f⁄t
, 
x1
 + 138, 
y1
 + 
m_±r
->
max_height
 + 2, 134, "%2i", 
bt_±r
[
bt
].
ørôy
);

1234 
s_±r
->
is_døw
 = 
FALSE
;

1239 
	}
}

1244 
	$wedô_jump
(
ds1_idx
, 
bt_idx
, * 
xn
, * 
yn
)

1246 
WIN_EDIT_S
 * 
w
 = & 
glb_ds1edô
.
wö_edô
;

1247 
WIN_ELEMENT_S
 * 
wt
 = & 
w
->
w_tûes
;

1248 
MAIN_LINE_S
 * 
m_±r
;

1249 
SUB_ELM_S
 * 
s_±r
;

1250 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

1251 
m
, 
s
;

1252 
BLK_TYP_E
 
t
;

1254 * 
xn
 = 0;

1255 * 
yn
 = 0;

1256 i‡(
bt_idx
 <= 0) {

1262 
t
 = 
bt_±r
[
bt_idx
].
ty≥
;

1263 
m
=0; m < 
w
->
maö_löe_num
[
t
]; m++) {

1264 
m_±r
 = 
w
->
maö_löe_èb
[
t
] + 
m
;

1265 
s
=0; s<
m_±r
->
bt_idx_num
; s++) {

1266 
s_±r
 = 
m_±r
->
sub_ñm
 + 
s
;

1267 i‡(
s_±r
->
bt_idx_èb
 =
bt_idx
) {

1268 * 
xn
 = 
s_±r
->
x1
 - 
glb_c⁄fig
.
s¸ﬁl
.
edô
.
x
;

1269 i‡(
t
 =
BT_WALL_DOWN
) {

1270 * 
yn
 = 
s_±r
->
y1
 - 
glb_c⁄fig
.
s¸ﬁl
.
edô
.
y
;

1272 * 
yn
 = 
s_±r
->
y2
 + 
glb_c⁄fig
.
s¸ﬁl
.
edô
.
y
 - 
wt
->
öside
->
h
;

1279 
	}
}

1284 
	$wedô_mou£_tûe
(
mx
, 
my
, 
x0
, 
y0
, 
t
, * 
m_idx
, * 
s_idx
)

1286 
WIN_EDIT_S
 * 
w
 = & 
glb_ds1edô
.
wö_edô
;

1287 
WIN_ELEMENT_S
 * 
wt
 = & 
w
->
w_tûes
;

1288 
MAIN_LINE_S
 * 
m_±r
;

1289 
SUB_ELM_S
 * 
s_±r
;

1290 
m
, 
i
, 
x
, 
y
;

1293 
x
 = 
mx
 - 
wt
->
i_x0
;

1294 
y
 = 
my
 - 
wt
->
i_y0
;

1295 i‡((
x
 >0Ë&& (x < 
wt
->
öside
->
w
Ë&& (
y
 >0Ë&& (y < wt->öside->
h
))

1298 
x
 +
x0
;

1299 
y
 +
y0
;

1300 
m
=0; m < 
w
->
maö_löe_num
[
t
]; m++)

1302 
m_±r
 = 
w
->
maö_löe_èb
[
t
] + 
m
;

1303 
i
=0; i < 
m_±r
->
bt_idx_num
; i++)

1305 
s_±r
 = 
m_±r
->
sub_ñm
 + 
i
;

1306 i‡(
s_±r
->
is_døw
)

1308 i‡((
x
 >
s_±r
->
x1
Ë&& (x <s_±r->
x2
) &&

1309 (
y
 >
s_±r
->
y1
Ë&& (y <s_±r->
y2
))

1311 * 
m_idx
 = 
m
;

1312 * 
s_idx
 = 
i
;

1320 * 
m_idx
 = * 
s_idx
 = -1;

1321 
	}
}

1326 
	$wedô_upd©e_tûe
(
ds1_idx
, 
x
, 
y
, 
BUT_TYP_E
 
buâ⁄
,

1327 
BLK_TYP_E
 
ty≥
, 
m_idx
, 
s_idx
)

1329 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

1330 
WIN_EDIT_S
 * 
e_±r
 = & 
glb_ds1edô
.
wö_edô
;

1331 
MAIN_LINE_S
 * 
m_±r
;

1332 
SUB_ELM_S
 * 
s_±r
;

1333 
CELL_W_S
 * 
w_±r
;

1334 
CELL_F_S
 * 
f_±r
;

1335 
CELL_S_S
 * 
sh_±r
;

1336 
f
 = -1, 
s
 = -1, 
w
 = -1, 
t
, 
bt
;

1338 
buâ⁄
)

1340 
BU_FLOOR1
 : i‡(
glb_ds1
[
ds1_idx
].
Êo‹_num
 >1Ë
f
 = 0; ;

1341 
BU_FLOOR2
 : i‡(
glb_ds1
[
ds1_idx
].
Êo‹_num
 >2Ë
f
 = 1; ;

1342 
BU_SHADOW
 : i‡(
glb_ds1
[
ds1_idx
].
shadow_num
 >1Ë
s
 = 0; ;

1343 
BU_WALL1
 : i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >1Ë
w
 = 0; ;

1344 
BU_WALL2
 : i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >2Ë
w
 = 1; ;

1345 
BU_WALL3
 : i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >3Ë
w
 = 2; ;

1346 
BU_WALL4
 : i‡(
glb_ds1
[
ds1_idx
].
wÆl_num
 >4Ë
w
 = 3; ;

1348 i‡((
f
 =-1Ë&& (
w
 =-1Ë&& (
s
 == -1))

1350 
m_±r
 = 
e_±r
->
maö_löe_èb
[
ty≥
] + 
m_idx
;

1351 
s_±r
 = 
m_±r
->
sub_ñm
 + 
s_idx
;

1352 
bt
 = 
s_±r
->
bt_idx_èb
;

1353 i‡(
f
 != -1)

1355 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1356 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
f
;

1357 i‡(
f_±r
->
¥›1
 == 0)

1358 
f_±r
->
¥›1
 = 194;

1359 
f_±r
->
¥›2
 = 
bt_±r
[
bt
].
sub_ödex
;

1360 
f_±r
->
¥›3
 = (
bt_±r
[
bt
].
maö_ödex
 & 0x0F) << 4;

1361 
f_±r
->
¥›4
 = (
bt_±r
[
bt
].
maö_ödex
 & 0x30) >> 4;

1362 
f_±r
->
bt_idx
 = 
bt
;

1364 i‡(
s
 != -1)

1366 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1367 
sh_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
s
;

1368 i‡(
sh_±r
->
¥›1
 == 0)

1369 
sh_±r
->
¥›1
 = 128;

1370 
sh_±r
->
¥›2
 = 
bt_±r
[
bt
].
sub_ödex
;

1371 
sh_±r
->
¥›3
 = (
bt_±r
[
bt
].
maö_ödex
 & 0x0F) << 4;

1372 
sh_±r
->
¥›4
 = ((
bt_±r
[
bt
].
maö_ödex
 & 0x30) >> 4) | 0x08;

1373 
sh_±r
->
bt_idx
 = 
bt
;

1375 i‡(
w
 != -1)

1377 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1378 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
w
;

1379 
w_±r
->
‹õ¡©i⁄
 = 
bt_±r
[
bt
].orientation;

1380 i‡(
w_±r
->
¥›1
 == 0)

1381 
w_±r
->
¥›1
 = 129;

1382 
w_±r
->
¥›2
 = 
bt_±r
[
bt
].
sub_ödex
;

1383 
w_±r
->
¥›3
 = (
bt_±r
[
bt
].
maö_ödex
 & 0x0F) << 4;

1384 
w_±r
->
¥›4
 = (
bt_±r
[
bt
].
maö_ödex
 & 0x30) >> 4;

1385 
w_±r
->
bt_idx
 = 
bt
;

1387 
	}
}

1392 
	$wedô_ßve_tûe
(
ds1_idx
, 
x
, 
y
, 
CELL_F_S
 * 
d°_f_±r
, 
CELL_W_S
 * 
d°_w_±r
, 
CELL_S_S
 * 
d°_s_±r
)

1399 
CELL_W_S
 * 
w_±r
;

1400 
CELL_F_S
 * 
f_±r
;

1401 
CELL_S_S
 * 
s_±r
;

1402 
i
, 
t
;

1406 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1408 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++) {

1410 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
 + 
i
;

1411 
d°_f_±r
[
i
].
¥›1
 = 
f_±r
->prop1;

1412 
d°_f_±r
[
i
].
¥›2
 = 
f_±r
->prop2;

1413 
d°_f_±r
[
i
].
¥›3
 = 
f_±r
->prop3;

1414 
d°_f_±r
[
i
].
¥›4
 = 
f_±r
->prop4;

1415 
d°_f_±r
[
i
].
bt_idx
 = 
f_±r
->bt_idx;

1416 
d°_f_±r
[
i
].
Êags
 = 
f_±r
->flags;

1420 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1421 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_num
; i++) {

1422 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
 + 
i
;

1423 
d°_s_±r
[
i
].
¥›1
 = 
s_±r
->prop1;

1424 
d°_s_±r
[
i
].
¥›2
 = 
s_±r
->prop2;

1425 
d°_s_±r
[
i
].
¥›3
 = 
s_±r
->prop3;

1426 
d°_s_±r
[
i
].
¥›4
 = 
s_±r
->prop4;

1427 
d°_s_±r
[
i
].
bt_idx
 = 
s_±r
->bt_idx;

1428 
d°_s_±r
[
i
].
Êags
 = 
s_±r
->flags;

1432 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1433 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_num
; i++) {

1434 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
 + 
i
;

1435 
d°_w_±r
[
i
].
¥›1
 = 
w_±r
->prop1;

1436 
d°_w_±r
[
i
].
¥›2
 = 
w_±r
->prop2;

1437 
d°_w_±r
[
i
].
¥›3
 = 
w_±r
->prop3;

1438 
d°_w_±r
[
i
].
¥›4
 = 
w_±r
->prop4;

1440 
d°_w_±r
[
i
].
‹õ¡©i⁄
 = 
w_±r
->orientation;

1441 
d°_w_±r
[
i
].
bt_idx
 = 
w_±r
->bt_idx;

1442 
d°_w_±r
[
i
].
Êags
 = 
w_±r
->flags;

1444 
	}
}

1449 
	$wedô_ˇn˚l_tûe
(
ds1_idx
, 
x
, 
y
,

1450 
CELL_F_S
 * 
§c_f_±r
, 
CELL_W_S
 * 
§c_w_±r
,

1451 
CELL_S_S
 * 
§c_s_±r
)

1453 
CELL_W_S
 * 
w_±r
;

1454 
CELL_F_S
 * 
f_±r
;

1455 
CELL_S_S
 * 
s_±r
;

1456 
i
, 
t
;

1460 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

1461 
i
=0; i<
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

1463 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
;

1464 
f_±r
[
i
].
¥›1
 = 
§c_f_±r
[i].prop1;

1465 
f_±r
[
i
].
¥›2
 = 
§c_f_±r
[i].prop2;

1466 
f_±r
[
i
].
¥›3
 = 
§c_f_±r
[i].prop3;

1467 
f_±r
[
i
].
¥›4
 = 
§c_f_±r
[i].prop4;

1468 
f_±r
[
i
].
bt_idx
 = 
§c_f_±r
[i].bt_idx;

1469 
f_±r
[
i
].
Êags
 = 
§c_f_±r
[i].flags;

1473 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

1474 
i
=0; i<
glb_ds1
[
ds1_idx
].
shadow_num
; i++)

1476 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
;

1477 
s_±r
[
i
].
¥›1
 = 
§c_s_±r
[i].prop1;

1478 
s_±r
[
i
].
¥›2
 = 
§c_s_±r
[i].prop2;

1479 
s_±r
[
i
].
¥›3
 = 
§c_s_±r
[i].prop3;

1480 
s_±r
[
i
].
¥›4
 = 
§c_s_±r
[i].prop4;

1481 
s_±r
[
i
].
bt_idx
 = 
§c_s_±r
[i].bt_idx;

1482 
s_±r
[
i
].
Êags
 = 
§c_s_±r
[i].flags;

1486 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1487 
i
=0; i<
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

1489 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

1490 
w_±r
[
i
].
¥›1
 = 
§c_w_±r
[i].prop1;

1491 
w_±r
[
i
].
¥›2
 = 
§c_w_±r
[i].prop2;

1492 
w_±r
[
i
].
¥›3
 = 
§c_w_±r
[i].prop3;

1493 
w_±r
[
i
].
¥›4
 = 
§c_w_±r
[i].prop4;

1494 
w_±r
[
i
].
‹õ¡©i⁄
 = 
§c_w_±r
[i].orientation;

1495 
w_±r
[
i
].
bt_idx
 = 
§c_w_±r
[i].bt_idx;

1496 
w_±r
[
i
].
Êags
 = 
§c_w_±r
[i].flags;

1498 
	}
}

1503 
	$wedô_kìp_tûe
(
ds1_idx
, 
x
, 
y
,

1504 
CELL_F_S
 * 
§c_f_±r
, 
CELL_W_S
 * 
§c_w_±r
,

1505 
CELL_S_S
 * 
§c_s_±r
)

1507 
UNDO_S
 * 
u
 = & 
glb_ds1
[
ds1_idx
].
undo
;

1508 
n
;

1510 
	`undo_√w_tûe_buf„r
(
ds1_idx
);

1512 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

1513 
u
->
d©_Êg
.
f
[
n
] = 
DF_P1
 | 
DF_P2
 | 
DF_P3
 | 
DF_P4
;

1515 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

1516 
u
->
d©_Êg
.
s
[
n
] = 
DF_P1
 | 
DF_P2
 | 
DF_P3
 | 
DF_P4
;

1518 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

1519 
u
->
d©_Êg
.
w
[
n
] = 
DF_P1
 | 
DF_P2
 | 
DF_P3
 | 
DF_P4
 | 
DF_OR
;

1521 
	`undo_add_this_tûe_to_buf„r
(
ds1_idx
, 
x
, 
y
, 
§c_f_±r
, 
§c_w_±r
, 
§c_s_±r
);

1522 
	`undo_˛o£_tûe_buf„r
(
ds1_idx
);

1523 
	}
}

1529 
	$wedô_ã°
(
ds1_idx
, 
tx
, 
ty
)

1531 
WIN_ELEMENT_S
 * 
w_ñm
;

1532 
WIN_EDIT_S
 * 
w
 = & 
glb_ds1edô
.
wö_edô
;

1533 
DS1_S
 * 
d
 = & 
glb_ds1
[
ds1_idx
];

1534 
BUTTON_S
 * 
b
;

1535 
BLOCK_TABLE_S
 * 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

1536 
i
, 
n
, 
d⁄e
=
FALSE
, 
mx
, 
my
, 
mb
;

1537 
focus
=0, 
focus_ˇn_ch™ge
=
TRUE
, 
bt_£l
;

1538 
my_b‹dî
 = 1, 
xn
=0, 
yn
=0, 
ﬁd_xn
=0, 
ﬁd_yn
=0;

1539 
BUT_TYP_E
 
cuºít_buâ⁄
 = 
BU_NULL
;

1540 
BLK_TYP_E
 
cuºít_ty≥
 = 
BT_NULL
;

1541 
m_idx
, 
s_idx
;

1542 
CELL_W_S
 
ßve_wÆl
 [
WALL_MAX_LAYER
];

1543 
CELL_F_S
 
ßve_Êo‹
 [
FLOOR_MAX_LAYER
];

1544 
CELL_S_S
 
ßve_shadow
 [
SHADOW_MAX_LAYER
];

1545 
tmp
[80];

1549 
	`wedô_ßve_tûe
(
ds1_idx
, 
tx
, 
ty
, 
ßve_Êo‹
, 
ßve_wÆl
, 
ßve_shadow
);

1550 
	`wedô_tûes_make
(
ds1_idx
);

1552 
	`posôi⁄_mou£
(200, 70);

1554 
w
->
buâ⁄
[
BU_WALL1
].
a˘ive
 = 0 < 
d
->
wÆl_num
 ? 
TRUE
 : 
FALSE
;

1555 
w
->
buâ⁄
[
BU_WALL2
].
a˘ive
 = 1 < 
d
->
wÆl_num
 ? 
TRUE
 : 
FALSE
;

1556 
w
->
buâ⁄
[
BU_WALL3
].
a˘ive
 = 2 < 
d
->
wÆl_num
 ? 
TRUE
 : 
FALSE
;

1557 
w
->
buâ⁄
[
BU_WALL4
].
a˘ive
 = 3 < 
d
->
wÆl_num
 ? 
TRUE
 : 
FALSE
;

1559 
w
->
buâ⁄
[
BU_FLOOR1
].
a˘ive
 = 0 < 
d
->
Êo‹_num
 ? 
TRUE
 : 
FALSE
;

1560 
w
->
buâ⁄
[
BU_FLOOR2
].
a˘ive
 = 1 < 
d
->
Êo‹_num
 ? 
TRUE
 : 
FALSE
;

1562 
w
->
buâ⁄
[
BU_OK
].
a˘ive
 = 
TRUE
;

1563 
w
->
buâ⁄
[
BU_CANCEL
].
a˘ive
 = 
TRUE
;

1565 
w
->
buâ⁄
[
BU_VIEW_RAND
].
a˘ive
 = 
FALSE
;

1570 
i
=
BU_NULL
 + 1; i<
BU_MAX
; i++) {

1571 i‡(
w
->
buâ⁄
[
i
].
a˘ive
) {

1572 
w
->
buâ⁄
[
i
].
mou£_ovî
 = 
FALSE
;

1573 
w
->
buâ⁄
[
i
].
°©e
 = 
BS_OFF
;

1577 i‡(
w
->
buâ⁄
[
BU_WALL1
].
a˘ive
 =
TRUE
) {

1578 
cuºít_buâ⁄
 = 
BU_WALL1
;

1579 } i‡(
w
->
buâ⁄
[
BU_FLOOR1
].
a˘ive
 =
TRUE
) {

1580 
cuºít_buâ⁄
 = 
BU_FLOOR1
;

1585 
bt_£l
 = 
	`wedô_£¨ch_tûe
(
ds1_idx
, 
tx
, 
ty
, 
cuºít_buâ⁄
);

1587 
	`wedô_jump
(
ds1_idx
, 
bt_£l
, & 
xn
, & 
yn
);

1589 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_tûes
;

1591 
b
 = & 
w
->
èb
[
BT_STATIC
];

1592 
b
->
x0
 = 
w_ñm
->
i_x0
;

1593 
b
->
y0
 = 88;

1594 
b
->
a˘ive
 = 
FALSE
;

1595 
b
->
°©e
 = 
BS_OFF
;

1596 
b
->
èb_have_tûes
 = 
	`wedô_èb_have
(
ds1_idx
, 
BT_STATIC
);

1598 
b
 = & 
w
->
èb
[
BT_ANIMATED
];

1599 
b
->
x0
 = 
w
->
èb
[
BT_STATIC
].x0 + w->èb[BT_STATIC].w + 
my_b‹dî
;

1600 
b
->
y0
 = 88;

1601 
b
->
a˘ive
 = 
FALSE
;

1602 
b
->
°©e
 = 
BS_OFF
;

1603 
b
->
èb_have_tûes
 = 
	`wedô_èb_have
(
ds1_idx
, 
BT_ANIMATED
);

1605 
b
 = & 
w
->
èb
[
BT_SHADOW
];

1606 
b
->
x0
 = 
w_ñm
->
i_x0
;

1607 
b
->
y0
 = 88;

1608 
b
->
a˘ive
 = 
FALSE
;

1609 
b
->
°©e
 = 
BS_OFF
;

1610 
b
->
èb_have_tûes
 = 
	`wedô_èb_have
(
ds1_idx
, 
BT_SHADOW
);

1614 i‡(
b
->
èb_have_tûes
) {

1615 
w
->
buâ⁄
[
BU_SHADOW
].
a˘ive
 = 
TRUE
;

1617 
w
->
buâ⁄
[
BU_SHADOW
].
a˘ive
 = 
FALSE
;

1620 
b
 = & 
w
->
èb
[
BT_WALL_UP
];

1621 
b
->
x0
 = 
w_ñm
->
i_x0
;

1622 
b
->
y0
 = 88;

1623 
b
->
°©e
 = 
BS_OFF
;

1624 
b
->
èb_have_tûes
 = b->
a˘ive
 = 
	`wedô_èb_have
(
ds1_idx
, 
BT_WALL_UP
);

1626 
b
 = & 
w
->
èb
[
BT_WALL_DOWN
];

1627 
b
->
x0
 = 
w
->
èb
[
BT_WALL_UP
].x0 + w->èb[BT_WALL_UP].w + 
my_b‹dî
;

1628 
b
->
y0
 = 88;

1629 
b
->
°©e
 = 
BS_OFF
;

1630 
b
->
èb_have_tûes
 = b->
a˘ive
 = 
	`wedô_èb_have
(
ds1_idx
, 
BT_WALL_DOWN
);

1632 
b
 = & 
w
->
èb
[
BT_ROOF
];

1633 
b
->
x0
 = 
w
->
èb
[
BT_WALL_DOWN
].x0 + w->èb[BT_WALL_DOWN].w + 
my_b‹dî
;

1634 
b
->
y0
 = 88;

1635 
b
->
°©e
 = 
BS_OFF
;

1636 
b
->
èb_have_tûes
 = b->
a˘ive
 = 
	`wedô_èb_have
(
ds1_idx
, 
BT_ROOF
);

1638 
b
 = & 
w
->
èb
[
BT_SPECIAL
];

1639 
b
->
x0
 = 
w
->
èb
[
BT_ROOF
].x0 + w->èb[BT_ROOF].w + 
my_b‹dî
;

1640 
b
->
y0
 = 88;

1641 
b
->
°©e
 = 
BS_OFF
;

1642 
b
->
èb_have_tûes
 = b->
a˘ive
 = 
	`wedô_èb_have
(
ds1_idx
, 
BT_SPECIAL
);

1644 
	`£t_cﬁ‹_dïth
(8);

1646 
w
->
tmp_edô
 = 
	`¸óã_bôm≠
(w->
w_tûes
.
öside
->w, w->w_tûes.öside->
h
);

1648 
	`£t_cﬁ‹_dïth
(
glb_c⁄fig
.
s¸ìn
.
dïth
);

1650 i‡(
bt_£l
 >= 1) {

1651 
cuºít_ty≥
 = 
bt_±r
[
bt_£l
].
ty≥
;

1652 
w
->
èb
[
cuºít_ty≥
].
°©e
 = 
BS_ON
;

1654 i‡(
w
->
èb
[
BT_WALL_UP
].
a˘ive
) {

1655 
w
->
èb
[
BT_WALL_UP
].
°©e
 = 
BS_ON
;

1656 
cuºít_ty≥
 = 
BT_WALL_UP
;

1657 } i‡(
w
->
èb
[
BT_WALL_DOWN
].
a˘ive
) {

1658 
w
->
èb
[
BT_WALL_DOWN
].
°©e
 = 
BS_ON
;

1659 
cuºít_ty≥
 = 
BT_WALL_DOWN
;

1660 } i‡(
w
->
èb
[
BT_ROOF
].
a˘ive
) {

1661 
w
->
èb
[
BT_ROOF
].
°©e
 = 
BS_ON
;

1662 
cuºít_ty≥
 = 
BT_ROOF
;

1663 } i‡(
w
->
èb
[
BT_SPECIAL
].
a˘ive
) {

1664 
w
->
èb
[
BT_SPECIAL
].
°©e
 = 
BS_ON
;

1665 
cuºít_ty≥
 = 
BT_SPECIAL
;

1670 
	`wedô_èb_tûes
(
ds1_idx
, 
cuºít_ty≥
, 
xn
, 
yn
, 
bt_£l
, -1, -1);

1673  ! 
d⁄e
) {

1675 
mx
 = 
mou£_x
;

1676 
my
 = 
mou£_y
;

1677 
mb
 = 
mou£_b
;

1681 
	`˛ór_to_cﬁ‹
(
glb_ds1edô
.
s¸ìn_buff
, 27);

1682 
i
 = 
BU_NULL
+1; i<
BU_MAX
; i++) {

1683 
	`wedô_døw_buâ⁄
(
i
);

1686 i‡(
cuºít_buâ⁄
 !
BU_NULL
) {

1687 
b
 = & 
glb_ds1edô
.
wö_edô
.
buâ⁄
[
cuºít_buâ⁄
];

1688 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
b
->
x0
-2, b->
y0
-2, b->x0+b->
w
+1, b->y0+b->
h
+1, 133);

1691 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_¥evõw
;

1692 
	`døw_æe_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_ñm
->
b‹dî
, w_ñm->
b_x0
, w_ñm->
b_y0
);

1693 
	`blô
(
w_ñm
->
öside
, 
glb_ds1edô
.
s¸ìn_buff
, 0, 0, w_ñm->
i_x0
, w_ñm->
i_y0
, w_ñm->öside->
w
, w_ñm->öside->
h
);

1695 
w_ñm
 = & 
glb_ds1edô
.
wö_edô
.
w_tûes
;

1696 
	`døw_æe_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
w_ñm
->
b‹dî
, w_ñm->
b_x0
, w_ñm->
b_y0
);

1702 
	`wedô_døw_w
 (
ds1_idx
, 
tx
, 
ty
, 
FALSE
);

1703 
	`wedô_døw_f
 (
ds1_idx
, 
tx
, 
ty
);

1704 
	`wedô_døw_s
 (
ds1_idx
, 
tx
, 
ty
);

1705 
	`wedô_døw_w
 (
ds1_idx
, 
tx
, 
ty
, 
TRUE
);

1706 
	`wedô_døw_r
 (
ds1_idx
, 
tx
, 
ty
);

1707 
	`wedô_døw_•
(
ds1_idx
, 
tx
, 
ty
);

1709 
i
=
BT_NULL
 + 1; i<
BT_MAX
; i++) {

1710 
b
 = & 
w
->
èb
[
i
];

1711 i‡(
b
->
a˘ive
) {

1712 
	`wedô_døw_èb
(
i
);

1716 
	`blô
(
w
->
tmp_edô
, 
glb_ds1edô
.
s¸ìn_buff
, 0, 0, 
w_ñm
->
i_x0
, w_ñm->
i_y0
, w->tmp_edô->w, w->tmp_edô->
h
);

1718 
	`misc_døw_s¸ìn
(
mx
, 
my
);

1721 
	`wedô_mou£_tûe
(
mx
, 
my
, 
xn
, 
yn
, 
cuºít_ty≥
, & 
m_idx
, & 
s_idx
);

1724 i‡(
key
[
KEY_UP
] || 
my
 == 0) {

1725 
yn
 -
glb_c⁄fig
.
s¸ﬁl
.
edô
.
y
;

1727 i‡(
key
[
KEY_DOWN
] || 
my
 =
glb_c⁄fig
.
s¸ìn
.
height
 - 1) {

1728 
yn
 +
glb_c⁄fig
.
s¸ﬁl
.
edô
.
y
;

1730 i‡(
key
[
KEY_LEFT
] || 
mx
 == 0) {

1731 
xn
 -
glb_c⁄fig
.
s¸ﬁl
.
edô
.
x
;

1733 i‡(
key
[
KEY_RIGHT
] || 
mx
 =
glb_c⁄fig
.
s¸ìn
.
width
 - 1) {

1734 
xn
 +
glb_c⁄fig
.
s¸ﬁl
.
edô
.
x
;

1736 i‡(
key
[
KEY_HOME
]) {

1737 
xn
 = 0;

1739 i‡(
key
[
KEY_PGUP
]) {

1740 i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

1741 
xn
 -
w
->
tmp_edô
->w;

1743 
yn
 -
w
->
tmp_edô
->
h
;

1745 
	`ª°
(80);

1747 i‡(
key
[
KEY_PGDN
]) {

1748 i‡(
key
[
KEY_LCONTROL
] || key[
KEY_RCONTROL
]) {

1749 
xn
 +
w
->
tmp_edô
->w;

1751 
yn
 +
w
->
tmp_edô
->
h
;

1753 
	`ª°
(80);

1757 i‡(
key
[
KEY_F9
]) {

1758 
key
[
KEY_F9
]) {

1761 
glb_ds1
[
ds1_idx
].
•ecül_œyî_mask
 = 1 - glb_ds1[ds1_idx].special_layer_mask;

1765 i‡(
key
[
KEY_F11
]) {

1766 
key
[
KEY_F11
]) {

1768 i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) {

1769 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0]--;

1770 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0] < 0) {

1771 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0] = 3;

1774 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0]++;

1775 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0] >= 4) {

1776 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0] = 0;

1782 i‡(
key
[
KEY_F12
]) {

1783 i‡(
key
[
KEY_LSHIFT
] || key[
KEY_RSHIFT
]) {

1784 i‡(
glb_ds1edô
.
cur_gamma
 > 
GC_060
) {

1785 
	`ª°
(80);

1786 
glb_ds1edô
.
cur_gamma
--;

1787 
	`misc_upd©e_∑l_wôh_gamma
();

1788 
	`£t_∑Àâe
(
glb_ds1edô
.
vga_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1]);

1791 i‡(
glb_ds1edô
.
cur_gamma
 < 
GC_300
) {

1792 
	`ª°
(80);

1793 
glb_ds1edô
.
cur_gamma
++;

1794 
	`misc_upd©e_∑l_wôh_gamma
();

1795 
	`£t_∑Àâe
(
glb_ds1edô
.
vga_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1]);

1801 i‡(
key
[
KEY_P
]) {

1802 
	`•rötf
(
tmp
, "s¸ìnshŸ-%05i.pcx", 
glb_ds1edô
.
s¸ìnshŸ_num
);

1803 
	`fûe_exi°s
(
tmp
, -1, 
NULL
)) {

1804 
glb_ds1edô
.
s¸ìnshŸ_num
++;

1805 
	`•rötf
(
tmp
, "s¸ìnshŸ-%05i.pcx", 
glb_ds1edô
.
s¸ìnshŸ_num
);

1809 
	`døw_•rôe
–
glb_ds1edô
.
s¸ìn_buff
, glb_ds1edô.
mou£_curs‹
[glb_ds1edô.
mode
], 
mou£_x
 - 1, 
mou£_y
 - 1);

1812 
	`ßve_pcx
(
tmp
, 
glb_ds1edô
.
s¸ìn_buff
, glb_ds1edô.
vga_∑l
[
glb_ds1
[
ds1_idx
].
a˘
-1]);

1813 
	`misc_pcx_put_d2_∑Àâe
(
tmp
, 
glb_ds1
[
ds1_idx
].
a˘
-1);

1814 
glb_ds1edô
.
s¸ìnshŸ_num
++;

1815 
key
[
KEY_P
]){

1821 i‡(
focus_ˇn_ch™ge
) {

1822 
focus
 = 0;

1825 
i
=
BU_NULL
 + 1; i<
BU_MAX
; i++) {

1826 
b
 = & 
w
->
buâ⁄
[
i
];

1827 i‡(
b
->
a˘ive
) {

1828 i‡((
mx
 >
b
->
x0
Ë&& (
my
 >b->
y0
Ë&& (mx < b->x0 + b->
w
Ë&& (my < b->y0 + b->
h
)) {

1830 
b
->
mou£_ovî
 = 
TRUE
;

1831 i‡(
mb
) {

1833 i‡((
focus_ˇn_ch™ge
Ë|| (
focus
 =
i
)) {

1835 i‡(
b
->
°©e
 =
BS_OFF
) {

1836 
b
->
°©e
 = 
BS_ON
;

1838 i‡(
focus_ˇn_ch™ge
) {

1839 
focus
 = 
i
;

1840 
focus_ˇn_ch™ge
 = 
FALSE
;

1845 i‡(
b
->
°©e
 =
BS_ON
) {

1846 
b
->
°©e
 = 
BS_OFF
;

1850 
b
->
mou£_ovî
 = 
FALSE
;

1851 i‡(
mb
) {

1853 i‡(
b
->
°©e
 =
BS_ON
) {

1854 
b
->
°©e
 = 
BS_OFF
;

1862 
i
=
BT_NULL
 + 1; i<
BT_MAX
; i++) {

1863 
b
 = & 
w
->
èb
[
i
];

1864 i‡(
b
->
a˘ive
) {

1865 i‡((
mx
 >
b
->
x0
Ë&& (
my
 >b->
y0
Ë&& (mx < b->x0 + b->
w
Ë&& (my < b->y0 + b->
h
)) {

1867 
b
->
mou£_ovî
 = 
TRUE
;

1868 i‡(
mb
) {

1870 i‡(
focus_ˇn_ch™ge
) {

1872 
n
=
BT_NULL
 + 1;Ç<
BT_MAX
;Ç++) {

1873 i‡(
w
->
èb
[
n
].
a˘ive
) {

1874 
w
->
èb
[
n
].
°©e
 = 
BS_OFF
;

1878 
b
->
°©e
 = 
BS_ON
;

1879 
cuºít_ty≥
 = 
i
;

1880 
xn
 = 
yn
 = 0;

1884 
b
->
mou£_ovî
 = 
FALSE
;

1890 i‡((
focus
 =0Ë&& (
mb
)) {

1891 
focus_ˇn_ch™ge
 = 
FALSE
;

1895 i‡(
mb
 == 0) {

1896 i‡(
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
]) {

1898 
d⁄e
 = 
TRUE
;

1899 
	`wedô_kìp_tûe
(
ds1_idx
, 
tx
, 
ty
, 
ßve_Êo‹
, 
ßve_wÆl
, 
ßve_shadow
);

1900 
key
[
KEY_ENTER
] || key[
KEY_ENTER_PAD
]) {

1903 
focus_ˇn_ch™ge
 = 
TRUE
;

1907 i‡(
focus_ˇn_ch™ge
 =
FALSE
) {

1908 i‡(
w
->
buâ⁄
[
focus
].
mou£_ovî
 =
TRUE
) {

1910 
focus
) {

1911 
BU_OK
 :

1913 
d⁄e
 = 
TRUE
;

1914 
	`wedô_kìp_tûe
(
ds1_idx
, 
tx
, 
ty
, 
ßve_Êo‹
, 
ßve_wÆl
, 
ßve_shadow
);

1917 
BU_CANCEL
 :

1919 
	`wedô_ˇn˚l_tûe
(
ds1_idx
, 
tx
, 
ty
, 
ßve_Êo‹
, 
ßve_wÆl
, 
ßve_shadow
);

1920 
d⁄e
 = 
TRUE
;

1923 
BU_FLOOR1
 :

1924 
BU_FLOOR2
 :

1925 
n
=
BT_NULL
 + 1;Ç<
BT_MAX
;Ç++) {

1926 
w
->
èb
[
n
].
a˘ive
 = 
FALSE
;

1927 
w
->
èb
[
n
].
°©e
 = 
BS_OFF
;

1929 
w
->
èb
[
BT_STATIC
].
a˘ive
 = w->èb[BT_STATIC].
èb_have_tûes
;

1930 
w
->
èb
[
BT_ANIMATED
].
a˘ive
 = w->èb[BT_ANIMATED].
èb_have_tûes
;

1931 
cuºít_buâ⁄
 = 
focus
;

1932 
bt_£l
 = 
	`wedô_£¨ch_tûe
(
ds1_idx
, 
tx
, 
ty
, 
cuºít_buâ⁄
);

1933 
	`wedô_jump
(
ds1_idx
, 
bt_£l
, & 
xn
, & 
yn
);

1934 i‡(
bt_£l
 >= 1) {

1935 
cuºít_ty≥
 = 
bt_±r
[
bt_£l
].
ty≥
;

1936 
w
->
èb
[
cuºít_ty≥
].
°©e
 = 
BS_ON
;

1938 i‡(
w
->
èb
[
BT_STATIC
].
a˘ive
) {

1939 
w
->
èb
[
BT_STATIC
].
°©e
 = 
BS_ON
;

1940 
cuºít_ty≥
 = 
BT_STATIC
;

1941 } i‡(
w
->
èb
[
BT_ANIMATED
].
a˘ive
) {

1942 
w
->
èb
[
BT_ANIMATED
].
°©e
 = 
BS_ON
;

1943 
cuºít_ty≥
 = 
BT_ANIMATED
;

1948 
BU_SHADOW
 :

1949 
n
=
BT_NULL
 + 1;Ç<
BT_MAX
;Ç++) {

1950 
w
->
èb
[
n
].
a˘ive
 = 
FALSE
;

1951 
w
->
èb
[
n
].
°©e
 = 
BS_OFF
;

1953 
w
->
èb
[
BT_SHADOW
].
a˘ive
 = w->èb[BT_SHADOW].
èb_have_tûes
;

1954 
cuºít_buâ⁄
 = 
focus
;

1955 
bt_£l
 = 
	`wedô_£¨ch_tûe
(
ds1_idx
, 
tx
, 
ty
, 
cuºít_buâ⁄
);

1956 
	`wedô_jump
(
ds1_idx
, 
bt_£l
, & 
xn
, & 
yn
);

1957 i‡(
bt_£l
 >= 1) {

1958 
cuºít_ty≥
 = 
bt_±r
[
bt_£l
].
ty≥
;

1959 
w
->
èb
[
cuºít_ty≥
].
°©e
 = 
BS_ON
;

1961 i‡(
w
->
èb
[
BT_SHADOW
].
a˘ive
) {

1962 
w
->
èb
[
BT_SHADOW
].
°©e
 = 
BS_ON
;

1963 
cuºít_ty≥
 = 
BT_SHADOW
;

1968 
BU_WALL1
 :

1969 
BU_WALL2
 :

1970 
BU_WALL3
 :

1971 
BU_WALL4
 :

1972 
n
=
BT_NULL
 + 1;Ç<
BT_MAX
;Ç++) {

1973 
w
->
èb
[
n
].
a˘ive
 = 
FALSE
;

1974 
w
->
èb
[
n
].
°©e
 = 
BS_OFF
;

1976 
w
->
èb
[
BT_WALL_UP
].
a˘ive
 = w->èb[BT_WALL_UP].
èb_have_tûes
;

1977 
w
->
èb
[
BT_WALL_DOWN
].
a˘ive
 = w->èb[BT_WALL_DOWN].
èb_have_tûes
;

1978 
w
->
èb
[
BT_ROOF
].
a˘ive
 = w->èb[BT_ROOF].
èb_have_tûes
;

1979 
w
->
èb
[
BT_SPECIAL
].
a˘ive
 = w->èb[BT_SPECIAL].
èb_have_tûes
;

1980 
cuºít_buâ⁄
 = 
focus
;

1981 
bt_£l
 = 
	`wedô_£¨ch_tûe
(
ds1_idx
, 
tx
, 
ty
, 
cuºít_buâ⁄
);

1982 
	`wedô_jump
(
ds1_idx
, 
bt_£l
, & 
xn
, & 
yn
);

1983 i‡(
bt_£l
 >= 1) {

1984 
cuºít_ty≥
 = 
bt_±r
[
bt_£l
].
ty≥
;

1985 
w
->
èb
[
cuºít_ty≥
].
°©e
 = 
BS_ON
;

1987 i‡(
w
->
èb
[
BT_WALL_UP
].
a˘ive
) {

1988 
w
->
èb
[
BT_WALL_UP
].
°©e
 = 
BS_ON
;

1989 
cuºít_ty≥
 = 
BT_WALL_UP
;

1990 } i‡(
w
->
èb
[
BT_WALL_DOWN
].
a˘ive
) {

1991 
w
->
èb
[
BT_WALL_DOWN
].
°©e
 = 
BS_ON
;

1992 
cuºít_ty≥
 = 
BT_WALL_DOWN
;

1993 } i‡(
w
->
èb
[
BT_ROOF
].
a˘ive
) {

1994 
w
->
èb
[
BT_ROOF
].
°©e
 = 
BS_ON
;

1995 
cuºít_ty≥
 = 
BT_ROOF
;

1996 } i‡(
w
->
èb
[
BT_SPECIAL
].
a˘ive
) {

1997 
w
->
èb
[
BT_SPECIAL
].
°©e
 = 
BS_ON
;

1998 
cuºít_ty≥
 = 
BT_SPECIAL
;

2004 
focus_ˇn_ch™ge
 = 
TRUE
;

2007 i‡((
m_idx
 !-1Ë&& (
s_idx
 != -1)) {

2009 
	`wedô_upd©e_tûe
(
ds1_idx
, 
tx
, 
ty
, 
cuºít_buâ⁄
, 
cuºít_ty≥
, 
m_idx
, 
s_idx
);

2010 
bt_£l
 = 
	`wedô_£¨ch_tûe
(
ds1_idx
, 
tx
, 
ty
, 
cuºít_buâ⁄
);

2016 
	`wedô_èb_tûes
(
ds1_idx
, 
cuºít_ty≥
, 
xn
, 
yn
, 
bt_£l
, 
m_idx
, 
s_idx
);

2017 
ﬁd_xn
 = 
xn
;

2018 
ﬁd_yn
 = 
yn
;

2021 
	`de°roy_bôm≠
(
w
->
tmp_edô
);

2022 
w
->
tmp_edô
 = 
NULL
;

2023 
	`wedô_tûes_‰ì
();

2024 
	}
}

	@wedit.h

1 #i‚de‡
_WEDIT_H_


3 
	#_WEDIT_H_


	)

5 
wedô_døw_s
 (
ds1_idx
, 
x
, 
y
);

6 
wedô_døw_f
 (
ds1_idx
, 
x
, 
y
);

7 
wedô_døw_w
 (
ds1_idx
, 
x
, 
y
, 
uµî
);

8 
wedô_døw_r
 (
ds1_idx
, 
x
, 
y
);

9 
wedô_døw_•
 (
ds1_idx
, 
x
, 
y
);

10 
wedô_make_2nd_buâ⁄s
 ();

11 
wedô_ªad_pcx
 ();

12 
wedô_‰ì
 ();

13 
wedô_døw_buâ⁄
 (
BUT_TYP_E
 
b_num
);

14 
wedô_døw_èb
 (
BLK_TYP_E
 
t_num
);

15 
wedô_èb_have
 (
ds1_idx
, 
BLK_TYP_E
 
t
);

16 
wedô_tûes_‰ì
 ();

17 
wedô_tûes_make
 (
ds1_idx
);

18 
wedô_£¨ch_tûe
 (
ds1_idx
, 
x
, 
y
, 
BUT_TYP_E
 
but
);

19 
wedô_èb_tûes
 (
ds1_idx
, 
BLK_TYP_E
 
t
, 
x0
, 
y0
, 
bt_£l
, 
m_idx
, 
s_idx
);

20 
wedô_jump
 (
ds1_idx
, 
bt_idx
, * 
xn
, * 
yn
);

21 
wedô_mou£_tûe
 (
mx
, 
my
, 
x0
, 
y0
, 
t
, * 
m_idx
, * 
s_idx
);

22 
wedô_upd©e_tûe
 (
ds1_idx
, 
x
, 
y
, 
BUT_TYP_E
 
buâ⁄
, 
BLK_TYP_E
 
ty≥
, 
m_idx
, 
s_idx
);

23 
wedô_ßve_tûe
 (
ds1_idx
, 
x
, 
y
, 
CELL_F_S
 * 
d°_f_±r
, 
CELL_W_S
 * 
d°_w_±r
, 
CELL_S_S
 * 
d°_s_±r
);

24 
wedô_ˇn˚l_tûe
 (
ds1_idx
, 
x
, 
y
, 
CELL_F_S
 * 
§c_f_±r
, 
CELL_W_S
 * 
§c_w_±r
, 
CELL_S_S
 * 
§c_s_±r
);

25 
wedô_kìp_tûe
 (
ds1_idx
, 
x
, 
y
, 
CELL_F_S
 * 
§c_f_±r
, 
CELL_W_S
 * 
§c_w_±r
, 
CELL_S_S
 * 
§c_s_±r
);

26 
wedô_ã°
 (
ds1_idx
, 
tx
, 
ty
);

	@wmsg.c

1 
	~<°rög.h
>

2 
	~"°ru˘s.h
"

3 
	~"îr‹.h
"

4 
	~"wmsg.h
"

5 
	~"misc.h
"

9 
	$wmsg_maö
(
WMSG_S
 * 
wmsg
)

11 
mx
, 
my
, 
mb
, 
d⁄e
 = 
FALSE
;

12 
wx0
, 
wy0
, 
wx1
, 
wy1
;

13 
i
, 
n
, 
cuº_Àngth
 = 0, 
max_Àngth
 = 0;

14 
cuº_width
, 
max_width
, 
cuº_height
;

15 
ãxt_löes
 = 0, 
löe_height
, 
x
, 
y
, 
x2
, 
y2
;

16 
ªt
 = -1, 
bx0
, 
by0
, 
but_maxwidth
 = 0, 
bg
, 
fg
, 
b‹dî
;

17 
s
, 
k
, 
Æl_keys
;

18 
tmp
[512];

21 i‡(
wmsg
 =
NULL
)

23 i‡(
wmsg
->
ãxt
 =
NULL
)

25 i‡(
wmsg
->
buâ⁄
 =
NULL
)

29 
n
 = 
	`°æí
(
wmsg
->
ãxt
) + 1;

30 
i
=0; i < 
n
; i++)

32 i‡–(
wmsg
->
ãxt
[
i
] != 0x0A) &&

33 (
wmsg
->
ãxt
[
i
] != 0x0D) &&

34 (
wmsg
->
ãxt
[
i
] != 0x00)

36 
cuº_Àngth
++;

39 i‡(
cuº_Àngth
 > 
max_Àngth
)

40 
max_Àngth
 = 
cuº_Àngth
;

41 
cuº_Àngth
 = 0;

42 
ãxt_löes
++;

45 
max_width
 = (
max_Àngth
 + 2Ë* 
wmsg
->
f⁄t_width
;

46 
löe_height
 = 
wmsg
->
f⁄t_height
 + 2;

47 
cuº_height
 = 
ãxt_löes
 * 
löe_height
;

48 
cuº_height
 +
löe_height
;

51 i‡(
wmsg
->
tôÀ
 !
NULL
)

53 
cuº_height
 +
löe_height
 * 2;

54 
cuº_width
 = 
wmsg
->
f⁄t_width
 * 
	`°æí
(wmsg->
tôÀ
);

55 i‡(
cuº_width
 > 
max_width
)

56 
max_width
 = 
cuº_width
;

60 
but_maxwidth
 = 0;

61 
i
 = 0;

62 
wmsg
->
buâ⁄
[
i
].
ãxt
 !
NULL
)

64 
n
 = 
	`°æí
(
wmsg
->
buâ⁄
[
i
].
ãxt
);

65 
but_maxwidth
 +(2 + 
n
 + 
wmsg
->
buâ⁄
[
i
].
right_•a˚s
) *

66 
wmsg
->
f⁄t_width
;

69 
i
++;

71 
but_maxwidth
 +2 * 
wmsg
->
f⁄t_width
;

72 i‡(
but_maxwidth
 > 
max_width
)

73 
max_width
 = 
but_maxwidth
;

74 
cuº_height
 +
löe_height
 * 5;

78 
wx0
 = (
glb_c⁄fig
.
s¸ìn
.
width
 - 
max_width
) / 2;

79 
bx0
 = 
wx0
 + 
wmsg
->
f⁄t_width
 + ((
max_width
 - 
but_maxwidth
) / 2);

80 
wy0
 = (
glb_c⁄fig
.
s¸ìn
.
height
 - 
cuº_height
) / 2;

81 
wx1
 = 
wx0
 + 
max_width
;

82 
wy1
 = 
wy0
 + 
cuº_height
;

83 
by0
 = 
wy1
 - 
löe_height
 * 4;

84 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
wx0
, 
wy0
, 
wx1
, 
wy1
, 
wmsg
->
cﬁ_wö
.
bg
);

85 
x
 = 
wx0
 + 
wmsg
->
f⁄t_width
;

86 
y
 = 
wy0
 + 
wmsg
->
f⁄t_height
;

89 i‡(
wmsg
->
tôÀ
 !
NULL
)

91 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
wx0
, 
wy0
, 
wx1
, wy0 + 
löe_height
*2, 
wmsg
->
cﬁ_tôÀ
.
bg
);

92 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
wx0
, 
wy0
, 
wx1
, wy0 + 
löe_height
*2, 
wmsg
->
cﬁ_tôÀ
.
fg
);

93 
	`hlöe
(
glb_ds1edô
.
s¸ìn_buff
, 
wx0
, 
wy0
 + 
löe_height
*2, 
wx1
, 
wmsg
->
cﬁ_wö
.
fg
);

95 
	`ãxt_mode
(
wmsg
->
cﬁ_tôÀ
.
bg
);

96 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
wmsg
->
tôÀ
, 
x
, 
y
, wmsg->
cﬁ_tôÀ
.
fg
);

97 
y
 +
löe_height
 * 2;

101 
tmp
[1] = 0x00;

102 
n
 = 
	`°æí
(
wmsg
->
ãxt
) + 1;

103 
	`ãxt_mode
(
wmsg
->
cﬁ_ãxt
.
bg
);

104 
i
=0; i < 
n
; i++)

106 i‡–(
wmsg
->
ãxt
[
i
] != 0x0A) &&

107 (
wmsg
->
ãxt
[
i
] != 0x0D) &&

108 (
wmsg
->
ãxt
[
i
] != 0x00)

112 
tmp
[0] = 
wmsg
->
ãxt
[
i
];

113 
	`ãxtout
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
tmp
, 
x
, 
y
, 
wmsg
->
cﬁ_ãxt
.
fg
);

114 
x
 +
wmsg
->
f⁄t_width
;

118 
x
 = 
wx0
 + 
wmsg
->
f⁄t_width
;

119 
y
 +
löe_height
;

124 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
wx0
, 
wy0
, 
wx1
, 
wy1
, 
wmsg
->
cﬁ_wö
.
fg
);

129 
mx
 = 
mou£_x
;

130 
my
 = 
mou£_y
;

131 
mb
 = 
mou£_b
;

134 
	`ãxt_mode
(-1);

135  ! 
d⁄e
)

138 
i
 = 0;

139 (
wmsg
->
buâ⁄
[
i
].
ãxt
 !
NULL
Ë&& ( ! 
d⁄e
) )

141 
s
=0; s < 
MW_SHORTCUT_NUM
; s++)

145 
Æl_keys
 = 
TRUE
;

146 i‡(
wmsg
->
buâ⁄
[
i
].
sh‹tcut
[
s
].
key
[0] != 0)

148 
k
=0; k < 
MW_COMBINATION_KEY_NUM
; k++)

150 i‡(
wmsg
->
buâ⁄
[
i
].
sh‹tcut
[
s
].
key
[
k
])

152 i‡–! 
key
[ 
wmsg
->
buâ⁄
[
i
].
sh‹tcut
[
s
].key[
k
] ])

153 
Æl_keys
 = 
FALSE
;

158 
Æl_keys
 = 
FALSE
;

159 i‡(
Æl_keys
 =
TRUE
)

161 
d⁄e
 = 
TRUE
;

162 
ªt
 = 
i
;

165 
Æl_keys
 =
TRUE
)

167 
Æl_keys
 = 
FALSE
;

168 
k
=0; k < 
MW_COMBINATION_KEY_NUM
; k++)

170 i‡(
wmsg
->
buâ⁄
[
i
].
sh‹tcut
[
s
].
key
[
k
])

172 i‡(
key
[ 
wmsg
->
buâ⁄
[
i
].
sh‹tcut
[
s
].key[
k
] ])

173 
Æl_keys
 = 
TRUE
;

181 
i
++;

185 
i
 = 0;

186 
x
 = 
bx0
;

187 
y
 = 
by0
;

188 
y2
 = 
y
 + (3 * 
löe_height
);

189 
wmsg
->
buâ⁄
[
i
].
ãxt
 !
NULL
)

191 
n
 = 
	`°æí
(
wmsg
->
buâ⁄
[
i
].
ãxt
);

192 
x2
 = 
x
 + ((
n
 + 2Ë* 
wmsg
->
f⁄t_width
);

195 i‡((
mx
 >
x
Ë&& (mx <
x2
Ë&& (
my
 >
y
Ë&& (my <
y2
))

198 
bg
 = 
wmsg
->
buâ⁄
[
i
].
⁄
.bg;

199 
fg
 = 
wmsg
->
buâ⁄
[
i
].
⁄
.fg;

200 
b‹dî
 = 
wmsg
->
buâ⁄
[
i
].
⁄
.border;

203 i‡(
mb
)

205 
mb
)

206 
mb
 = 
mou£_b
;

207 
d⁄e
 = 
TRUE
;

208 
ªt
 = 
i
;

214 
bg
 = 
wmsg
->
buâ⁄
[
i
].
off
.bg;

215 
fg
 = 
wmsg
->
buâ⁄
[
i
].
off
.fg;

216 
b‹dî
 = 
wmsg
->
buâ⁄
[
i
].
off
.border;

220 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x
, 
y
, 
x2
, 
y2
, 
bg
);

221 
	`ãxçrötf
(

222 
glb_ds1edô
.
s¸ìn_buff
,

223 
f⁄t
,

224 
x
 + 
wmsg
->
f⁄t_width
,

225 
y
 + 
löe_height
 + 2,

226 
fg
,

227 "%s", 
wmsg
->
buâ⁄
[
i
].
ãxt


229 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x
, 
y
, 
x2
, 
y2
, 
b‹dî
);

232 
x
 = 
x2
 + (
wmsg
->
f⁄t_width
 * wmsg->
buâ⁄
[
i
].
right_•a˚s
);

233 
i
++;

236 
	`misc_døw_s¸ìn
(
mx
, 
my
);

239 
mx
 = 
mou£_x
;

240 
my
 = 
mou£_y
;

241 
mb
 = 
mou£_b
;

244 
	`ãxt_mode
(-1);

246  
ªt
;

247 
	}
}

	@wmsg.h

1 #i‚de‡
_WMSG_H_


3 
	#_WMSG_H_


	)

5 
wmsg_maö
(
WMSG_S
 * 
wmsg
);

	@wpreview.c

1 
	~<m©h.h
>

2 
	~<°rög.h
>

3 
	~"°ru˘s.h
"

4 
	~"gfx_cu°om.h
"

5 
	~"misc.h
"

6 
	~"edôobj.h
"

7 
	~"edô∑th.h
"

8 
	~"w¥evõw.h
"

10 #ifde‡
WIN32


11 #¥agm®
w¨nög
 (
push
)

12 #¥agm®
w¨nög
 (
dißbÀ
 : 4244 4267 )

17 
	$w¥evõw_sh≠e
(
BITMAP
 * 
tmp_bmp
, 
x0
, 
y0
, 
ds1_idx
,

18 
COL_E
 
cﬁ_idx
)

20 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

21 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SELECT
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

23 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SELECT
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

24 
	`døw_lô_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
, 
cﬁ_idx
);

25 
	}
}

30 
	$w¥evõw_gouøud_f
(
BITMAP
 * 
tmp_bmp
, 
x0
, 
y0
, 
ds1_idx
,

31 
c1
, 
c2
, 
c3
, 
c4
)

33 i‡((
c1
 =
c2
Ë&& (c2 =
c3
Ë&& (c3 =
c4
))

35 i‡(
c1
 <= 7)

37 i‡(
c1
 >= 248)

38 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
);

41 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

42 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

44 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

45 
	`døw_lô_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
, 
c1
);

50 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

51 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

53 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

54 i‡(
glb_ds1edô
.
night_mode
 == 1)

56 
	`døw_gouøud_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
,

57 
c1
, 
c2
, 
c3
, 
c4
);

61 
	`døw_lô_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
,

62 (
c1
 + 
c2
 + 
c3
 + 
c4
) / 4);

65 
	}
}

70 
	$w¥evõw_gouøud_w
(
BITMAP
 * 
tmp_bmp
, 
x0
, 
y0
, 
ds1_idx
,

71 
c1
, 
c2
, 
c3
, 
c4
)

73 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

74 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

76 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

78 i‡((
c1
 =
c2
Ë&& (c2 =
c3
Ë&& (c3 =
c4
))

80 i‡(
c1
 >= 248)

81 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
);

84 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

85 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

87 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

88 
	`døw_lô_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
, 
c1
);

93 i‡(
glb_ds1edô
.
night_mode
 == 1)

95 
	`døw_gouøud_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
,

96 
c1
, 
c2
, 
c3
, 
c4
);

100 
	`døw_lô_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
x0
, 
y0
,

101 (
c1
 + 
c2
 + 
c3
 + 
c4
) / 4);

104 
	}
}

109 
	$w¥evõw_light_di°
(
x0
, 
y0
, 
mx
, 
my
)

111 
dx
, 
dy
;

113 
dx
 = 
mx
 - 
x0
;

114 
dx
 *= dx;

116 
dy
 = (
my
 - 
y0
) * 2;

117 
dy
 *= dy;

120  
	`˚û
(
	`sqπ
(
dx
 + 
dy
));

121 
	}
}

126 
	$qs‹t_hñ≥r_‹dî_d©a
(c⁄° *
e1
, c⁄° *
e2
)

128 
ORDER_DATA_S
 * 
o1
, * 
o2
;

130 
o1
 = (
ORDER_DATA_S
 *Ë
e1
;

131 
o2
 = (
ORDER_DATA_S
 *Ë
e2
;

134 i‡(
o1
->
height
 =
o2
->height)

135  
o1
->
idx
 - 
o2
->idx;

137  
o1
->
height
 - 
o2
->height;

138 
	}
}

143 
	$w¥evõw_døw_s
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
,

144 
£À˘ed
)

146 
BLOCK_TABLE_S
 * 
bt_±r
;

147 
BITMAP
 * 
tmp_bmp
;

148 
CELL_S_S
 * 
s_±r
;

149 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
y1
, 
cﬁ‹
;

150 
ux1
, 
ux2
, 
ux3
, 
ux4
, 
uy1
, 
uy2
, 
uy3
;

153 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

154 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
;

156 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

158 
cﬁ‹
 = -1;

159 i‡(
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[
n
] == 0)

162 i‡(
	`IS_HIDE
(
s_±r
[
n
].
Êags
))

165 
bt_idx
 = 
s_±r
[
n
].bt_idx;

167 i‡(
s_±r
[
n
].
¥›4
 & 0x80)

168 
bt_idx
 = -1;

170 i‡(
bt_idx
 == -1)

172 
ux1
 = 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

173 
ux2
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2 - 1;

174 
ux3
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

175 
ux4
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 - 1;

177 
uy1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
;

178 
uy2
 = 
uy1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2 - 1;

179 
uy3
 = 
uy1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 - 2;

181 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy1
, 168);

182 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy1
, 
ux4
, 
uy2
, 168);

183 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy3
, 
ux4
, 
uy2
, 168);

184 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy3
, 168);

186 i‡(
glb_ds1
[
ds1_idx
].
cur_zoom
 =
ZM_11
)

188 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+8, 
uy2
-2, 0,

190 
s_±r
[
n
].
¥›1
,

191 
s_±r
[
n
].
¥›2
,

192 
s_±r
[
n
].
¥›3
,

193 
s_±r
[
n
].
¥›4


195 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+7, 
uy2
-3, 255,

197 
s_±r
[
n
].
¥›1
,

198 
s_±r
[
n
].
¥›2
,

199 
s_±r
[
n
].
¥›3
,

200 
s_±r
[
n
].
¥›4


204 i‡(
bt_idx
 <= 0)

207 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

209 i‡(
bt_±r
->
ty≥
 !
BT_SHADOW
)

212 
dt1_idx
 = 
bt_±r
->dt1_idx;

213 
block_idx
 = 
bt_±r
->block_idx;

215 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

217 i‡(
tmp_bmp
 =
NULL
)

220 
y1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 -

221 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

222 
y1
 +
glb_ds1
[
ds1_idx
].
tûe_h
;

225 i‡–(
y1
 + 
tmp_bmp
->
h
) < 0)

227 i‡(
y1
 >
glb_ds1edô
.
wö_¥evõw
.
h
)

230 i‡(
£À˘ed
)

232 i‡(
	`IS_COPY_INFO
(
s_±r
[
n
].
Êags
))

234 
cﬁ‹
 = 
COL_PASTE_OK
;

235 i‡(
	`IS_COPY_STATE
(
s_±r
[
n
].
Êags
))

236 
cﬁ‹
 = 
COL_PASTE_KO
;

238 i‡(
	`IS_TMP_SELECT
(
s_±r
[
n
].
Êags
))

239 
cﬁ‹
 = 
COL_TMPSEL_M
;

240 i‡(
	`IS_SELECTED
(
s_±r
[
n
].
Êags
))

241 
cﬁ‹
 = 
COL_FLOOR_M
;

243 
cﬁ‹
 = 
COL_MOUSE
;

247 i‡(
	`IS_COPY_INFO
(
s_±r
[
n
].
Êags
))

249 
cﬁ‹
 = 
COL_PASTE_OK
;

250 i‡(
	`IS_COPY_STATE
(
s_±r
[
n
].
Êags
))

251 
cﬁ‹
 = 
COL_PASTE_KO
;

253 i‡(
	`IS_TMP_SELECT
(
s_±r
[
n
].
Êags
))

254 
cﬁ‹
 = 
COL_TMPSEL
;

255 i‡(
	`IS_SELECTED
(
s_±r
[
n
].
Êags
))

256 
cﬁ‹
 = 
COL_FLOOR
;

258 i‡((
cﬁ‹
 !-1Ë&& (
glb_ds1edô
.
mode
 !
MOD_L
))

260 
	`w¥evõw_sh≠e
(
tmp_bmp
,

261 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

262 
ds1_idx
, 
cﬁ‹
);

266 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0])

272 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
,

273 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
);

277 
	`w¥evõw_sh≠e
(
tmp_bmp
,

278 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

279 
ds1_idx
, 
COL_SHADOW
);

283 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

284 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_TRANS
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

286 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_TRANS
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

287 
	`døw_å™s_•rôe
(

288 
glb_ds1edô
.
s¸ìn_buff
,

289 
tmp_bmp
,

290 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
,

291 
y1


297 
	}
}

302 
	$w¥evõw_ªiöô_™im©ed_Êo‹
(
ds1_idx
)

304 
BLOCK_TABLE_S
 * 
bt_±r
;

305 
i
;

308 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
;

309 
i
=0; i < 
glb_ds1
[
ds1_idx
].
bt_num
; i++)

311 i‡(
bt_±r
->
ty≥
 =
BT_ANIMATED
)

312 
bt_±r
->
upd©ed
 = 
FALSE
;

313 
bt_±r
++;

315 
	}
}

320 
	$w¥evõw_døw_f
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘ed
)

322 
BLOCK_TABLE_S
 * 
bt_±r
;

323 
BITMAP
 * 
tmp_bmp
;

324 
CELL_F_S
 * 
f_±r
;

325 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
y1
, 
cﬁ‹
;

326 
ORDER_DATA_S
 
‹dî_d©a
[4];

327 
di°
, 
c1
, 
c2
, 
c3
, 
c4
;

328 
ux1
, 
ux2
, 
ux3
, 
ux4
, 
uy1
, 
uy2
, 
uy3
;

331 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

332 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
;

335 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

337 
‹dî_d©a
[
n
].
idx
 =Ç;

338 
‹dî_d©a
[
n
].
height
 = 
f_±r
[n].
¥›1
;

340 
	`qs‹t
(
‹dî_d©a
, 
glb_ds1
[
ds1_idx
].
Êo‹_num
, (
ORDER_DATA_S
),

341 
qs‹t_hñ≥r_‹dî_d©a
);

343 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

345 
cﬁ‹
 = -1;

346 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
‹dî_d©a
[
n
].
idx
] == 0)

349 i‡(
	`IS_HIDE
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

352 
bt_idx
 = 
f_±r
[
‹dî_d©a
[
n
].
idx
].bt_idx;

354 i‡(
bt_idx
 == 0)

357 i‡(
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4
 & 0x80)

358 
bt_idx
 = -1;

360 i‡(
bt_idx
 == -1)

362 
ux1
 = 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

363 
ux2
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2 - 1;

364 
ux3
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

365 
ux4
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 - 1;

367 
uy1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
;

368 
uy2
 = 
uy1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2 - 1;

369 
uy3
 = 
uy1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 - 2;

371 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy1
, 168);

372 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy1
, 
ux4
, 
uy2
, 168);

373 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy3
, 
ux4
, 
uy2
, 168);

374 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy3
, 168);

376 i‡(
glb_ds1
[
ds1_idx
].
cur_zoom
 =
ZM_11
)

378 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+8, 
uy2
-2, 0,

380 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›1
,

381 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›2
,

382 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›3
,

383 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4


385 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+7, 
uy2
-3, 255,

387 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›1
,

388 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›2
,

389 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›3
,

390 
f_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4


394 i‡(
bt_idx
 <= 0)

397 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

399 i‡–(
bt_±r
->
ty≥
 !
BT_STATIC
Ë&& (bt_±r->ty≥ !
BT_ANIMATED
) )

402 i‡(
bt_±r
->
ty≥
 =
BT_ANIMATED
)

405 i‡(
bt_±r
->
upd©ed
 =
FALSE
)

407 
bt_±r
->
cuº_‰ame
 =

408 (
glb_ds1
[
ds1_idx
].
cur_™im_Êo‹_‰ame
 / 5Ë% (
bt_±r
->
ørôy
 + 1);

409 
bt_±r
->
upd©ed
 = 
TRUE
;

411 
bt_±r
 +bt_±r->
cuº_‰ame
 - bt_±r->
ørôy
;

414 
dt1_idx
 = 
bt_±r
->dt1_idx;

415 
block_idx
 = 
bt_±r
->block_idx;

417 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

419 i‡(
tmp_bmp
 =
NULL
)

422 
y1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 -

423 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

424 i‡–(
y1
 + 
tmp_bmp
->
h
) < 0)

426 i‡(
y1
 >
glb_ds1edô
.
wö_¥evõw
.
h
)

429 i‡(
glb_ds1edô
.
mode
 =
MOD_L
)

432 
di°
 = 
	`w¥evõw_light_di°
(

433 
mx
,

434 
my
,

435 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
,

436 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y


438 i‡(
di°
 < 200)

439 
c1
 = 255;

440 i‡(
di°
 > 500)

441 
c1
 = 0;

443 
c1
 = 255 - ((
di°
 - 200) * 255 / (500 - 200));

446 
di°
 = 
	`w¥evõw_light_di°
(

447 
mx
 + 
tmp_bmp
->
w
,

448 
my
,

449 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
,

450 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y


452 i‡(
di°
 < 200)

453 
c2
 = 255;

454 i‡(
di°
 > 500)

455 
c2
 = 0;

457 
c2
 = 255 - ((
di°
 - 200) * 255 / (500 - 200));

460 
di°
 = 
	`w¥evõw_light_di°
(

461 
mx
 + 
tmp_bmp
->
w
,

462 
my
 + 
glb_ds1
[
ds1_idx
].
tûe_h
,

463 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
,

464 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y


466 i‡(
di°
 < 200)

467 
c3
 = 255;

468 i‡(
di°
 > 500)

469 
c3
 = 0;

471 
c3
 = 255 - ((
di°
 - 200) * 255 / (500 - 200));

474 
di°
 = 
	`w¥evõw_light_di°
(

475 
mx
,

476 
my
 + 
glb_ds1
[
ds1_idx
].
tûe_h
,

477 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
,

478 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y


480 i‡(
di°
 < 200)

481 
c4
 = 255;

482 i‡(
di°
 > 500)

483 
c4
 = 0;

485 
c4
 = 255 - ((
di°
 - 200) * 255 / (500 - 200));

488 
	`w¥evõw_gouøud_f
(
tmp_bmp
,

489 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

490 
ds1_idx
,

491 
c1
, 
c2
, 
c3
, 
c4
);

495 i‡(
£À˘ed
)

497 i‡(
	`IS_COPY_INFO
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

499 
cﬁ‹
 = 
COL_PASTE_OK
;

500 i‡(
	`IS_COPY_STATE
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

501 
cﬁ‹
 = 
COL_PASTE_KO
;

503 i‡(
	`IS_TMP_SELECT
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

504 
cﬁ‹
 = 
COL_TMPSEL_M
;

505 i‡(
	`IS_SELECTED
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

506 
cﬁ‹
 = 
COL_FLOOR_M
;

508 
cﬁ‹
 = 
COL_MOUSE
;

512 i‡(
	`IS_COPY_INFO
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

514 
cﬁ‹
 = 
COL_PASTE_OK
;

515 i‡(
	`IS_COPY_STATE
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

516 
cﬁ‹
 = 
COL_PASTE_KO
;

518 i‡(
	`IS_TMP_SELECT
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

519 
cﬁ‹
 = 
COL_TMPSEL
;

520 i‡(
	`IS_SELECTED
(
f_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

521 
cﬁ‹
 = 
COL_FLOOR
;

524 i‡(
cﬁ‹
 != -1)

526 
	`w¥evõw_sh≠e
(
tmp_bmp
,

527 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

528 
ds1_idx
, 
cﬁ‹
);

532 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
,

533 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
);

537 
	}
}

542 
	$w¥evõw_døw_w
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
,

543 
£À˘ed
, 
uµî
)

545 
BLOCK_TABLE_S
 * 
bt_±r
;

546 
BITMAP
 * 
tmp_bmp
;

547 
CELL_W_S
 * 
w_±r
;

548 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
m
, 
s
, 
y1
;

549 
d⁄e
, 
found
, 
o
, 
cﬁ‹
;

550 
ORDER_DATA_S
 
‹dî_d©a
[4];

551 
di°
, 
c1
=0, 
c2
=0;

552 
ux1
, 
ux2
, 
ux3
, 
ux4
, 
uy1
, 
uy2
, 
uy3
;

555 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

556 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

558 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

560 
‹dî_d©a
[
n
].
idx
 =Ç;

561 
‹dî_d©a
[
n
].
height
 = 
w_±r
[n].
¥›1
;

570 i‡(
w_±r
[
n
].
‹õ¡©i⁄
 == 10)

571 
‹dî_d©a
[
n
].
height
 = 255;

576 
	`qs‹t
(
‹dî_d©a
, 
glb_ds1
[
ds1_idx
].
wÆl_num
, (
ORDER_DATA_S
),

577 
qs‹t_hñ≥r_‹dî_d©a
);

579 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

581 
cﬁ‹
 = -1;

582 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
‹dî_d©a
[
n
].
idx
] == 0)

588 i‡(
	`IS_HIDE
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

602 
o
 = 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
;

605 i‡((
uµî
 =
TRUE
Ë&& (
o
 >= 15))

607 i‡((
uµî
 =
FALSE
Ë&& (
o
 <= 15))

614 
bt_idx
 = 
w_±r
[
‹dî_d©a
[
n
].
idx
].bt_idx;

617 i‡(
bt_idx
 == 0){

622 i‡(
glb_ds1
[
ds1_idx
].
•ecül_œyî_mask
 && ((
o
 == 10) || (o == 11))) {

627 i‡(
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4
 & 0x80)

630 i‡((
o
 != 10) && (o != 11))

631 
bt_idx
 = -1;

634 i‡(
bt_idx
 == -1)

636 
ux1
 = 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

637 
ux2
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2 - 1;

638 
ux3
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

639 
ux4
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 - 1;

641 
uy1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
;

642 
uy2
 = 
uy1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2 - 1;

643 
uy3
 = 
uy1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 - 2;

645 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy1
, 168);

646 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy1
, 
ux4
, 
uy2
, 168);

647 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy3
, 
ux4
, 
uy2
, 168);

648 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy3
, 168);

650 i‡(
glb_ds1
[
ds1_idx
].
cur_zoom
 =
ZM_11
)

652 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+8, 
uy2
-2, 0,

654 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
,

655 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›1
,

656 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›2
,

657 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›3
,

658 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4


660 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+7, 
uy2
-3, 255,

662 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
,

663 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›1
,

664 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›2
,

665 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›3
,

666 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4


673 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

675 i‡–(
bt_±r
->
ty≥
 !
BT_WALL_UP
Ë&& (bt_±r->ty≥ !
BT_WALL_DOWN
Ë&& (bt_±r->ty≥ !
BT_SPECIAL
)){

679 
dt1_idx
 = 
bt_±r
->dt1_idx;

680 
block_idx
 = 
bt_±r
->block_idx;

683 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

685 i‡(
tmp_bmp
 =
NULL
)

688 
y1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

713 
y1
 +
glb_ds1
[
ds1_idx
].
tûe_h
;

714 i‡–(
y1
 + 
tmp_bmp
->
h
) < 0)

716 i‡(
y1
 >
glb_ds1edô
.
wö_¥evõw
.
h
)

719 i‡(
glb_ds1edô
.
mode
 =
MOD_L
)

725 
di°
 = 
	`w¥evõw_light_di°
(

726 
mx
,

727 
my
 + (
glb_ds1
[
ds1_idx
].
tûe_h
 / 2),

728 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
,

729 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y


732 i‡(
di°
 < 200)

733 
c1
 = 255;

734 i‡(
di°
 > 500)

735 
c1
 = 0;

737 
c1
 = 255 - ((
di°
 - 200) * 255 / (500 - 200));

740 
di°
 = 
	`w¥evõw_light_di°
(

741 
mx
 + 
tmp_bmp
->
w
,

742 
my
 + (
glb_ds1
[
ds1_idx
].
tûe_h
 / 2),

743 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
,

744 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y


746 i‡(
di°
 < 200)

747 
c2
 = 255;

748 i‡(
di°
 > 500)

749 
c2
 = 0;

751 
c2
 = 255 - ((
di°
 - 200) * 255 / (500 - 200));

754 
	`w¥evõw_gouøud_w
(
tmp_bmp
,

755 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

756 
ds1_idx
,

757 
c1
, 
c2
, c2, c1);

760 i‡(
£À˘ed
) {

761 i‡(
	`IS_COPY_INFO
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

763 
cﬁ‹
 = 
COL_PASTE_OK
;

764 i‡(
	`IS_COPY_STATE
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

765 
cﬁ‹
 = 
COL_PASTE_KO
;

767 i‡(
	`IS_TMP_SELECT
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

768 
cﬁ‹
 = 
COL_TMPSEL_M
;

769 i‡(
	`IS_SELECTED
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

770 
cﬁ‹
 = 
COL_WALL_M
;

772 
cﬁ‹
 = 
COL_MOUSE
;

777 i‡(
	`IS_COPY_INFO
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

779 
cﬁ‹
 = 
COL_PASTE_OK
;

780 i‡(
	`IS_COPY_STATE
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

781 
cﬁ‹
 = 
COL_PASTE_KO
;

783 i‡(
	`IS_TMP_SELECT
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

784 
cﬁ‹
 = 
COL_TMPSEL
;

785 i‡(
	`IS_SELECTED
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

786 
cﬁ‹
 = 
COL_WALL
;

788 i‡(
cﬁ‹
 != -1)

789 
	`w¥evõw_sh≠e
(
tmp_bmp
,

790 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

791 
ds1_idx
, 
cﬁ‹
);

793 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
,

794 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
);

800 i‡(
bt_±r
->
‹õ¡©i⁄
 == 3)

807 
m
 = 
bt_±r
->
maö_ödex
;

808 
s
 = 
bt_±r
->
sub_ödex
;

809 
d⁄e
 = 
FALSE
;

810 
found
 = 
FALSE
;

811  ! 
d⁄e
) {

818 i‡(
bt_idx
 >
glb_ds1
[
ds1_idx
].
bt_num
){

819 
d⁄e
 = 
TRUE
;

821 
bt_±r
++;

822 i‡(
bt_±r
->
‹õ¡©i⁄
 < 4){

824 
bt_idx
++;

827 i‡(
bt_±r
->
‹õ¡©i⁄
 == 4)

828 i‡((
bt_±r
->
maö_ödex
 =
m
Ë&& (bt_±r->
sub_ödex
 =
s
))

829 
d⁄e
 = 
found
 = 
TRUE
;

834 i‡(
found
 =
TRUE
) {

835 
dt1_idx
 = 
bt_±r
->dt1_idx;

836 
block_idx
 = 
bt_±r
->block_idx;

837 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

839 i‡(
tmp_bmp
 =
NULL
) ;

841 
y1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

842 
y1
 +
glb_ds1
[
ds1_idx
].
tûe_h
;

843 i‡–(
y1
 + 
tmp_bmp
->
h
) < 0)

845 i‡(
y1
 >
glb_ds1edô
.
wö_¥evõw
.
h
)

848 i‡(
glb_ds1edô
.
mode
 =
MOD_L
)

850 
	`w¥evõw_gouøud_w
(
tmp_bmp
, 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
, 
ds1_idx
, 
c1
, 
c2
, c2, c1);

852 i‡(
cﬁ‹
 != -1){

853 
	`w¥evõw_sh≠e
(
tmp_bmp
, 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
, 
ds1_idx
, 
cﬁ‹
);

856 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
, 
mx
 - glb_ds1edô.
wö_¥evõw
.
x0
, 
y1
);

862 
	}
}

867 
	$w¥evõw_døw_r
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
,

868 
£À˘ed
)

870 
BLOCK_TABLE_S
 * 
bt_±r
;

871 
BITMAP
 * 
tmp_bmp
;

872 
CELL_W_S
 * 
r_±r
;

873 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
y1
, 
cﬁ‹
;

874 
ORDER_DATA_S
 
‹dî_d©a
[4];

877 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

878 
r_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

880 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

882 
‹dî_d©a
[
n
].
idx
 =Ç;

883 
‹dî_d©a
[
n
].
height
 = 
r_±r
[n].
¥›1
;

885 
	`qs‹t
(
‹dî_d©a
, 
glb_ds1
[
ds1_idx
].
wÆl_num
, (
ORDER_DATA_S
),

886 
qs‹t_hñ≥r_‹dî_d©a
);

888 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

890 
cﬁ‹
 = -1;

891 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
‹dî_d©a
[
n
].
idx
] == 0)

894 i‡(
	`IS_HIDE
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

897 
bt_idx
 = 
r_±r
[
‹dî_d©a
[
n
].
idx
].bt_idx;

899 i‡(
bt_idx
 <= 0)

902 i‡(
r_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4
 & 0x80)

903 
bt_idx
 = -1;

905 i‡(
bt_idx
 <= 0)

908 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

910 i‡(
bt_±r
->
ty≥
 !
BT_ROOF
)

913 
dt1_idx
 = 
bt_±r
->dt1_idx;

914 
block_idx
 = 
bt_±r
->block_idx;

916 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

918 i‡(
tmp_bmp
 =
NULL
)

921 
y1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 -

922 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

925 
y1
 -
bt_±r
->
roof_y
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

927 i‡–(
y1
 + 
tmp_bmp
->
h
) < 0)

929 i‡(
y1
 >
glb_ds1edô
.
wö_¥evõw
.
h
)

932 i‡(
glb_ds1edô
.
mode
 =
MOD_L
)

935 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

936 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][
glb_ds1
[
ds1_idx
].
a˘
 - 1];

938 
cﬁ‹_m≠
 = & 
glb_ds1edô
.
cm≠
[
CM_SHADOW
][glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

939 
	`døw_lô_•rôe
(
glb_ds1edô
.
s¸ìn_buff
,

940 
tmp_bmp
,

941 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
,

942 
y1
,

948 i‡(
£À˘ed
)

950 i‡(
	`IS_COPY_INFO
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

952 
cﬁ‹
 = 
COL_PASTE_OK
;

953 i‡(
	`IS_COPY_STATE
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

954 
cﬁ‹
 = 
COL_PASTE_KO
;

956 i‡(
	`IS_TMP_SELECT
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

957 
cﬁ‹
 = 
COL_TMPSEL_M
;

958 i‡(
	`IS_SELECTED
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

959 
cﬁ‹
 = 
COL_WALL_M
;

961 
cﬁ‹
 = 
COL_MOUSE
;

965 i‡(
	`IS_COPY_INFO
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

967 
cﬁ‹
 = 
COL_PASTE_OK
;

968 i‡(
	`IS_COPY_STATE
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

969 
cﬁ‹
 = 
COL_PASTE_KO
;

971 i‡(
	`IS_TMP_SELECT
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

972 
cﬁ‹
 = 
COL_TMPSEL
;

973 i‡(
	`IS_SELECTED
(
r_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

974 
cﬁ‹
 = 
COL_WALL
;

976 i‡(
cﬁ‹
 != -1)

977 
	`w¥evõw_sh≠e
(
tmp_bmp
,

978 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

979 
ds1_idx
, 
cﬁ‹
);

981 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
,

982 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
);

985 
	}
}

990 
	$w¥evõw_døw_•
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
,

991 
£À˘ed
)

993 
BLOCK_TABLE_S
 * 
bt_±r
;

994 
BITMAP
 * 
tmp_bmp
;

995 
CELL_W_S
 * 
w_±r
;

996 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
, 
y1
, 
o
;

997 
cﬁ‹
;

998 
ORDER_DATA_S
 
‹dî_d©a
[4];

999 
di°
, 
c1
, 
c2
;

1000 
ux1
, 
ux2
, 
ux3
, 
ux4
, 
uy1
, 
uy2
, 
uy3
;

1003 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

1004 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

1006 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

1008 
‹dî_d©a
[
n
].
idx
 =Ç;

1009 
‹dî_d©a
[
n
].
height
 = 
w_±r
[n].
¥›1
;

1010 i‡(
w_±r
[
n
].
‹õ¡©i⁄
 == 10)

1011 
‹dî_d©a
[
n
].
height
 = 255;

1013 
	`qs‹t
(
‹dî_d©a
, 
glb_ds1
[
ds1_idx
].
wÆl_num
, (
ORDER_DATA_S
),

1014 
qs‹t_hñ≥r_‹dî_d©a
);

1016 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

1018 
cﬁ‹
 = -1;

1019 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
‹dî_d©a
[
n
].
idx
] == 0)

1022 i‡(
	`IS_HIDE
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1025 
bt_idx
 = 
w_±r
[
‹dî_d©a
[
n
].
idx
].bt_idx;

1027 i‡(
bt_idx
 == 0)

1030 
o
 = 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
;

1032 i‡((
o
 != 10) && (o != 11))

1041 i‡(
bt_idx
 <= 0)

1044 
ux1
 = 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1045 
ux2
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2 - 1;

1046 
ux3
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

1047 
ux4
 = 
ux1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 - 1;

1049 
uy1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
;

1050 
uy2
 = 
uy1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2 - 1;

1051 
uy3
 = 
uy1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 - 2;

1053 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy1
, 168);

1054 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy1
, 
ux4
, 
uy2
, 168);

1055 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux3
, 
uy3
, 
ux4
, 
uy2
, 168);

1056 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
ux1
, 
uy2
, 
ux2
, 
uy3
, 168);

1058 i‡(
glb_ds1
[
ds1_idx
].
cur_zoom
 =
ZM_11
)

1060 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+8, 
uy2
-2, 0,

1062 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
,

1063 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›1
,

1064 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›2
,

1065 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›3
,

1066 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4


1068 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
ux1
+7, 
uy2
-3, 255,

1070 
w_±r
[
‹dî_d©a
[
n
].
idx
].
‹õ¡©i⁄
,

1071 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›1
,

1072 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›2
,

1073 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›3
,

1074 
w_±r
[
‹dî_d©a
[
n
].
idx
].
¥›4


1081 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

1082 
dt1_idx
 = 
bt_±r
->dt1_idx;

1083 
block_idx
 = 
bt_±r
->block_idx;

1085 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

1087 i‡(
tmp_bmp
 =
NULL
)

1090 
y1
 = 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 -

1091 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

1092 
y1
 +
glb_ds1
[
ds1_idx
].
tûe_h
;

1093 i‡–(
y1
 + 
tmp_bmp
->
h
) < 0)

1095 i‡(
y1
 >
glb_ds1edô
.
wö_¥evõw
.
h
)

1098 i‡(
glb_ds1edô
.
mode
 =
MOD_L
)

1101 
di°
 = 
	`w¥evõw_light_di°
(

1102 
mx
,

1103 
my
 + (
glb_ds1
[
ds1_idx
].
tûe_h
 / 2),

1104 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
,

1105 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y


1107 i‡(
di°
 < 200)

1108 
c1
 = 255;

1109 i‡(
di°
 > 500)

1110 
c1
 = 0;

1112 
c1
 = 255 - ((
di°
 - 200) * 255 / (500 - 200));

1115 
di°
 = 
	`w¥evõw_light_di°
(

1116 
mx
 + 
tmp_bmp
->
w
,

1117 
my
 + (
glb_ds1
[
ds1_idx
].
tûe_h
 / 2),

1118 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
,

1119 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y


1121 i‡(
di°
 < 200)

1122 
c2
 = 255;

1123 i‡(
di°
 > 500)

1124 
c2
 = 0;

1126 
c2
 = 255 - ((
di°
 - 200) * 255 / (500 - 200));

1129 
	`w¥evõw_gouøud_w
(
tmp_bmp
,

1130 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

1131 
ds1_idx
,

1132 
c1
, 
c2
, c2, c1);

1136 i‡(
£À˘ed
)

1138 i‡(
	`IS_COPY_INFO
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1140 
cﬁ‹
 = 
COL_PASTE_OK
;

1141 i‡(
	`IS_COPY_STATE
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1142 
cﬁ‹
 = 
COL_PASTE_KO
;

1144 i‡(
	`IS_TMP_SELECT
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1145 
cﬁ‹
 = 
COL_TMPSEL_M
;

1146 i‡(
	`IS_SELECTED
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1147 
cﬁ‹
 = 
COL_WALL_M
;

1149 
cﬁ‹
 = 
COL_MOUSE
;

1153 i‡(
	`IS_COPY_INFO
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1155 
cﬁ‹
 = 
COL_PASTE_OK
;

1156 i‡(
	`IS_COPY_STATE
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1157 
cﬁ‹
 = 
COL_PASTE_KO
;

1159 i‡(
	`IS_TMP_SELECT
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1160 
cﬁ‹
 = 
COL_TMPSEL
;

1161 i‡(
	`IS_SELECTED
(
w_±r
[
‹dî_d©a
[
n
].
idx
].
Êags
))

1162 
cﬁ‹
 = 
COL_WALL
;

1164 i‡(
cﬁ‹
 != -1)

1165 
	`w¥evõw_sh≠e
(
tmp_bmp
,

1166 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
,

1167 
ds1_idx
, 
cﬁ‹
);

1169 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
tmp_bmp
,

1170 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
, 
y1
);

1173 
	}
}

1178 
	$co‹d_to_tûe
(
ds1_idx
, 
ax
, 
ay
, * 
œyî_x
, * 
œyî_y
)

1180 
bx
, 
by
, 
cx
, 
cy
, 
rx
, 
ry
;

1183 i‡–(
glb_ds1edô
.
mode
 =
MOD_O
) ||

1184 (
glb_ds1edô
.
mode
 =
MOD_P
) ||

1185 (
glb_ds1edô
.
mode
 =
MOD_L
) )

1187 
ax
 *= 5;

1188 
ay
 *= 5;

1192 i‡(
ax
 < 0)

1193 
ax
 -
glb_ds1
[
ds1_idx
].
tûe_w
;

1194 i‡(
ay
 < 0)

1195 
ay
 -
glb_ds1
[
ds1_idx
].
tûe_h
;

1198 
bx
 = 
ax
 / 
glb_ds1
[
ds1_idx
].
tûe_w
;

1199 
by
 = 
ay
 / 
glb_ds1
[
ds1_idx
].
tûe_h
;

1200 
cx
 = 
bx
 + 
by
;

1201 
cy
 = -
bx
 + 
by
;

1204 
rx
 = 
ax
 % 
glb_ds1
[
ds1_idx
].
tûe_w
;

1205 
ry
 = 
ay
 % 
glb_ds1
[
ds1_idx
].
tûe_h
;

1206 i‡(
ax
 < 0Ë
rx
 = 
glb_ds1
[
ds1_idx
].
tûe_w
 +Ñx;

1207 i‡(
ay
 < 0Ë
ry
 = 
glb_ds1
[
ds1_idx
].
tûe_h
 +Ñy;

1209 i‡(
ry
 >-
rx
 / 2 + 
glb_ds1
[
ds1_idx
].
tûe_w
/2 + glb_ds1[ds1_idx].
tûe_h
/2Ë
cx
++;

1210 i‡(
ry
 < -
rx
 / 2 + 
glb_ds1
[
ds1_idx
].
tûe_h
/2Ë
cx
--;

1211 i‡(
glb_ds1
[
ds1_idx
].
tûe_w
/2 - 
ry
 >=

1212 -
rx
 / 2 + 
glb_ds1
[
ds1_idx
].
tûe_w
/2 + glb_ds1[ds1_idx].
tûe_h
/2Ë
cy
--;

1213 i‡(
glb_ds1
[
ds1_idx
].
tûe_w
/2 - 
ry
 < -
rx
 / 2 + glb_ds1[ds1_idx].
tûe_h
/2Ë
cy
++;

1216 * 
œyî_x
 = 
cx
;

1217 * 
œyî_y
 = 
cy
;

1218 
	}
}

1223 
	$mou£_to_tûe
(
ds1_idx
, * 
œyî_x
, * 
œyî_y
)

1225 
ax
, 
ay
;

1228 
ax
 = 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
mou£_x
;

1229 
ay
 = 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
mou£_y
;

1231 
	`co‹d_to_tûe
(
ds1_idx
, 
ax
, 
ay
, 
œyî_x
, 
œyî_y
);

1232 
	}
}

1237 
	$ch™ge_zoom
(
ds1_idx
, 
ZOOM_E
 
z
)

1239 
mul
, 
div
, 
dx
, 
dy
, 
cx
, 
cy
;

1241 i‡(
z
 < 
ZM_11
){

1242 
z
 = 
ZM_11
;

1243 }i‡(
z
 > 
ZM_116
){

1244 
z
 = 
ZM_116
;

1247 
dx
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 + glb_ds1[ds1_idx].own_w¥evõw.
w
 / 2;

1248 
dy
 = 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 + glb_ds1[ds1_idx].own_w¥evõw.
h
 / 2;

1251 
	`co‹d_to_tûe
(
ds1_idx
, 
dx
, 
dy
, &
cx
, &
cy
);

1252 
cx
++;

1254 
z
){

1255 
ZM_11
 : 
mul
 = 1, 
div
 = 1; ;

1256 
ZM_12
 : 
mul
 = 1, 
div
 = 2; ;

1257 
ZM_14
 : 
mul
 = 1, 
div
 = 4; ;

1258 
ZM_18
 : 
mul
 = 1, 
div
 = 8; ;

1259 
ZM_116
 : 
mul
 = 1, 
div
 = 16; ;

1260  : 
mul
 = 1, 
div
 = 1; ;

1263 
glb_ds1
[
ds1_idx
].
cur_zoom
 = 
z
;

1264 
glb_ds1
[
ds1_idx
].
height_mul
 = 
mul
;

1265 
glb_ds1
[
ds1_idx
].
height_div
 = 
div
;

1266 
glb_ds1
[
ds1_idx
].
tûe_w
 = 160 * 
mul
 / 
div
;

1267 
glb_ds1
[
ds1_idx
].
tûe_h
 = 80 * 
mul
 / 
div
;

1268 i‡(
glb_c⁄fig
.
lowî_•ìd_zoom_out
){

1269 
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
x
 = 
glb_c⁄fig
.
s¸ﬁl
.keyb.x * 
mul
 / 
div
;

1270 
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
keyb
.
y
 = 
glb_c⁄fig
.
s¸ﬁl
.keyb.y * 
mul
 / 
div
;

1271 
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
x
 = 
glb_c⁄fig
.
s¸ﬁl
.mou£.x * 
mul
 / 
div
;

1272 
glb_ds1
[
ds1_idx
].
cur_s¸ﬁl
.
mou£
.
y
 = 
glb_c⁄fig
.
s¸ﬁl
.mou£.y * 
mul
 / 
div
;

1275 i‡(
glb_ds1edô
.
mode
 =
MOD_T
){

1277 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 2);

1278 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 2);

1282 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 10);

1283 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 10);

1286 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
x0
 = 
dx
 - glb_ds1[ds1_idx].own_w¥evõw.
w
 / 2;

1287 
glb_ds1
[
ds1_idx
].
own_w¥evõw
.
y0
 = 
dy
 - glb_ds1[ds1_idx].own_w¥evõw.
h
 / 2;

1288 
	}
}

1293 
	$w¥evõw_døw_∑ths
(
ds1_idx
)

1295 
x
, 
y
, 
dx
, 
dy
, 
o
, 
p
, 
x1
, 
y1
, 
x2
, 
y2
, 
cﬁ‹1
, 
cﬁ‹2
;

1297 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

1299 i‡(
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
 == 0)

1303 i‡(
	`IS_SELECTED
(
glb_ds1
[
ds1_idx
].
obj
[
o
].
Êags
Ë|| IS_SELECTED(glb_ds1[ds1_idx].obj[o].
œbñ
.flags))

1305 
cﬁ‹1
 = 255;

1306 
cﬁ‹2
 = 10;

1310 
cﬁ‹1
 = 219;

1311 
cﬁ‹2
 = 155;

1316 i‡(
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
)

1319 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].x;

1320 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].y;

1322 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1323 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1325 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1326 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 1;

1329 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[0].x;

1330 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[0].y;

1332 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1333 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1335 
x2
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1336 
y2
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 1;

1339 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
+1, 
y1
+1, 
x2
+1, 
y2
+1, 0);

1340 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
cﬁ‹1
);

1344 
p
=0;Ö < 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
;Ö++)

1347 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].x;

1348 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].y;

1350 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1351 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1353 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1354 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 1;

1357 i‡(
p
 =
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
 - 1)

1359 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[0].x;

1360 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[0].y;

1364 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
 + 1].x;

1365 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
 + 1].y;

1368 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1369 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1371 
x2
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1372 
y2
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 1;

1375 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
+1, 
y1
+1, 
x2
+1, 
y2
+1, 0);

1376 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
cﬁ‹2
);

1379 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, x1+2, y1+2, 0);

1380 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
-1, 
y1
-1, x1+1, y1+1, 157);

1383 
	}
}

1388 
	$w¥evõw_døw_∑ths_1obj
(
ds1_idx
, 
o
)

1390 
x
, 
y
, 
dx
, 
dy
, 
p
, 
x1
, 
y1
, 
x2
, 
y2
, 
cﬁ‹
;

1393 i‡((
o
 < 0Ë|| (ÿ>
glb_ds1
[
ds1_idx
].
cuºít_obj_max
))

1396 i‡(
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
 == 0)

1400 i‡(
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
)

1403 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].x;

1404 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].y;

1406 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1407 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1409 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1410 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 1;

1413 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[0].x;

1414 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[0].y;

1416 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1417 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1419 
x2
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1420 
y2
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 1;

1423 
cﬁ‹
 = 219;

1424 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
+1, 
y1
+1, 
x2
+1, 
y2
+1, 0);

1425 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
cﬁ‹
);

1429 
p
=0;Ö < 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
;Ö++)

1432 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].x;

1433 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
].y;

1435 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1436 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1438 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1439 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 1;

1442 i‡(
p
 =
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th_num
 - 1)

1444 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[0].x;

1445 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[0].y;

1449 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
 + 1].x;

1450 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
∑th
[
p
 + 1].y;

1453 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1454 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1456 
x2
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

1457 
y2
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 1;

1460 
cﬁ‹
 = 155;

1461 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
+1, 
y1
+1, 
x2
+1, 
y2
+1, 0);

1462 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
cﬁ‹
);

1465 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, x1+2, y1+2, 0);

1466 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
-1, 
y1
-1, x1+1, y1+1, 157);

1468 
	}
}

1472 
	$w¥evõw_obj_™im©e
()

1474 
TXT_S
 * 
txt
 = 
glb_ds1edô
.
obj_buff
;

1475 
COF_S
 * 
cof
;

1476 
o
;

1477 
n
, 
nb_ticks
 = 
glb_ds1edô
.
ticks_ñ≠£d
;

1480 
glb_ds1edô
.
ticks_ñ≠£d
 = 0;

1482 i‡(
txt
 =
NULL
)

1486 
o
=0; o < 
txt
->
löe_num
; o++)

1488 i‡(
glb_ds1edô
.
obj_desc
[
o
].
ußge_cou¡
)

1490 
cof
 = 
glb_ds1edô
.
obj_desc
[
o
].cof;

1491 i‡(
cof
 =
NULL
)

1493 i‡(
cof
->
Âd
 == 0)

1495 i‡(
cof
->
•d_div
 == 0)

1552 
n
 = 
nb_ticks
 * 
cof
->
•d_mul
 + cof->
•d_mod
;

1553 
cof
->
cur_‰ame
 +
n
 / cof->
•d_div
;

1555 
cof
->
•d_mod
 = 
n
 % cof->
•d_div
;

1557 
cof
->
cur_‰ame
 >cof->
Âd
)

1558 
cof
->
cur_‰ame
 -cof->
Âd
;

1561 
	}
}

1566 
	$w¥evõw_døw_obje˘s
(
ds1_idx
)

1568 
dx
, 
dy
, 
o
, 
x1
, 
y1
, 
d
;

1569 
ty≥
, 
id
, 
x
, 
y
;

1572 
o
=0; o < 
glb_ds1
[
ds1_idx
].
obj_num
; o++)

1574 
ty≥
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].type;

1575 
id
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].id;

1576 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].x;

1577 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].y;

1578 
d
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
;

1580 
dx
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1581 
dy
 = ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1583 i‡(
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
 =
OL_DESC
)

1586 i‡(
d
 != -1)

1588 i‡(
glb_ds1edô
.
obj_desc
[
d
].
desc
[0] == '?')

1589 
d
 = -1;

1593 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
 -

1594 (8 * 
	`°æí
(
glb_ds1edô
.
obj_desc
[
d
].
desc
) / 2);

1595 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 4;

1597 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
+1, 
y1
+1, 0, "%s",

1598 
glb_ds1edô
.
obj_desc
[
d
].
desc
);

1600 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 255, "%s",

1601 
glb_ds1edô
.
obj_desc
[
d
].
desc
);

1606 i‡((
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
 =
OL_TYPEID
Ë|| (
d
 == -1))

1609 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
 - 20;

1610 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 4;

1612 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
+1, 
y1
+1, 0, "%i,%3i",

1613 
glb_ds1
[
ds1_idx
].
obj
[
o
].
ty≥
, glb_ds1[ds1_idx].obj[o].
id
);

1615 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
, 
y1
, 11, "%i",

1616 
glb_ds1
[
ds1_idx
].
obj
[
o
].
ty≥
);

1618 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
x1
+8, 
y1
, 255, ",%3i",

1619 
glb_ds1
[
ds1_idx
].
obj
[
o
].
id
);

1622 
	}
}

1627 
	$w¥evõw_døw_sim∂e_wi
(
mx
, 
my
, 
z
, 
UBYTE
 * 
wÆköfo
)

1629 
i
;

1631 
i
=0; i<25; i++)

1633 i‡(
wÆköfo
[
i
] & 0x04)

1635 
	`døw_æe_•rôe
(
glb_ds1edô
.
s¸ìn_buff
,

1636 
glb_ds1edô
.
subtûe_nojump
[
z
][
i
],

1637 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
,

1638 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0


1641 i‡(
wÆköfo
[
i
] & 0x09)

1643 
	`døw_æe_•rôe
(
glb_ds1edô
.
s¸ìn_buff
,

1644 
glb_ds1edô
.
subtûe_nowÆk
[
z
][
i
],

1645 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
,

1646 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0


1650 
	}
}

1655 
	$w¥evõw_døw_wi
(
mx
, 
my
, 
z
, 
UBYTE
 * 
wÆköfo
)

1657 
i
;

1659 
i
=0; i<25; i++)

1661 i‡(
wÆköfo
[
i
])

1663 
	`døw_æe_•rôe
(

1664 
glb_ds1edô
.
s¸ìn_buff
,

1665 
glb_ds1edô
.
subtûe_Êag_combö©i⁄
[
wÆköfo
[
i
]][
z
][i],

1666 
mx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
,

1667 
my
 - 
glb_ds1edô
.
wö_¥evõw
.
y0


1671 
	}
}

1675 
	$w¥evõw_døw_™_obje˘
(
ds1_idx
, 
o
)

1677 
COF_S
 * 
cof
;

1678 
LAY_INF_S
 * 
œy
;

1679 
BITMAP
 ** 
bmp_±r
, * 
bmp
;

1680 
c
, 
f
, 
x
, 
y
, 
d
, 
dx0
, 
dy0
, 
dx
, 
dy
, 
p
, 
cﬁ_bœck
, 
cﬁ_whôe
;

1681 
UBYTE
 * 
b±r
;

1682 
UBYTE
 
√w_‰ame
;

1685 
d
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
;

1687 i‡(
d
 == -1)

1690 i‡(
glb_ds1edô
.
obj_desc
[
d
].
ußge_cou¡
 == 0)

1693 
cof
 = 
glb_ds1edô
.
obj_desc
[
d
].cof;

1694 i‡(
cof
 =
NULL
)

1696 i‡(
cof
->
Âd
 == 0)

1701 
√w_‰ame
 = 
cof
->
cur_‰ame
 + 
glb_ds1
[
ds1_idx
].
obj
[
o
].
‰ame_dñè
;

1702 
√w_‰ame
 >
cof
->
Âd
)

1703 
√w_‰ame
 -
cof
->
Âd
;

1705 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].x;

1706 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].y;

1707 
dx0
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1708 
dy0
 = 4 + ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1710 
cﬁ_bœck
 = 
	`makecﬁ
( 0, 0, 0);

1711 
cﬁ_whôe
 = 
	`makecﬁ
(255, 255, 255);

1714 
c
=0; c < 
cof
->
œy
; c++)

1716 
p
 = (
cof
->
cur_dú
 * cof->
œy
 * cof->
Âd
);

1717 
p
 +
c
 + (
√w_‰ame
 * 
cof
->
œy
);

1718 
p
 = 
cof
->
¥i‹ôy
[p];

1719 i‡(
p
 >
COMPOSIT_NB
)

1722 
œy
 = & 
cof
->
œy_öf
[
p
];

1723 i‡(
œy
 =
NULL
)

1725 
bmp_±r
 = 
œy
->
bmp
;

1726 i‡(
bmp_±r
 =
NULL
)

1728 i‡(
√w_‰ame
 >
œy
->
bmp_num
)

1729 
f
 = 
œy
->
œ°_good_‰ame
;

1731 
f
 = 
√w_‰ame
;

1732 
bmp
 = 
bmp_±r
[
f
];

1733 i‡(
bmp
 =
NULL
)

1735 
dx
 = 
dx0
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
cof
->
xoff£t
 + 
œy
->
off_x
;

1736 
dy
 = 
dy0
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
cof
->
yoff£t
 + 
œy
->
off_y
;

1737 i‡(((
dx
 + 
bmp
->
w
Ë< 0Ë|| ((
dy
 + bmp->
h
) < 0))

1739 i‡–(
dx
 >
glb_ds1edô
.
wö_¥evõw
.
w
Ë|| (
dy
 >glb_ds1edô.wö_¥evõw.
h
))

1742 i‡((
glb_ds1
[
ds1_idx
].
cur_zoom
 =
ZM_11
Ë|| (
glb_c⁄fig
.
°ªtch_•rôes
 !
TRUE
))

1745 i‡((
œy
->
å™s_a
Ë&& (œy->
å™s_b
 <= 6) && (lay->trans_b != 5))

1748 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

1749 
b±r
 = 
glb_ds1edô
.
d2_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1];

1751 
b±r
 = 
glb_ds1edô
.
d2_∑l
[glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

1752 
œy
->
å™s_b
)

1754 0 : 
b±r
 +(256 * 
COF_75TRANS
); ;

1755 1 : 
b±r
 +(256 * 
COF_50TRANS
); ;

1756 2 : 
b±r
 +(256 * 
COF_25TRANS
); ;

1757 3 : 
b±r
 +(256 * 
COF_ALPHA
); ;

1758 4 : 
b±r
 +(256 * 
COF_LUMINANCE
); ;

1759 6 : 
b±r
 +(256 * 
COF_ALPHABRIGHT
); ;

1761 
cﬁ‹_m≠
 = (
COLOR_MAP
 *Ë
b±r
;

1762 
	`døw_å™s_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
bmp
, 
dx
, 
dy
);

1767 
	`døw_•rôe
(
glb_ds1edô
.
s¸ìn_buff
, 
bmp
, 
dx
, 
dy
);

1773 
dx
 = 
dx0
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
 + (
cof
->
xoff£t
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
Ë+ (
œy
->
off_x
 * glb_ds1[ds1_idx].height_mul / glb_ds1[ds1_idx].height_div);

1775 
dy
 = 
dy0
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 + (
cof
->
yoff£t
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
Ë+ (
œy
->
off_y
 * glb_ds1[ds1_idx].height_mul / glb_ds1[ds1_idx].height_div);

1777 i‡((
œy
->
å™s_a
Ë&& (œy->
å™s_b
 <= 6) && (lay->trans_b != 5)){

1779 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1){

1780 
b±r
 = 
glb_ds1edô
.
d2_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1];

1782 
b±r
 = 
glb_ds1edô
.
d2_∑l
[glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

1784 
œy
->
å™s_b
)

1786 0 : 
b±r
 +(256 * 
COF_75TRANS
); ;

1787 1 : 
b±r
 +(256 * 
COF_50TRANS
); ;

1788 2 : 
b±r
 +(256 * 
COF_25TRANS
); ;

1789 3 : 
b±r
 +(256 * 
COF_ALPHA
); ;

1790 4 : 
b±r
 +(256 * 
COF_LUMINANCE
); ;

1791 6 : 
b±r
 +(256 * 
COF_ALPHABRIGHT
); ;

1793 
cﬁ‹_m≠
 = (
COLOR_MAP
 *Ë
b±r
;

1798 
cﬁ‹_m≠
 = 
NULL
;

1801 
	`°ªtch_å™s_•rôe_8bµ
(

1802 
glb_ds1edô
.
s¸ìn_buff
,

1803 
bmp
,

1804 
dx
,

1805 
dy
,

1806 
glb_ds1
[
ds1_idx
].
height_div


1811 i‡(
√w_‰ame
 < 
œy
->
bmp_num
)

1812 
œy
->
œ°_good_‰ame
 = 
f
;

1816 i‡(
glb_ds1edô
.
mode
 =
MOD_O
)

1820 i‡(
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
 =
OL_SPEED
)

1822 
dx
 = 
dx0
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
 - 44;

1823 
dy
 = 
dy0
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 - 8;

1825 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
dx
+1, 
dy
+1, 
cﬁ_bœck
,

1826 "•ìd = %3li", 
cof
->
•d_mul
);

1828 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
dx
, 
dy
, 
cﬁ_whôe
,

1829 "•ìd = %3li", 
cof
->
•d_mul
);

1831 
	}
}

1835 
	$w¥evõw_døw_™_obje˘_shad
(
ds1_idx
, 
o
)

1837 
COF_S
 * 
cof
;

1838 
LAY_INF_S
 * 
œy
;

1839 
BITMAP
 ** 
bmp_±r
, * 
bmp
;

1840 
c
, 
f
, 
x
, 
y
, 
d
, 
dx0
, 
dy0
, 
dx
, 
dy
, 
p
, 
offx
, 
offy
;

1841 
UBYTE
 * 
b±r
;

1842 
UBYTE
 
√w_‰ame
;

1844 
d
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
;

1846 i‡(
d
 == -1)

1849 i‡(
glb_ds1edô
.
obj_desc
[
d
].
ußge_cou¡
 == 0)

1852 
cof
 = 
glb_ds1edô
.
obj_desc
[
d
].cof;

1853 i‡(
cof
 =
NULL
)

1855 i‡(
cof
->
Âd
 == 0)

1858 
√w_‰ame
 = 
cof
->
cur_‰ame
 + 
glb_ds1
[
ds1_idx
].
obj
[
o
].
‰ame_dñè
;

1859 
√w_‰ame
 >
cof
->
Âd
)

1860 
√w_‰ame
 -
cof
->
Âd
;

1862 
x
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].x;

1863 
y
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].y;

1865 
dx0
 = ((
y
-2Ë* -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_w / 10);

1866 
dy0
 = 4 + ((
y
-2Ë* 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ ((
x
+3) * glb_ds1[ds1_idx].tile_h / 10);

1869 
c
=0; c < 
cof
->
œy
; c++)

1871 
p
 = (
cof
->
cur_dú
 * cof->
œy
 * cof->
Âd
);

1872 
p
 +
c
 + (
√w_‰ame
 * 
cof
->
œy
);

1873 
p
 = 
cof
->
¥i‹ôy
[p];

1874 i‡(
p
 >
COMPOSIT_NB
)

1877 
œy
 = & 
cof
->
œy_öf
[
p
];

1878 i‡(
œy
 =
NULL
)

1882 i‡(
œy
->
shad_a
 == 0)

1885 
bmp_±r
 = 
œy
->
bmp
;

1886 i‡(
bmp_±r
 =
NULL
)

1888 i‡(
√w_‰ame
 >
œy
->
bmp_num
)

1889 
f
 = 
œy
->
œ°_good_‰ame
;

1891 
f
 = 
√w_‰ame
;

1892 
bmp
 = 
bmp_±r
[
f
];

1893 i‡(
bmp
 =
NULL
)

1895 
dx
 = 
dx0
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
cof
->
xoff£t
 + 
œy
->
off_x
;

1896 
dy
 = 
dy0
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
cof
->
yoff£t
 + 
œy
->
off_y
;

1897 i‡(((
dx
 + 
bmp
->
w
Ë< 0Ë|| ((
dy
 + bmp->
h
) < 0))

1899 i‡–(
dx
 >
glb_ds1edô
.
wö_¥evõw
.
w
) ||

1900 (
dy
 >
glb_ds1edô
.
wö_¥evõw
.
h
))

1905 i‡(
œy
->
å™s_a
)

1908 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

1909 
b±r
 = 
glb_ds1edô
.
d2_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1];

1911 
b±r
 = 
glb_ds1edô
.
d2_∑l
[glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

1912 
b±r
 += (256 * 32);

1917 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

1918 
b±r
 = 
glb_ds1edô
.
d2_∑l
[
glb_ds1
[
ds1_idx
].
a˘
 - 1];

1920 
b±r
 = 
glb_ds1edô
.
d2_∑l
[glb_ds1edô.
cmd_löe
.
f‹˚_∑l_num
 - 1];

1921 
b±r
 += (256 * 14);

1924 i‡((
glb_ds1
[
ds1_idx
].
cur_zoom
 =
ZM_11
Ë|| (
glb_c⁄fig
.
°ªtch_•rôes
 !
TRUE
))

1926 
offx
 = 
cof
->
xoff£t
 + 
œy
->
off_x
;

1927 
offy
 = 
cof
->
yoff£t
 + 
œy
->
off_y
;

1929 
dx
 = 
dx0
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
offx
;

1930 
dy
 = 
dy0
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
offy
;

1932 
	`°ªtch_å™s_shadow_8bµ
(

1933 
glb_ds1edô
.
s¸ìn_buff
,

1934 
bmp
,

1935 
dx
,

1936 
dy
,

1938 
b±r
,

1939 
dy0
 - 
glb_ds1edô
.
wö_¥evõw
.
y0


1944 
offx
 = (
cof
->
xoff£t
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
) +

1945 (
œy
->
off_x
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
);

1947 
offy
 = (
cof
->
yoff£t
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
) +

1948 (
œy
->
off_y
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
);

1950 
dx
 = 
dx0
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
 + 
offx
;

1951 
dy
 = 
dy0
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
 + 
offy
;

1953 
	`°ªtch_å™s_shadow_8bµ
(

1954 
glb_ds1edô
.
s¸ìn_buff
,

1955 
bmp
,

1956 
dx
,

1957 
dy
,

1958 
glb_ds1
[
ds1_idx
].
height_div
,

1959 
b±r
,

1960 
dy0
 - 
glb_ds1edô
.
wö_¥evõw
.
y0


1964 
	}
}

1968 
	$w¥evõw_døw_obj_tûe_shad
(
ds1_idx
, 
x
, 
y
, * 
cur_idx
)

1970 
OBJ_S
 * 
obj
;

1971 
o
;

1975 i‡((* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
)

1979 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

1980 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

1981 
obj
->
ty
 < 
y
)

1983 (* 
cur_idx
) ++;

1984 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
 )

1986 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

1987 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

1989 i‡(
obj
->
ty
 =
y
)

1991 
obj
->
tx
 < 
x
)

1993 (* 
cur_idx
) ++;

1994 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
 )

1996 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

1997 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2006 i‡((
obj
->
tx
 =
x
Ë&& (obj->
ty
 =
y
))

2009 
	`w¥evõw_døw_™_obje˘_shad
(
ds1_idx
, 
o
);

2012 (* 
cur_idx
) ++;

2013 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
)

2015 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2016 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2021 
	}
}

2025 
	$w¥evõw_døw_obj_tûe_0_2
(
ds1_idx
, 
x
, 
y
, * 
cur_idx
)

2027 
OBJ_S
 * 
obj
;

2028 
o
, 
d
;

2029 
COF_S
 * 
cof
;

2033 i‡((* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
)

2037 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2038 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2039 
obj
->
ty
 < 
y
)

2041 (* 
cur_idx
) ++;

2042 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
 )

2044 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2045 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2047 i‡(
obj
->
ty
 =
y
)

2049 
obj
->
tx
 < 
x
)

2051 (* 
cur_idx
) ++;

2052 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
 )

2054 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2055 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2064 i‡((
obj
->
tx
 =
x
Ë&& (obj->
ty
 =
y
))

2067 
d
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
;

2068 i‡(
d
 != -1)

2070 i‡(
glb_ds1edô
.
obj_desc
[
d
].
ußge_cou¡
)

2072 
cof
 = 
glb_ds1edô
.
obj_desc
[
d
].cof;

2073 i‡(
cof
 !
NULL
)

2075 i‡((
cof
->
‹dîÊag
 == 0) || (cof->orderflag == 2))

2076 
	`w¥evõw_døw_™_obje˘
(
ds1_idx
, 
o
);

2082 (* 
cur_idx
) ++;

2083 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
)

2085 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2086 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2091 
	}
}

2095 
	$w¥evõw_døw_obj_tûe_1
(
ds1_idx
, 
x
, 
y
, * 
cur_idx
)

2097 
OBJ_S
 * 
obj
;

2098 
o
, 
d
;

2099 
COF_S
 * 
cof
;

2103 i‡((* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
)

2107 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2108 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2109 
obj
->
ty
 < 
y
)

2111 (* 
cur_idx
) ++;

2112 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
 )

2114 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2115 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2117 i‡(
obj
->
ty
 =
y
)

2119 
obj
->
tx
 < 
x
)

2121 (* 
cur_idx
) ++;

2122 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
 )

2124 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2125 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2134 i‡((
obj
->
tx
 =
x
Ë&& (obj->
ty
 =
y
))

2137 
d
 = 
glb_ds1
[
ds1_idx
].
obj
[
o
].
desc_idx
;

2138 i‡(
d
 != -1)

2140 i‡(
glb_ds1edô
.
obj_desc
[
d
].
ußge_cou¡
)

2142 
cof
 = 
glb_ds1edô
.
obj_desc
[
d
].cof;

2143 i‡(
cof
 !
NULL
)

2145 i‡(
cof
->
‹dîÊag
 == 1)

2146 
	`w¥evõw_døw_™_obje˘
(
ds1_idx
, 
o
);

2152 (* 
cur_idx
) ++;

2153 i‡–(* 
cur_idx
Ë>
glb_ds1
[
ds1_idx
].
obj_num
)

2155 
o
 = 
glb_ds1
[
ds1_idx
].
døwög_‹dî
[* 
cur_idx
];

2156 
obj
 = & 
glb_ds1
[
ds1_idx
].obj[
o
];

2161 
	}
}

2166 
	$w¥evõw_døw_tûe_grid
(
ds1_idx
)

2168 
tw
, 
th
, 
dw
, 
dh
, 
px
, 
py
, 
ba£_x
, 
ba£_y
, 
mx
, 
my
, 
c
, 
i
, 
x1
, 
y1
, 
x2
, 
y2
;

2169 
mö_x
, 
mö_y
, 
max_x
, 
max_y
, 
dummy
;

2172 
tw
 = 
glb_ds1
[
ds1_idx
].
tûe_w
;

2173 
th
 = 
glb_ds1
[
ds1_idx
].
tûe_h
;

2174 
dw
 = 
glb_ds1
[
ds1_idx
].
width
;

2175 
dh
 = 
glb_ds1
[
ds1_idx
].
height
;

2176 
px
 = 
glb_ds1edô
.
wö_¥evõw
.
x0
;

2177 
py
 = 
glb_ds1edô
.
wö_¥evõw
.
y0
;

2178 
c
 = 
	`makecﬁ
(255, 255, 255);

2180 
ba£_x
 = 
tw
/2 - 
px
 - 1;

2181 
ba£_y
 = - 
py
 - 1;

2182 
mx
 = 
ba£_x
 - (
tw
 * 
dh
 / 2);

2183 
my
 = 
ba£_y
 + (
th
 * 
dh
 / 2);

2185 
x1
 = 
px
;

2186 
y1
 = 
py
;

2187 
	`co‹d_to_tûe
(
ds1_idx
, 
x1
, 
y1
, & 
mö_x
, & 
dummy
);

2189 
x1
 = 
px
 + 
glb_c⁄fig
.
s¸ìn
.
width
;

2190 
	`co‹d_to_tûe
(
ds1_idx
, 
x1
, 
y1
, & 
dummy
, & 
mö_y
);

2192 
x1
 = 
px
;

2193 
y1
 = 
py
 + 
glb_c⁄fig
.
s¸ìn
.
height
;

2194 
	`co‹d_to_tûe
(
ds1_idx
, 
x1
, 
y1
, & 
dummy
, & 
max_y
);

2196 
x1
 = 
px
 + 
glb_c⁄fig
.
s¸ìn
.
width
;

2197 
	`co‹d_to_tûe
(
ds1_idx
, 
x1
, 
y1
, & 
max_x
, & 
dummy
);

2199 i‡–(
glb_ds1edô
.
mode
 =
MOD_O
) ||

2200 (
glb_ds1edô
.
mode
 =
MOD_P
) ||

2201 (
glb_ds1edô
.
mode
 =
MOD_L
) )

2203 
mö_x
 /= 5;

2204 
mö_y
 /= 5;

2205 
max_x
 /= 5;

2206 
max_y
 /= 5;

2208 i‡(
mö_x
 < 0) min_x = 0;

2209 i‡(
mö_y
 < 0) min_y = 0;

2210 i‡(
max_x
 > 
glb_ds1
[
ds1_idx
].
width
) max_x = glb_ds1[ds1_idx].width;

2211 i‡(
max_y
 > 
glb_ds1
[
ds1_idx
].
height
) max_y = glb_ds1[ds1_idx].height;

2214 
i
=
mö_x
; i <
max_x
 ; i++)

2216 
x1
 = 
ba£_x
 + 
i
 * 
tw
 / 2;

2217 
y1
 = 
ba£_y
 + 
i
 * 
th
 / 2;

2218 
x2
 = 
mx
 + 
i
 * 
tw
 / 2;

2219 
y2
 = 
my
 + 
i
 * 
th
 / 2;

2220 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
c
);

2223 
ba£_x
 = 
tw
/2 - 
px
 - 1;

2224 
ba£_y
 = - 
py
 - 1;

2225 
mx
 = 
ba£_x
 + (
tw
 * 
dw
 / 2);

2226 
my
 = 
ba£_y
 + (
th
 * 
dw
 / 2);

2227 
i
=
mö_y
; i <
max_y
 ; i++)

2229 
x1
 = 
ba£_x
 - 
i
 * 
tw
 / 2;

2230 
y1
 = 
ba£_y
 + 
i
 * 
th
 / 2;

2231 
x2
 = 
mx
 - 
i
 * 
tw
 / 2;

2232 
y2
 = 
my
 + 
i
 * 
th
 / 2;

2233 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y1
, 
x2
, 
y2
, 
c
);

2235 
	}
}

2240 
	$w¥evõw_døw_tûes
(
ds1_idx
)

2242 
x
, 
y
, 
ba£_x
 = 0, 
ba£_y
 = 0, 
mx
, 
my
;

2243 
cx
, 
cy
, 
dx
, 
dy
, 
z
, 
x1
, 
x2
, 
x3
, 
x4
, 
y1
, 
y2
, 
y3
, 
i
, 
£À˘
;

2244 
ﬁd_∑l
 = -1;

2245 * 
mode
;

2246 
UBYTE
 
wÆköfo
[25];

2247 
objdøw_cur_idx
 = 0;

2248 (* 
Âå_wi
Ë(, , , 
UBYTE
 *);

2249 
PATH_EDIT_WIN_S
 * 
pwö
 = & 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
;

2252 
z
 = 
glb_ds1
[
ds1_idx
].
cur_zoom
;

2253 
	`˛ór
(
glb_ds1edô
.
s¸ìn_buff
);

2256 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

2259 i‡(
ﬁd_∑l
 !
glb_ds1
[
ds1_idx
].
a˘
 - 1)

2261 
ﬁd_∑l
 = 
glb_ds1
[
ds1_idx
].
a˘
 - 1;

2262 
	`£t_∑Àâe
(
glb_ds1edô
.
vga_∑l
[
ﬁd_∑l
]);

2268 i‡(
ﬁd_∑l
 !
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 - 1)

2270 
ﬁd_∑l
 = 
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 - 1;

2271 
	`£t_∑Àâe
(
glb_ds1edô
.
vga_∑l
[
ﬁd_∑l
]);

2276 
	`mou£_to_tûe
(
ds1_idx
, &
cx
, &
cy
);

2277 i‡(
glb_ds1edô
.
mode
 =
MOD_T
)

2279 i‡(
cx
 < 0)

2280 
cx
 = 0;

2281 i‡(
cx
 >
glb_ds1
[
ds1_idx
].
width
)

2282 
cx
 = 
glb_ds1
[
ds1_idx
].
width
 - 1;

2283 i‡(
cy
 < 0)

2284 
cy
 = 0;

2285 i‡(
cy
 >
glb_ds1
[
ds1_idx
].
height
)

2286 
cy
 = 
glb_ds1
[
ds1_idx
].
height
 - 1;

2293 
cx
 -= 2;

2294 
cy
 += 2;

2299 i‡(
glb_ds1edô
.
mode
 !
MOD_P
)

2301 i‡(
cx
 < 0)

2302 
cx
 = 0;

2303 i‡(
cx
 >
glb_ds1
[
ds1_idx
].
width
 * 5 - 1)

2304 
cx
 = 
glb_ds1
[
ds1_idx
].
width
 * 5 - 1;

2305 i‡(
cy
 < 0)

2306 
cy
 = 0;

2307 i‡(
cy
 >
glb_ds1
[
ds1_idx
].
height
 * 5 - 1)

2308 
cy
 = 
glb_ds1
[
ds1_idx
].
height
 * 5 - 1;

2313 i‡(
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
 == 1)

2315 
	`w¥evõw_obj_™im©e
();

2319 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

2321 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2322 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2323 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

2325 
£À˘
 = 
FALSE
;

2326 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

2327 
£À˘
 = 
TRUE
;

2328 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2329 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
Ë&& (mx < glb_ds1edô.wö_¥evõw.x0 + glb_ds1edô.wö_¥evõw.
w
))

2331 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2332 
	`w¥evõw_døw_w
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
, 
FALSE
);

2333 
	`w¥evõw_døw_f
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
);

2334 
	`w¥evõw_døw_s
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
);

2340 
objdøw_cur_idx
 = 0;

2341 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

2343 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2344 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2345 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

2347 
£À˘
 = 
FALSE
;

2348 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

2349 
£À˘
 = 
TRUE
;

2350 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2351 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

2352 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

2355 i‡(
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
)

2356 
	`w¥evõw_døw_obj_tûe_shad
(
ds1_idx
, 
x
, 
y
, & 
objdøw_cur_idx
);

2362 
objdøw_cur_idx
 = 0;

2363 i‡(
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
)

2365 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

2367 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2368 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2369 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

2371 
£À˘
 = 
FALSE
;

2372 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

2373 
£À˘
 = 
TRUE
;

2374 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2375 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
Ë&& (mx < glb_ds1edô.wö_¥evõw.x0 + glb_ds1edô.wö_¥evõw.
w
))

2378 
	`w¥evõw_døw_obj_tûe_1
(
ds1_idx
, 
x
, 
y
, & 
objdøw_cur_idx
);

2385 i‡(
glb_ds1edô
.
di•œy_tûe_grid
 =
TG_OVERFLOOR
)

2386 
	`w¥evõw_døw_tûe_grid
(
ds1_idx
);

2389 
objdøw_cur_idx
 = 0;

2390 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

2392 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2393 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2394 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

2396 
£À˘
 = 
FALSE
;

2397 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

2398 
£À˘
 = 
TRUE
;

2399 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2400 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
Ë&& (mx < glb_ds1edô.wö_¥evõw.x0 + glb_ds1edô.wö_¥evõw.
w
))

2402 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2403 
	`w¥evõw_døw_w
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
, 
TRUE
);

2406 i‡(
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
)

2407 
	`w¥evõw_døw_obj_tûe_0_2
(
ds1_idx
, 
x
, 
y
, & 
objdøw_cur_idx
);

2413 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

2415 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2416 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2417 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

2419 
£À˘
 = 
FALSE
;

2420 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

2421 
£À˘
 = 
TRUE
;

2422 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2423 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

2424 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

2426 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2427 
	`w¥evõw_døw_r
 (
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
);

2433 i‡(
glb_ds1
[
ds1_idx
].
•ecül_œyî_mask
)

2435 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

2437 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2438 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2439 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

2441 
£À˘
 = 
FALSE
;

2442 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

2443 
£À˘
 = 
TRUE
;

2444 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2445 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

2446 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

2448 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2449 
	`w¥evõw_døw_•
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
);

2456 
glb_ds1
[
ds1_idx
].
wÆkabÀ_œyî_mask
)

2458 1 : 
Âå_wi
 = 
w¥evõw_døw_sim∂e_wi
; ;

2459 2 : 
Âå_wi
 = 
w¥evõw_døw_wi
; ;

2460  : 
Âå_wi
 = 
NULL
;

2462 i‡(
Âå_wi
 !
NULL
)

2464 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

2466 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2467 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2468 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

2470 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2471 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

2472 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

2474 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2475 i‡((
my
 >
glb_ds1edô
.
wö_¥evõw
.
y0
-
glb_ds1
[
ds1_idx
].
tûe_h
) &&

2476 (
my
 < 
glb_ds1edô
.
wö_¥evõw
.
y0
 + glb_ds1edô.wö_¥evõw.
h
))

2478 
	`misc_£¨ch_wÆk_öfos
(
ds1_idx
, 
x
, 
y
, 
wÆköfo
);

2479 
	`Âå_wi
(
mx
, 
my
, 
z
, 
wÆköfo
);

2487 i‡(
glb_ds1edô
.
di•œy_tûe_grid
 =
TG_OVERWALL
)

2488 
	`w¥evõw_døw_tûe_grid
(
ds1_idx
);

2491 i‡(
glb_ds1edô
.
mode
 =
MOD_T
)

2494 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 2);

2495 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 2);

2497 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

2498 
x2
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2 - 1;

2499 
x3
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2500 
x4
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 - 1;

2502 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
;

2503 
y2
 = 
y1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2 - 1;

2504 
y3
 = 
y1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 - 2;

2506 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y2
, 
x2
, 
y1
, 129);

2507 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x3
, 
y1
, 
x4
, 
y2
, 129);

2508 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x3
, 
y3
, 
x4
, 
y2
, 129);

2509 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y2
, 
x2
, 
y3
, 129);

2516 
cx
 += 2;

2517 
cy
 -= 2;

2520 
dx
 = (
cy
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 10Ë+ (
cx
 * glb_ds1[ds1_idx].tile_w / 10);

2521 
dy
 = (
cy
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10Ë+ (
cx
 * glb_ds1[ds1_idx].tile_h / 10);

2524 
cx
 -= 2;

2525 
cy
 += 2;

2527 
x1
 = 
dx
 - 
glb_ds1edô
.
wö_¥evõw
.
x0
;

2528 
x2
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 10 - 1;

2529 
x3
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 10;

2530 
x4
 = 
x1
 + 
glb_ds1
[
ds1_idx
].
tûe_w
 / 5 - 1;

2532 
y1
 = 
dy
 - 
glb_ds1edô
.
wö_¥evõw
.
y0
;

2533 
y2
 = 
y1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 10 - 1;

2534 
y3
 = 
y1
 + 
glb_ds1
[
ds1_idx
].
tûe_h
 / 5 - 2;

2536 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y2
, 
x2
, 
y1
, 129);

2537 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x3
, 
y1
, 
x4
, 
y2
, 129);

2538 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x3
, 
y3
, 
x4
, 
y2
, 129);

2539 
	`löe
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
, 
y2
, 
x2
, 
y3
, 129);

2543 i‡(
glb_ds1edô
.
mode
 =
MOD_P
)

2544 
	`w¥evõw_døw_∑ths_1obj
(
ds1_idx
, 
pwö
->
obj_idx
);

2545 i‡(
glb_ds1
[
ds1_idx
].
∑ths_œyî_mask
)

2546 
	`w¥evõw_døw_∑ths
(
ds1_idx
);

2549 i‡(
glb_ds1edô
.
mode
 =
MOD_O
)

2551 
	`edôobj_døw_obj_œb
(
ds1_idx
, 
TRUE
);

2552 
	`edôobj_døw_obj_œb
(
ds1_idx
, 
FALSE
);

2553 i‡(
glb_ds1
[
ds1_idx
].
døw_edô_obj
)

2554 
	`edôobj_døw_edô_obj
(
ds1_idx
);

2556 i‡(
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
 !
OL_NONE
)

2557 
	`w¥evõw_døw_obje˘s
(
ds1_idx
);

2560 i‡(
glb_ds1edô
.
mode
 =
MOD_P
)

2562 
	`edô∑th_døw
(
ds1_idx
, 
mou£_x
, 
mou£_y
, 
mou£_b
, 
cx
, 
cy
);

2566 i‡((
glb_ds1
[
ds1_idx
].
wÆkabÀ_œyî_mask
 == 2) &&

2567 (
glb_ds1
[
ds1_idx
].
subtûe_hñp_di•œy
))

2569 
x1
 = 
glb_ds1edô
.
s¸ìn_buff
->
w
 - glb_ds1edô.
subtûe_hñp
->w - 10;

2570 
x2
 = 
x1
 + 
glb_ds1edô
.
subtûe_hñp
->
w
;

2571 
y1
 = 
glb_ds1edô
.
s¸ìn_buff
->
h
 - glb_ds1edô.
subtûe_hñp
->h - 20;

2572 
y2
 = 
y1
 + 
glb_ds1edô
.
subtûe_hñp
->
h
;

2573 
	`blô
(
glb_ds1edô
.
subtûe_hñp
, glb_ds1edô.
s¸ìn_buff
,

2574 0, 0, 
x1
, 
y1
, 
x2
, 
y2
);

2575 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
-1, 
y1
-1, 
x2
+1, 
y2
+1, 255);

2579 i‡(
glb_ds1edô
.
show_2nd_row
 =
TRUE
)

2581 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 0, 0, 
glb_c⁄fig
.
s¸ìn
.
width
, 19, 0);

2582 
	`hlöe
(
glb_ds1edô
.
s¸ìn_buff
, 0, 9, 
glb_c⁄fig
.
s¸ìn
.
width
, 29);

2583 
	`hlöe
(
glb_ds1edô
.
s¸ìn_buff
, 0, 20, 
glb_c⁄fig
.
s¸ìn
.
width
, 255);

2586 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 0, 11, 255, "Set:");

2587 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 32, 11, 109, "%i", glb_ds1edô.
ds1_group_idx
 + 1);

2589 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 65, 11, 255, "Ds1Index:");

2590 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 137, 11, 109, "%i", 
ds1_idx
 + 1);

2592 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 175, 11, 255, "File:");

2593 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 215, 11, 109, "%s", 
glb_ds1
[
ds1_idx
].
«me
);

2597 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 0, 0, 
glb_c⁄fig
.
s¸ìn
.
width
, 8, 0);

2598 
	`hlöe
(
glb_ds1edô
.
s¸ìn_buff
, 0, 9, 
glb_c⁄fig
.
s¸ìn
.
width
, 255);

2602 
	`ª˘fûl
(
glb_ds1edô
.
s¸ìn_buff
, 0, 
glb_c⁄fig
.
s¸ìn
.
height
-9, glb_c⁄fig.s¸ìn.
width
, glb_config.screen.height, 0);

2603 
	`hlöe
(
glb_ds1edô
.
s¸ìn_buff
, 0, 
glb_c⁄fig
.
s¸ìn
.
height
-10, glb_c⁄fig.s¸ìn.
width
, 255);

2606 
	`ãxt_mode
(-1);

2609 
i
=0; i < 
glb_ds1
[
ds1_idx
].
Êo‹_num
; i++)

2611 i‡(
glb_ds1
[
ds1_idx
].
Êo‹_œyî_mask
[
i
] == 0)

2612 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 20*
i
, 0, 98, "f%i", i+1);

2614 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 20*
i
, 0, 132, "f%i", i+1);

2618 
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
)

2621 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 50, 0, 98, "anims");

2625 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 50, 0, 132, "anims");

2629 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 50, 0, 108, "anims");

2634 
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
)

2636 
OL_NONE
 :

2637 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 100, 0, 98, "obj");

2640 
OL_TYPEID
 :

2641 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 100, 0, 210, "obj");

2644 
OL_SPEED
 :

2645 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 100, 0, 108, "obj");

2648 
OL_DESC
 :

2649 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 100, 0, 132, "obj");

2657 
glb_ds1
[
ds1_idx
].
•ecül_œyî_mask
)

2660 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 240, 0, 98, "spl");

2664 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 240, 0, 132, "spl");

2669 
i
=0; i < 
glb_ds1
[
ds1_idx
].
wÆl_num
; i++)

2671 i‡(
glb_ds1
[
ds1_idx
].
wÆl_œyî_mask
[
i
] == 0)

2672 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 140+20*
i
, 0, 98, "w%i", i+1);

2674 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 140+20*
i
, 0, 132, "w%i", i+1);

2678 i‡(
glb_ds1
[
ds1_idx
].
∑ths_œyî_mask
 == 0)

2679 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 280, 0, 98, "path");

2681 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 280, 0, 132, "path");

2684 
glb_ds1
[
ds1_idx
].
shadow_œyî_mask
[0])

2687 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 340, 0, 210, "shad");

2691 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 340, 0, 255, "shad");

2695 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 340, 0, 132, "shad");

2699 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 340, 0, 98, "shad");

2707 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 390, 0, 255, "zoom=%i:%i",

2708 
glb_ds1
[
ds1_idx
].
height_mul
, glb_ds1[ds1_idx].
height_div
);

2711 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 490, 0, 255, "gamma=%s",

2712 
glb_gamma_°r
[
glb_ds1edô
.
cur_gamma
].
°r
);

2715 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 606, 0, 109, "%s",

2716 
glb_ds1
[
ds1_idx
].
fûíame
);

2719 i‡(
glb_ds1edô
.
mode
 =
MOD_T
)

2722 
	`ãxçrötf
(

2723 
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 0, 
glb_c⁄fig
.
s¸ìn
.
height
-8, 255,

2725 
cx
, 
cy


2731 
	`ãxçrötf
(

2732 
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 0, 
glb_c⁄fig
.
s¸ìn
.
height
-8, 255,

2734 
cx
, 
cy


2739 
	`ãxçrötf
(

2740 
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
, 
glb_c⁄fig
.
s¸ìn
.
width
-80, 0, 255,

2742 
glb_ds1edô
.
ﬁd_Âs


2746 
	`ãxçrötf
(

2747 
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

2748 
glb_c⁄fig
.
s¸ìn
.
width
-168, glb_c⁄fig.s¸ìn.
height
-8,

2751 
glb_ds1edô
.
cuºít_ª‰esh_øã


2755 
	`ãxçrötf
(

2756 
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

2757 200, 
glb_c⁄fig
.
s¸ìn
.
height
-8,

2760 
glb_ds1
[
ds1_idx
].
obj_num
,

2761 
glb_ds1
[
ds1_idx
].
cuºít_obj_max


2765 
glb_ds1edô
.
mode
)

2767 
MOD_T
 : 
mode
 = "Tiles "; ;

2768 
MOD_O
 : 
mode
 = "Objects"; ;

2769 
MOD_P
 : 
mode
 = "Paths "; ;

2771 
MOD_L
 : i‡(
glb_ds1edô
.
night_mode
 == 0)

2772 
mode
 = "Night 1";

2774 
mode
 = "Night 2";

2777  : 
mode
 = "? "; ;

2779 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

2780 
glb_c⁄fig
.
s¸ìn
.
width
-112, glb_c⁄fig.s¸ìn.
height
-8, 255, "Mode :");

2781 
	`ãxçrötf
(
glb_ds1edô
.
s¸ìn_buff
, 
f⁄t
,

2782 
glb_c⁄fig
.
s¸ìn
.
width
-56, glb_c⁄fig.s¸ìn.
height
-8, 108, "%s", 
mode
);

2794 
	`misc_døw_s¸ìn
(
mou£_x
, 
mou£_y
);

2796 
	`w¥evõw_ªiöô_™im©ed_Êo‹
(
ds1_idx
);

2797 
	}
}

2802 
	$w¥evõw_døw_tûes_big_s¸ìnshŸ
(
ds1_idx
)

2804 
x
, 
y
, 
ba£_x
 = 0, 
ba£_y
 = 0, 
mx
, 
my
;

2805 
cx
, 
cy
, 
z
, 
x1
, 
x2
, 
y1
, 
y2
, 
£À˘
;

2806 
ﬁd_∑l
 = -1;

2807 
UBYTE
 
wÆköfo
[25];

2808 
objdøw_cur_idx
 = 0;

2809 (* 
Âå_wi
Ë(, , , 
UBYTE
 *);

2810 
PATH_EDIT_WIN_S
 * 
pwö
 = & 
glb_ds1
[
ds1_idx
].
∑th_edô_wö
;

2812 
möx
, 
möy
, 
maxx
, 
maxy
, 
tmpw
, 
tmph
;

2813 
BLOCK_TABLE_S
 * 
bt_±r
;

2814 
BITMAP
 * 
tmp_bmp
;

2815 
CELL_S_S
 * 
s_±r
;

2816 
CELL_F_S
 * 
f_±r
;

2817 
CELL_W_S
 * 
w_±r
;

2818 
n
, 
t
, 
bt_idx
, 
dt1_idx
, 
block_idx
;

2819 
ﬁd_s¸ìn_width
, 
ﬁd_s¸ìn_height
,

2820 
ﬁd_s¸ìn_x0
, 
ﬁd_s¸ìn_y0
;

2823 
z
 = 
glb_ds1
[
ds1_idx
].
cur_zoom
;

2826 
möx
 = 
möy
 = 0x7FFFFFFFLU;

2827 
maxx
 = 
maxy
 = 0x80000000LU;

2830 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

2832 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2833 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2834 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

2836 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

2837 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

2840 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
shadow_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
shadow_num
);

2841 
s_±r
 = 
glb_ds1
[
ds1_idx
].
shadow_buff
 + 
t
;

2842 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
shadow_num
;Ç++)

2844 
bt_idx
 = 
s_±r
[
n
].bt_idx;

2846 i‡(
s_±r
[
n
].
¥›4
 & 0x80)

2847 
bt_idx
 = -1;

2849 i‡(
bt_idx
 != -1)

2851 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

2853 i‡(
bt_±r
->
ty≥
 !
BT_SHADOW
)

2856 
dt1_idx
 = 
bt_±r
->dt1_idx;

2857 
block_idx
 = 
bt_±r
->block_idx;

2859 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

2861 i‡(
tmp_bmp
 =
NULL
)

2864 
y1
 = 
my
 -

2865 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

2866 
y1
 +
glb_ds1
[
ds1_idx
].
tûe_h
;

2868 
y2
 = 
y1
 + 
tmp_bmp
->
h
;

2869 
x1
 = 
mx
;

2870 
x2
 = 
x1
 + 
tmp_bmp
->
w
;

2871 i‡(
x1
 < 
möx
)

2872 
möx
 = 
x1
;

2873 i‡(
x2
 > 
maxx
)

2874 
maxx
 = 
x2
;

2875 i‡(
y1
 < 
möy
)

2876 
möy
 = 
y1
;

2877 i‡(
y2
 > 
maxy
)

2878 
maxy
 = 
y2
;

2883 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
Êo‹_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
Êo‹_num
);

2884 
f_±r
 = 
glb_ds1
[
ds1_idx
].
Êo‹_buff
 + 
t
;

2885 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
Êo‹_num
;Ç++)

2887 
bt_idx
 = 
f_±r
[
n
].bt_idx;

2889 i‡(
bt_idx
 != -1)

2891 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

2893 i‡((
bt_±r
->
ty≥
 !
BT_STATIC
Ë&& (bt_±r->ty≥ !
BT_ANIMATED
))

2896 
dt1_idx
 = 
bt_±r
->dt1_idx;

2897 
block_idx
 = 
bt_±r
->block_idx;

2899 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

2901 i‡(
tmp_bmp
 =
NULL
)

2904 
y1
 = 
my
 -

2905 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

2906 
y2
 = 
y1
 + 
tmp_bmp
->
h
;

2907 
x1
 = 
mx
;

2908 
x2
 = 
x1
 + 
tmp_bmp
->
w
;

2909 i‡(
x1
 < 
möx
)

2910 
möx
 = 
x1
;

2911 i‡(
x2
 > 
maxx
)

2912 
maxx
 = 
x2
;

2913 i‡(
y1
 < 
möy
)

2914 
möy
 = 
y1
;

2915 i‡(
y2
 > 
maxy
)

2916 
maxy
 = 
y2
;

2921 
t
 = (
y
 * 
glb_ds1
[
ds1_idx
].
wÆl_löe
Ë+ (
x
 * glb_ds1[ds1_idx].
wÆl_num
);

2922 
w_±r
 = 
glb_ds1
[
ds1_idx
].
wÆl_buff
 + 
t
;

2923 
n
=0;Ç<
glb_ds1
[
ds1_idx
].
wÆl_num
;Ç++)

2925 
bt_idx
 = 
w_±r
[
n
].bt_idx;

2927 i‡(
bt_idx
 != -1)

2929 
bt_±r
 = 
glb_ds1
[
ds1_idx
].
block_èbÀ
 + 
bt_idx
;

2931 i‡–(
bt_±r
->
ty≥
 !
BT_WALL_UP
) &&

2932 (
bt_±r
->
ty≥
 !
BT_WALL_DOWN
) &&

2933 (
bt_±r
->
ty≥
 !
BT_ROOF
) &&

2934 (
bt_±r
->
ty≥
 !
BT_SPECIAL
) &&

2935 (
bt_±r
->
ty≥
 !
BT_WALL_ANIMATED
)

2941 
dt1_idx
 = 
bt_±r
->dt1_idx;

2942 
block_idx
 = 
bt_±r
->block_idx;

2944 
tmp_bmp
 = * (
glb_dt1
[
dt1_idx
].
block_zoom
[
z
] + 
block_idx
);

2946 i‡(
tmp_bmp
 =
NULL
)

2949 
y1
 = 
my
 -

2950 
bt_±r
->
zîo_löe
 * 
glb_ds1
[
ds1_idx
].
height_mul
 / glb_ds1[ds1_idx].
height_div
;

2951 
y1
 +
glb_ds1
[
ds1_idx
].
tûe_h
;

2953 
y2
 = 
y1
 + 
tmp_bmp
->
h
;

2954 
x1
 = 
mx
;

2955 
x2
 = 
x1
 + 
tmp_bmp
->
w
;

2956 i‡(
x1
 < 
möx
)

2957 
möx
 = 
x1
;

2958 i‡(
x2
 > 
maxx
)

2959 
maxx
 = 
x2
;

2960 i‡(
y1
 < 
möy
)

2961 
möy
 = 
y1
;

2962 i‡(
y2
 > 
maxy
)

2963 
maxy
 = 
y2
;

2970 
tmpw
 = 
maxx
 - 
möx
;

2971 
tmph
 = 
maxy
 - 
möy
;

2979 i‡((
tmpw
 <0Ë|| (
tmph
 <= 0))

2981 
tmp_bmp
 = 
	`¸óã_bôm≠_ex
(8, 
tmpw
, 
tmph
);

2982 i‡(
tmp_bmp
 =
NULL
)

2986 
glb_ds1edô
.
s¸ìn_buff
 = 
tmp_bmp
;

2988 
ﬁd_s¸ìn_width
 = 
glb_ds1edô
.
wö_¥evõw
.
w
;

2989 
ﬁd_s¸ìn_height
 = 
glb_ds1edô
.
wö_¥evõw
.
h
;

2990 
ﬁd_s¸ìn_x0
 = 
glb_ds1edô
.
wö_¥evõw
.
x0
;

2991 
ﬁd_s¸ìn_y0
 = 
glb_ds1edô
.
wö_¥evõw
.
y0
;

2993 
glb_ds1edô
.
wö_¥evõw
.
w
 = 
tmpw
;

2994 
glb_ds1edô
.
wö_¥evõw
.
h
 = 
tmph
;

2995 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
möx
;

2996 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
möy
;

2997 
glb_c⁄fig
.
s¸ìn
.
width
 = 
tmpw
;

2998 
glb_c⁄fig
.
s¸ìn
.
height
 = 
tmph
;

3001 
	`˛ór
(
glb_ds1edô
.
s¸ìn_buff
);

3004 i‡(
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 == -1)

3007 i‡(
ﬁd_∑l
 !
glb_ds1
[
ds1_idx
].
a˘
 - 1)

3009 
ﬁd_∑l
 = 
glb_ds1
[
ds1_idx
].
a˘
 - 1;

3010 
	`£t_∑Àâe
(
glb_ds1edô
.
vga_∑l
[
ﬁd_∑l
]);

3016 i‡(
ﬁd_∑l
 !
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 - 1)

3018 
ﬁd_∑l
 = 
glb_ds1edô
.
cmd_löe
.
f‹˚_∑l_num
 - 1;

3019 
	`£t_∑Àâe
(
glb_ds1edô
.
vga_∑l
[
ﬁd_∑l
]);

3024 
cx
 = 
cy
 = -1;

3027 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

3029 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3030 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3031 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

3033 
£À˘
 = 
FALSE
;

3034 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

3035 
£À˘
 = 
TRUE
;

3036 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3037 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

3038 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

3040 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3041 
	`w¥evõw_døw_w
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
, 
FALSE
);

3042 
	`w¥evõw_døw_f
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
);

3043 
	`w¥evõw_døw_s
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
);

3049 
objdøw_cur_idx
 = 0;

3050 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

3052 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3053 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3054 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

3056 
£À˘
 = 
FALSE
;

3057 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

3058 
£À˘
 = 
TRUE
;

3059 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3060 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

3061 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

3064 i‡(
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
)

3065 
	`w¥evõw_døw_obj_tûe_shad
(
ds1_idx
, 
x
, 
y
, & 
objdøw_cur_idx
);

3071 
objdøw_cur_idx
 = 0;

3072 i‡(
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
)

3074 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

3076 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3077 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3078 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

3080 
£À˘
 = 
FALSE
;

3081 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

3082 
£À˘
 = 
TRUE
;

3083 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3084 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

3085 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

3088 
	`w¥evõw_døw_obj_tûe_1
(
ds1_idx
, 
x
, 
y
, & 
objdøw_cur_idx
);

3095 
objdøw_cur_idx
 = 0;

3096 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

3098 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3099 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3100 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

3102 
£À˘
 = 
FALSE
;

3103 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

3104 
£À˘
 = 
TRUE
;

3105 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3106 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

3107 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

3109 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3110 
	`w¥evõw_døw_w
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
, 
TRUE
);

3113 i‡(
glb_ds1
[
ds1_idx
].
™im©i⁄s_œyî_mask
)

3114 
	`w¥evõw_døw_obj_tûe_0_2
(
ds1_idx
, 
x
, 
y
, & 
objdøw_cur_idx
);

3120 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

3122 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3123 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3124 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

3126 
£À˘
 = 
FALSE
;

3127 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

3128 
£À˘
 = 
TRUE
;

3129 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3130 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

3131 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

3133 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3134 
	`w¥evõw_døw_r
 (
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
);

3140 i‡(
glb_ds1
[
ds1_idx
].
•ecül_œyî_mask
)

3142 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

3144 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3145 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3146 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

3148 
£À˘
 = 
FALSE
;

3149 i‡((
glb_ds1edô
.
mode
 =
MOD_T
Ë&& (
x
==
cx
Ë&& (
y
==
cy
))

3150 
£À˘
 = 
TRUE
;

3151 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3152 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

3153 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

3155 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3156 
	`w¥evõw_døw_•
(
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘
);

3163 
glb_ds1
[
ds1_idx
].
wÆkabÀ_œyî_mask
)

3165 1 : 
Âå_wi
 = 
w¥evõw_døw_sim∂e_wi
; ;

3166 2 : 
Âå_wi
 = 
w¥evõw_døw_wi
; ;

3167  : 
Âå_wi
 = 
NULL
;

3169 i‡(
Âå_wi
 !
NULL
)

3171 
y
=0; y<
glb_ds1
[
ds1_idx
].
height
; y++)

3173 
ba£_x
 = 
y
 * -
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3174 
ba£_y
 = 
y
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3175 
x
=0; x<
glb_ds1
[
ds1_idx
].
width
; x++)

3177 
mx
 = 
ba£_x
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_w
 / 2;

3178 i‡((
mx
 >
glb_ds1edô
.
wö_¥evõw
.
x0
-
glb_ds1
[
ds1_idx
].
tûe_w
) &&

3179 (
mx
 < 
glb_ds1edô
.
wö_¥evõw
.
x0
 + glb_ds1edô.wö_¥evõw.
w
))

3181 
my
 = 
ba£_y
 + 
x
 * 
glb_ds1
[
ds1_idx
].
tûe_h
 / 2;

3182 i‡((
my
 >
glb_ds1edô
.
wö_¥evõw
.
y0
-
glb_ds1
[
ds1_idx
].
tûe_h
) &&

3183 (
my
 < 
glb_ds1edô
.
wö_¥evõw
.
y0
 + glb_ds1edô.wö_¥evõw.
h
))

3185 
	`misc_£¨ch_wÆk_öfos
(
ds1_idx
, 
x
, 
y
, 
wÆköfo
);

3186 
	`Âå_wi
(
mx
, 
my
, 
z
, 
wÆköfo
);

3194 i‡(
glb_ds1edô
.
di•œy_tûe_grid
 =
TRUE
)

3195 
	`w¥evõw_døw_tûe_grid
(
ds1_idx
);

3198 i‡(
glb_ds1edô
.
mode
 =
MOD_P
)

3199 
	`w¥evõw_døw_∑ths_1obj
(
ds1_idx
, 
pwö
->
obj_idx
);

3200 i‡(
glb_ds1
[
ds1_idx
].
∑ths_œyî_mask
)

3201 
	`w¥evõw_døw_∑ths
(
ds1_idx
);

3204 i‡(
glb_ds1edô
.
mode
 =
MOD_O
)

3206 
	`edôobj_døw_obj_œb
(
ds1_idx
, 
TRUE
);

3207 
	`edôobj_døw_obj_œb
(
ds1_idx
, 
FALSE
);

3208 i‡(
glb_ds1
[
ds1_idx
].
døw_edô_obj
)

3209 
	`edôobj_døw_edô_obj
(
ds1_idx
);

3211 i‡(
glb_ds1
[
ds1_idx
].
obje˘s_œyî_mask
 !
OL_NONE
)

3212 
	`w¥evõw_døw_obje˘s
(
ds1_idx
);

3215 i‡(
glb_ds1edô
.
mode
 =
MOD_P
)

3217 
	`edô∑th_døw
(
ds1_idx
, 
mou£_x
, 
mou£_y
, 
mou£_b
, 
cx
, 
cy
);

3221 i‡((
glb_ds1
[
ds1_idx
].
wÆkabÀ_œyî_mask
 == 2) &&

3222 (
glb_ds1
[
ds1_idx
].
subtûe_hñp_di•œy
))

3224 
x1
 = 
glb_ds1edô
.
s¸ìn_buff
->
w
 - glb_ds1edô.
subtûe_hñp
->w - 10;

3225 
x2
 = 
x1
 + 
glb_ds1edô
.
subtûe_hñp
->
w
;

3226 
y1
 = 
glb_ds1edô
.
s¸ìn_buff
->
h
 - glb_ds1edô.
subtûe_hñp
->h - 20;

3227 
y2
 = 
y1
 + 
glb_ds1edô
.
subtûe_hñp
->
h
;

3228 
	`blô
(
glb_ds1edô
.
subtûe_hñp
, glb_ds1edô.
s¸ìn_buff
,

3229 0, 0, 
x1
, 
y1
, 
x2
, 
y2
);

3230 
	`ª˘
(
glb_ds1edô
.
s¸ìn_buff
, 
x1
-1, 
y1
-1, 
x2
+1, 
y2
+1, 255);

3233 
glb_ds1edô
.
wö_¥evõw
.
w
 = 
ﬁd_s¸ìn_width
;

3234 
glb_ds1edô
.
wö_¥evõw
.
h
 = 
ﬁd_s¸ìn_height
;

3235 
glb_ds1edô
.
wö_¥evõw
.
x0
 = 
ﬁd_s¸ìn_x0
;

3236 
glb_ds1edô
.
wö_¥evõw
.
y0
 = 
ﬁd_s¸ìn_y0
;

3237 
glb_c⁄fig
.
s¸ìn
.
width
 = 
ﬁd_s¸ìn_width
;

3238 
glb_c⁄fig
.
s¸ìn
.
height
 = 
ﬁd_s¸ìn_height
;

3241 
	}
}

3243 #ifde‡
WIN32


3244 #¥agm®
w¨nög
 (
p›
)

	@wpreview.h

1 #i‚de‡
_WPREVIEW_H_


3 
	#_WPREVIEW_H_


	)

5 
w¥evõw_sh≠e
 (
BITMAP
 * 
tmp_bmp
, 
x0
, 
y0
, 
ds1_idx
, 
COL_E
 
cﬁ_idx
);

6 
w¥evõw_gouøud_f
 (
BITMAP
 * 
tmp_bmp
, 
x0
, 
y0
, 
ds1_idx
, 
c1
, 
c2
, 
c3
, 
c4
);

7 
w¥evõw_gouøud_w
 (
BITMAP
 * 
tmp_bmp
, 
x0
, 
y0
, 
ds1_idx
, 
c1
, 
c2
, 
c3
, 
c4
);

8 
w¥evõw_light_di°
 (
x0
, 
y0
, 
mx
, 
my
);

9 
qs‹t_hñ≥r_‹dî_d©a
 (c⁄° *
e1
, c⁄° *
e2
);

10 
w¥evõw_døw_s
 (
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘ed
);

11 
w¥evõw_døw_f
 (
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘ed
);

12 
w¥evõw_døw_w
 (
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘ed
, 
uµî
);

13 
w¥evõw_døw_r
 (
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘ed
);

14 
w¥evõw_døw_•
 (
ds1_idx
, 
x
, 
y
, 
mx
, 
my
, 
z
, 
£À˘ed
);

15 
co‹d_to_tûe
 (
ds1_idx
, 
ax
, 
ay
, * 
œyî_x
, * 
œyî_y
);

16 
mou£_to_tûe
 (
ds1_idx
, * 
œyî_x
, * 
œyî_y
);

17 
ch™ge_zoom
 (
ds1_idx
, 
ZOOM_E
 
z
);

18 
w¥evõw_døw_∑ths
 (
ds1_idx
);

19 
w¥evõw_døw_∑ths_1obj
 (
ds1_idx
, 
o
);

20 
w¥evõw_obj_™im©e
 ();

21 
w¥evõw_døw_obje˘s
 (
ds1_idx
);

22 
w¥evõw_døw_sim∂e_wi
 (
mx
, 
my
, 
z
, 
UBYTE
 * 
wÆköfo
);

23 
w¥evõw_døw_wi
 (
mx
, 
my
, 
z
, 
UBYTE
 * 
wÆköfo
);

24 
w¥evõw_døw_™_obje˘
 (
ds1_idx
, 
o
);

25 
w¥evõw_døw_™_obje˘_shad
 (
ds1_idx
, 
o
);

26 
w¥evõw_døw_obj_tûe_shad
 (
ds1_idx
, 
x
, 
y
, * 
cur_idx
);

27 
w¥evõw_døw_obj_tûe_0_2
 (
ds1_idx
, 
x
, 
y
, * 
cur_idx
);

28 
w¥evõw_døw_obj_tûe_1
 (
ds1_idx
, 
x
, 
y
, * 
cur_idx
);

29 
w¥evõw_døw_tûes
 (
ds1_idx
);

30 
w¥evõw_ªiöô_™im©ed_Êo‹
 (
ds1_idx
);

31 
w¥evõw_døw_tûes_big_s¸ìnshŸ
 (
ds1_idx
);

	@
1
.
0
61
624
anim.c
anim.h
animdata.c
animdata.h
dc6info.c
dc6info.h
dccinfo.c
dccinfo.h
ds1misc.c
ds1misc.h
ds1save.c
ds1save.h
dt1_draw.c
dt1_draw.h
dt1misc.c
dt1misc.h
editobj.c
editobj.h
editpath.c
editpath.h
edittile.c
edittile.h
error.c
error.h
gfx_custom.c
gfx_custom.h
inicreat.c
inicreat.h
iniread.c
iniread.h
interfac.c
interfac.h
main.c
misc.c
misc.h
mpq/dcl_tbl.c
mpq/dclib.h
mpq/explode.c
mpq/mpqtypes.h
mpq/mpqview.c
mpq/mpqview.h
mpq/wav_unp.c
mpq/wav_unp.h
msg_quit.c
msg_quit.h
msg_save.c
msg_save.h
structs.h
txtread.c
txtread.h
types.h
undo.c
undo.h
wbits.c
wbits.h
wedit.c
wedit.h
wmsg.c
wmsg.h
wpreview.c
wpreview.h
